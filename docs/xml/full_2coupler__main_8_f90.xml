<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.14">
  <compounddef id="full_2coupler__main_8_f90" kind="file" language="Fortran">
    <compoundname>coupler_main.F90</compoundname>
    <innernamespace refid="namespaceomp__lib">omp_lib</innernamespace>
      <sectiondef kind="func">
      <memberdef kind="function" id="full_2coupler__main_8_f90_1ae6938ccf85d88f9b7127a81ce195bad2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>program</type>
        <definition>program coupler_main</definition>
        <argsstring></argsstring>
        <name>coupler_main</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="exception"><parameteritem>
<parameternamelist>
<parametername>FATAL</parametername>
<parametername>no namelist value for current_date</parametername>
</parameternamelist>
<parameterdescription>
<para>A namelist value for current_date must be given if no restart file for coupler_main (INPUT/coupler.res) is found. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FATAL</parametername>
<parametername>invalid namelist value for calendar</parametername>
</parameternamelist>
<parameterdescription>
<para>The value of calendar must be &apos;gregorian&apos;, &apos;julian&apos;, &apos;noleap&apos;, or &apos;thirty_day&apos;. See the namelist documentation. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FATAL</parametername>
<parametername>no namelist value for calendar</parametername>
</parameternamelist>
<parameterdescription>
<para>If no restart file is present, then a namelist value for calendar must be specified. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FATAL</parametername>
<parametername>initial time is greater than current time</parametername>
</parameternamelist>
<parameterdescription>
<para>If a restart file is present, then the namelist value for either current_date or start_date was incorrectly set. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FATAL</parametername>
<parametername>run length must be multiple of ocean time step</parametername>
</parameternamelist>
<parameterdescription>
<para>There must be an even number of ocean time steps for the requested run length. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FATAL</parametername>
<parametername>final time does not match expected ending time</parametername>
</parameternamelist>
<parameterdescription>
<para>This error should probably not occur because of checks done at initialization time. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="full/coupler_main.F90" line="332" column="1" bodyfile="full/coupler_main.F90" bodystart="332" bodyend="-1"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
<para>Main driver program for full coupler. Provides the capability to couple component models (atmosphere, land, sea ice, and ocean). </para>    </briefdescription>
    <detaileddescription>
<para>Please see the <ulink url="index.html"><bold>main page</bold></ulink> for additional information. </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">!***********************************************************************</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">!*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GNU<sp/>Lesser<sp/>General<sp/>Public<sp/>License</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">!*</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>This<sp/>file<sp/>is<sp/>part<sp/>of<sp/>the<sp/>GFDL<sp/>Flexible<sp/>Modeling<sp/>System<sp/>(FMS)<sp/>Coupler.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="comment">!*</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>FMS<sp/>Coupler<sp/>is<sp/>free<sp/>software:<sp/>you<sp/>can<sp/>redistribute<sp/>it<sp/>and/or<sp/>modify</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>it<sp/>under<sp/>the<sp/>terms<sp/>of<sp/>the<sp/>GNU<sp/>Lesser<sp/>General<sp/>Public<sp/>License<sp/>as</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>published<sp/>by<sp/>the<sp/>Free<sp/>Software<sp/>Foundation,<sp/>either<sp/>version<sp/>3<sp/>of<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>License,<sp/>or<sp/>(at<sp/>your<sp/>option)<sp/>any<sp/>later<sp/>version.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="comment">!*</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>FMS<sp/>Coupler<sp/>is<sp/>distributed<sp/>in<sp/>the<sp/>hope<sp/>that<sp/>it<sp/>will<sp/>be<sp/>useful,<sp/>but</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>WITHOUT<sp/>ANY<sp/>WARRANTY;<sp/>without<sp/>even<sp/>the<sp/>implied<sp/>warranty<sp/>of</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>MERCHANTABILITY<sp/>or<sp/>FITNESS<sp/>FOR<sp/>A<sp/>PARTICULAR<sp/>PURPOSE.<sp/><sp/>See<sp/>the<sp/>GNU</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>General<sp/>Public<sp/>License<sp/>for<sp/>more<sp/>details.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="comment">!*</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>You<sp/>should<sp/>have<sp/>received<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>GNU<sp/>Lesser<sp/>General<sp/>Public</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>License<sp/>along<sp/>with<sp/>FMS<sp/>Coupler.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>If<sp/>not,<sp/>see<sp/>&lt;http://www.gnu.org/licenses/&gt;.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="comment">!***********************************************************************</highlight></codeline>
<codeline lineno="25"></codeline>
<codeline lineno="118"></codeline>
<codeline lineno="315"></codeline>
<codeline lineno="332"><highlight class="keyword">program</highlight><highlight class="normal"><sp/><ref refid="full_2coupler__main_8_f90_1ae6938ccf85d88f9b7127a81ce195bad2" kindref="member">coupler_main</ref></highlight></codeline>
<codeline lineno="333"><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!---<sp/>F90<sp/>module<sp/>for<sp/>OpenMP</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">omp_lib</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">fms</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod" kindref="compound">full_coupler_mod</ref></highlight></codeline>
<codeline lineno="338"><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">implicit<sp/>none</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"></highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/>type(atmos_data_type),<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/>::<sp/>atm</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/>type(land_data_type),<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/>::<sp/>land</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/>type(ice_data_type),<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/>::<sp/>ice</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>allow<sp/>members<sp/>of<sp/>ocean<sp/>type<sp/>to<sp/>be<sp/>aliased<sp/>(ap)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/>type(ocean_public_type),<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/><sp/>::<sp/>ocean</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/>type(ocean_state_type),<sp/><sp/></highlight><highlight class="keywordtype">pointer</highlight><highlight class="normal"><sp/>::<sp/>ocean_state<sp/>=&gt;<sp/>null()</highlight></codeline>
<codeline lineno="349"><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_land_boundary_type),<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/>::<sp/>Atmos_land_boundary</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_ice_boundary_type),<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/><sp/>::<sp/>Atmos_ice_boundary</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(land_ice_atmos_boundary_type),<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/><sp/>::<sp/>Land_ice_atmos_boundary</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(land_ice_boundary_type),<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/><sp/>::<sp/>Land_ice_boundary</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(ice_ocean_boundary_type),<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/>::<sp/>Ice_ocean_boundary</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(ocean_ice_boundary_type),<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/>::<sp/>Ocean_ice_boundary</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(ice_ocean_driver_type),<sp/></highlight><highlight class="keywordtype">pointer</highlight><highlight class="normal"><sp/><sp/>::<sp/>ice_ocean_driver_CS<sp/>=&gt;<sp/>null()</highlight></codeline>
<codeline lineno="357"><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsTime_type)<sp/>::<sp/>Time</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsTime_type)<sp/>::<sp/>Time_step_atmos,<sp/>Time_step_cpld</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsTime_type)<sp/>::<sp/>Time_atmos,<sp/>Time_ocean</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsTime_type)<sp/>::<sp/>Time_flux_ice_to_ocean,<sp/>Time_flux_ocean_to_ice</highlight></codeline>
<codeline lineno="362"><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>num_atmos_calls,<sp/>na</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>num_cpld_calls,<sp/>nc</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>current_timestep</highlight></codeline>
<codeline lineno="366"><highlight class="normal"></highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsNetcdfDomainFile_t),<sp/></highlight><highlight class="keywordtype">dimension(:)</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">pointer</highlight><highlight class="normal"><sp/>::<sp/>Ice_bc_restart<sp/>=&gt;<sp/>null()</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsNetcdfDomainFile_t),<sp/></highlight><highlight class="keywordtype">dimension(:)</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">pointer</highlight><highlight class="normal"><sp/>::<sp/>Ocn_bc_restart<sp/>=&gt;<sp/>null()</highlight></codeline>
<codeline lineno="369"><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsTime_type)<sp/>::<sp/>Time_restart,<sp/>Time_start,<sp/>Time_end,<sp/>Time_restart_current</highlight></codeline>
<codeline lineno="371"><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(coupler_clock_type)<sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>coupler_clocks</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(coupler_components_type),<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/>::<sp/>coupler_components_obj</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(coupler_chksum_type)<sp/><sp/><sp/><sp/><sp/>::<sp/>coupler_chksum_obj</highlight></codeline>
<codeline lineno="375"><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">allocatable</highlight><highlight class="normal"><sp/>::<sp/>ensemble_pelist(:,<sp/>:)</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">allocatable</highlight><highlight class="normal"><sp/>::<sp/>slow_ice_ocean_pelist(:)</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>conc_nthreads<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal"><sp/>::<sp/>dsec,<sp/>omp_sec(2)=0.0,<sp/>imb_sec(2)=0.0</highlight></codeline>
<codeline lineno="380"><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_init()</highlight></codeline>
<codeline lineno="382"><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/>coupler_clocks%initialization<sp/>=<sp/>fms_mpp_clock_id(<sp/></highlight><highlight class="stringliteral">&apos;Initialization&apos;</highlight><highlight class="normal"><sp/>)</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_begin(coupler_clocks%initialization)</highlight></codeline>
<codeline lineno="386"><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_init</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fmsconstants_init</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_affinity_init</highlight></codeline>
<codeline lineno="390"><highlight class="normal"></highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a492d05bed09bd21cfdfd552ad94a41a1" kindref="member">coupler_init</ref>(atm,<sp/>ocean,<sp/>land,<sp/>ice,<sp/>ocean_state,<sp/>atmos_land_boundary,<sp/>atmos_ice_boundary,<sp/>&amp;</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/>ocean_ice_boundary,<sp/>ice_ocean_boundary,<sp/>land_ice_atmos_boundary,<sp/>land_ice_boundary,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/>ice_ocean_driver_cs,<sp/>ice_bc_restart,<sp/>ocn_bc_restart,<sp/>ensemble_pelist,<sp/>slow_ice_ocean_pelist,<sp/>&amp;</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/>conc_nthreads,<sp/>coupler_clocks,<sp/>coupler_components_obj,<sp/>coupler_chksum_obj,<sp/>&amp;</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/>time_step_cpld,<sp/>time_step_atmos,<sp/>time_atmos,<sp/>time_ocean,<sp/>num_cpld_calls,<sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/>num_atmos_calls,<sp/>time,<sp/>time_start,<sp/>time_end,<sp/>time_restart,<sp/>time_restart_current)</highlight></codeline>
<codeline lineno="397"><highlight class="normal"></highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a74ce4e2724ae9e0d2d9721cdbd9e56e2" kindref="member">do_chksum</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">coupler_chksum_obj%get_coupler_chksums(</highlight><highlight class="stringliteral">&apos;coupler_init+&apos;</highlight><highlight class="normal">,<sp/>0)</highlight></codeline>
<codeline lineno="399"><highlight class="normal"></highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_set_current_pelist()</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_end(coupler_clocks%initialization)<sp/></highlight><highlight class="comment">!end<sp/>initialization</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_begin(coupler_clocks%main)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!begin<sp/>main<sp/>loop</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="403"><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight><highlight class="comment">!-----------------------------------------------------------------------</highlight></codeline>
<codeline lineno="406"><highlight class="normal"></highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a87ccc8af0ea38216b76cb914b641fa43" kindref="member">check_stocks</ref><sp/>&gt;=<sp/>0<sp/>.and.<sp/><ref refid="namespacefull__coupler__mod_1a9e75cc87d8a2a12446415c8e96020256" kindref="member">do_flux</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1aacd2b02808f6f249686b8dfda325a476" kindref="member">coupler_flux_init_finish_stocks</ref>(time,<sp/>atm,<sp/>land,<sp/>ice,<sp/>ocean_state,<sp/>&amp;</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coupler_clocks,<sp/>init_stocks=.true.)</highlight></codeline>
<codeline lineno="409"><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/>coupled_timestep_loop<sp/>:<sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>nc<sp/>=<sp/>1,<sp/>num_cpld_calls</highlight></codeline>
<codeline lineno="412"><highlight class="normal"></highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a74ce4e2724ae9e0d2d9721cdbd9e56e2" kindref="member">do_chksum</ref>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">coupler_chksum_obj%get_coupler_chksums(</highlight><highlight class="stringliteral">&apos;top_of_coupled_loop+&apos;</highlight><highlight class="normal">,<sp/>nc)</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">coupler_chksum_obj%get_atmos_ice_land_ocean_chksums(</highlight><highlight class="stringliteral">&apos;MAIN_LOOP-&apos;</highlight><highlight class="normal">,<sp/>nc)</highlight></codeline>
<codeline lineno="416"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="417"><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ice%slow_ice_PE<sp/>.or.<sp/>ocean%is_ocean_pe)<sp/></highlight><highlight class="keywordflow">then</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1aea669a50f8bf186ab6563fc3a593727d" kindref="member">coupler_flux_ocean_to_ice</ref>(ocean,<sp/>ice,<sp/>ocean_ice_boundary,<sp/>coupler_clocks,<sp/>slow_ice_ocean_pelist)</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>time_flux_ocean_to_ice<sp/>=<sp/>time</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="namespacefull__coupler__mod_1a9a1c54998e22ffba7be908ad06c4695a" kindref="member">use_lag_fluxes</ref>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a21ac2bd35b5e12e39409de231485fc49" kindref="member">coupler_flux_ice_to_ocean</ref>(ice,<sp/>ocean,<sp/>ice_ocean_boundary,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>time_flux_ice_to_ocean<sp/>=<sp/>time</highlight></codeline>
<codeline lineno="430"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"></highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a74ce4e2724ae9e0d2d9721cdbd9e56e2" kindref="member">do_chksum</ref>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">coupler_chksum_obj%get_coupler_chksums(</highlight><highlight class="stringliteral">&apos;flux_ocn2ice+&apos;</highlight><highlight class="normal">,<sp/>nc)</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">coupler_chksum_obj%get_atmos_ice_land_ocean_chksums(</highlight><highlight class="stringliteral">&apos;flux_ocn2ice+&apos;</highlight><highlight class="normal">,<sp/>nc)</highlight></codeline>
<codeline lineno="436"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="437"><highlight class="normal"></highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>needs<sp/>to<sp/>sit<sp/>here<sp/>rather<sp/>than<sp/>at<sp/>the<sp/>end<sp/>of<sp/>the<sp/>coupler<sp/>loop.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a87ccc8af0ea38216b76cb914b641fa43" kindref="member">check_stocks</ref><sp/>&gt;<sp/>0<sp/>.and.<sp/><ref refid="namespacefull__coupler__mod_1a9e75cc87d8a2a12446415c8e96020256" kindref="member">do_flux</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a0c78ac70ae6ce91467b7039912804e05" kindref="member">coupler_flux_check_stocks</ref>(nc,<sp/>time,<sp/>atm,<sp/>land,<sp/>ice,<sp/>ocean_state,<sp/>&amp;</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="441"><highlight class="normal"></highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a129ad943f269777da974e4b6237aca81" kindref="member">do_ice</ref><sp/>.and.<sp/>ice%pe)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ice%slow_ice_pe)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a03dfec6ce79bf87d70af81a67036d0d5" kindref="member">coupler_unpack_ocean_ice_boundary</ref>(nc,<sp/>time_flux_ocean_to_ice,<sp/>ice,<sp/>ocean_ice_boundary,&amp;</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coupler_clocks,<sp/>coupler_chksum_obj)</highlight></codeline>
<codeline lineno="445"><highlight class="normal"></highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>This<sp/>could<sp/>be<sp/>a<sp/>point<sp/>where<sp/>the<sp/>model<sp/>is<sp/>serialized<sp/>if<sp/>the<sp/>fast<sp/>and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>slow<sp/>ice<sp/>are<sp/>on<sp/>different<sp/>PEs.<sp/><sp/>call<sp/>fms_mpp_set_current_pelist(Ice%pelist)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>is<sp/>called<sp/>if(.not.Ice%shared_slow_fast_PEs)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1acc373b8c70ab51bcd1abd62a0f2cc458" kindref="member">coupler_exchange_slow_to_fast_ice</ref>(ice,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1ad028fe6369495ea7e76623b4382d393d" kindref="member">concurrent_ice</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1adfa43bbc4b86cff9ebbf83c303c1536c" kindref="member">coupler_exchange_fast_to_slow_ice</ref>(ice,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ice%fast_ice_pe)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1abddb0d5b155dcae16de66f20ec7beb6b" kindref="member">coupler_set_ice_surface_fields</ref>(ice,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="454"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"></highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/>atm_pe_block<sp/>:<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(atm%pe)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="457"><highlight class="normal"></highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(.NOT.(<ref refid="namespacefull__coupler__mod_1a129ad943f269777da974e4b6237aca81" kindref="member">do_ice</ref>.and.ice%pe)<sp/>.OR.<sp/>(<ref refid="namespacefull__coupler__mod_1ad05b147d644b53ac6be5c56a85e80105" kindref="member">ice_npes</ref>.NE.<ref refid="namespacefull__coupler__mod_1a85adcfb2f6ef212cc2e6415f23f0a946" kindref="member">atmos_npes</ref>))<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_set_current_pelist(atm%pelist)</highlight></codeline>
<codeline lineno="459"><highlight class="normal"></highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="namespacefull__coupler__mod_1a74ce4e2724ae9e0d2d9721cdbd9e56e2" kindref="member">do_chksum</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">coupler_chksum_obj%get_atmos_ice_land_chksums(</highlight><highlight class="stringliteral">&apos;set_ice_surface+&apos;</highlight><highlight class="normal">,<sp/>nc)</highlight></codeline>
<codeline lineno="461"><highlight class="normal"></highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_begin(coupler_clocks%atm)</highlight></codeline>
<codeline lineno="464"><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a9e75cc87d8a2a12446415c8e96020256" kindref="member">do_flux</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a5a6aad430601ef6236f0aef37ae7e8d9" kindref="member">coupler_generate_sfc_xgrid</ref>(land,<sp/>ice,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_ice_mask_sic(time)</highlight></codeline>
<codeline lineno="467"><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-----------------------------------------------------------------------</highlight></codeline>
<codeline lineno="470"><highlight class="normal"></highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_begin(coupler_clocks%atmos_loop)</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fast_integration_loop<sp/>:<sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>na<sp/>=<sp/>1,<sp/>num_atmos_calls</highlight></codeline>
<codeline lineno="473"><highlight class="normal"></highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>time_atmos<sp/>=<sp/>time_atmos<sp/>+<sp/>time_step_atmos</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>current_timestep<sp/>=<sp/>(nc-1)*num_atmos_calls+na</highlight></codeline>
<codeline lineno="476"><highlight class="normal"></highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a74ce4e2724ae9e0d2d9721cdbd9e56e2" kindref="member">do_chksum</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">coupler_chksum_obj%get_atmos_ice_land_chksums(</highlight><highlight class="stringliteral">&apos;top_of_atmos_loop-&apos;</highlight><highlight class="normal">,<sp/>current_timestep)</highlight></codeline>
<codeline lineno="478"><highlight class="normal"></highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1ac5f115cf3ec7b2b595aee0857cabdf90" kindref="member">do_atmos</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a5a028d46d98bc897bd6896fdb5755e96" kindref="member">coupler_atmos_tracer_driver_gather_data</ref>(atm,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="480"><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a9e75cc87d8a2a12446415c8e96020256" kindref="member">do_flux</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a229bd773fc74906d301d68606f1fa0ba" kindref="member">coupler_sfc_boundary_layer</ref>(atm,<sp/>land,<sp/>ice,<sp/>land_ice_atmos_boundary,<sp/>&amp;</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>time_atmos,<sp/>current_timestep,<sp/>coupler_chksum_obj,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="483"><highlight class="normal"></highlight></codeline>
<codeline lineno="484"><highlight class="normal"></highlight></codeline>
<codeline lineno="485"><highlight class="normal"></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/>PARALLEL<sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/>NUM_THREADS(conc_nthreads)<sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="487"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/>DEFAULT(NONE)<sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="488"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/>PRIVATE(conc_nthreads)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/>SHARED(atmos_nthreads,<sp/>radiation_nthreads,<sp/>nc,<sp/>na,<sp/>num_atmos_calls,<sp/>atmos_npes,<sp/>land_npes,<sp/>ice_npes)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="490"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/>SHARED(Time_atmos,<sp/>Atm,<sp/>Land,<sp/>Ice,<sp/>Land_ice_atmos_boundary,<sp/>Atmos_land_boundary,<sp/>Atmos_ice_boundary)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/>SHARED(Ocean_ice_boundary)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="492"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/>SHARED(do_debug,<sp/>do_flux,<sp/>do_chksum,<sp/>do_atmos,<sp/>do_land,<sp/>do_ice,<sp/>do_concurrent_radiation,<sp/>omp_sec,<sp/>imb_sec)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/>SHARED(coupler_clocks,<sp/>current_timestep,<sp/>coupler_chksum_obj)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"></highlight><highlight class="comment">!$<sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(omp_get_thread_num()<sp/>==<sp/>0)<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="495"><highlight class="normal"></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/>PARALLEL<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="496"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/><sp/><sp/>NUM_THREADS(1)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="497"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/><sp/><sp/>DEFAULT(NONE)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="498"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/><sp/><sp/>PRIVATE(dsec)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="499"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/><sp/><sp/>SHARED(atmos_nthreads,<sp/>radiation_nthreads,<sp/>nc,<sp/>na,<sp/>num_atmos_calls,<sp/>atmos_npes,<sp/>land_npes,<sp/>ice_npes)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="500"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/><sp/><sp/>SHARED(Time_atmos,<sp/>Atm,<sp/>Land,<sp/>Ice,<sp/>Land_ice_atmos_boundary,<sp/>Atmos_land_boundary,<sp/>Atmos_ice_boundary)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="501"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/><sp/><sp/>SHARED(Ocean_ice_boundary)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/><sp/><sp/>SHARED(do_debug,<sp/>do_flux,<sp/>do_chksum,<sp/>do_atmos,<sp/>do_land,<sp/>do_ice,<sp/>do_concurrent_radiation,<sp/>omp_sec,<sp/>imb_sec)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/><sp/><sp/>SHARED(coupler_clocks,<sp/>current_timestep,<sp/>coupler_chksum_obj)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="504"><highlight class="normal"></highlight><highlight class="comment">!$<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>call<sp/>omp_set_num_threads(atmos_nthreads)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="505"><highlight class="normal"></highlight><highlight class="comment">!$<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dsec=omp_get_wtime()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="506"><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a131c273c9c0e80eb8350cb6809dd4c04" kindref="member">do_concurrent_radiation</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_begin(coupler_clocks%concurrent_atmos)</highlight></codeline>
<codeline lineno="508"><highlight class="normal"></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1ac5f115cf3ec7b2b595aee0857cabdf90" kindref="member">do_atmos</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a9870c4ebd0509e3a451918312aeab9bc" kindref="member">coupler_update_atmos_model_dynamics</ref>(atm,<sp/>current_timestep,<sp/>&amp;</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coupler_chksum_obj,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="512"><highlight class="normal"></highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(.not.<ref refid="namespacefull__coupler__mod_1a131c273c9c0e80eb8350cb6809dd4c04" kindref="member">do_concurrent_radiation</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a53e78be022cbfa2705d38c357862b299" kindref="member">coupler_update_atmos_model_radiation</ref>(atm,<sp/>land_ice_atmos_boundary,<sp/>&amp;</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coupler_clocks,<sp/>current_timestep,<sp/>coupler_chksum_obj)</highlight></codeline>
<codeline lineno="516"><highlight class="normal"></highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1ac5f115cf3ec7b2b595aee0857cabdf90" kindref="member">do_atmos</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a12b401d180e4ef450900bf99326cf7b1" kindref="member">coupler_update_atmos_model_down</ref>(atm,<sp/>land_ice_atmos_boundary,<sp/>&amp;</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>current_timestep,<sp/>coupler_chksum_obj,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="520"><highlight class="normal"></highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a9e75cc87d8a2a12446415c8e96020256" kindref="member">do_flux</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a2bbfad8acb27d074dcab777315e83020" kindref="member">coupler_flux_down_from_atmos</ref>(atm,<sp/>land,<sp/>ice,<sp/>land_ice_atmos_boundary,<sp/>atmos_land_boundary,<sp/>&amp;</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atmos_ice_boundary,<sp/>time_atmos,<sp/>current_timestep,<sp/>coupler_clocks,<sp/>coupler_chksum_obj)</highlight></codeline>
<codeline lineno="524"><highlight class="normal"></highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!--------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="526"><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1ae29c7dedacd07b876ab9a8c88f3fcb0a" kindref="member">do_land</ref><sp/>.AND.<sp/>land%pe)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1ac362087e9af50b6210abceca68bc71b4" kindref="member">coupler_update_land_model_fast</ref>(land,<sp/>atmos_land_boundary,<sp/>atm%pelist,<sp/>&amp;</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>current_timestep,<sp/>coupler_chksum_obj,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="530"><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a129ad943f269777da974e4b6237aca81" kindref="member">do_ice</ref><sp/>.AND.<sp/>ice%fast_ice_pe)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a16ef5e434cc41e25acca7c13c914a7dd" kindref="member">coupler_update_ice_model_fast</ref>(ice,<sp/>atmos_ice_boundary,<sp/>atm%pelist,<sp/>&amp;</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>current_timestep,<sp/>coupler_chksum_obj,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="534"><highlight class="normal"></highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!--------------------------------------------------------------</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a9e75cc87d8a2a12446415c8e96020256" kindref="member">do_flux</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a815b7cd5c923bcc6983455275e760562" kindref="member">coupler_flux_up_to_atmos</ref>(land,<sp/>ice,<sp/>land_ice_atmos_boundary,<sp/>atmos_land_boundary,<sp/>&amp;</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atmos_ice_boundary,<sp/>time_atmos,<sp/>current_timestep,<sp/>coupler_chksum_obj,<sp/>&amp;</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="540"><highlight class="normal"></highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1ac5f115cf3ec7b2b595aee0857cabdf90" kindref="member">do_atmos</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a6d261ed1082536075cf038512bfb554c" kindref="member">coupler_update_atmos_model_up</ref>(atm,<sp/>land_ice_atmos_boundary,<sp/>current_timestep,<sp/>&amp;</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coupler_chksum_obj,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="543"><highlight class="normal"></highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a9e75cc87d8a2a12446415c8e96020256" kindref="member">do_flux</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a5d6ec62cbf5b295aace24abd48724d72" kindref="member">coupler_flux_atmos_to_ocean</ref>(atm,<sp/>atmos_ice_boundary,<sp/>ice,<sp/>time_atmos)</highlight></codeline>
<codeline lineno="545"><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!--------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a131c273c9c0e80eb8350cb6809dd4c04" kindref="member">do_concurrent_radiation</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_end(coupler_clocks%concurrent_atmos)</highlight></codeline>
<codeline lineno="548"><highlight class="normal"></highlight><highlight class="comment">!$<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>omp_sec(1)<sp/>=<sp/>omp_sec(1)<sp/>+<sp/>(omp_get_wtime()<sp/>-<sp/>dsec)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="549"><highlight class="normal"></highlight><highlight class="comment">!$OMP<sp/>END<sp/>PARALLEL</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="550"><highlight class="normal"></highlight><highlight class="comment">!$<sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"></highlight><highlight class="comment">!$<sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(omp_get_thread_num()<sp/>==<sp/>max(0,omp_get_num_threads()-1))<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/>----<sp/>atmosphere<sp/>radiation<sp/>----</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a131c273c9c0e80eb8350cb6809dd4c04" kindref="member">do_concurrent_radiation</ref>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="554"><highlight class="normal"></highlight><highlight class="comment">!$OMP<sp/>PARALLEL<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/><sp/><sp/>NUM_THREADS(1)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/><sp/><sp/>DEFAULT(NONE)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="557"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/><sp/><sp/>PRIVATE(dsec)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/><sp/><sp/>SHARED(Atm,<sp/>Land,<sp/>Ice,<sp/>Land_ice_atmos_boundary,<sp/>Atmos_ice_boundary,<sp/>Ocean_ice_boundary,Atmos_land_boundary)&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="559"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/><sp/><sp/>SHARED(do_chksum,<sp/>do_debug,<sp/>omp_sec,<sp/>num_atmos_calls,<sp/>na,<sp/>radiation_nthreads)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="560"><highlight class="normal"></highlight><highlight class="comment">!$OMP&amp;<sp/><sp/><sp/><sp/><sp/><sp/>SHARED(coupler_clocks)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"></highlight><highlight class="comment">!$<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>call<sp/>omp_set_num_threads(radiation_nthreads)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="562"><highlight class="normal"></highlight><highlight class="comment">!$<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dsec=omp_get_wtime()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a53e78be022cbfa2705d38c357862b299" kindref="member">coupler_update_atmos_model_radiation</ref>(atm,<sp/>land_ice_atmos_boundary,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="564"><highlight class="normal"></highlight><highlight class="comment">!$<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>omp_sec(2)<sp/>=<sp/>omp_sec(2)<sp/>+<sp/>(omp_get_wtime()<sp/>-<sp/>dsec)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"></highlight><highlight class="comment">!$OMP<sp/>END<sp/>PARALLEL</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="566"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"></highlight><highlight class="comment">!$<sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="568"><highlight class="normal"></highlight><highlight class="comment">!$<sp/><sp/><sp/><sp/><sp/><sp/>imb_sec(omp_get_thread_num()+1)<sp/>=<sp/>imb_sec(omp_get_thread_num()+1)<sp/>-<sp/>omp_get_wtime()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="569"><highlight class="normal"></highlight><highlight class="comment">!$OMP<sp/>END<sp/>PARALLEL</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="570"><highlight class="normal"></highlight><highlight class="comment">!$<sp/><sp/><sp/><sp/><sp/><sp/>imb_sec(1)<sp/>=<sp/>imb_sec(1)<sp/>+<sp/>omp_get_wtime()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="571"><highlight class="normal"></highlight><highlight class="comment">!$<sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(do_concurrent_radiation)<sp/>imb_sec(2)<sp/>=<sp/>imb_sec(2)<sp/>+<sp/>omp_get_wtime()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="572"><highlight class="normal"></highlight><highlight class="comment">!$<sp/><sp/><sp/><sp/><sp/><sp/>call<sp/>omp_set_num_threads(atmos_nthreads+(conc_nthreads-1)*radiation_nthreads)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="573"><highlight class="normal"></highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1abcc0129feb720f653d1331b74bdcc83e" kindref="member">coupler_update_atmos_model_state</ref>(atm,<sp/>current_timestep,<sp/>coupler_chksum_obj,<sp/>coupler_clocks<sp/>)</highlight></codeline>
<codeline lineno="575"><highlight class="normal"></highlight></codeline>
<codeline lineno="576"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"><sp/>fast_integration_loop<sp/></highlight><highlight class="comment">!<sp/>end<sp/>of<sp/>na<sp/>(fast<sp/>loop)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="577"><highlight class="normal"></highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_end(coupler_clocks%atmos_loop)</highlight></codeline>
<codeline lineno="580"></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1ae29c7dedacd07b876ab9a8c88f3fcb0a" kindref="member">do_land</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a439064bbf2747a318875cd2658ee5687" kindref="member">coupler_update_land_model_slow</ref>(land,<sp/>atmos_land_boundary,<sp/>&amp;</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atm%pelist,<sp/>current_timestep,<sp/>coupler_chksum_obj,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="584"><highlight class="normal"></highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1abf2778399410a6dc8bd900e06fb32c73" kindref="member">coupler_flux_land_to_ice</ref>(land,<sp/>ice,<sp/>land_ice_boundary,<sp/>time,<sp/>current_timestep,<sp/>&amp;</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coupler_chksum_obj,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="588"><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>atmos_ice_boundary%p<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="591"><highlight class="normal"></highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>time<sp/>=<sp/>time_atmos</highlight></codeline>
<codeline lineno="593"><highlight class="normal"></highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_end(coupler_clocks%atm)</highlight></codeline>
<codeline lineno="596"><highlight class="normal"></highlight></codeline>
<codeline lineno="597"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"><sp/>atm_pe_block</highlight></codeline>
<codeline lineno="598"><highlight class="normal"></highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/>start_atm_clock2:<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(atm%pe)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_begin(coupler_clocks%atm)</highlight></codeline>
<codeline lineno="603"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"><sp/>start_atm_clock2</highlight></codeline>
<codeline lineno="604"><highlight class="normal"></highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a129ad943f269777da974e4b6237aca81" kindref="member">do_ice</ref><sp/>.and.<sp/>ice%pe)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ice%fast_ice_PE)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1abaf548c80785bc86cdf6905e878beea2" kindref="member">coupler_unpack_land_ice_boundary</ref>(ice,<sp/>land_ice_boundary,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(.not.<ref refid="namespacefull__coupler__mod_1ad028fe6369495ea7e76623b4382d393d" kindref="member">concurrent_ice</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1adfa43bbc4b86cff9ebbf83c303c1536c" kindref="member">coupler_exchange_fast_to_slow_ice</ref>(ice,<sp/>coupler_clocks,<sp/>&amp;</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>set_ice_current_pelist=.true.)</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ice%slow_ice_PE<sp/>.and.<sp/>.not.<ref refid="namespacefull__coupler__mod_1aa59cb045fb5f6eaa4ffd5116ad640dc2" kindref="member">combined_ice_and_ocean</ref>)<sp/>&amp;</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespacefull__coupler__mod_1a99772f79049c6478c178ff5936cd96f5" kindref="member">coupler_update_ice_model_slow_and_stocks</ref>(ice,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacefull__coupler__mod_1a74ce4e2724ae9e0d2d9721cdbd9e56e2" kindref="member">do_chksum</ref>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">coupler_chksum_obj%get_slow_ice_chksums(</highlight><highlight class="stringliteral">&apos;update_ice_slow+&apos;</highlight><highlight class="normal">,<sp/>nc)</highlight></codeline>
<codeline lineno="615"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>End<sp/>of<sp/>Ice%pe<sp/>block</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="616"><highlight class="normal"></highlight></codeline>
<codeline lineno="617"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/><sp/><sp/>end</highlight><highlight class="normal">_atm_clock2:<sp/>if(Atm%pe)<sp/>then</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_set_current_pelist(atm%pelist)</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_end(coupler_clocks%atm)</highlight></codeline>
<codeline lineno="620"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"><sp/>end_atm_clock2</highlight></codeline>
<codeline lineno="621"><highlight class="normal"></highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Update<sp/>Ice_ocean_boundary<sp/>using<sp/>the<sp/>newly<sp/>calculated<sp/>fluxes.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((concurrent_ice<sp/>.or.<sp/>.not.use_lag_fluxes)<sp/>.and.<sp/>.not.combined_ice_and_ocean)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!this<sp/>could<sp/>serialize<sp/>unless<sp/>slow_ice_with_ocean<sp/>is<sp/>true.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((.not.do_ice)<sp/>.or.<sp/>(.not.slow_ice_with_ocean))<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_set_current_pelist()</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ice%slow_ice_PE<sp/>.or.<sp/>ocean%is_ocean_pe)<sp/>&amp;</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">coupler_flux_ice_to_ocean(ice,<sp/>ocean,<sp/>ice_ocean_boundary,<sp/>coupler_clocks,<sp/>&amp;</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>slow_ice_ocean_pelist=slow_ice_ocean_pelist,<sp/>set_current_slow_ice_ocean_pelist=.true.)</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>time_flux_ice_to_ocean<sp/>=<sp/>time</highlight></codeline>
<codeline lineno="630"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="631"><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ocean%is_ocean_pe)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_set_current_pelist(ocean%pelist)</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_begin(coupler_clocks%ocean)</highlight></codeline>
<codeline lineno="635"><highlight class="normal"></highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>This<sp/>may<sp/>do<sp/>data<sp/>override<sp/>or<sp/>diagnostics<sp/>on<sp/>Ice_ocean_boundary.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">flux_ice_to_ocean_finish(time_flux_ice_to_ocean,<sp/>ice_ocean_boundary)</highlight></codeline>
<codeline lineno="638"><highlight class="normal"></highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(combined_ice_and_ocean)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">flux_ice_to_ocean_stocks(ice)</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">update_slow_ice_and_ocean(ice_ocean_driver_cs,<sp/>ice,<sp/>ocean_state,<sp/>ocean,<sp/>&amp;</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ice_ocean_boundary,<sp/>time_ocean,<sp/>time_step_cpld<sp/>)</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_chksum)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">coupler_chksum_obj%get_ocean_chksums(</highlight><highlight class="stringliteral">&apos;update_ocean_model-&apos;</highlight><highlight class="normal">,<sp/>nc)</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>update_ocean_model<sp/>since<sp/>fluxes<sp/>don&apos;t<sp/>change<sp/>here</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_ocean)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">coupler_update_ocean_model(ocean,<sp/>ocean_state,<sp/>ice_ocean_boundary,&amp;</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>time_ocean,<sp/>time_step_cpld,<sp/>nc,<sp/>coupler_chksum_obj)</highlight></codeline>
<codeline lineno="648"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="649"><highlight class="normal"></highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Get<sp/>stocks<sp/>from<sp/>&quot;Ice_ocean_boundary&quot;<sp/>and<sp/>add<sp/>them<sp/>to<sp/>Ocean<sp/>stocks.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>This<sp/>call<sp/>is<sp/>just<sp/>for<sp/>record<sp/>keeping<sp/>of<sp/>stocks<sp/>transfer<sp/>and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>does<sp/>not<sp/>modify<sp/>either<sp/>Ocean<sp/>or<sp/>Ice_ocean_boundary</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">flux_ocean_from_ice_stocks(ocean_state,<sp/>ocean,<sp/>ice_ocean_boundary)</highlight></codeline>
<codeline lineno="654"><highlight class="normal"></highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_send_complete(time_step_cpld)</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>time_ocean<sp/>=<sp/>time_ocean<sp/>+<sp/><sp/>time_step_cpld</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>time<sp/>=<sp/>time_ocean</highlight></codeline>
<codeline lineno="658"><highlight class="normal"></highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_end(coupler_clocks%ocean)</highlight></codeline>
<codeline lineno="660"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="661"><highlight class="normal"></highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(time<sp/>&gt;=<sp/>time_restart)<sp/>&amp;</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">coupler_intermediate_restart(atm,<sp/>ice,<sp/>ocean,<sp/>ocean_state,<sp/>ocn_bc_restart,<sp/>ice_bc_restart,<sp/>&amp;</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>time,<sp/>time_restart,<sp/>time_restart_current,<sp/>time_start)</highlight></codeline>
<codeline lineno="666"><highlight class="normal"></highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">coupler_summarize_timestep(nc,<sp/>num_cpld_calls,<sp/>coupler_chksum_obj,<sp/>atm%pe,<sp/>omp_sec,<sp/>imb_sec)</highlight></codeline>
<codeline lineno="668"><highlight class="normal"></highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/>omp_sec(:)=0.</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/>imb_sec(:)=0.</highlight></codeline>
<codeline lineno="671"><highlight class="normal"></highlight></codeline>
<codeline lineno="672"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/>enddo</highlight><highlight class="normal"><sp/>coupled_timestep_loop</highlight></codeline>
<codeline lineno="673"><highlight class="normal"></highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!-----------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(check_stocks<sp/>&gt;=0<sp/>.and.<sp/>do_flux)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">coupler_flux_init_finish_stocks(time,<sp/>atm,<sp/>land,<sp/>ice,<sp/>ocean_state,<sp/>&amp;</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coupler_clocks,<sp/>finish_stocks=.true.)</highlight></codeline>
<codeline lineno="677"><highlight class="normal"></highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_set_current_pelist()</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_end(coupler_clocks%main)</highlight></codeline>
<codeline lineno="680"><highlight class="normal"></highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="_s_hi_e_l_d_2coupler__main_8_f90_1a9c12cf6c31eac7da0e73ab89e6cb57a7" kindref="member">coupler_end</ref>(atm,<sp/>land,<sp/>ice,<sp/>ocean,<sp/>ocean_state,<sp/>land_ice_atmos_boundary,<sp/>atmos_ice_boundary,&amp;</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>atmos_land_boundary,<sp/>ice_ocean_boundary,<sp/>ocean_ice_boundary,<sp/>ocn_bc_restart,<sp/>ice_bc_restart,<sp/>&amp;</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>nc,<sp/>time,<sp/>time_start,<sp/>time_end,<sp/>time_restart_current,<sp/>coupler_chksum_obj,<sp/>coupler_clocks)</highlight></codeline>
<codeline lineno="684"><highlight class="normal"></highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_memutils_print_memuse_stats(<sp/></highlight><highlight class="stringliteral">&apos;Memory<sp/>HiWaterMark&apos;</highlight><highlight class="normal">,<sp/>always=.true.<sp/>)</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_end</highlight></codeline>
<codeline lineno="687"><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"></highlight><highlight class="comment">!-----------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="689"><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"></highlight><highlight class="keyword">end<sp/>program<sp/></highlight><highlight class="normal"><ref refid="full_2coupler__main_8_f90_1ae6938ccf85d88f9b7127a81ce195bad2" kindref="member">coupler_main</ref></highlight></codeline>
    </programlisting>
    <location file="full/coupler_main.F90"/>
  </compounddef>
</doxygen>
