<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.14">
  <compounddef id="full_2flux__exchange_8_f90" kind="file" language="Fortran">
    <compoundname>flux_exchange.F90</compoundname>
    <innernamespace refid="namespaceflux__exchange__mod">flux_exchange_mod</innernamespace>
    <briefdescription>
<para>The flux_exchange module provides interfaces to couple the following component models: atmosphere, ocean, land, and ice. All interpolation between physically distinct model grids is handled by the exchange grid (xgrid_mod) with the interpolated quantities being conserved. </para>    </briefdescription>
    <detaileddescription>
<para><simplesect kind="author"><para>Bruce Wyman <ulink url="mailto:Bruce.Wyman@noaa.gov">Bruce.Wyman@noaa.gov</ulink> </para></simplesect>
<simplesect kind="author"><para>V. Balaji <ulink url="mailto:V.Balaji@noaa.gov">V.Balaji@noaa.gov</ulink> </para></simplesect>
<simplesect kind="author"><para>Sergey Malyshev <ulink url="mailto:Sergey.Malyshev@noaa.gov">Sergey.Malyshev@noaa.gov</ulink></para></simplesect>
<orderedlist>
<listitem><para>This version of <ref refid="namespaceflux__exchange__mod" kindref="compound">flux_exchange_mod</ref> allows the definition of physically independent grids for atmosphere, land and sea ice. Ice and ocean must share the same physical grid (though the domain decomposition on parallel systems may be different). Grid information is input through the grid_spec file (URL). The masked region of the land grid and ice/ocean grid must &quot;tile&quot; each other. The masked region of the ice grid and ocean grid must be identical. <preformatted>
         ATMOSPHERE  |----|----|----|----|----|----|----|----|</preformatted></para><para><preformatted>               LAND  |---|---|---|---|xxx|xxx|xxx|xxx|xxx|xxx|</preformatted></para><para><preformatted>                ICE  |xxx|xxx|xxx|xxx|---|---|---|---|---|---|</preformatted></para><para><preformatted>               OCEAN |xxx|xxx|xxx|xxx|---|---|---|---|---|---|
 </preformatted></para><para>where <computeroutput>|xxx|</computeroutput> represents a masked grid point</para><para>The atmosphere, land, and ice grids exchange information using the exchange grid xmap_sfc.</para><para>The land and ice grids exchange runoff data using the exchange grid xmap_runoff.</para><para>Transfer of data between the ice bottom and ocean does not require an exchange grid as the grids are physically identical. The flux routines will automatically detect and redistribute data if their domain decompositions are different.</para><para>To get information from the atmosphere to the ocean it must pass through the ice model, first by interpolating from the atmospheric grid to the ice grid, and then transferring from the ice grid to the ocean grid.</para></listitem><listitem><para>Each component model must have a public defined data type containing specific boundary fields. A list of these quantities is located in the NOTES of this document.</para></listitem><listitem><para>The surface flux of sensible heat and surface evaporation can be implicit functions of surface temperature. As a consequence, the parts of the land and sea-ice models that update the surface temperature must be called on the atmospheric time step</para></listitem><listitem><para>The surface fluxes of all other tracers and of momentum are assumed to be explicit functions of all surface parameters.</para></listitem><listitem><para>While no explicit reference is made within this module to the implicit treatment of vertical diffusion in the atmosphere and in the land or sea-ice models, the module is designed to allow for simultaneous implicit time integration on both sides of the surface interface.</para></listitem><listitem><para>Due to #5, the diffusion part of the land and ice models must be called on the atmospheric time step, although in the case of concurrent-ice coupling, this version of the sea-ice that is called by the atmosphere may later be replaced by a version of the ice that is tightly coupled with the ocean.</para></listitem><listitem><para>The fluxes of additional tracers related to biological quantities or the air-sea exchange of gases are accomplished by specifying fields that will be passed between components via the &quot;field_table&quot; and the use of named fields in the coupler_..._bc_types.</para></listitem><listitem><para>Any field passed from one component to another may be &quot;faked&quot; to a constant value, or to data acquired from a file, using the data_override feature of FMS. The fields to override are runtime configurable, using the text file <computeroutput>data_table</computeroutput> for input. See the data_override_mod documentation for more details.</para><para>We DO NOT RECOMMEND exercising the data override capabilities of the FMS coupler until the user has acquired considerable sophistication in running FMS.</para><para>Here is a listing of the override capabilities of the flux_exchange module:<itemizedlist>
<listitem><para>FROM the atmosphere boundary TO the exchange grid (in sfc_boundary_layer):</para><para>t_bot, q_bot, z_bot, p_bot, u_bot, v_bot, p_surf, slp, gust</para></listitem><listitem><para>FROM the ice boundary TO the exchange grid (in sfc_boundary_layer):</para><para>t_surf, rough_mom, rough_heat, rough_moist, albedo, u_surf, v_surf</para></listitem><listitem><para>FROM the land boundary TO the exchange grid (in sfc_boundary_layer):</para><para>t_surf, t_ca, q_ca, rough_mom, rough_heat, albedo</para></listitem><listitem><para>FROM the exchange grid TO land_ice_atmos_boundary (in sfc_boundary_layer):</para><para>t, albedo, land_frac, dt_t, dt_q, u_flux, v_flux, dtaudu, dtaudv, u_star, b_star, rough_mom</para></listitem><listitem><para>FROM the atmosphere boundary TO the exchange grid (in flux_down_from_atmos):</para><para>flux_sw, flux_lw, lprec, fprec, coszen, dtmass, delta_t, delta_q, dflux_t, dflux_q</para></listitem><listitem><para>FROM the exchange grid TO the land boundary (in flux_down_from_atmos):</para><para>t_flux, q_flux, lw_flux, sw_flux, lprec, fprec, dhdt, dedt, dedq, drdt, drag_q, p_surf</para></listitem><listitem><para>FROM the exchange grid TO the ice boundary (in flux_down_from_atmos):</para><para>u_flux, v_flux, t_flux, q_flux, lw_flux, lw_flux_dn, sw_flux, sw_flux_dn, lprec, fprec, dhdt, dedt, drdt, coszen, p</para></listitem><listitem><para>FROM the land boundary TO the ice boundary (in flux_land_to_ice):</para><para>runoff, calving</para></listitem><listitem><para>FROM the ice boundary TO the ocean boundary (in flux_ice_to_ocean):</para><para>u_flux, v_flux, t_flux, q_flux, salt_flux, lw_flux, sw_flux, lprec, fprec, runoff, calving, p, ustar_berg, area_berg, mass_berg</para></listitem><listitem><para>FROM the ocean boundary TO the ice boundary (in flux_ocean_to_ice):</para><para>u, v, t, s, frazil, sea_level</para></listitem><listitem><para>FROM the ice boundary TO the atmosphere boundary (in flux_up_to_atmos):</para><para>t_surf</para></listitem><listitem><para>FROM the land boundary TO the atmosphere boundary (in flux_up_to_atmos):</para><para>t_ca, t_surf, q_ca</para></listitem></itemizedlist>
</para><para>See NOTES below for an explanation of the field names.</para></listitem></orderedlist>
</para><sect1 id="full_2flux__exchange_8_f90_1diag_fields">
<title>Diagnostic Fields</title>
<para>The table below contains the available diagnostic fields is the <computeroutput>flux</computeroutput> diagnostic module.</para><para><table rows="35" cols="3"><row>
<entry thead="yes"><para>Field Name  </para></entry><entry thead="yes"><para>Units  </para></entry><entry thead="yes"><para>Description   </para></entry></row>
<row>
<entry thead="no"><para>land_mask  </para></entry><entry thead="no"><para>none  </para></entry><entry thead="no"><para>Fractional amount of land   </para></entry></row>
<row>
<entry thead="no"><para>wind  </para></entry><entry thead="no"><para>m/s  </para></entry><entry thead="no"><para>Wind speed for flux calculations   </para></entry></row>
<row>
<entry thead="no"><para>drag_moist  </para></entry><entry thead="no"><para>none  </para></entry><entry thead="no"><para>Drag coeff for moisture   </para></entry></row>
<row>
<entry thead="no"><para>drag_heat  </para></entry><entry thead="no"><para>none  </para></entry><entry thead="no"><para>Drag coeff for heat   </para></entry></row>
<row>
<entry thead="no"><para>drag_mom  </para></entry><entry thead="no"><para>none  </para></entry><entry thead="no"><para>Drag coeff for momentum   </para></entry></row>
<row>
<entry thead="no"><para>rough_moist  </para></entry><entry thead="no"><para>m  </para></entry><entry thead="no"><para>Surface roughness for moisture   </para></entry></row>
<row>
<entry thead="no"><para>rough_heat  </para></entry><entry thead="no"><para>m  </para></entry><entry thead="no"><para>Surface roughness for heat   </para></entry></row>
<row>
<entry thead="no"><para>rough_mom  </para></entry><entry thead="no"><para>m  </para></entry><entry thead="no"><para>Surface roughness for momentum   </para></entry></row>
<row>
<entry thead="no"><para>u_star  </para></entry><entry thead="no"><para>m/s  </para></entry><entry thead="no"><para>Friction velocity   </para></entry></row>
<row>
<entry thead="no"><para>b_star  </para></entry><entry thead="no"><para>m/s  </para></entry><entry thead="no"><para>Buoyancy scale   </para></entry></row>
<row>
<entry thead="no"><para>q_star  </para></entry><entry thead="no"><para>kg water/kg air  </para></entry><entry thead="no"><para>moisture scale   </para></entry></row>
<row>
<entry thead="no"><para>t_atm  </para></entry><entry thead="no"><para>deg_k  </para></entry><entry thead="no"><para>temperature at btm level   </para></entry></row>
<row>
<entry thead="no"><para>u_atm  </para></entry><entry thead="no"><para>m/s  </para></entry><entry thead="no"><para>u wind component at btm level   </para></entry></row>
<row>
<entry thead="no"><para>v_atm  </para></entry><entry thead="no"><para>m/s  </para></entry><entry thead="no"><para>v wind component at btm level   </para></entry></row>
<row>
<entry thead="no"><para>q_atm  </para></entry><entry thead="no"><para>kg/kg  </para></entry><entry thead="no"><para>specific humidity at btm level   </para></entry></row>
<row>
<entry thead="no"><para>p_atm  </para></entry><entry thead="no"><para>pa  </para></entry><entry thead="no"><para>pressure at btm level   </para></entry></row>
<row>
<entry thead="no"><para>z_atm  </para></entry><entry thead="no"><para>m  </para></entry><entry thead="no"><para>height of btm level   </para></entry></row>
<row>
<entry thead="no"><para>gust  </para></entry><entry thead="no"><para>m/s  </para></entry><entry thead="no"><para>gust scale   </para></entry></row>
<row>
<entry thead="no"><para>rh_ref  </para></entry><entry thead="no"><para>percent  </para></entry><entry thead="no"><para>relative humidity at ref height   </para></entry></row>
<row>
<entry thead="no"><para>t_ref  </para></entry><entry thead="no"><para>deg_k  </para></entry><entry thead="no"><para>temperature at ref height   </para></entry></row>
<row>
<entry thead="no"><para>u_ref  </para></entry><entry thead="no"><para>m/s  </para></entry><entry thead="no"><para>zonal wind component at ref height   </para></entry></row>
<row>
<entry thead="no"><para>v_ref  </para></entry><entry thead="no"><para>m/s  </para></entry><entry thead="no"><para>meridional wind component at ref height   </para></entry></row>
<row>
<entry thead="no"><para>del_h  </para></entry><entry thead="no"><para>none  </para></entry><entry thead="no"><para>ref height interp factor for heat   </para></entry></row>
<row>
<entry thead="no"><para>del_m  </para></entry><entry thead="no"><para>none  </para></entry><entry thead="no"><para>ref height interp factor for momentum   </para></entry></row>
<row>
<entry thead="no"><para>del_q  </para></entry><entry thead="no"><para>none  </para></entry><entry thead="no"><para>ref height interp factor for moisture   </para></entry></row>
<row>
<entry thead="no"><para>tau_x  </para></entry><entry thead="no"><para>pa  </para></entry><entry thead="no"><para>zonal wind stress   </para></entry></row>
<row>
<entry thead="no"><para>tau_y  </para></entry><entry thead="no"><para>pa  </para></entry><entry thead="no"><para>meridional wind stress   </para></entry></row>
<row>
<entry thead="no"><para>ice_mask  </para></entry><entry thead="no"><para>none  </para></entry><entry thead="no"><para>fractional amount of sea ice   </para></entry></row>
<row>
<entry thead="no"><para>t_surf  </para></entry><entry thead="no"><para>deg_k  </para></entry><entry thead="no"><para>surface temperature   </para></entry></row>
<row>
<entry thead="no"><para>t_ca  </para></entry><entry thead="no"><para>deg_k  </para></entry><entry thead="no"><para>canopy air temperature   </para></entry></row>
<row>
<entry thead="no"><para>q_surf  </para></entry><entry thead="no"><para>kg/kg  </para></entry><entry thead="no"><para>surface specific humidity   </para></entry></row>
<row>
<entry thead="no"><para>shflx  </para></entry><entry thead="no"><para>w/m2  </para></entry><entry thead="no"><para>sensible heat flux   </para></entry></row>
<row>
<entry thead="no"><para>evap  </para></entry><entry thead="no"><para>kg/m2/s  </para></entry><entry thead="no"><para>evaporation rate   </para></entry></row>
<row>
<entry thead="no"><para>lwflx  </para></entry><entry thead="no"><para>w/m2  </para></entry><entry thead="no"><para>net (down-up) longwave flux   </para></entry></row>
</table>
</para></sect1>
<sect1 id="full_2flux__exchange_8_f90_1main_example">
<title>Main Program Example</title>
<para>Below is some pseudo-code to illustrate the logic of the main loop.</para><para><programlisting filename=".f90"><codeline><highlight class="keywordflow">DO</highlight><highlight class="normal"><sp/>slow<sp/>time<sp/>steps(ocean)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">flux_ocean_to_ice</highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">ice_slow_up</highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">DO</highlight><highlight class="normal"><sp/>fast<sp/>time<sp/>steps(atmos)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">sfc_boundary_layer</highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">atmos_down</highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">flux_down_from_atmos</highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">land_fast</highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">ice_fast</highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">flux_up_to_atmos</highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">atmos_up</highlight></codeline>
<codeline><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/>END<sp/>DO</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">ice_slow_dn</highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">flux_ice_to_ocean</highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">ocean</highlight></codeline>
<codeline><highlight class="normal"></highlight><highlight class="keyword">END<sp/></highlight><highlight class="normal">DO</highlight></codeline>
</programlisting></para><para><simplesect kind="note"><para>LAND_FAST and ICE_FAST must update the surface temperature</para></simplesect>
</para></sect1>
<sect1 id="full_2flux__exchange_8_f90_1Required">
<title>Variables In Defined Data Types For Component Models</title>
<sect2 id="full_2flux__exchange_8_f90_1Atmosphere">
<title>Atmosphere</title>
<para><programlisting filename=".f90"><codeline><highlight class="normal">type(atmos_boundary_data_type)<sp/>::<sp/>atm</highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:)</highlight><highlight class="normal"><sp/>::<sp/>Atm%lon_bnd<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>longitude<sp/>axis<sp/>grid<sp/>box<sp/>boundaries<sp/>in<sp/>radians</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>must<sp/>be<sp/>monotonic</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atm%lat_bnd<sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>latitude<sp/>axis<sp/>grid<sp/>box<sp/>boundaries<sp/>in<sp/>radians</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>must<sp/>be<sp/>monotonic</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:,:)</highlight><highlight class="normal"><sp/>::<sp/>Atm%t_bot<sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>temperature<sp/>at<sp/>lowest<sp/>model<sp/>level</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Atm%q_bot<sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>specific<sp/>humidity<sp/>at<sp/>lowest<sp/>model<sp/>level</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Atm%z_bot<sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>height<sp/>above<sp/>the<sp/>surface<sp/>for<sp/>the<sp/>lowest<sp/>model<sp/>level<sp/>(m)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Atm%p_bot<sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>pressure<sp/>at<sp/>lowest<sp/>model<sp/>level<sp/>(pa)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Atm%u_bot<sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>zonal<sp/>wind<sp/>component<sp/>at<sp/>lowest<sp/>model<sp/>level<sp/>(m/s)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Atm%v_bot<sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>meridional<sp/>wind<sp/>component<sp/>at<sp/>lowest<sp/>model<sp/>level<sp/>(m/s)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Atm%p_surf<sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/><sp/><sp/>surface<sp/>pressure<sp/>(pa)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Atm%slp<sp/><sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/><sp/><sp/>sea<sp/>level<sp/>pressure<sp/>(pa)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Atm%gust<sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/><sp/><sp/>gustiness<sp/>factor<sp/>(m/s)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Atm%flux_sw<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/><sp/>net<sp/>shortwave<sp/>flux<sp/>at<sp/>the<sp/>surface</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Atm%flux_lw<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/><sp/>downward<sp/>longwave<sp/>flux<sp/>at<sp/>the<sp/>surface</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Atm%lprec<sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/><sp/>liquid<sp/>precipitation<sp/>(kg/m2)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Atm%fprec<sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/><sp/>water<sp/>equivalent<sp/>frozen<sp/>precipitation<sp/>(kg/m2)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Atm%coszen<sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/><sp/>cosine<sp/>of<sp/>the<sp/>zenith<sp/>angle</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(4)</highlight><highlight class="normal"><sp/>::<sp/>Atm%axes<sp/></highlight><highlight class="comment">!<sp/>Axis<sp/>identifiers<sp/>returned<sp/>by<sp/>diag_axis_init<sp/>for<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>atmospheric<sp/>model<sp/>axes:<sp/>x,<sp/>y,<sp/>z_full,<sp/>z_half.</highlight></codeline>
</programlisting></para><para>The following five fields are gathered into a data type for convenience in passing this information through the different levels of the atmospheric model <ndash/> these fields are rlated to the simultaneous implicit time steps in the atmosphere and surface models <ndash/> they are described more fully in flux_exchange.tech.ps and in the documntation for vert_diff_mod</para><para><programlisting filename=".f90"><codeline><highlight class="normal">type(surf_diff_type)<sp/>::<sp/>atm%Surf_Diff</highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:,:)</highlight><highlight class="normal"><sp/>::<sp/>Atm%Surf_Diff%dtmass<sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!dt/mass<sp/>where<sp/>dt=atmospheric<sp/>time<sp/>step<sp/>((i+1)=(i-1)<sp/>for<sp/>leapfrog)(s)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>mass<sp/>=<sp/>mass<sp/>per<sp/>unit<sp/>area<sp/>of<sp/>lowest<sp/>atmosphehic<sp/>layer<sp/><sp/>(Kg/m2))</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atm%Surf_Diff%delta_t<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>increment<sp/>((i+1)<sp/>=<sp/>(i-1)<sp/>for<sp/>leapfrog)<sp/>in<sp/>temperature<sp/>of</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>lowest<sp/>atmospheric<sp/>layer<sp/><sp/>(K)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atm%Surf_Diff%delta_q<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>increment<sp/>((i+1)<sp/>=<sp/>(i-1)<sp/>for<sp/>leapfrog)<sp/>in<sp/>specific<sp/>humidity<sp/>of</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>lowest<sp/>atmospheric<sp/>layer<sp/>(nondimensional<sp/>--<sp/>Kg/Kg)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atm%Surf_Diff%dflux_t<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>derivative<sp/>of<sp/>implicit<sp/>part<sp/>of<sp/>downward<sp/>temperature<sp/>flux<sp/>at<sp/>top<sp/>of</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>lowest<sp/>atmospheric<sp/>layer<sp/>with<sp/>respect<sp/>to<sp/>temperature</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>of<sp/>lowest<sp/>atmospheric<sp/>layer<sp/>(Kg/(m2<sp/>s))</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atm%Surf_Diff%dflux_q<sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>derivative<sp/>of<sp/>implicit<sp/>part<sp/>of<sp/>downward<sp/>moisture<sp/>flux<sp/>at<sp/>top<sp/>of</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>lowest<sp/>atmospheric<sp/>layer<sp/>with<sp/>respect<sp/>to<sp/>specific<sp/>humidity<sp/>of</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>of<sp/>lowest<sp/>atmospheric<sp/>layer(kg/(m2<sp/>s))</highlight></codeline>
</programlisting></para></sect2>
<sect2 id="full_2flux__exchange_8_f90_1Land">
<title>Land</title>
<para><programlisting filename=".f90"><codeline><highlight class="normal">type(land_boundary_data_type)<sp/>::<sp/>land</highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:)</highlight><highlight class="normal"><sp/>::<sp/>Land%lon_bnd<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>longitude<sp/>axis<sp/>grid<sp/>box<sp/>boundaries<sp/>in<sp/>radians</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>must<sp/>be<sp/>monotonic</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land%lat_bnd<sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>latitude<sp/>axis<sp/>grid<sp/>box<sp/>boundaries<sp/>in<sp/>radians</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>must<sp/>be<sp/>monotonic</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:,:,:)</highlight><highlight class="normal"><sp/>::<sp/>Land%mask<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>land/sea<sp/>mask<sp/>(true<sp/>for<sp/>land)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Land%glacier<sp/></highlight><highlight class="comment">!<sp/>glacier<sp/>mask<sp/><sp/>(true<sp/>for<sp/>glacier)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:,:,:)</highlight><highlight class="normal"><sp/>::<sp/>Land%tile_size<sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/><sp/>fractional<sp/>area<sp/>of<sp/>each<sp/>tile<sp/>(partition)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Land%t_surf<sp/><sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>temperature<sp/>(deg<sp/>k)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Land%albedo<sp/><sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>albedo<sp/>(fraction)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Land%rough_mom<sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>roughness<sp/>for<sp/>momentum<sp/>(m)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Land%rough_heat<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>roughness<sp/>for<sp/>heat/moisture<sp/>(m)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Land%stomatal<sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>stomatal<sp/>resistance</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Land%snow<sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>snow<sp/>depth<sp/>(water<sp/>equivalent)<sp/>(kg/m2)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Land%water<sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>water<sp/>depth<sp/>of<sp/>the<sp/>uppermost<sp/>bucket<sp/>(kg/m2)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Land%max_water<sp/><sp/><sp/><sp/>!<sp/>maximum<sp/>water<sp/>depth<sp/>allowed<sp/>in<sp/>the<sp/>uppermost<sp/>bucket<sp/>(kg/m2)</highlight></codeline>
</programlisting></para></sect2>
<sect2 id="full_2flux__exchange_8_f90_1Ice">
<title>Ice</title>
<para><programlisting><codeline><highlight class="normal">type<sp/>(ice_boundary_data_type)<sp/>::<sp/>Ice</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">real,<sp/>dimension(:)<sp/>::<sp/>Ice%lon_bnd<sp/><sp/><sp/><sp/>&amp;<sp/>!<sp/>longitude<sp/>axis<sp/>grid<sp/>box<sp/>boundaries<sp/>for<sp/>temperature<sp/>points</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>in<sp/>radians<sp/>(must<sp/>be<sp/>monotonic)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%lat_bnd<sp/><sp/><sp/><sp/>&amp;<sp/>!<sp/>latitude<sp/>axis<sp/>grid<sp/>box<sp/>boundaries<sp/>for<sp/>temperature<sp/>points</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>in<sp/>radians<sp/>(must<sp/>be<sp/>monotonic)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%lon_bnd_uv<sp/>&amp;<sp/>!<sp/>longitude<sp/>axis<sp/>grid<sp/>box<sp/>boundaries<sp/>for<sp/>momentum<sp/>points</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>in<sp/>radians<sp/>(must<sp/>be<sp/>monotonic)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%lat_bnd_uv<sp/><sp/><sp/>!<sp/>latitude<sp/>axis<sp/>grid<sp/>box<sp/>boundaries<sp/>for<sp/>momentum<sp/>points</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>in<sp/>radians<sp/>(must<sp/>be<sp/>monotonic)</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">logical,<sp/>dimension(:,:,:)<sp/>::<sp/>Ice%mask<sp/><sp/><sp/><sp/>&amp;<sp/>!<sp/>ocean/land<sp/>mask<sp/>for<sp/>temperature<sp/>points</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>(true<sp/>for<sp/>ocean,<sp/>with<sp/>or<sp/>without<sp/>ice)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%mask_uv<sp/>&amp;<sp/>!<sp/>ocean/land<sp/>mask<sp/>for<sp/>momentum<sp/>points</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>(true<sp/>for<sp/>ocean,<sp/>with<sp/>or<sp/>without<sp/>ice)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%ice_mask<sp/><sp/>!<sp/>optional<sp/>ice<sp/>mask<sp/>(true<sp/>for<sp/>ice)</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">real,<sp/>dimension(:,:,:)<sp/>::<sp/>Ice%part_size<sp/><sp/>&amp;<sp/>!<sp/>fractional<sp/>area<sp/>of<sp/>each<sp/>partition<sp/>of<sp/>a<sp/>temperature<sp/>grid<sp/>box</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%part_size_uv<sp/>!<sp/>fractional<sp/>area<sp/>of<sp/>each<sp/>partition<sp/>of<sp/>a<sp/>momentum<sp/>grid<sp/>box</highlight></codeline>
</programlisting></para><para>The following fields are located on the ice top grid</para><para><programlisting filename=".f90"><codeline><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:,:,:)</highlight><highlight class="normal"><sp/>::<sp/>Ice%t_surf<sp/><sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>temperature<sp/>(deg<sp/>k)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%albedo<sp/><sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>albedo<sp/>(fraction)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%rough_mom<sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>roughness<sp/>for<sp/>momentum<sp/>(m)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%rough_heat<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>roughness<sp/>for<sp/>heat/moisture<sp/>(m)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%u_surf<sp/><sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>zonal<sp/>(ocean/ice)<sp/>current<sp/>at<sp/>the<sp/>surface<sp/>(m/s)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%v_surf<sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>meridional<sp/>(ocean/ice)<sp/>current<sp/>at<sp/>the<sp/>surface<sp/>(m/s)</highlight></codeline>
</programlisting></para><para>The following fields are located on the ice bottom grid</para><para><programlisting filename=".f90"><codeline><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:,:,:)</highlight><highlight class="normal"><sp/>::<sp/>Ice%flux_u<sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>zonal<sp/>wind<sp/>stress<sp/>(Pa)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%flux_v<sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>meridional<sp/>wind<sp/>stress<sp/>(Pa)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%flux_t<sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>sensible<sp/>heat<sp/>flux<sp/>(w/m2)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%flux_q<sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>specific<sp/>humidity<sp/>flux<sp/>(kg/m2/s)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%flux_sw<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>net<sp/>(down-up)<sp/>shortwave<sp/>flux<sp/>(w/m2)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%flux_lw<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>net<sp/>(down-up)<sp/>longwave<sp/>flux<sp/>(w/m2)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%lprec<sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>mass<sp/>of<sp/>liquid<sp/>precipitation<sp/>since<sp/>last<sp/>time<sp/>step<sp/>(Kg/m2)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%fprec<sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>mass<sp/>of<sp/>frozen<sp/>precipitation<sp/>since<sp/>last<sp/>time<sp/>step<sp/>(Kg/m2)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice%runoff<sp/><sp/><sp/><sp/>!<sp/>mass<sp/>of<sp/>runoff<sp/>water<sp/>since<sp/>last<sp/>time<sp/>step<sp/>(Kg/m2)</highlight></codeline>
</programlisting></para></sect2>
<sect2 id="full_2flux__exchange_8_f90_1Ocean">
<title>Ocean</title>
<para><programlisting filename=".f90"><codeline><highlight class="normal">type(ocean_boundary_data_type)<sp/>::<sp/>ocean</highlight></codeline>
<codeline><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:)</highlight><highlight class="normal"><sp/>::<sp/>Ocean%Data%lon_bnd<sp/><sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>longitude<sp/>axis<sp/>grid<sp/>box<sp/>boundaries<sp/>for<sp/>temperature</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>points<sp/>on<sp/>the<sp/>ocean<sp/>DATA<sp/>GRID<sp/>(radians)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean%Data%lat_bnd<sp/><sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>latitude<sp/>axis<sp/>grid<sp/>box<sp/>boundaries<sp/>for<sp/>temperature</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>points<sp/>on<sp/>the<sp/>ocean<sp/>DATA<sp/>GRID<sp/>(radians)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean%Data%lon_bnd_uv<sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>longitude<sp/>axis<sp/>grid<sp/>box<sp/>boundaries<sp/>for<sp/>momentum</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>points<sp/>on<sp/>the<sp/>ocean<sp/>DATA<sp/>GRID<sp/>(radians)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean%Data%lat_bnd_uv<sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>latitude<sp/>axis<sp/>grid<sp/>box<sp/>boundaries<sp/>for<sp/>momentum</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>points<sp/>on<sp/>the<sp/>ocean<sp/>DATA<sp/>GRID<sp/>(radians)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean%Ocean%lon_bnd<sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>longitude<sp/>axis<sp/>grid<sp/>box<sp/>boundaries<sp/>for<sp/>temperature</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>points<sp/>on<sp/>the<sp/>ocean<sp/>MODEL<sp/>GRID<sp/>(radians)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean%Ocean%lat_bnd<sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>latitude<sp/>axis<sp/>grid<sp/>box<sp/>boundaries<sp/>for<sp/>temperature</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>points<sp/>on<sp/>the<sp/>ocean<sp/>MODEL<sp/>GRID<sp/>(radians)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean%Ocean%lon_bnd_uv<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>longitude<sp/>axis<sp/>grid<sp/>box<sp/>boundaries<sp/>for<sp/>momentum</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>points<sp/>on<sp/>the<sp/>ocean<sp/>MODEL<sp/>GRID<sp/>(radians)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean%Ocean%lat_bnd_uv<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>latitude<sp/>axis<sp/>grid<sp/>box<sp/>boundaries<sp/>for<sp/>momentum</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>points<sp/>on<sp/>the<sp/>ocean<sp/>model<sp/>grid(radians)</highlight></codeline>
</programlisting></para><para><simplesect kind="note"><para>The data values in all longitude and latitude grid box boundary array must be monotonic.</para></simplesect>
<programlisting filename=".f90"><codeline><highlight class="keywordtype">logical</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:,:)</highlight><highlight class="normal"><sp/>::<sp/>Ocean%Data%mask<sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>ocean/land<sp/>mask<sp/>for<sp/>temperature<sp/>points<sp/>on<sp/>the<sp/>ocean</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>DATA<sp/>GRID<sp/>(true<sp/>for<sp/>ocean)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean%Data%mask_uv<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>ocean/land<sp/>mask<sp/>for<sp/>momentum<sp/>points<sp/>on<sp/>the<sp/>ocean</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>DATA<sp/>GRID<sp/>(true<sp/>for<sp/>ocean)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean%Ocean%mask<sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>ocean/land<sp/>mask<sp/>for<sp/>temperature<sp/>points<sp/>on<sp/>the<sp/>ocean</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>MODEL<sp/>GRID<sp/>(true<sp/>for<sp/>ocean)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean%Ocean%mask_uv<sp/><sp/></highlight><highlight class="comment">!<sp/>ocean/land<sp/>mask<sp/>for<sp/>momentum<sp/>points<sp/>on<sp/>the<sp/>ocean</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>MODEL<sp/>GRID<sp/>(true<sp/>for<sp/>ocean)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:,:)</highlight><highlight class="normal"><sp/>::<sp/>Ocean%t_surf_data<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>temperature<sp/>on<sp/>the<sp/>ocean<sp/>DATA<sp/>GRID<sp/>(deg<sp/>k)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ocean%t_surf<sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>temperature<sp/>on<sp/>the<sp/>ocean<sp/>MODEL<sp/>GRID<sp/>(deg<sp/>k)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ocean%u_surf<sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>zonal<sp/>ocean<sp/>current<sp/>at<sp/>the<sp/>surface<sp/>on<sp/>the<sp/>ocean</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>MODEL<sp/>GRID<sp/>(m/s)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean%v_surf<sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>meridional<sp/>ocean<sp/>current<sp/>at<sp/>the<sp/>surface<sp/>on<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>ocean<sp/>MODEL<sp/>GRID<sp/>(m/s)</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean%frazil<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>frazil<sp/>at<sp/>temperature<sp/>points<sp/>on<sp/>the<sp/>ocean<sp/>model<sp/>grid</highlight></codeline>
</programlisting> </para></sect2>
</sect1>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">!***********************************************************************</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">!*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GNU<sp/>Lesser<sp/>General<sp/>Public<sp/>License</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">!*</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>This<sp/>file<sp/>is<sp/>part<sp/>of<sp/>the<sp/>GFDL<sp/>Flexible<sp/>Modeling<sp/>System<sp/>(FMS)<sp/>Coupler.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="comment">!*</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>FMS<sp/>Coupler<sp/>is<sp/>free<sp/>software:<sp/>you<sp/>can<sp/>redistribute<sp/>it<sp/>and/or<sp/>modify</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>it<sp/>under<sp/>the<sp/>terms<sp/>of<sp/>the<sp/>GNU<sp/>Lesser<sp/>General<sp/>Public<sp/>License<sp/>as</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>published<sp/>by<sp/>the<sp/>Free<sp/>Software<sp/>Foundation,<sp/>either<sp/>version<sp/>3<sp/>of<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>License,<sp/>or<sp/>(at<sp/>your<sp/>option)<sp/>any<sp/>later<sp/>version.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="comment">!*</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>FMS<sp/>Coupler<sp/>is<sp/>distributed<sp/>in<sp/>the<sp/>hope<sp/>that<sp/>it<sp/>will<sp/>be<sp/>useful,<sp/>but</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>WITHOUT<sp/>ANY<sp/>WARRANTY;<sp/>without<sp/>even<sp/>the<sp/>implied<sp/>warranty<sp/>of</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>MERCHANTABILITY<sp/>or<sp/>FITNESS<sp/>FOR<sp/>A<sp/>PARTICULAR<sp/>PURPOSE.<sp/><sp/>See<sp/>the<sp/>GNU</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>General<sp/>Public<sp/>License<sp/>for<sp/>more<sp/>details.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="comment">!*</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>You<sp/>should<sp/>have<sp/>received<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>GNU<sp/>Lesser<sp/>General<sp/>Public</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>License<sp/>along<sp/>with<sp/>FMS<sp/>Coupler.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>If<sp/>not,<sp/>see<sp/>&lt;http://www.gnu.org/licenses/&gt;.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="comment">!***********************************************************************</highlight></codeline>
<codeline lineno="99"></codeline>
<codeline lineno="482" refid="namespaceflux__exchange__mod" refkind="compound"><highlight class="keyword">module</highlight><highlight class="normal"><sp/><ref refid="namespaceflux__exchange__mod" kindref="compound">flux_exchange_mod</ref></highlight></codeline>
<codeline lineno="483"><highlight class="normal"></highlight></codeline>
<codeline lineno="484"><highlight class="normal"></highlight></codeline>
<codeline lineno="485"><highlight class="normal"></highlight><highlight class="comment">!model_boundary_data_type<sp/>contains<sp/>all<sp/>model<sp/>fields<sp/>at<sp/>the<sp/>boundary.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"></highlight><highlight class="comment">!model1_model2_boundary_type<sp/>contains<sp/>fields<sp/>that<sp/>model2<sp/>gets</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="487"><highlight class="normal"></highlight><highlight class="comment">!from<sp/>model1,<sp/>may<sp/>also<sp/>include<sp/>fluxes.<sp/>These<sp/>are<sp/>declared<sp/>by</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="488"><highlight class="normal"></highlight><highlight class="comment">!flux_exchange_mod<sp/>and<sp/>have<sp/>private<sp/>components.<sp/>All<sp/>model<sp/>fields<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"></highlight><highlight class="comment">!model_boundary_data_type<sp/>may<sp/>not<sp/>be<sp/>exchanged.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="490"><highlight class="normal"></highlight><highlight class="comment">!will<sp/>support<sp/>3<sp/>types<sp/>of<sp/>flux_exchange:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"></highlight><highlight class="comment">!REGRID:<sp/>physically<sp/>distinct<sp/>grids,<sp/>via<sp/>xgrid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="492"><highlight class="normal"></highlight><highlight class="comment">!REDIST:<sp/>same<sp/>grid,<sp/>transfer<sp/>in<sp/>index<sp/>space<sp/>only</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"></highlight><highlight class="comment">!DIRECT:<sp/>same<sp/>grid,<sp/>same<sp/>decomp,<sp/>direct<sp/>copy</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"></highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">fms</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">fmsconstants,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>rdgas,<sp/>rvgas,<sp/>cp_air,<sp/>stefan,<sp/>wtmair,<sp/>&amp;</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hlv,<sp/>hlf,<sp/>radius,<sp/>pi,<sp/>cp_ocean,<sp/>wtmco2,<sp/>wtmc</highlight></codeline>
<codeline lineno="498"><highlight class="normal"></highlight></codeline>
<codeline lineno="499"><highlight class="normal"></highlight><highlight class="comment">!!<sp/>Components</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">land_model_mod,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>lnd_stock_pe</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">ocean_model_mod,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>ocean_stock_pe</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">atmos_model_mod,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>atm_stock_pe</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod" kindref="compound">atm_land_ice_flux_exchange_mod</ref>,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ab8675556ecdbebfb8b3093fadbe11cde" kindref="member">atm_land_ice_flux_exchange_init</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae7a53520e8a084f5fa930c5c18c85b54" kindref="member">sfc_boundary_layer</ref></highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod" kindref="compound">atm_land_ice_flux_exchange_mod</ref>,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae90760b8fd57a82bc54db9ece86486ba" kindref="member">generate_sfc_xgrid</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a377e367901950e4541859f65655b6f38" kindref="member">flux_down_from_atmos</ref></highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod" kindref="compound">atm_land_ice_flux_exchange_mod</ref>,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a9ff1868e71257630777ac2d9c8b6180c" kindref="member">flux_up_to_atmos</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ad11a70fa9758ae36a312504e589b3c1a" kindref="member">atm_stock_integrate</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af00a10abb94ffaa2f305e00de92362bc" kindref="member">send_ice_mask_sic</ref></highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod" kindref="compound">atm_land_ice_flux_exchange_mod</ref>,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b47968fcb9188a68db2b7b8e1ea7a0f" kindref="member">flux_atmos_to_ocean</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac8716ce7e07543b081c151bd0b24d7d1" kindref="member">flux_ex_arrays_dealloc</ref></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal"><ref refid="namespaceland__ice__flux__exchange__mod" kindref="compound">land_ice_flux_exchange_mod</ref>,<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/><ref refid="namespaceland__ice__flux__exchange__mod_1a7430ed2b8895cbe33376aaa6315ea0da" kindref="member">flux_land_to_ice</ref>,<sp/><ref refid="namespaceland__ice__flux__exchange__mod_1a0a8f20fe83d26714842110feea23aea6" kindref="member">land_ice_flux_exchange_init</ref></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal"><ref refid="namespaceice__ocean__flux__exchange__mod" kindref="compound">ice_ocean_flux_exchange_mod</ref>,<sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/><ref refid="namespaceice__ocean__flux__exchange__mod_1a63be7a22389a38bfd7f7e8aafc2f81d3" kindref="member">ice_ocean_flux_exchange_init</ref></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal"><ref refid="namespaceice__ocean__flux__exchange__mod" kindref="compound">ice_ocean_flux_exchange_mod</ref>,<sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/><ref refid="namespaceice__ocean__flux__exchange__mod_1a5270f15d181575b7559f4664afcd987a" kindref="member">flux_ocean_to_ice</ref>,<sp/><ref refid="namespaceice__ocean__flux__exchange__mod_1a2af0c159f5b00bd98d7f8339761df29e" kindref="member">flux_ocean_to_ice_finish</ref></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal"><ref refid="namespaceice__ocean__flux__exchange__mod" kindref="compound">ice_ocean_flux_exchange_mod</ref>,<sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/><ref refid="namespaceice__ocean__flux__exchange__mod_1afcc66b7731a985e1916e5ac4a303df37" kindref="member">flux_ice_to_ocean</ref>,<sp/><ref refid="namespaceice__ocean__flux__exchange__mod_1a1f894795596097d716f953bbfdb9dc80" kindref="member">flux_ice_to_ocean_finish</ref></highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal"><ref refid="namespaceice__ocean__flux__exchange__mod" kindref="compound">ice_ocean_flux_exchange_mod</ref>,<sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/><ref refid="namespaceice__ocean__flux__exchange__mod_1ac7d12dcdb5b25d4a1bb38935360cceab" kindref="member">flux_ice_to_ocean_stocks</ref>,<sp/><ref refid="namespaceice__ocean__flux__exchange__mod_1ac5daa11e6f312156be99d617a705bae8" kindref="member">flux_ocean_from_ice_stocks</ref></highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">atmos_model_mod,<sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>atmos_data_type,<sp/>land_ice_atmos_boundary_type</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">ocean_model_mod,<sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>ocean_public_type,<sp/>ice_ocean_boundary_type</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">ocean_model_mod,<sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>ocean_state_type</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal"><ref refid="namespaceice__model__mod" kindref="compound">ice_model_mod</ref>,<sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/><ref refid="structice__model__mod_1_1ice__data__type" kindref="compound">ice_data_type</ref>,<sp/>land_ice_boundary_type,<sp/>&amp;</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean_ice_boundary_type,<sp/><ref refid="structice__model__mod_1_1atmos__ice__boundary__type" kindref="compound">atmos_ice_boundary_type</ref>,<sp/>ice_stock_pe</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">land_model_mod,<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>land_data_type,<sp/>atmos_land_boundary_type</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">atmos_ocean_fluxes_mod,<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>atmos_ocean_fluxes_init,<sp/>atmos_ocean_type_fluxes_init</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal"><ref refid="namespaceatmos__ocean__fluxes__calc__mod" kindref="compound">atmos_ocean_fluxes_calc_mod</ref>,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/><ref refid="namespaceatmos__ocean__fluxes__calc__mod_1acc10568af1ebdd92581183632c4e1f74" kindref="member">atmos_ocean_fluxes_calc</ref></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">ocean_model_mod,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>ocean_model_init_sfc,<sp/>ocean_model_flux_init</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">atmos_tracer_driver_mod,<sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>atmos_tracer_flux_init</highlight></codeline>
<codeline lineno="522"><highlight class="normal"></highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">implicit<sp/>none</highlight><highlight class="normal"><sp/>;<sp/></highlight><highlight class="keywordtype">private</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="524"><highlight class="normal"></highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">public</highlight><highlight class="normal"><sp/>::<sp/><ref refid="namespaceflux__exchange__mod_1aa0a4db6845eb6ba4aa2246e67c9bcc6b" kindref="member">flux_exchange_init</ref>,<sp/><ref refid="namespaceflux__exchange__mod_1a9d5d9cb2721d5b49e6dfbaefa89185f8" kindref="member">gas_exchange_init</ref>,<sp/>&amp;</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceflux__exchange__mod_1ac23f45f5b115ee4104491181339b0afd" kindref="member">sfc_boundary_layer</ref>,<sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>generate_sfc_xgrid,<sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceflux__exchange__mod_1afe03028b95b28b886955e918dbdac585" kindref="member">flux_down_from_atmos</ref>,<sp/>&amp;</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceflux__exchange__mod_1a1d11e5795efdb294286c17959719dbe9" kindref="member">flux_up_to_atmos</ref>,<sp/><sp/><sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceland__ice__flux__exchange__mod_1a7430ed2b8895cbe33376aaa6315ea0da" kindref="member">flux_land_to_ice</ref>,<sp/><sp/><sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b47968fcb9188a68db2b7b8e1ea7a0f" kindref="member">flux_atmos_to_ocean</ref>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac8716ce7e07543b081c151bd0b24d7d1" kindref="member">flux_ex_arrays_dealloc</ref>,&amp;</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>flux_ice_to_ocean,<sp/><sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>flux_ice_to_ocean_finish,<sp/>&amp;</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>flux_ocean_to_ice,<sp/><sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>flux_ocean_to_ice_finish,<sp/>&amp;</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceflux__exchange__mod_1a905b179ee9688d2feeef94f3417b25e5" kindref="member">flux_check_stocks</ref>,<sp/><sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceflux__exchange__mod_1a8482ebe698f25da2d177b2508fa9d2b8" kindref="member">flux_init_stocks</ref>,<sp/><sp/><sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceice__ocean__flux__exchange__mod_1ac7d12dcdb5b25d4a1bb38935360cceab" kindref="member">flux_ice_to_ocean_stocks</ref>,&amp;</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceice__ocean__flux__exchange__mod_1ac5daa11e6f312156be99d617a705bae8" kindref="member">flux_ocean_from_ice_stocks</ref>,&amp;</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>send_ice_mask_sic</highlight></codeline>
<codeline lineno="542"><highlight class="normal"></highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!-----------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">character(len=128)</highlight><highlight class="normal"><sp/>::<sp/>version<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;$Id$&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">character(len=128)</highlight><highlight class="normal"><sp/>::<sp/>tag<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;$Name$&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>do_init<sp/>=<sp/>.true.</highlight></codeline>
<codeline lineno="548"><highlight class="normal"></highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">parameter</highlight><highlight class="normal"><sp/>::<sp/>bound_tol<sp/>=<sp/>1e-7</highlight></codeline>
<codeline lineno="550"><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">parameter</highlight><highlight class="normal"><sp/>::<sp/>d622<sp/>=<sp/>rdgas/rvgas</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">parameter</highlight><highlight class="normal"><sp/>::<sp/>d378<sp/>=<sp/>1.0-d622</highlight></codeline>
<codeline lineno="553"><highlight class="normal"></highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal"><sp/>::<sp/>z_ref_heat<sp/>=<sp/><sp/>2.</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal"><sp/>::<sp/>z_ref_mom<sp/><sp/>=<sp/>10.</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>do_area_weighted_flux<sp/>=<sp/>.false.</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>debug_stocks<sp/>=<sp/>.false.</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>divert_stocks_report<sp/>=<sp/>.false.</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>do_runoff<sp/>=<sp/>.true.<sp/></highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>do_forecast<sp/>=<sp/>.false.</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>nblocks<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="563"><highlight class="normal"></highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>partition_fprec_from_lprec<sp/>=<sp/>.false.<sp/><sp/></highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">parameter</highlight><highlight class="normal"><sp/><sp/><sp/><sp/>::<sp/>tfreeze<sp/>=<sp/>273.15</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>scale_precip_2d<sp/>=<sp/>.false.</highlight></codeline>
<codeline lineno="569"><highlight class="normal"></highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/>namelist<sp/>/flux_exchange_nml/<sp/>z_ref_heat,<sp/>z_ref_mom,&amp;</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>do_area_weighted_flux,<sp/>debug_stocks,<sp/>divert_stocks_report,<sp/>do_runoff,<sp/>do_forecast,<sp/>nblocks,&amp;</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>partition_fprec_from_lprec,<sp/>scale_precip_2d</highlight></codeline>
<codeline lineno="573"><highlight class="normal"></highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>gas_fluxes_initialized<sp/>=<sp/>.false.<sp/><sp/></highlight><highlight class="comment">!<sp/>This<sp/>is<sp/>set<sp/>to<sp/>true<sp/>when<sp/>the<sp/>following<sp/>types<sp/>are<sp/>initialized.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsCoupler1dBC_type),<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/>::<sp/>ex_gas_fields_atm<sp/><sp/></highlight><highlight class="comment">!<sp/>gas<sp/>fields<sp/>in<sp/>atm</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsCoupler1dBC_type),<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/>::<sp/>ex_gas_fields_ice<sp/><sp/></highlight><highlight class="comment">!<sp/>gas<sp/>fields<sp/>atop<sp/>the<sp/>ice<sp/>or<sp/>ocean</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsCoupler1dBC_type),<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/>::<sp/>ex_gas_fluxes<sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>gas<sp/>fluxes<sp/>between<sp/>the<sp/>atm<sp/>and<sp/>ocean</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="587"><highlight class="normal"></highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>ni_atm,<sp/>nj_atm</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(3)</highlight><highlight class="normal"><sp/>::<sp/>ccc</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!Balaji:<sp/>clocks<sp/>moved<sp/>into<sp/>flux_exchange</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>cplClock</highlight></codeline>
<codeline lineno="592"><highlight class="normal"></highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>Exchange<sp/>grid<sp/>indices</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal"><sp/><sp/><sp/><sp/>::<sp/>Dt_atm,<sp/>Dt_cpl</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal"><sp/><sp/><sp/><sp/>::<sp/>ATM_PRECIP_NEW</highlight></codeline>
<codeline lineno="596"><highlight class="normal"></highlight></codeline>
<codeline lineno="597"><highlight class="normal"></highlight><highlight class="keyword">contains</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="598"><highlight class="normal"></highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!#######################################################################</highlight></codeline>
<codeline lineno="607"><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceflux__exchange__mod_1a9d5d9cb2721d5b49e6dfbaefa89185f8" kindref="member">gas_exchange_init</ref><sp/>(gas_fields_atm,<sp/>gas_fields_ice,<sp/>gas_fluxes)</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsCoupler1dBC_type),<sp/></highlight><highlight class="keywordtype">optional</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">pointer</highlight><highlight class="normal"><sp/>::<sp/>gas_fields_atm</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsCoupler1dBC_type),<sp/></highlight><highlight class="keywordtype">optional</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">pointer</highlight><highlight class="normal"><sp/>::<sp/>gas_fields_ice</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsCoupler1dBC_type),<sp/></highlight><highlight class="keywordtype">optional</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">pointer</highlight><highlight class="normal"><sp/>::<sp/>gas_fluxes</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="621"><highlight class="normal"></highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(.not.gas_fluxes_initialized)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_atmos_ocean_type_fluxes_init(<sp/>)</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">ocean_model_flux_init(<sp/>)</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">atmos_tracer_flux_init(<sp/>)</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_atmos_ocean_fluxes_init(ex_gas_fluxes,<sp/>ex_gas_fields_atm,<sp/>ex_gas_fields_ice)</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>gas_fluxes_initialized<sp/>=<sp/>.true.</highlight></codeline>
<codeline lineno="628"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="629"><highlight class="normal"></highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">present</highlight><highlight class="normal">(gas_fields_atm))<sp/>gas_fields_atm<sp/>=&gt;<sp/>ex_gas_fields_atm</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">present</highlight><highlight class="normal">(gas_fields_ice))<sp/>gas_fields_ice<sp/>=&gt;<sp/>ex_gas_fields_ice</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">present</highlight><highlight class="normal">(gas_fluxes))<sp/>gas_fluxes<sp/>=&gt;<sp/>ex_gas_fluxes</highlight></codeline>
<codeline lineno="633"><highlight class="normal"></highlight></codeline>
<codeline lineno="634"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceflux__exchange__mod_1a9d5d9cb2721d5b49e6dfbaefa89185f8" kindref="member">gas_exchange_init</ref></highlight></codeline>
<codeline lineno="635"><highlight class="normal"></highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!#######################################################################</highlight></codeline>
<codeline lineno="650"><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceflux__exchange__mod_1aa0a4db6845eb6ba4aa2246e67c9bcc6b" kindref="member">flux_exchange_init</ref><sp/>(<sp/>Time,<sp/>Atm,<sp/>Land,<sp/>Ice,<sp/>Ocean,<sp/>Ocean_state,&amp;</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atmos_ice_boundary,<sp/>land_ice_atmos_boundary,<sp/>&amp;</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land_ice_boundary,<sp/>ice_ocean_boundary,<sp/>ocean_ice_boundary,<sp/>&amp;</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>do_ocean,<sp/>slow_ice_ocean_pelist,<sp/>dt_atmos,<sp/>dt_cpld<sp/>)</highlight></codeline>
<codeline lineno="654"><highlight class="normal"></highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsTime_type),<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>::<sp/>Time</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_data_type),<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/><sp/>::<sp/>Atm</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(land_data_type),<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>::<sp/>Land</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(ice_data_type),<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/><sp/>::<sp/>Ice</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(ocean_public_type),<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/><sp/>::<sp/>Ocean</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(ocean_state_type),<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">pointer</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>Ocean_state</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>All<sp/>intent(OUT)<sp/>derived<sp/>types<sp/>with<sp/>pointer<sp/>components<sp/>must<sp/>be</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>COMPLETELY<sp/>allocated<sp/>here<sp/>and<sp/>in<sp/>subroutines<sp/>called<sp/>from<sp/>here;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>NO<sp/>pointer<sp/>components<sp/>should<sp/>have<sp/>been<sp/>allocated<sp/>before<sp/>entry<sp/>if<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>derived<sp/>type<sp/>has<sp/>intent(OUT)<sp/>otherwise<sp/>they<sp/>may<sp/>be<sp/>lost.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_ice_boundary_type),<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>atmos_ice_boundary</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(land_ice_atmos_boundary_type),</highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>land_ice_atmos_boundary</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(land_ice_boundary_type),<sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>land_ice_boundary</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(ice_ocean_boundary_type),<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>ice_ocean_boundary</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(ocean_ice_boundary_type),<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>ocean_ice_boundary</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/><sp/><sp/><sp/>::<sp/>do_ocean</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:)</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/><sp/><sp/><sp/>::<sp/>slow_ice_ocean_pelist</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">optional</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/><sp/><sp/><sp/>::<sp/>dt_atmos</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">optional</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/><sp/><sp/><sp/>::<sp/>dt_cpld</highlight></codeline>
<codeline lineno="680"><highlight class="normal"></highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">character(len=64)</highlight><highlight class="normal">,<sp/><sp/></highlight><highlight class="keywordtype">parameter</highlight><highlight class="normal"><sp/><sp/><sp/>::<sp/>grid_file<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;INPUT/grid_spec.nc&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>ierr,<sp/>io</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>logunit,<sp/>unit</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">character(len=256)</highlight><highlight class="normal"><sp/>::<sp/>errmsg</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>omp_get_num_threads,<sp/>nthreads</highlight></codeline>
<codeline lineno="686"><highlight class="normal"></highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-----------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"></highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/>initialize<sp/>atmos_ocean_fluxes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Setting<sp/>up<sp/>flux<sp/>types,<sp/>allocates<sp/>the<sp/>arrays.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="693"><highlight class="normal"></highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean_tracer_flux_init<sp/>is<sp/>called<sp/>first<sp/>since<sp/>it<sp/>has<sp/>the<sp/>meaningful<sp/>value<sp/>to<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/>for<sp/>the<sp/>input/output<sp/>file<sp/>names<sp/>for<sp/>the<sp/>tracer<sp/>flux<sp/>values<sp/>used<sp/>in<sp/>restarts.<sp/>These</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/>values<sp/>could<sp/>be<sp/>set<sp/>in<sp/>the<sp/>field<sp/>table,<sp/>and<sp/>this<sp/>ordering<sp/>allows<sp/>this.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/>atmos_tracer_flux_init<sp/>is<sp/>called<sp/>last<sp/>since<sp/>it<sp/>will<sp/>use<sp/>the<sp/>values<sp/>set<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean_tracer_flux_init<sp/>with<sp/>the<sp/>exception<sp/>of<sp/>atm_tr_index,<sp/>which<sp/>can<sp/>only</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/>be<sp/>meaningfully<sp/>set<sp/>from<sp/>the<sp/>atmospheric<sp/>model<sp/>(not<sp/>from<sp/>the<sp/>field<sp/>table)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="702"><highlight class="normal"></highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_sat_vapor_pres_init()</highlight></codeline>
<codeline lineno="704"><highlight class="normal"></highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/>nthreads<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>assign<sp/>nblocks<sp/>to<sp/>number<sp/>of<sp/>threads.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>PARALLEL</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$<sp/><sp/>nthreads<sp/>=<sp/>omp_get_num_threads()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>END<sp/>PARALLEL</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/>nblocks<sp/>=<sp/>nthreads</highlight></codeline>
<codeline lineno="711"><highlight class="normal"></highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-----------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/>logunit<sp/>=<sp/>fms_mpp_stdlog()</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-----<sp/>read<sp/>namelist<sp/>-------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="715"><highlight class="normal"></highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">read</highlight><highlight class="normal"><sp/>(fms_mpp_input_nml_file,<sp/>flux_exchange_nml,<sp/>iostat=io)</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/>ierr<sp/>=<sp/>fms_check_nml_error(io,<sp/></highlight><highlight class="stringliteral">&apos;flux_exchange_nml&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="718"><highlight class="normal"></highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-----<sp/>write<sp/>namelist<sp/>to<sp/>logfile<sp/>-----</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_write_version_number<sp/>(version,<sp/>tag)</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>fms_mpp_pe()<sp/>==<sp/>fms_mpp_root_pe()<sp/>)</highlight><highlight class="keyword">write</highlight><highlight class="normal">(<sp/>logunit,<sp/>nml=flux_exchange_nml<sp/>)</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(nblocks&lt;1)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_error_mesg<sp/>(</highlight><highlight class="stringliteral">&apos;flux_exchange_mod&apos;</highlight><highlight class="normal">,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;flux_exchange_nml<sp/>nblocks<sp/>must<sp/>be<sp/>positive&apos;</highlight><highlight class="normal">,<sp/>fatal)</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(nblocks<sp/>.NE.<sp/>nthreads)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">write</highlight><highlight class="normal">(errmsg,<sp/></highlight><highlight class="stringliteral">&apos;(a,i3,a,i3)&apos;</highlight><highlight class="normal">)</highlight><highlight class="stringliteral">&apos;flux_exchange_nml<sp/>nblocks<sp/>is<sp/>set<sp/>to<sp/>&apos;</highlight><highlight class="normal">,<sp/>nblocks,<sp/>&amp;</highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;<sp/>is<sp/>different<sp/>from<sp/>the<sp/>default<sp/>value<sp/>(number<sp/>of<sp/>threads)<sp/>=<sp/>&apos;</highlight><highlight class="normal">,<sp/>nthreads</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_error_mesg<sp/>(</highlight><highlight class="stringliteral">&apos;flux_exchange_mod&apos;</highlight><highlight class="normal">,<sp/>errmsg,<sp/>note)</highlight></codeline>
<codeline lineno="728"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="729"><highlight class="normal"></highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>required<sp/>by<sp/>stock_move,<sp/>all<sp/>fluxes<sp/>used<sp/>to<sp/>update<sp/>stocks<sp/>will<sp/>be<sp/>zero<sp/>if<sp/>dt_atmos,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>and<sp/>dt_cpld<sp/>are<sp/>absent</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/>dt_atm<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/>dt_cpl<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight><highlight class="keyword">present</highlight><highlight class="normal">(dt_atmos))<sp/>dt_atm<sp/>=<sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">(dt_atmos)</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight><highlight class="keyword">present</highlight><highlight class="normal">(dt_cpld<sp/>))<sp/>dt_cpl<sp/>=<sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">(dt_cpld)</highlight></codeline>
<codeline lineno="736"><highlight class="normal"></highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_ocean_model_area_elements(ocean%domain,<sp/>grid_file)</highlight></codeline>
<codeline lineno="738"><highlight class="normal"></highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>atm%pe<sp/>)</highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_set_current_pelist(atm%pelist)</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cplclock<sp/>=<sp/>fms_mpp_clock_id(<sp/></highlight><highlight class="stringliteral">&apos;Land-ice-atm<sp/>coupler&apos;</highlight><highlight class="normal">,<sp/>flags=fms_clock_flag_default,<sp/>grain=clock_component<sp/>)</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespaceflux__exchange__mod_1a9b9500d8c86af3e964c1558bb7ae464e" kindref="member">check_atm_grid</ref>(atm,<sp/>grid_file)</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">atm_land_ice_flux_exchange_init(time,<sp/>atm,<sp/>land,<sp/>ice,<sp/>atmos_ice_boundary,<sp/>land_ice_atmos_boundary,<sp/>&amp;</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dt_atm,<sp/>dt_cpl,<sp/>z_ref_heat,<sp/>z_ref_mom,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>do_area_weighted_flux,<sp/>do_forecast,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>partition_fprec_from_lprec,<sp/>scale_precip_2d,<sp/>nblocks,<sp/>cplclock,<sp/>&amp;</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gas_fields_atm,<sp/>ex_gas_fields_ice,<sp/>ex_gas_fluxes)</highlight></codeline>
<codeline lineno="748"><highlight class="normal"></highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespaceland__ice__flux__exchange__mod_1a0a8f20fe83d26714842110feea23aea6" kindref="member">land_ice_flux_exchange_init</ref>(land,<sp/>ice,<sp/>land_ice_boundary,<sp/>dt_cpl,<sp/>do_runoff,<sp/>cplclock)</highlight></codeline>
<codeline lineno="750"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="751"><highlight class="normal"></highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_set_current_pelist()</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">ice_ocean_flux_exchange_init(time,<sp/>ice,<sp/>ocean,<sp/>ocean_state,ice_ocean_boundary,<sp/>ocean_ice_boundary,<sp/>&amp;</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dt_cpl,<sp/>debug_stocks,<sp/>do_area_weighted_flux,<sp/>ex_gas_fields_ice,<sp/>ex_gas_fluxes,<sp/>do_ocean,<sp/>slow_ice_ocean_pelist)</highlight></codeline>
<codeline lineno="755"><highlight class="normal"></highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!----<sp/>done<sp/>----</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/>do_init<sp/>=<sp/>.false.</highlight></codeline>
<codeline lineno="758"><highlight class="normal"></highlight></codeline>
<codeline lineno="759"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceflux__exchange__mod_1aa0a4db6845eb6ba4aa2246e67c9bcc6b" kindref="member">flux_exchange_init</ref></highlight></codeline>
<codeline lineno="760"><highlight class="normal"></highlight></codeline>
<codeline lineno="766"><highlight class="normal"></highlight></codeline>
<codeline lineno="767"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceflux__exchange__mod_1a905b179ee9688d2feeef94f3417b25e5" kindref="member">flux_check_stocks</ref>(Time,<sp/>Atm,<sp/>Lnd,<sp/>Ice,<sp/>Ocn_state)</highlight></codeline>
<codeline lineno="768"><highlight class="normal"></highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsTime_type),<sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>Time</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_data_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">optional</highlight><highlight class="normal"><sp/>::<sp/>Atm</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(land_data_type),<sp/><sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">optional</highlight><highlight class="normal"><sp/>::<sp/>Lnd</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(ice_data_type),<sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">optional</highlight><highlight class="normal"><sp/>::<sp/>Ice</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(ocean_state_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">optional</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">pointer</highlight><highlight class="normal"><sp/>::<sp/>Ocn_state</highlight></codeline>
<codeline lineno="774"><highlight class="normal"></highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal"><sp/>::<sp/>ref_value</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>i</highlight></codeline>
<codeline lineno="777"><highlight class="normal"></highlight></codeline>
<codeline lineno="778"><highlight class="normal"></highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>1,<sp/>nelems</highlight></codeline>
<codeline lineno="780"><highlight class="normal"></highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight><highlight class="keyword">present</highlight><highlight class="normal">(atm))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ref_value<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">atm_stock_pe(atm,<sp/>index=i,<sp/></highlight><highlight class="keywordtype">value</highlight><highlight class="normal">=ref_value)</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(i==istock_water<sp/>.and.<sp/>atm%pe<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>decrease<sp/>the<sp/>Atm<sp/>stock<sp/>by<sp/>the<sp/>precip<sp/>adjustment<sp/>to<sp/>reflect<sp/>the<sp/>fact<sp/>that</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>after<sp/>an<sp/>update_atmos_up<sp/>call,<sp/>the<sp/>precip<sp/>will<sp/>be<sp/>that<sp/>of<sp/>the<sp/>future<sp/>time<sp/>step.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Thus,<sp/>the<sp/>stock<sp/>call<sp/>will<sp/>represent<sp/>the<sp/>(explicit<sp/>)<sp/>precip<sp/>at</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>the<sp/>beginning<sp/>of<sp/>the<sp/>preceding<sp/>time<sp/>step,<sp/>and<sp/>the<sp/>(implicit)<sp/>evap<sp/>at<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>end<sp/>of<sp/>the<sp/>preceding<sp/>time<sp/>step</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">atm_stock_integrate(atm,<sp/>atm_precip_new)</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ref_value<sp/>=<sp/>ref_value<sp/>+<sp/>atm_precip_new</highlight></codeline>
<codeline lineno="792"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="793"><highlight class="normal"></highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fms_stock_constants_atm_stock(i)%q_now<sp/>=<sp/>ref_value</highlight></codeline>
<codeline lineno="795"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="796"><highlight class="normal"></highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight><highlight class="keyword">present</highlight><highlight class="normal">(lnd))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ref_value<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">lnd_stock_pe(lnd,<sp/>index=i,<sp/></highlight><highlight class="keywordtype">value</highlight><highlight class="normal">=ref_value)</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fms_stock_constants_lnd_stock(i)%q_now<sp/>=<sp/>ref_value</highlight></codeline>
<codeline lineno="801"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="802"><highlight class="normal"></highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight><highlight class="keyword">present</highlight><highlight class="normal">(ice))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ref_value<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">ice_stock_pe(ice,<sp/>index=i,<sp/></highlight><highlight class="keywordtype">value</highlight><highlight class="normal">=ref_value)</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fms_stock_constants_ice_stock(i)%q_now<sp/>=<sp/>ref_value</highlight></codeline>
<codeline lineno="807"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="808"><highlight class="normal"></highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight><highlight class="keyword">present</highlight><highlight class="normal">(ocn_state))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ref_value<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">ocean_stock_pe(ocn_state,<sp/>index=i,<sp/></highlight><highlight class="keywordtype">value</highlight><highlight class="normal">=ref_value)</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fms_stock_constants_ocn_stock(i)%q_now<sp/>=<sp/>ref_value</highlight></codeline>
<codeline lineno="813"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="814"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="815"><highlight class="normal"></highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_stock_constants_stocks_report(time)</highlight></codeline>
<codeline lineno="817"><highlight class="normal"></highlight></codeline>
<codeline lineno="818"><highlight class="normal"></highlight></codeline>
<codeline lineno="819"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceflux__exchange__mod_1a905b179ee9688d2feeef94f3417b25e5" kindref="member">flux_check_stocks</ref></highlight></codeline>
<codeline lineno="820"><highlight class="normal"></highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!#######################################################################</highlight></codeline>
<codeline lineno="826"><highlight class="normal"></highlight></codeline>
<codeline lineno="827"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceflux__exchange__mod_1a8482ebe698f25da2d177b2508fa9d2b8" kindref="member">flux_init_stocks</ref>(Time,<sp/>Atm,<sp/>Lnd,<sp/>Ice,<sp/>Ocn_state)</highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsTime_type)<sp/>,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>Time</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_data_type)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>Atm</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(land_data_type)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>Lnd</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(ice_data_type)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>Ice</highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(ocean_state_type),<sp/></highlight><highlight class="keywordtype">pointer</highlight><highlight class="normal"><sp/>::<sp/>Ocn_state</highlight></codeline>
<codeline lineno="833"><highlight class="normal"></highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>i</highlight></codeline>
<codeline lineno="835"><highlight class="normal"></highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/>fms_stock_constants_stocks_file=fms_mpp_stdout()</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>If<sp/>the<sp/>divert_stocks_report<sp/>is<sp/>set<sp/>to<sp/>true,<sp/>write<sp/>the<sp/>stocks<sp/>to<sp/>a<sp/>new<sp/>file<sp/>&quot;stocks.out&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(fms_mpp_pe()==fms_mpp_root_pe()<sp/>.and.<sp/>divert_stocks_report)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">open</highlight><highlight class="normal">(newunit<sp/>=<sp/>fms_stock_constants_stocks_file,<sp/>file=</highlight><highlight class="stringliteral">&apos;stocks.out&apos;</highlight><highlight class="normal">,<sp/>status=</highlight><highlight class="stringliteral">&apos;replace&apos;</highlight><highlight class="normal">,<sp/>form=</highlight><highlight class="stringliteral">&apos;formatted&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="840"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="841"><highlight class="normal"></highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Initialize<sp/>stock<sp/>values</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>1,<sp/>nelems</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">atm_stock_pe(<sp/><sp/><sp/>atm<sp/>,<sp/>index=i,<sp/></highlight><highlight class="keywordtype">value</highlight><highlight class="normal">=fms_stock_constants_atm_stock(i)%q_start)</highlight></codeline>
<codeline lineno="845"><highlight class="normal"></highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(i==istock_water<sp/>.and.<sp/>atm%pe<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">atm_stock_integrate(atm,<sp/>atm_precip_new)</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fms_stock_constants_atm_stock(i)%q_start<sp/>=<sp/>fms_stock_constants_atm_stock(i)%q_start<sp/>+<sp/>atm_precip_new</highlight></codeline>
<codeline lineno="849"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="850"><highlight class="normal"></highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">lnd_stock_pe(<sp/><sp/><sp/>lnd<sp/>,<sp/>index=i,<sp/></highlight><highlight class="keywordtype">value</highlight><highlight class="normal">=fms_stock_constants_lnd_stock(i)%q_start)</highlight></codeline>
<codeline lineno="852"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">ice_stock_pe(<sp/><sp/><sp/>ice<sp/>,<sp/>index=i,<sp/></highlight><highlight class="keywordtype">value</highlight><highlight class="normal">=fms_stock_constants_ice_stock(i)%q_start)</highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">ocean_stock_pe(<sp/>ocn_state<sp/>,<sp/>index=i,<sp/></highlight><highlight class="keywordtype">value</highlight><highlight class="normal">=fms_stock_constants_ocn_stock(i)%q_start)</highlight></codeline>
<codeline lineno="854"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="855"><highlight class="normal"></highlight></codeline>
<codeline lineno="856"><highlight class="normal"></highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_stocks_report_init(time)</highlight></codeline>
<codeline lineno="858"><highlight class="normal"></highlight></codeline>
<codeline lineno="859"><highlight class="normal"></highlight></codeline>
<codeline lineno="860"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceflux__exchange__mod_1a8482ebe698f25da2d177b2508fa9d2b8" kindref="member">flux_init_stocks</ref></highlight></codeline>
<codeline lineno="861"><highlight class="normal"></highlight></codeline>
<codeline lineno="862"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceflux__exchange__mod_1a9b9500d8c86af3e964c1558bb7ae464e" kindref="member">check_atm_grid</ref>(Atm,<sp/>grid_file)</highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_data_type),<sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>Atm</highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">character(len=*)</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>grid_file</highlight></codeline>
<codeline lineno="865"><highlight class="normal"></highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>isg,<sp/>ieg,<sp/>jsg,<sp/>jeg</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>isc,<sp/>iec,<sp/>jsc,<sp/>jec</highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>isd,<sp/>ied,<sp/>jsd,<sp/>jed</highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>isc2,<sp/>iec2,<sp/>jsc2,<sp/>jec2</highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>nxg,<sp/>nyg,<sp/>ioff,<sp/>joff</highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>nlon,<sp/>nlat,<sp/>siz(4)</highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>i,<sp/>j</highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsMppDomain2D)<sp/>::<sp/>domain2</highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:,:)</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">allocatable</highlight><highlight class="normal"><sp/>::<sp/>tmpx,<sp/>tmpy</highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:)</highlight><highlight class="normal">,<sp/><sp/><sp/></highlight><highlight class="keywordtype">allocatable</highlight><highlight class="normal"><sp/>::<sp/>atmlonb,<sp/>atmlatb</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">character(len=256)</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>::<sp/>atm_mosaic_file,<sp/>tile_file,<sp/>buffer</highlight></codeline>
<codeline lineno="877"><highlight class="normal"></highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:)</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">allocatable</highlight><highlight class="normal"><sp/>::<sp/>pes</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsNetcdfFile_t)<sp/>::<sp/>grid_file_obj,<sp/>atm_mosaic_file_obj</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsNetcdfDomainFile_t)<sp/>::<sp/>tile_file_obj</highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">character(len=20)</highlight><highlight class="normal"><sp/>::<sp/>dim_names(2)</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>ppos</highlight></codeline>
<codeline lineno="883"><highlight class="normal"></highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_get_global_domain(atm%domain,<sp/>isg,<sp/>ieg,<sp/>jsg,<sp/>jeg,<sp/>xsize=nxg,<sp/>ysize=nyg)</highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_get_compute_domain(atm%domain,<sp/>isc,<sp/>iec,<sp/>jsc,<sp/>jec)</highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_get_data_domain(atm%domain,<sp/>isd,<sp/>ied,<sp/>jsd,<sp/>jed)</highlight></codeline>
<codeline lineno="887"><highlight class="normal"></highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(pes(fms_mpp_npes()))</highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_get_current_pelist(pes)</highlight></codeline>
<codeline lineno="891"><highlight class="normal"></highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>.not.<sp/>fms2_io_open_file(grid_file_obj,<sp/>grid_file,<sp/></highlight><highlight class="stringliteral">&quot;read&quot;</highlight><highlight class="normal">,<sp/>pelist=pes))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_error_mesg<sp/>(</highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_mod&apos;</highlight><highlight class="normal">,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="stringliteral">&apos;Error<sp/>opening<sp/>&apos;</highlight><highlight class="normal">//trim(grid_file),<sp/>fatal)</highlight></codeline>
<codeline lineno="895"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="896"><highlight class="normal"></highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight><highlight class="keyword">size</highlight><highlight class="normal">(atm%lon_bnd,1)<sp/>.NE.<sp/>iec-isc+2<sp/>.OR.<sp/></highlight><highlight class="keyword">size</highlight><highlight class="normal">(atm%lon_bnd,2)<sp/>.NE.<sp/>jec-jsc+2)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_error_mesg<sp/>(</highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_mod&apos;</highlight><highlight class="normal">,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;size<sp/>of<sp/>Atm%lon_bnd<sp/>does<sp/>not<sp/>match<sp/>the<sp/>Atm<sp/>computational<sp/>domain&apos;</highlight><highlight class="normal">,<sp/>fatal)</highlight></codeline>
<codeline lineno="900"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/><sp/><sp/>ioff<sp/>=<sp/>lbound(atm%lon_bnd,1)<sp/>-<sp/>isc</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/>joff<sp/>=<sp/>lbound(atm%lon_bnd,2)<sp/>-<sp/>jsc</highlight></codeline>
<codeline lineno="903"><highlight class="normal"></highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(fms2_io_variable_exists(grid_file_obj,<sp/></highlight><highlight class="stringliteral">&quot;AREA_ATM&quot;</highlight><highlight class="normal"><sp/>)<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>old<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms2_io_get_variable_size(grid_file_obj,<sp/></highlight><highlight class="stringliteral">&quot;AREA_ATM&quot;</highlight><highlight class="normal">,<sp/>siz(1:2))</highlight></codeline>
<codeline lineno="906"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nlon<sp/>=<sp/>siz(1)</highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nlat<sp/>=<sp/>siz(2)</highlight></codeline>
<codeline lineno="908"><highlight class="normal"></highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nlon<sp/>/=<sp/>nxg<sp/>.or.<sp/>nlat<sp/>/=<sp/>nyg)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fms_mpp_pe()==fms_mpp_root_pe())<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/>*,<sp/></highlight><highlight class="stringliteral">&apos;grid_spec.nc<sp/>has&apos;</highlight><highlight class="normal">,<sp/>nlon,<sp/></highlight><highlight class="stringliteral">&apos;longitudes,&apos;</highlight><highlight class="normal">,<sp/>nlat,<sp/></highlight><highlight class="stringliteral">&apos;latitudes;<sp/>&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;atmosphere<sp/>has&apos;</highlight><highlight class="normal">,<sp/>nxg,<sp/></highlight><highlight class="stringliteral">&apos;longitudes,&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nyg,<sp/></highlight><highlight class="stringliteral">&apos;latitudes<sp/>(see<sp/>xba.dat<sp/>and<sp/>yba.dat)&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="914"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_error_mesg<sp/>(</highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_mod&apos;</highlight><highlight class="normal">,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;grid_spec.nc<sp/>incompatible<sp/>with<sp/>atmosphere<sp/>resolution&apos;</highlight><highlight class="normal">,<sp/>fatal)</highlight></codeline>
<codeline lineno="917"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(<sp/>atmlonb(isg:ieg+1)<sp/>)</highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(<sp/>atmlatb(jsg:jeg+1)<sp/>)</highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms2_io_read_data(grid_file_obj,<sp/></highlight><highlight class="stringliteral">&apos;xba&apos;</highlight><highlight class="normal">,<sp/>atmlonb)</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms2_io_read_data(grid_file_obj,<sp/></highlight><highlight class="stringliteral">&apos;yba&apos;</highlight><highlight class="normal">,<sp/>atmlatb)</highlight></codeline>
<codeline lineno="922"><highlight class="normal"></highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i=isc,<sp/>iec+1</highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(abs(atmlonb(i)-atm%lon_bnd(i+ioff,jsc+joff)*45.0/atan(1.0))&gt;bound_tol)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/>*,<sp/></highlight><highlight class="stringliteral">&apos;GRID_SPEC/ATMOS<sp/>LONGITUDE<sp/>INCONSISTENCY<sp/>at<sp/>i=<sp/>&apos;</highlight><highlight class="normal">,i,<sp/></highlight><highlight class="stringliteral">&apos;:<sp/>&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atmlonb(i),<sp/><sp/>atm%lon_bnd(i+ioff,jsc+joff)*45.0/atan(1.0)</highlight></codeline>
<codeline lineno="927"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_error_mesg<sp/>(</highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_mod&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;grid_spec.nc<sp/>incompatible<sp/>with<sp/>atmosphere<sp/>longitudes<sp/>(see<sp/>xba.dat<sp/>and<sp/>yba.dat)&apos;</highlight><highlight class="normal">&amp;</highlight></codeline>
<codeline lineno="929"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>fatal)</highlight></codeline>
<codeline lineno="930"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="931"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="932"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>j=jsc,<sp/>jec+1</highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(abs(atmlatb(j)-atm%lat_bnd(isc+ioff,j+joff)*45.0/atan(1.0))&gt;bound_tol)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/>*,<sp/></highlight><highlight class="stringliteral">&apos;GRID_SPEC/ATMOS<sp/>LATITUDE<sp/>INCONSISTENCY<sp/>at<sp/>j=<sp/>&apos;</highlight><highlight class="normal">,j,<sp/></highlight><highlight class="stringliteral">&apos;:<sp/>&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atmlatb(j),<sp/><sp/>atm%lat_bnd(isc+ioff,<sp/>j+joff)*45.0/atan(1.0)</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_error_mesg<sp/>(</highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_mod&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;grid_spec.nc<sp/>incompatible<sp/>with<sp/>atmosphere<sp/>latitudes<sp/>(see<sp/>xba.dat<sp/>and<sp/>yba.dat)&apos;</highlight><highlight class="normal">&amp;</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>fatal)</highlight></codeline>
<codeline lineno="939"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="940"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">deallocate</highlight><highlight class="normal">(atmlonb,<sp/>atmlatb)</highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(fms2_io_variable_exists(grid_file_obj,<sp/></highlight><highlight class="stringliteral">&quot;atm_mosaic_file&quot;</highlight><highlight class="normal"><sp/>)<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>mosaic<sp/>grid<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms2_io_read_data(grid_file_obj,<sp/></highlight><highlight class="stringliteral">&apos;atm_mosaic_file&apos;</highlight><highlight class="normal">,<sp/>atm_mosaic_file)</highlight></codeline>
<codeline lineno="944"><highlight class="normal"></highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>.not.<sp/>fms2_io_open_file(atm_mosaic_file_obj,<sp/></highlight><highlight class="stringliteral">&quot;INPUT/&quot;</highlight><highlight class="normal">//trim(atm_mosaic_file)//</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;read&quot;</highlight><highlight class="normal">,<sp/>pelist=pes))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_error_mesg<sp/>(</highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_mod&apos;</highlight><highlight class="normal">,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="947"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="stringliteral">&apos;Error<sp/>opening<sp/>&apos;</highlight><highlight class="normal">//trim(atm_mosaic_file),<sp/>fatal)</highlight></codeline>
<codeline lineno="948"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="949"><highlight class="normal"></highlight></codeline>
<codeline lineno="950"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms2_io_read_data(atm_mosaic_file_obj,<sp/></highlight><highlight class="stringliteral">&quot;gridfiles&quot;</highlight><highlight class="normal">,<sp/>buffer,<sp/>corner=1)</highlight></codeline>
<codeline lineno="951"><highlight class="normal"></highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="953"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ppos<sp/>=<sp/>index(trim(buffer),</highlight><highlight class="stringliteral">&quot;.tile&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="954"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>ppos<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="955"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tile_file<sp/>=<sp/>buffer(1:ppos-1)//</highlight><highlight class="stringliteral">&quot;.nc&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="956"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="957"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tile_file<sp/>=<sp/>buffer</highlight></codeline>
<codeline lineno="958"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="959"><highlight class="normal"></highlight></codeline>
<codeline lineno="960"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms2_io_close_file(atm_mosaic_file_obj)</highlight></codeline>
<codeline lineno="961"><highlight class="normal"></highlight></codeline>
<codeline lineno="962"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_copy_domain(atm%domain,<sp/>domain2)</highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_create_super_grid_domain(domain2)</highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_define_io_domain<sp/><sp/>(domain2,<sp/>(/1,1/))</highlight></codeline>
<codeline lineno="965"><highlight class="normal"></highlight></codeline>
<codeline lineno="966"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_get_compute_domain(domain2,<sp/>isc2,<sp/>iec2,<sp/>jsc2,<sp/>jec2)</highlight></codeline>
<codeline lineno="967"><highlight class="normal"></highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(isc2<sp/>.NE.<sp/>2*isc-1<sp/>.OR.<sp/>iec2<sp/>.NE.<sp/>2*iec+1<sp/>.OR.<sp/>jsc2<sp/>.NE.<sp/>2*jsc-1<sp/>.OR.<sp/>jec2<sp/>.NE.<sp/>2*jec+1)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="969"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_error(fatal,<sp/></highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_mod:<sp/>supergrid<sp/>domain<sp/>is<sp/>not<sp/>set<sp/>properly&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="970"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="971"><highlight class="normal"></highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="973"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>.not.<sp/>fms2_io_open_file(tile_file_obj,<sp/></highlight><highlight class="stringliteral">&quot;INPUT/&quot;</highlight><highlight class="normal">//trim(tile_file)//</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;read&quot;</highlight><highlight class="normal">,<sp/>domain2))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="974"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_error_mesg<sp/>(</highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_mod&apos;</highlight><highlight class="normal">,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="975"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/></highlight><highlight class="stringliteral">&apos;Error<sp/>opening<sp/>&apos;</highlight><highlight class="normal">//trim(tile_file),<sp/>fatal)</highlight></codeline>
<codeline lineno="976"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="977"><highlight class="normal"></highlight></codeline>
<codeline lineno="978"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms2_io_get_variable_size(tile_file_obj,<sp/></highlight><highlight class="stringliteral">&apos;area&apos;</highlight><highlight class="normal">,<sp/>siz(1:2))</highlight></codeline>
<codeline lineno="979"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nlon<sp/>=<sp/>siz(1);<sp/>nlat<sp/>=<sp/>siz(2)</highlight></codeline>
<codeline lineno="980"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>mod(nlon,2)<sp/>.NE.<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_error(fatal,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="981"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_mod:<sp/>atmos<sp/>supergrid<sp/>longitude<sp/>size<sp/>can<sp/>not<sp/>be<sp/>divided<sp/>by<sp/>2&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>mod(nlat,2)<sp/>.NE.<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_error(fatal,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="983"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_mod:<sp/>atmos<sp/>supergrid<sp/>latitude<sp/>size<sp/>can<sp/>not<sp/>be<sp/>divided<sp/>by<sp/>2&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nlon<sp/>=<sp/>nlon/2</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nlat<sp/>=<sp/>nlat/2</highlight></codeline>
<codeline lineno="986"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nlon<sp/>/=<sp/>nxg<sp/>.or.<sp/>nlat<sp/>/=<sp/>nyg)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="987"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fms_mpp_pe()==fms_mpp_root_pe())<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="988"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/>*,<sp/></highlight><highlight class="stringliteral">&apos;atmosphere<sp/>mosaic<sp/>tile<sp/>has&apos;</highlight><highlight class="normal">,<sp/>nlon,<sp/></highlight><highlight class="stringliteral">&apos;longitudes,&apos;</highlight><highlight class="normal">,<sp/>nlat,<sp/></highlight><highlight class="stringliteral">&apos;latitudes;<sp/>&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;atmosphere<sp/>has&apos;</highlight><highlight class="normal">,<sp/>nxg,<sp/></highlight><highlight class="stringliteral">&apos;longitudes,&apos;</highlight><highlight class="normal">,<sp/>nyg,<sp/></highlight><highlight class="stringliteral">&apos;latitudes&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="990"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="991"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_error_mesg<sp/>(</highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_mod&apos;</highlight><highlight class="normal">,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="992"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;atmosphere<sp/>mosaic<sp/>tile<sp/>grid<sp/>file<sp/>incompatible<sp/>with<sp/>atmosphere<sp/>resolution&apos;</highlight><highlight class="normal">,<sp/>fatal)</highlight></codeline>
<codeline lineno="993"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="994"><highlight class="normal"></highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(tmpx(isc2:iec2,jsc2:jec2),<sp/>tmpy(isc2:iec2,jsc2:jec2)<sp/>)</highlight></codeline>
<codeline lineno="996"><highlight class="normal"></highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms2_io_get_variable_dimension_names(tile_file_obj,<sp/></highlight><highlight class="stringliteral">&quot;x&quot;</highlight><highlight class="normal">,<sp/>dim_names)</highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms2_io_register_axis(tile_file_obj,<sp/>dim_names(1),<sp/></highlight><highlight class="stringliteral">&quot;x&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms2_io_register_axis(tile_file_obj,<sp/>dim_names(2),<sp/></highlight><highlight class="stringliteral">&quot;y&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1001"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms2_io_register_field(tile_file_obj,<sp/></highlight><highlight class="stringliteral">&quot;x&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;double&quot;</highlight><highlight class="normal">,<sp/>dim_names)</highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms2_io_register_field(tile_file_obj,<sp/></highlight><highlight class="stringliteral">&quot;y&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;double&quot;</highlight><highlight class="normal">,<sp/>dim_names)</highlight></codeline>
<codeline lineno="1003"><highlight class="normal"></highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms2_io_read_data(<sp/>tile_file_obj,<sp/></highlight><highlight class="stringliteral">&apos;x&apos;</highlight><highlight class="normal">,<sp/>tmpx)</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms2_io_read_data(<sp/>tile_file_obj,<sp/></highlight><highlight class="stringliteral">&apos;y&apos;</highlight><highlight class="normal">,<sp/>tmpy)</highlight></codeline>
<codeline lineno="1007"><highlight class="normal"></highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms2_io_close_file(tile_file_obj)</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"></highlight></codeline>
<codeline lineno="1010"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_deallocate_domain(domain2)</highlight></codeline>
<codeline lineno="1011"><highlight class="normal"></highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>jsc,<sp/>jec+1</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>isc,<sp/>iec+1</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(abs(tmpx(2*i-1,2*j-1)-atm%lon_bnd(i+ioff,j+joff)*45.0/atan(1.0))&gt;bound_tol)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1015"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/>*,<sp/></highlight><highlight class="stringliteral">&apos;GRID_SPEC/ATMOS<sp/>LONGITUDE<sp/>INCONSISTENCY<sp/>at<sp/>i=<sp/>&apos;</highlight><highlight class="normal">,i,<sp/></highlight><highlight class="stringliteral">&apos;,<sp/>j=<sp/>&apos;</highlight><highlight class="normal">,<sp/>j,<sp/></highlight><highlight class="stringliteral">&apos;:<sp/>&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tmpx(2*i-1,2*j-1),<sp/><sp/>atm%lon_bnd(i+ioff,j+joff)*45.0/atan(1.0)</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_error_mesg<sp/>(</highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_mod&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;grid_spec.nc<sp/>incompatible<sp/>with<sp/>atmosphere<sp/>longitudes<sp/>(see<sp/>&apos;</highlight><highlight class="normal">//trim(tile_file)//</highlight><highlight class="stringliteral">&apos;)&apos;</highlight><highlight class="normal">&amp;</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>,fatal)</highlight></codeline>
<codeline lineno="1020"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(abs(tmpy(2*i-1,2*j-1)-atm%lat_bnd(i+ioff,j+joff)*45.0/atan(1.0))&gt;bound_tol)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1022"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/>*,<sp/></highlight><highlight class="stringliteral">&apos;GRID_SPEC/ATMOS<sp/>LATITUDE<sp/>INCONSISTENCY<sp/>at<sp/>i=<sp/>&apos;</highlight><highlight class="normal">,i,<sp/></highlight><highlight class="stringliteral">&apos;,<sp/>j=<sp/>&apos;</highlight><highlight class="normal">,<sp/>j,<sp/></highlight><highlight class="stringliteral">&apos;:<sp/>&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tmpy(2*i-1,2*j-1),<sp/><sp/>atm%lat_bnd(i+ioff,j+joff)*45.0/atan(1.0)</highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_error_mesg<sp/>(</highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_mod&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;grid_spec.nc<sp/>incompatible<sp/>with<sp/>atmosphere<sp/>latitudes<sp/>(see<sp/>&apos;</highlight><highlight class="normal">//trim(tile_file)//</highlight><highlight class="stringliteral">&apos;)&apos;</highlight><highlight class="normal">&amp;</highlight></codeline>
<codeline lineno="1026"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>,fatal)</highlight></codeline>
<codeline lineno="1027"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1028"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>do</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1029"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>do</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1030"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">deallocate</highlight><highlight class="normal">(tmpx,<sp/>tmpy)</highlight></codeline>
<codeline lineno="1031"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1032"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_error(fatal,<sp/>&amp;</highlight></codeline>
<codeline lineno="1033"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_mod:<sp/>both<sp/>AREA_ATMxOCN<sp/>and<sp/>ocn_mosaic_file<sp/>does<sp/>not<sp/>exist<sp/>in<sp/>&apos;</highlight><highlight class="normal">//trim(grid_file))</highlight></codeline>
<codeline lineno="1034"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1035"><highlight class="normal"></highlight></codeline>
<codeline lineno="1036"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms2_io_close_file(grid_file_obj)</highlight></codeline>
<codeline lineno="1037"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceflux__exchange__mod_1a9b9500d8c86af3e964c1558bb7ae464e" kindref="member">check_atm_grid</ref></highlight></codeline>
<codeline lineno="1038"><highlight class="normal"></highlight></codeline>
<codeline lineno="1039"><highlight class="normal"></highlight><highlight class="keyword">end<sp/>module<sp/></highlight><highlight class="normal"><ref refid="namespaceflux__exchange__mod" kindref="compound">flux_exchange_mod</ref></highlight></codeline>
    </programlisting>
    <location file="full/flux_exchange.F90"/>
  </compounddef>
</doxygen>
