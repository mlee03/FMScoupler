<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.14">
  <compounddef id="atm__land__ice__flux__exchange_8_f90" kind="file" language="Fortran">
    <compoundname>atm_land_ice_flux_exchange.F90</compoundname>
    <innerclass refid="interfaceatm__land__ice__flux__exchange__mod_1_1put__logical__to__real" prot="private">atm_land_ice_flux_exchange_mod::put_logical_to_real</innerclass>
    <innerclass refid="structatm__land__ice__flux__exchange__mod_1_1tracer__ind__type" prot="private">atm_land_ice_flux_exchange_mod::tracer_ind_type</innerclass>
    <innerclass refid="structatm__land__ice__flux__exchange__mod_1_1tracer__exch__ind__type" prot="private">atm_land_ice_flux_exchange_mod::tracer_exch_ind_type</innerclass>
    <innernamespace refid="namespaceatm__land__ice__flux__exchange__mod">atm_land_ice_flux_exchange_mod</innernamespace>
    <innernamespace refid="namespace_f_m_s">FMS</innernamespace>
      <sectiondef kind="define">
      <memberdef kind="define" id="atm__land__ice__flux__exchange_8_f90_1aef6ab106d6887299b126582343d93183" prot="public" static="no">
        <name>FMS_DATA_OVERRIDE_</name>
        <initializer>fms_data_override_ug</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="full/atm_land_ice_flux_exchange.F90" line="31" column="9"/>
      </memberdef>
      <memberdef kind="define" id="atm__land__ice__flux__exchange_8_f90_1a98ddae76989225533f851aeab5cd88d0" prot="public" static="no">
        <name>FMS_XGRID_PUT_TO_XGRID_</name>
        <initializer>fms_xgrid_put_to_xgrid_ug</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="full/atm_land_ice_flux_exchange.F90" line="32" column="9"/>
      </memberdef>
      <memberdef kind="define" id="atm__land__ice__flux__exchange_8_f90_1a32a373f98074071708e69eae63f0c01e" prot="public" static="no">
        <name>FMS_XGRID_STOCK_MOVE_</name>
        <initializer>fms_xgrid_stock_move_ug</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="full/atm_land_ice_flux_exchange.F90" line="33" column="9"/>
      </memberdef>
      <memberdef kind="define" id="atm__land__ice__flux__exchange_8_f90_1a858c0b8673fd468a8b145032eec57bc8" prot="public" static="no">
        <name>FMS_XGRID_SET_FRAC_AREA_</name>
        <initializer>fms_xgrid_set_frac_area_ug</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="full/atm_land_ice_flux_exchange.F90" line="34" column="9"/>
      </memberdef>
      <memberdef kind="define" id="atm__land__ice__flux__exchange_8_f90_1a0f01948491438713a940bf9e3f6b29ad" prot="public" static="no">
        <name>FMS_XGRID_GET_FROM_XGRID_</name>
        <initializer>fms_xgrid_get_from_xgrid_ug</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="full/atm_land_ice_flux_exchange.F90" line="35" column="9"/>
      </memberdef>
      <memberdef kind="define" id="atm__land__ice__flux__exchange_8_f90_1a9751bd6d519ab8e938ed064498813ba0" prot="public" static="no">
        <name>FMS_DIAG_REGISTER_FIELD_</name>
        <initializer>register_tiled_diag_field</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="full/atm_land_ice_flux_exchange.F90" line="36" column="9"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
<para>Performs flux calculations and exchange grid operations for atmosphere, land and ice. </para>    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">!***********************************************************************</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">!*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GNU<sp/>Lesser<sp/>General<sp/>Public<sp/>License</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">!*</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>This<sp/>file<sp/>is<sp/>part<sp/>of<sp/>the<sp/>GFDL<sp/>Flexible<sp/>Modeling<sp/>System<sp/>(FMS)<sp/>Coupler.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="comment">!*</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>FMS<sp/>Coupler<sp/>is<sp/>free<sp/>software:<sp/>you<sp/>can<sp/>redistribute<sp/>it<sp/>and/or<sp/>modify</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>it<sp/>under<sp/>the<sp/>terms<sp/>of<sp/>the<sp/>GNU<sp/>Lesser<sp/>General<sp/>Public<sp/>License<sp/>as</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>published<sp/>by<sp/>the<sp/>Free<sp/>Software<sp/>Foundation,<sp/>either<sp/>version<sp/>3<sp/>of<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>License,<sp/>or<sp/>(at<sp/>your<sp/>option)<sp/>any<sp/>later<sp/>version.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="comment">!*</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>FMS<sp/>Coupler<sp/>is<sp/>distributed<sp/>in<sp/>the<sp/>hope<sp/>that<sp/>it<sp/>will<sp/>be<sp/>useful,<sp/>but</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>WITHOUT<sp/>ANY<sp/>WARRANTY;<sp/>without<sp/>even<sp/>the<sp/>implied<sp/>warranty<sp/>of</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>MERCHANTABILITY<sp/>or<sp/>FITNESS<sp/>FOR<sp/>A<sp/>PARTICULAR<sp/>PURPOSE.<sp/><sp/>See<sp/>the<sp/>GNU</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>General<sp/>Public<sp/>License<sp/>for<sp/>more<sp/>details.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="comment">!*</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>You<sp/>should<sp/>have<sp/>received<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>GNU<sp/>Lesser<sp/>General<sp/>Public</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>License<sp/>along<sp/>with<sp/>FMS<sp/>Coupler.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="comment">!*<sp/>If<sp/>not,<sp/>see<sp/>&lt;http://www.gnu.org/licenses/&gt;.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="comment">!***********************************************************************</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="preprocessor">#undef<sp/>FMS_DATA_OVERRIDE_</highlight></codeline>
<codeline lineno="24"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#undef<sp/>FMS_XGRID_PUT_TO_XGRID_</highlight></codeline>
<codeline lineno="25"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#undef<sp/>FMS_XGRID_STOCK_MOVE_</highlight></codeline>
<codeline lineno="26"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#undef<sp/>FMS_XGRID_SET_FRAC_AREA_</highlight></codeline>
<codeline lineno="27"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#undef<sp/>FMS_XGRID_GET_FROM_XGRID_</highlight></codeline>
<codeline lineno="28"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#undef<sp/>FMS_DIAG_REGISTER_FIELD_</highlight></codeline>
<codeline lineno="29"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="31"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#define<sp/>FMS_DATA_OVERRIDE_<sp/>fms_data_override_ug</highlight></codeline>
<codeline lineno="32"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#define<sp/>FMS_XGRID_PUT_TO_XGRID_<sp/>fms_xgrid_put_to_xgrid_ug</highlight></codeline>
<codeline lineno="33"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#define<sp/>FMS_XGRID_STOCK_MOVE_<sp/>fms_xgrid_stock_move_ug</highlight></codeline>
<codeline lineno="34"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#define<sp/>FMS_XGRID_SET_FRAC_AREA_<sp/>fms_xgrid_set_frac_area_ug</highlight></codeline>
<codeline lineno="35"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#define<sp/>FMS_XGRID_GET_FROM_XGRID_<sp/>fms_xgrid_get_from_xgrid_ug</highlight></codeline>
<codeline lineno="36"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#define<sp/>FMS_DIAG_REGISTER_FIELD_<sp/>register_tiled_diag_field</highlight></codeline>
<codeline lineno="37"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="38"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#define<sp/>FMS_DATA_OVERRIDE_<sp/>fms_data_override</highlight></codeline>
<codeline lineno="39"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#define<sp/>FMS_XGRID_PUT_TO_XGRID_<sp/>fms_xgrid_put_to_xgrid</highlight></codeline>
<codeline lineno="40"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#define<sp/>FMS_XGRID_STOCK_MOVE_<sp/>fms_xgrid_stock_move</highlight></codeline>
<codeline lineno="41"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#define<sp/>FMS_XGRID_SET_FRAC_AREA_<sp/>fms_xgrid_set_frac_area</highlight></codeline>
<codeline lineno="42"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#define<sp/>FMS_XGRID_GET_FROM_XGRID_<sp/>fms_xgrid_get_from_xgrid</highlight></codeline>
<codeline lineno="43"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#define<sp/>FMS_DIAG_REGISTER_FIELD_<sp/>fms_diag_register_diag_field</highlight></codeline>
<codeline lineno="44"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="45"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="46" refid="namespaceatm__land__ice__flux__exchange__mod" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">module</highlight><highlight class="normal"><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod" kindref="compound">atm_land_ice_flux_exchange_mod</ref></highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>atmos_drivers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">atmos_model_mod,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>&amp;</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atm_stock_pe,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>subroutine<sp/>to<sp/>compute<sp/>the<sp/>total<sp/>stock<sp/>in<sp/>the<sp/>atmospheric<sp/>model</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atmos_data_type,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>derived<sp/>type<sp/>containing<sp/>fields<sp/>needed<sp/>for<sp/>flux<sp/>exchange<sp/>between<sp/>components</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land_ice_atmos_boundary_type<sp/></highlight><highlight class="comment">!<sp/>derived<sp/>type<sp/>containing<sp/>quantities<sp/>going<sp/>from<sp/>land<sp/>and<sp/>ice<sp/>to<sp/>atmos</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>FMSCoupler/full</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal"><ref refid="namespaceatmos__ocean__dep__fluxes__calc__mod" kindref="compound">atmos_ocean_dep_fluxes_calc_mod</ref>,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>&amp;</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatmos__ocean__dep__fluxes__calc__mod_1a5880644207752e6a4873458a90f04cea" kindref="member">atmos_ocean_dep_fluxes_calc</ref><sp/></highlight><highlight class="comment">!<sp/>subroutine<sp/>to<sp/>compute<sp/>ocean<sp/>and<sp/>atmosphere<sp/>deposition<sp/>gas<sp/>fluxes<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>FMSCoupler/full</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal"><ref refid="namespaceatmos__ocean__fluxes__calc__mod" kindref="compound">atmos_ocean_fluxes_calc_mod</ref>,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>&amp;</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatmos__ocean__fluxes__calc__mod_1acc10568af1ebdd92581183632c4e1f74" kindref="member">atmos_ocean_fluxes_calc</ref><sp/></highlight><highlight class="comment">!<sp/>subroutine<sp/>to<sp/>computes<sp/>gas<sp/>fluxes<sp/>for<sp/>atmosphere<sp/>and<sp/>ocean</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>FMS/coupler<sp/><sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">atmos_ocean_fluxes_mod,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>&amp;</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atmos_ocean_fluxes_init<sp/></highlight><highlight class="comment">!<sp/>subroutine<sp/>initializes<sp/>gas<sp/>fluxes<sp/>in<sp/>coupler<sp/>derived<sp/>types<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>am5_phys</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">atmos_tracer_driver_mod,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>&amp;</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atmos_tracer_flux_init<sp/></highlight><highlight class="comment">!<sp/>subroutine<sp/>to<sp/>initialize<sp/>atmos_tracer_driver_mod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>MOM6/SIS2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal"><ref refid="namespaceice__model__mod" kindref="compound">ice_model_mod</ref>,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>&amp;</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structice__model__mod_1_1atmos__ice__boundary__type" kindref="compound">atmos_ice_boundary_type</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>derived<sp/>type<sp/>for<sp/>flux<sp/>exchange<sp/>between<sp/>atmosphere<sp/>and<sp/>sea<sp/>ice</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structice__model__mod_1_1ice__data__type" kindref="compound">ice_data_type</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>derived<sp/>type<sp/>holding<sp/>ice<sp/>model<sp/>data</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ice_stock_pe,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>subroutine<sp/>to<sp/>compute<sp/>stocks<sp/>of<sp/>heat,<sp/>water,<sp/>etc<sp/>for<sp/>conservation<sp/>checks</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land_ice_boundary_type,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>derived<sp/>type<sp/>for<sp/>flux<sp/>exchange<sp/>between<sp/>land<sp/>and<sp/>sea<sp/>ice</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean_ice_boundary_type,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>derived<sp/>type<sp/>for<sp/>flux<sp/>exchange<sp/>between<sp/>ocean<sp/>and<sp/>sea<sp/>ice</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>update_ice_atm_deposition_flux<sp/></highlight><highlight class="comment">!<sp/>updates<sp/>fluxes<sp/>of<sp/>type<sp/>&quot;air_sea_deposition&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>Land_lad2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">land_model_mod,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>&amp;</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atmos_land_boundary_type,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>derived<sp/>type<sp/>to<sp/>pass<sp/>information<sp/>from<sp/>atmosphere<sp/>to<sp/>land</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land_data_type,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>derived<sp/>type<sp/>to<sp/>pass<sp/>information<sp/>from<sp/>land<sp/>to<sp/>atmosphere<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lnd_stock_pe<sp/></highlight><highlight class="comment">!<sp/>subroutine<sp/>to<sp/>compute<sp/>stocks<sp/>of<sp/>conservative<sp/>land<sp/>quantities</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>If<sp/>not<sp/>_USE_LEGACY_LAND_,<sp/>use<sp/>land_lad2/land_tile_diag_mod<sp/>instead<sp/>of<sp/>FMS/diag_manager</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="87"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">land_model_mod,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>&amp;</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dump_tile_diag_fields,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>subroutine<sp/>for<sp/>workaround<sp/>with<sp/>Intel<sp/>compilers<sp/><sp/>and<sp/>OpenMP</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>register_tiled_diag_field,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>subroutine<sp/>to<sp/>register<sp/>diag<sp/>field<sp/>within<sp/>the<sp/>land<sp/>model</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>send_tile_data,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>subroutine<sp/>to<sp/>save<sp/>data<sp/>in<sp/>buffer<sp/>within<sp/>the<sp/>land<sp/>model<sp/>for<sp/>the<sp/>registered<sp/>field</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>set_default_diag_filter<sp/></highlight><highlight class="comment">!<sp/>subroutine<sp/>to<sp/>set<sp/>default<sp/>tile<sp/>diagnostic<sp/>selector</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="93"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>MOM6</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">ocean_model_mod,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>&amp;</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ice_ocean_boundary_type,<sp/>&amp;<sp/></highlight><highlight class="comment">!derived<sp/>type<sp/>containing<sp/>the<sp/>forcings</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean_model_init_sfc,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>subroutine<sp/>to<sp/>extracts<sp/>surface<sp/>properties<sp/>from<sp/>the<sp/>ocean&apos;s<sp/>internal<sp/>state</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean_model_data_get,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>interface<sp/>procedure<sp/>to<sp/>extract<sp/>scalar<sp/>fields<sp/>from<sp/>ocean<sp/>surface<sp/>or<sp/>ocean_public<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean_model_flux_init,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>subroutine<sp/>to<sp/>initializes<sp/>the<sp/>properties<sp/>from<sp/>air-sea<sp/>fluxes<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean_public_type,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>derived<sp/>type<sp/>used<sp/>in<sp/>FMScoupler<sp/>to<sp/>communicate<sp/>with<sp/>other<sp/>model<sp/>components</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean_state_type,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>derived<sp/>type<sp/>containing<sp/>the<sp/>state<sp/>of<sp/>the<sp/>ocean</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean_stock_pe<sp/></highlight><highlight class="comment">!<sp/>subroutine<sp/>to<sp/>computes<sp/>integrated<sp/>stocks<sp/>of<sp/>heat,<sp/>water,<sp/>etc.<sp/>for<sp/>conservation<sp/>checks</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>FMSCoupler/shared</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal"><ref refid="namespacesurface__flux__mod" kindref="compound">surface_flux_mod</ref>,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>&amp;</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfacesurface__flux__mod_1_1surface__flux" kindref="compound">surface_flux</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>subroutine<sp/>to<sp/>compute<sp/>fluxes<sp/>on<sp/>exchange<sp/>grids</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>surface_flux_init<sp/></highlight><highlight class="comment">!<sp/>subroutine<sp/>to<sp/>initialize<sp/>surface_flux_mod<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>am5_phys</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="111"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">atmos_cmip_diag_mod,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>&amp;</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>register_cmip_diag_field_2d<sp/></highlight><highlight class="comment">!function<sp/>to<sp/>register<sp/>CMIP<sp/>diagnostic<sp/>data</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">atmos_global_diag_mod,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>&amp;</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>get_global_diag_field_id,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>function<sp/>to<sp/>retrieve<sp/>internally-tracked<sp/>id<sp/>of<sp/>the<sp/>global<sp/>diag<sp/>field</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>register_global_diag_field,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>function<sp/>that<sp/>calls<sp/>FMS/register_diag_field<sp/>for<sp/>globally<sp/>averaged<sp/>data</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>send_global_diag<sp/></highlight><highlight class="comment">!<sp/>function<sp/>that<sp/>calls<sp/>FMS/diag_manager/send_data<sp/>for<sp/>global<sp/>fields</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">atmos_tracer_driver_mod,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal"><sp/>&amp;</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atmos_tracer_has_surf_setl_flux,<sp/>&amp;</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!function<sp/>returns<sp/>True<sp/>of<sp/>tracer<sp/>sedimentation<sp/>flux<sp/>&gt;<sp/>0<sp/>at<sp/>bottom<sp/>of<sp/>the<sp/>atmosphere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>get_atmos_tracer_surf_setl_flux,<sp/>&amp;</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!subroutine<sp/>to<sp/>retrieve<sp/>tracer<sp/>sedimentation<sp/>flux<sp/>at<sp/>bottom<sp/>of<sp/>the<sp/>atmosphere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atmos_tracer_driver_gather_data_down<sp/></highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="124"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">land_model_mod,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>&amp;</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>send_global_land_diag<sp/></highlight><highlight class="comment">!<sp/>function<sp/>to<sp/>save<sp/>land<sp/>model<sp/>field<sp/>on<sp/>unstructured<sp/>grid<sp/>for<sp/>global<sp/>integral</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="127"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="128"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>option<sp/>to<sp/>override<sp/>various<sp/>surface<sp/>boundary<sp/>conditions<sp/>for<sp/>SCM</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>SCM<sp/><sp/></highlight></codeline>
<codeline lineno="131"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">scm_forc_mod,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>&amp;</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>albedo_obs,<sp/>&amp;</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>do_specified_albedo,<sp/>&amp;</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>do_specified_land,<sp/>&amp;</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>do_specified_rough_leng,<sp/>&amp;</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>do_specified_tskin,<sp/>&amp;</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>do_specified_flux,<sp/>&amp;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rough_mom,<sp/>&amp;</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rough_heat,<sp/>&amp;</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scm_surface_flux,<sp/>&amp;</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tskin</highlight></codeline>
<codeline lineno="142"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="143"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">fms<sp/></highlight><highlight class="comment">!<sp/>mainly<sp/>for<sp/>calls<sp/>to<sp/>diag_manager,<sp/>data_override,<sp/>and<sp/>exchange<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">use<sp/></highlight><highlight class="normal">fmsconstants,<sp/></highlight><highlight class="keywordtype">only</highlight><highlight class="normal">:<sp/>&amp;</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cp_air,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>RDGAS/KAPPA<sp/>,<sp/>specific<sp/>heat<sp/>capacity<sp/>of<sp/>dry<sp/>air<sp/>at<sp/>constant<sp/>pressure<sp/>[J/kg/deg]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cp_ocean,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>3989.24495292815,<sp/>specific<sp/>heat<sp/>capacity<sp/>[J/kg/deg]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>epsln,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>1.0e-40,<sp/>a<sp/>small<sp/>number<sp/>to<sp/>prevent<sp/>divide<sp/>by<sp/>zero<sp/>exceptions</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>grav,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>9.80,<sp/>acceleration<sp/>due<sp/>to<sp/>gravity<sp/>[m/s^2]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hlf,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/><sp/>3.34e5,<sp/>latent<sp/>heat<sp/>of<sp/>fusion<sp/>[J/kg]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hlv,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>2.500e6,<sp/>latent<sp/>heat<sp/>of<sp/>evaporation<sp/>[J/kg]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pi,<sp/>&amp;<sp/><sp/></highlight><highlight class="comment">!<sp/>3.14159265358979323846</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>radius,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>6371.0e+3,<sp/>radius<sp/>of<sp/>the<sp/>Earth<sp/>[m]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rdgas,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>287.04,<sp/>gas<sp/>constant<sp/>for<sp/>dry<sp/>air<sp/>[J/kg/deg]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rvgas,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>461.50,<sp/>gas<sp/>constant<sp/>for<sp/>water<sp/>vapor</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>stefan,<sp/>&amp;<sp/><sp/></highlight><highlight class="comment">!<sp/>5.6734e-8,<sp/>Stefan-Boltzmann<sp/>constant<sp/>[W/m^2/deg^4]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wtmc,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>12.00000,<sp/><sp/>molecular<sp/>weight<sp/>of<sp/>carbon<sp/>[amu]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wtmco2,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>44.00995,<sp/><sp/>molecular<sp/>weight<sp/>of<sp/>carbon<sp/>dioxide<sp/>[amu]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wtmair,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>2.896440e+01,<sp/><sp/>molecular<sp/>weight<sp/>of<sp/>air<sp/>[amu]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wtmh2o<sp/></highlight><highlight class="comment">!<sp/>WTMAIR*(RDGAS/RVGAS)<sp/>molecular<sp/>weight<sp/>of<sp/>water<sp/>[amu]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">implicit<sp/>none</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/>include<sp/></highlight><highlight class="stringliteral">&apos;netcdf.inc&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">private</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">public</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ab8675556ecdbebfb8b3093fadbe11cde" kindref="member">atm_land_ice_flux_exchange_init</ref>,<sp/>&amp;</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae7a53520e8a084f5fa930c5c18c85b54" kindref="member">sfc_boundary_layer</ref>,<sp/>&amp;</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae90760b8fd57a82bc54db9ece86486ba" kindref="member">generate_sfc_xgrid</ref>,<sp/>&amp;</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a377e367901950e4541859f65655b6f38" kindref="member">flux_down_from_atmos</ref>,<sp/>&amp;</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a9ff1868e71257630777ac2d9c8b6180c" kindref="member">flux_up_to_atmos</ref>,<sp/>&amp;</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b47968fcb9188a68db2b7b8e1ea7a0f" kindref="member">flux_atmos_to_ocean</ref>,<sp/>&amp;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac8716ce7e07543b081c151bd0b24d7d1" kindref="member">flux_ex_arrays_dealloc</ref>,<sp/>&amp;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ad11a70fa9758ae36a312504e589b3c1a" kindref="member">atm_stock_integrate</ref>,<sp/>&amp;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af00a10abb94ffaa2f305e00de92362bc" kindref="member">send_ice_mask_sic</ref></highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight></codeline>
<codeline lineno="177" refid="interfaceatm__land__ice__flux__exchange__mod_1_1put__logical__to__real" refkind="compound"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">interface</highlight><highlight class="normal"><sp/><ref refid="interfaceatm__land__ice__flux__exchange__mod_1_1put__logical__to__real" kindref="compound">put_logical_to_real</ref></highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">module<sp/>procedure</highlight><highlight class="normal"><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a50837c09366fc3aee78c7d5909783559" kindref="member">put_logical_to_real_sg</ref></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">module<sp/>procedure</highlight><highlight class="normal"><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a996a4e123202df434c2b7a3e370dd854" kindref="member">put_logical_to_real_ug</ref></highlight></codeline>
<codeline lineno="180"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>interface<sp/><sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">character(len=128)</highlight><highlight class="normal"><sp/>::<sp/>version<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;$Id$&apos;</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">character(len=128)</highlight><highlight class="normal"><sp/>::<sp/>tag<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;$Name$&apos;</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsXgridXmap_type),<sp/></highlight><highlight class="keywordtype">save</highlight><highlight class="normal"><sp/>::<sp/>xmap_sfc</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>n_xgrid_sfc=0</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">character(len=4)</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">parameter</highlight><highlight class="normal"><sp/>::<sp/>mod_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;flux&apos;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"></highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>returned<sp/>ids<sp/>from<sp/>registering<sp/>diagnostic<sp/>field<sp/>with<sp/>diag_manager</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_b_star,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>bouyancy<sp/>scale</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_del_h,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>ref<sp/>height<sp/>interp<sp/>factor<sp/>for<sp/>heat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_del_m,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>ref<sp/>height<sp/>for<sp/>interp<sp/>factor<sp/>for<sp/>momentum</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_del_q,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>ref<sp/>height<sp/>interp<sp/>factor<sp/>for<sp/>moisture</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_drag_heat,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>drag<sp/>coefficient<sp/>for<sp/>heat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_drag_moist,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>drag<sp/>coefficient<sp/>for<sp/>moisture</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_drag_mom,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>drag<sp/>coefficient<sp/>for<sp/>momentum</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_gust,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>gust<sp/>scale</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_hussLut_land,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>near-surface<sp/>specific<sp/>humidity<sp/>on<sp/>land<sp/>use<sp/>tile</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_ice_mask,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>fractional<sp/>amount<sp/>of<sp/>land</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_land_mask,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>fractional<sp/>amount<sp/>of<sp/>sea<sp/>ice</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_p_atm,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>pressure<sp/>at<sp/>lowest<sp/>atmospheric<sp/>level<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_q_flux,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>evaporation<sp/>rate</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_q_flux_land,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>evaporation<sp/>rate<sp/>over<sp/>land</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_q_ref,<sp/>&amp;<sp/></highlight><highlight class="comment">!specific<sp/>humidity<sp/>at<sp/>z_ref_heat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_q_ref_land,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>specific<sp/>humidity<sp/>at<sp/>z_ref_heat<sp/>over<sp/>land</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_q_star,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>moisture<sp/>scale</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_r_flux,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>net<sp/>(down-up)<sp/>longwave<sp/>flux<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_rh_ref,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>relative<sp/>humidity<sp/>at<sp/>z_ref_heat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_rh_ref_cmip,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>relative<sp/>humidity<sp/>at<sp/>z_ref_heat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_rh_ref_land,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>relative<sp/>humidity<sp/>at<sp/>z_ref_heat<sp/>over<sp/>land</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_rough_heat,<sp/>&amp;<sp/></highlight><highlight class="comment">!surface<sp/>roughness<sp/>for<sp/>heat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_rough_moist,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>roughness<sp/>for<sp/>moisture</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_rough_mom,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>roughness<sp/>for<sp/>momentum</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_rough_scale,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>topographic<sp/>scaling<sp/>fractor<sp/>for<sp/>momentum<sp/>drag</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_slp,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>sea<sp/>level<sp/>pressure<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_t_atm,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>temperature<sp/>at<sp/><sp/>lowest<sp/>atmospheric<sp/>level</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_t_ca,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>canopy<sp/>air<sp/>temperature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_t_flux,<sp/>&amp;<sp/></highlight><highlight class="comment">!sensible<sp/>heat<sp/>flux</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_t_ocean,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>temperature<sp/>from<sp/>ocean<sp/>output</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_t_ref,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>temperature<sp/>at<sp/>z_ref_heat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_t_ref_land,<sp/>&amp;<sp/></highlight><highlight class="comment">!temperature<sp/>at<sp/>z_ref_heat<sp/>over<sp/>land</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_t_surf,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>temperature<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tasLut_land,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>near-surface<sp/>air<sp/>temperature<sp/>z_ref_heat<sp/>above<sp/>displacement<sp/>height<sp/>on<sp/>land-use<sp/>tile</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_thv_atm,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>air<sp/>virtual<sp/>potential<sp/>temperature<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_thv_surf,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>virtual<sp/>potential<sp/>temperature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_u_atm,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>u<sp/>wind<sp/>component<sp/>at<sp/>lowest<sp/>atmospheric<sp/>level</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_u_flux,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>zonal<sp/>wind<sp/>stress<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_u_ref,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>zonal<sp/>wind<sp/>component<sp/>at<sp/>z_ref_mom</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_u_ref_land,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>zonal<sp/>wind<sp/>component<sp/>at<sp/>z_ref_mom<sp/>over<sp/>land</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_u_star,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>friction<sp/>velocity</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_v_atm,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>v<sp/>wind<sp/>component<sp/>at<sp/>lowest<sp/>atmospheric<sp/>level</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_v_flux,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>meridional<sp/>wind<sp/>stress</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_v_ref,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>meridional<sp/>wind<sp/>component<sp/>at<sp/>z_ref_mom</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_v_ref_land,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>meridional<sp/>wind<sp/>component<sp/>at<sp/>z_ref_mom<sp/>over<sp/>land</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_wind,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>wind<sp/>speed<sp/>for<sp/>flux<sp/>calculations</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_wind_ref,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>absolute<sp/>value<sp/>of<sp/>wind<sp/>at<sp/>z_ref_mom</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_z_atm,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>height<sp/>of<sp/>lowest<sp/>atmospheric<sp/>level</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_co2_atm_dvmr,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>co2<sp/>dry<sp/>volume<sp/>mixing<sp/>ratio<sp/>at<sp/>lowest<sp/>atmospheric<sp/>level</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_co2_surf_dvmr<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>c02<sp/>dry<sp/>volume<sp/>mixing<sp/>ratio<sp/>at<sp/>surface</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>2017/08/15<sp/>jgj<sp/>added</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1abe4744b6ee8cc8e236be33b11254b857" kindref="member">id_co2_bot</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>concentration<sp/>of<sp/>co2<sp/>to<sp/>be<sp/>passed<sp/>to<sp/>land/photosynthesis</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a24abe80c13032b56cb0127ef9fdbf801" kindref="member">id_co2_flux_pcair_atm</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>concentration<sp/>of<sp/>co2<sp/>to<sp/>be<sp/>passed<sp/>to<sp/>ocean<sp/>NEED<sp/>HELP</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1adeb499100d57339308ae4b676aeeaa93" kindref="member">id_o2_flux_pcair_atm</ref><sp/></highlight><highlight class="comment">!<sp/>concentration<sp/>of<sp/>o2<sp/>to<sp/>be<sp/>passed<sp/>to<sp/>to<sp/>ocean<sp/>NEED<sp/>HELP</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>arrays<sp/>for<sp/>holding<sp/>ids<sp/>returned<sp/>from<sp/>registering<sp/>diag_fields<sp/>with<sp/>diag_manager<sp/>for<sp/>tracers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">allocatable</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tr_atm(:),<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>value<sp/>of<sp/>tracer<sp/>at<sp/>lowest<sp/>atmospheric<sp/>level<sp/>NEED<sp/>HELP</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tr_surf(:),<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>value<sp/>of<sp/>tracer<sp/>at<sp/>surface<sp/>NEED<sp/>HELP</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tr_flux(:),<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>tracer<sp/>fluxes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tr_mol_flux(:),<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>flux<sp/>of<sp/>co2<sp/>concentration<sp/>in<sp/>[mol/m2*s]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tr_ref(:),<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>value<sp/>of<sp/>tracer<sp/>at<sp/>z_ref_heat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tr_ref_land(:),<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>tracer<sp/>flux<sp/>at<sp/>z_ref_heat<sp/>over<sp/>land<sp/>NEED<sp/>HELP<sp/><sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!f1p</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af4c241a58e2d051452ea6ac2165b605c" kindref="member">id_tr_mol_flux0</ref>(:),<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>gross<sp/>flux<sp/>of<sp/>tracer<sp/>concentration<sp/>over<sp/>land<sp/>in<sp/>[mol/m2*s]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a92413e2be778482c1557dc71b7dd6961" kindref="member">id_tr_flux_land</ref>(:),<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>flux<sp/>of<sp/>tracer<sp/>concentration<sp/>over<sp/>land<sp/>in<sp/>[kg/m2*s]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a75dad27ee32489cb9f2d4075a92dfffd" kindref="member">id_tr_mol_flux_land</ref>(:),<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>flux<sp/>of<sp/>tracer<sp/>concentration<sp/>over<sp/>land<sp/>in<sp/>[mol/m2*s]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>used<sp/>with<sp/>_USE_LEGACY_LAND_</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3700e57c52d7ba6ff7ce17de7a52f885" kindref="member">id_tr_con_atm</ref>(:),<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>deposition<sp/>velocity<sp/>at<sp/>lowest<sp/>atmospheric<sp/>level<sp/>(atm)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aaf13f42049e3c17ce32b99e263ed19ca" kindref="member">id_tr_con_atm_land</ref>(:),<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>deposition<sp/>velocity<sp/>at<sp/>lowest<sp/>atmospheric<sp/>level<sp/>over<sp/>land</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ab67aebeab080001bcc0b7df4ba4ce31d" kindref="member">id_tr_con_ref</ref>(:),<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>deposition<sp/>velocity<sp/>at<sp/>reference<sp/>height<sp/>(atm)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3b0582183221d7ffb1ba6e814cdd2bd5" kindref="member">id_tr_con_ref_land</ref>(:)<sp/></highlight><highlight class="comment">!<sp/>deposition<sp/>velocity<sp/>at<sp/>reference<sp/>height<sp/>over<sp/>land</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>id&apos;s<sp/>for<sp/>cmip<sp/>specific<sp/>fields</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_evspsbl,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>water<sp/>evaporation<sp/>flux</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_height10m,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>near<sp/>surface<sp/>height</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_height2m,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>near<sp/>surface<sp/>height</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_hfls,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>upward<sp/>latent<sp/>heat<sp/>flux</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_hfss,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>upward<sp/>sensible<sp/>heat<sp/>flux</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_hurs,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>near-surface<sp/>relative<sp/>humidty</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_huss,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>near-surface<sp/>specific<sp/>humidity</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_psl,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>air<sp/>pressure<sp/>at<sp/>sea<sp/>level</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_rhs,<sp/>&amp;<sp/><sp/></highlight><highlight class="comment">!<sp/>near-surface<sp/>relative<sp/>humidty</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_sfcWind,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>near-surface<sp/>wind<sp/>speed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_sftlf,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>fraction<sp/>of<sp/>the<sp/>grid<sp/>cell<sp/>occupied<sp/>by<sp/>land</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_sic,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>sea<sp/>ice<sp/>area<sp/>fraction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tas,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>near-surface<sp/>air<sp/>temperature<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tauu,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>downward<sp/>eastward<sp/>wind<sp/>stress</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tauv,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>downward<sp/>northward<sp/>wind<sp/>stress</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tos,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>sea<sp/>surface<sp/>temperature<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_ts,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>temperature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tslsi,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>temperature<sp/>on<sp/>land<sp/>or<sp/>sea<sp/>ice</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_uas,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>eastward<sp/>near-surface<sp/>wind</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_vas<sp/></highlight><highlight class="comment">!northward<sp/>near-surface<sp/>wind</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"></highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>globally<sp/>averaged<sp/>diagnostics</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_evspsbl_g,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>global<sp/>integral<sp/>of<sp/>water<sp/>evaporation<sp/>flux</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_hfls_g,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>global<sp/>integral<sp/>of<sp/>surface<sp/>upward<sp/>latent<sp/>heat<sp/>flux</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_hfss_g,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>global<sp/>integral<sp/>of<sp/>surface<sp/>upward<sp/>sensible<sp/>heat<sp/>flux</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_rls_g,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>global<sp/>integral<sp/>of<sp/>near-surface<sp/>relative<sp/>humidty<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tas_g,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>global<sp/>integral<sp/>of<sp/>near-surface<sp/>air<sp/>temperature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tasl_g,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>global<sp/>integral<sp/>of<sp/>near-surface<sp/>air<sp/>temperature<sp/>on<sp/>land<sp/>only</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_ts_g<sp/></highlight><highlight class="comment">!<sp/>global<sp/>integral<sp/>of<sp/>surface<sp/>temperature<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"></highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>first_static<sp/>=<sp/>.true.</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>do_init<sp/>=<sp/>.true.<sp/></highlight><highlight class="comment">!<sp/>true<sp/>if<sp/>atm_land_ice_flux_exchnge_init<sp/>has<sp/>been<sp/>called<sp/><sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>remap_method<sp/>=<sp/>1<sp/></highlight><highlight class="comment">!<sp/>first<sp/>or<sp/>second<sp/>order<sp/>conservative<sp/>remapping<sp/>onto<sp/>exchange<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="303"><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">parameter</highlight><highlight class="normal"><sp/>::<sp/>d622<sp/>=<sp/>rdgas/rvgas<sp/></highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">parameter</highlight><highlight class="normal"><sp/>::<sp/>d378<sp/>=<sp/>1.0-d622</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">parameter</highlight><highlight class="normal"><sp/>::<sp/>d608<sp/><sp/><sp/>=<sp/>d378/d622</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">parameter</highlight><highlight class="normal"><sp/>::<sp/>tfreeze<sp/>=<sp/>273.15</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">allocatable</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:,:)</highlight><highlight class="normal"><sp/>::<sp/>frac_precip<sp/></highlight></codeline>
<codeline lineno="309"><highlight class="normal"></highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!---<sp/>the<sp/>following<sp/>is<sp/>from<sp/>flux_exchange_nml</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal"><sp/>::<sp/>z_ref_heat<sp/>=<sp/><sp/>2.</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Reference<sp/>height<sp/>[m]<sp/>for<sp/>temperature<sp/>and<sp/>relative<sp/>humidity<sp/>diagnostics<sp/>t_ref,<sp/>rh_ref,<sp/>del_h,<sp/>and<sp/>del_q</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal"><sp/>::<sp/>z_ref_mom<sp/><sp/>=<sp/>10.</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Reference<sp/>height<sp/>([M]<sp/>for<sp/>momentum<sp/>diagnostics<sp/>u_ref,<sp/>v_ref,<sp/>and<sp/>del_m<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"></highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>do_area_weighted_flux<sp/>=<sp/>.false.<sp/></highlight><highlight class="comment">!<sp/>NOT<sp/>USED<sp/>DELETE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>do_forecast<sp/>=<sp/>.false.<sp/></highlight><highlight class="comment">!<sp/>NEED<sp/>HELP</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>nblocks<sp/>=<sp/>1<sp/></highlight><highlight class="comment">!OpenMP<sp/>number<sp/>of<sp/>threads<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>partition_fprec_from_lprec<sp/>=<sp/>.false.</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>If<sp/>true,<sp/>convert<sp/>liquid<sp/>precip<sp/>to<sp/>snow<sp/>when<sp/>t_ref<sp/>&lt;<sp/>tfreeze</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Used<sp/>for<sp/>atm<sp/>override<sp/>experiments<sp/>where<sp/>liquid<sp/>and<sp/>frozen<sp/>precip<sp/>are<sp/>combined</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>scale_precip_2d<sp/>=<sp/>.false.<sp/></highlight><highlight class="comment">!<sp/>If<sp/>true,<sp/>scale<sp/>mass<sp/>of<sp/>liqud<sp/>preciptation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>my_nblocks<sp/>=<sp/>1<sp/></highlight><highlight class="comment">!<sp/>Initializing<sp/>OpenMP<sp/>parameter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">allocatable</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>block_start(:),<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>starting<sp/>do<sp/>loop<sp/>indices<sp/>for<sp/>OpenMP<sp/>thread</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>block_end(:)<sp/></highlight><highlight class="comment">!<sp/>ending<sp/>do<sp/>loop<sp/>indices<sp/>for<sp/>OpenMP<sp/>thread</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">allocatable</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:)</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>NOTE:<sp/>T<sp/>canopy<sp/>is<sp/>only<sp/>differet<sp/>from<sp/>t_surf<sp/>over<sp/>vegetated<sp/>land</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6ce3eaf605064a25d5cc1283e0e11276" kindref="member">ex_albedo_fix</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a328257f3efd36a27514c76d5cf96c379" kindref="member">ex_albedo_nir_dif_fix</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a104be61b1aa14a50d997b6993b5274c9" kindref="member">ex_albedo_nir_dir_fix</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aa10f4fb058cec37b5080747c92b38ccc" kindref="member">ex_albedo_vis_dif_fix</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aad98ee1a168521649429409b391b9762" kindref="member">ex_albedo_vis_dir_fix</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a0fd79bc7659c354908e2e6c325985544" kindref="member">ex_b_star</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>boyuancy<sp/>scale<sp/>on<sp/>exchange<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a26e0b81f6ed8473af88bdec4dda23c4b" kindref="member">ex_cd_m</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>drag<sp/>coefficient<sp/>for<sp/>momentum<sp/>on<sp/>exchange<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a1fc83cb6b523c05c9925f67c1bef77eb" kindref="member">ex_cd_t</ref>,<sp/>&amp;<sp/></highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a972ea1bb3939a7b1fed1e698b182de88" kindref="member">ex_con_atm</ref>,<sp/>&amp;<sp/></highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a50b141a6a27c86e08632eb459f39324b" kindref="member">ex_dedt_surf</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>d(water.vap.flux)/d(T<sp/>canopy)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a04986e4dfe0871fb9b662597e47772bb" kindref="member">ex_dhdt_atm</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>d(sens.heat.flux)/d(T<sp/>atm)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7a723109680791b32db1371f623f679d" kindref="member">ex_dhdt_surf</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>d(sens.heat.flux)/d(T<sp/>canopy)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a1dcdd143924c77ba06ef91b15bfae469" kindref="member">ex_dqsatdt_surf</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>d(water.vap.flux)/d(q<sp/>canopy)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aeba37d2c046170e4112311711809f620" kindref="member">ex_drdt_surf</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>d(LW<sp/>flux)/d(T<sp/>surf)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a4916ecd33588bcfbce81a5393f436671" kindref="member">ex_dtaudu_atm</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>d(stress)/d(u)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae3ae41712484a6829639b4cd4431dab1" kindref="member">ex_dtaudv_atm</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>d(stress)/d(v)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a86ed92f16c0fb112e38dd6873ca4cded" kindref="member">ex_e_q_n</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>dt/mass<sp/>*<sp/>dedet_surf<sp/>*<sp/>gamma</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af36a6c987c16a10e698b500396554130" kindref="member">ex_flux_lw</ref>,<sp/>&amp;<sp/><sp/></highlight><highlight class="comment">!<sp/>longwave<sp/>radiation<sp/>flux</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>sens<sp/>heat<sp/>flux</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a5419fecfda33b11db1caab9042cf90c2" kindref="member">ex_flux_u</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>u<sp/>stress<sp/>on<sp/>atmosphere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac27b58d41879537c39e4b8bc6eac83f8" kindref="member">ex_flux_v</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>v<sp/>stress<sp/>on<sp/>atmosphere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ab6f4b7e07f9aca6eb7fe2723915a2d40" kindref="member">ex_old_albedo</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>old<sp/>value<sp/>of<sp/>albedo<sp/>for<sp/>downward<sp/>flux<sp/>calculations</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af4fdc80a51f0145da4aa80a6317cc156" kindref="member">ex_p_surf</ref>,<sp/>&amp;<sp/><sp/></highlight><highlight class="comment">!<sp/>surface<sp/>pressure<sp/>on<sp/>exchange<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7cc9b8d546d6589e3b2cf8a7ad6dd90c" kindref="member">ex_seawater</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>mask<sp/>array<sp/>of<sp/>seaice<sp/>fractions<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae70d5c9a1a49eff91b2c14c1657103a6" kindref="member">ex_slp</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>pressure<sp/>on<sp/>exchange<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>near-surface<sp/>(canopy)<sp/>air<sp/>temperature<sp/>on<sp/>exchange<sp/>grid<sp/>[K]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>temperature<sp/>for<sp/>radiation<sp/>calc<sp/>on<sp/>exchange<sp/>grid<sp/>[K]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a29071f5ae5e2772b510570b3834fe1b4" kindref="member">ex_t_surf_miz</ref>,<sp/>&amp;<sp/></highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3faddc34ad457fdb55533bead75ce7f0" kindref="member">ex_u_star</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>friction<sp/>velocity<sp/>on<sp/>exchange<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ada77a5490b1ad25fa3ca68f3f81b9548" kindref="member">ex_wind</ref>,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>wind<sp/>speed<sp/>on<sp/>exchange<sp/>grid<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a415a43eca092359dca12e46ac24bb0de" kindref="member">ex_z_atm</ref><sp/></highlight><highlight class="comment">!<sp/>height<sp/>of<sp/>lowest<sp/>atmospheric<sp/>level<sp/>on<sp/>exchange<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>SCM</highlight></codeline>
<codeline lineno="364"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">allocatable</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:)</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dhdt_surf_forland,<sp/>&amp;</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dedt_surf_forland,<sp/>&amp;</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dedq_surf_forland</highlight></codeline>
<codeline lineno="368"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="369"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">allocatable</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:,:)</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dfdtr_atm,<sp/>&amp;<sp/>!&lt;<sp/>d(tracer<sp/>flux)/d(atm<sp/>tracer)</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dfdtr_surf,<sp/>&amp;<sp/>!&lt;<sp/>d(tracer<sp/>flux)/d(surf<sp/>tracer)</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_e_tr_n,<sp/>&amp;<sp/>!&lt;<sp/>coefficient<sp/>in<sp/>implicit<sp/>scheme<sp/></highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_f_tr_delt_n,<sp/>&amp;<sp/>!&lt;<sp/>coefficient<sp/>in<sp/>implicit<sp/>scheme</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_tr,<sp/>&amp;<sp/>!&lt;<sp/>tracer<sp/>fluxes</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_con_ref,<sp/>&amp;<sp/>!&lt;<sp/>deposition<sp/>velocity<sp/>at<sp/>reference<sp/>height</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_con_atm,<sp/>&amp;<sp/>!&lt;<sp/>deposition<sp/>velocity<sp/>at<sp/>atmospheric<sp/>height</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_surf</highlight></codeline>
<codeline lineno="379"><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">allocatable</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:)</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_avail,<sp/>&amp;<sp/>!&lt;<sp/>true<sp/>where<sp/>data<sp/>on<sp/>exchange<sp/>grid<sp/>are<sp/>available</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_land</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">allocatable</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(:)</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_e_t_n,<sp/>&amp;</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_f_t_delt_n</highlight></codeline>
<codeline lineno="386"><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>n_atm_tr</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>n_atm_tr_tot</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>n_lnd_tr</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>n_lnd_tr_tot</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>n_exch_tr</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>n_gex_atm2lnd</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>n_gex_lnd2atm</highlight></codeline>
<codeline lineno="394"><highlight class="normal"></highlight></codeline>
<codeline lineno="395" refid="structatm__land__ice__flux__exchange__mod_1_1tracer__ind__type" refkind="compound"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">type</highlight><highlight class="normal"><sp/>::<sp/><ref refid="structatm__land__ice__flux__exchange__mod_1_1tracer__ind__type" kindref="compound">tracer_ind_type</ref></highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>atm</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>ice</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>lnd</highlight></codeline>
<codeline lineno="399"><highlight class="keyword"><sp/><sp/>end<sp/>type<sp/></highlight><highlight class="normal"><ref refid="structatm__land__ice__flux__exchange__mod_1_1tracer__ind__type" kindref="compound">tracer_ind_type</ref></highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(tracer_ind_type),<sp/></highlight><highlight class="keywordtype">allocatable</highlight><highlight class="normal"><sp/>::<sp/>tr_table(:)</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="402" refid="structatm__land__ice__flux__exchange__mod_1_1tracer__exch__ind__type" refkind="compound"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">type</highlight><highlight class="normal"><sp/>::<sp/><ref refid="structatm__land__ice__flux__exchange__mod_1_1tracer__exch__ind__type" kindref="compound">tracer_exch_ind_type</ref></highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>exch<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>ice<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>lnd<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="406"><highlight class="keyword"><sp/><sp/>end<sp/>type<sp/></highlight><highlight class="normal"><ref refid="structatm__land__ice__flux__exchange__mod_1_1tracer__exch__ind__type" kindref="compound">tracer_exch_ind_type</ref></highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(tracer_exch_ind_type),<sp/></highlight><highlight class="keywordtype">allocatable</highlight><highlight class="normal"><sp/>::<sp/>tr_table_map(:)</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>isphum<sp/>=<sp/>no_tracer<sp/></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>ico2<sp/><sp/><sp/>=<sp/>no_tracer<sp/></highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>inh3<sp/><sp/><sp/>=<sp/>no_tracer<sp/></highlight></codeline>
<codeline lineno="413"><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(fmscoupler1dbc_type),<sp/></highlight><highlight class="keywordtype">pointer</highlight><highlight class="normal"><sp/>::<sp/>ex_gas_fields_atm=&gt;null()</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(fmscoupler1dbc_type),<sp/></highlight><highlight class="keywordtype">pointer</highlight><highlight class="normal"><sp/>::<sp/>ex_gas_fields_ice=&gt;null()</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(fmscoupler1dbc_type),<sp/></highlight><highlight class="keywordtype">pointer</highlight><highlight class="normal"><sp/>::<sp/>ex_gas_fluxes=&gt;null()</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!real,<sp/>dimension(3)<sp/>::<sp/>ccc<sp/>!&lt;<sp/>for<sp/>conservation<sp/>checks</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"></highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!balaji,<sp/>sets<sp/>boundary_type%xtype</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">parameter</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>regrid=1,<sp/>&amp;<sp/>!&lt;<sp/>grids<sp/>are<sp/>physically<sp/>different,<sp/>pass<sp/>via<sp/>exchange<sp/>grid</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a9d21a4be462dd340e9f192cc66627d54" kindref="member">redist</ref>=2,<sp/>&amp;<sp/></highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a056bbf92b7605811c7ff570c45ebafd6" kindref="member">redirect</ref>=3<sp/></highlight></codeline>
<codeline lineno="428"><highlight class="normal"></highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cplClock,<sp/>&amp;</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sfcClock,<sp/>&amp;<sp/>!&lt;<sp/>FMS<sp/>clock<sp/>id<sp/>to<sp/>profile<sp/>sfc_boundary_layer<sp/></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fluxAtmDnClock,<sp/>&amp;<sp/>!&lt;<sp/>FMS<sp/>clock<sp/>id<sp/>to<sp/>profile<sp/>flux<sp/>down<sp/>from<sp/>atmosphere<sp/></highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>regenClock,<sp/>&amp;<sp/>!&lt;<sp/>FMS<sp/>clock<sp/>to<sp/>profile<sp/>exchange<sp/>grid<sp/>generation</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fluxAtmUpClock</highlight></codeline>
<codeline lineno="435"><highlight class="normal"></highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>X1_GRID_ATM,<sp/>&amp;<sp/>!&lt;<sp/>=1,<sp/>exchange<sp/>grid<sp/>index<sp/>for<sp/>xgrid_stock_move</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>X1_GRID_ICE,<sp/>&amp;<sp/>!&lt;<sp/>=2,<sp/>exchange<sp/>grid<sp/>index<sp/>for<sp/>xgrid_stock_move</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>X1_GRID_LND</highlight></codeline>
<codeline lineno="440"><highlight class="normal"></highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Dt_atm,<sp/>&amp;<sp/><sp/>&lt;<sp/>atmospheric<sp/>timestep<sp/>[s]</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Dt_cpl</highlight></codeline>
<codeline lineno="444"><highlight class="normal"></highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ni_atm,<sp/>&amp;<sp/>!&lt;<sp/>number<sp/>of<sp/>x<sp/>gridpoints<sp/>to<sp/>compute<sp/>diagnostics<sp/>in<sp/>subroutine<sp/>flux_ocean_to_ice</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nj_atm</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nxc_ice=0,<sp/>&amp;<sp/>!&lt;<sp/>number<sp/>of<sp/>x<sp/>points<sp/>in<sp/>ice<sp/>compute<sp/>domain</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a8d9d3bc11f1a73d8a019470b1769a156" kindref="member">nyc_ice</ref>=0,<sp/>&amp;<sp/></highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a4382a4653bce90fa50988dbf415ba7d9" kindref="member">nk_ice</ref>=0<sp/></highlight></codeline>
<codeline lineno="453"><highlight class="normal"></highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nxc_lnd=0,<sp/>&amp;<sp/>!&lt;<sp/>number<sp/>of<sp/>x<sp/>points<sp/>in<sp/>land<sp/>compute<sp/>domain</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac39eb3c6c82add4a1d0d7e2857c5b431" kindref="member">nyc_lnd</ref>=0<sp/></highlight></codeline>
<codeline lineno="457"><highlight class="normal"></highlight></codeline>
<codeline lineno="458"><highlight class="normal"></highlight><highlight class="keyword">contains</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="459"><highlight class="normal"></highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!#######################################################################</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="466"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ab8675556ecdbebfb8b3093fadbe11cde" kindref="member">atm_land_ice_flux_exchange_init</ref>(Time,<sp/>Atm,<sp/>Land,<sp/>Ice,<sp/>atmos_ice_boundary,<sp/>land_ice_atmos_boundary,<sp/>&amp;</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Dt_atm_in,<sp/>Dt_cpl_in,<sp/>z_ref_heat_in,<sp/>z_ref_mom_in,<sp/>do_area_weighted_flux_in,<sp/>do_forecast_in,<sp/>&amp;</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>partition_fprec_from_lprec_in,<sp/>scale_precip_2d_in,<sp/>nblocks_in,<sp/>cplClock_in,<sp/>ex_gas_fields_atm_in,<sp/>&amp;</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gas_fields_ice_in,<sp/>ex_gas_fluxes_in)</highlight></codeline>
<codeline lineno="470"><highlight class="normal"></highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">implicit<sp/>none</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsTime_type),<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>Time</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_data_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>Atm</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(land_data_type),<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>Land</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(ice_data_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>Ice</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_ice_boundary_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>atmos_ice_boundary</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(land_ice_atmos_boundary_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>land_ice_atmos_boundary</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>Dt_atm_in</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>Dt_cpl_in</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>z_ref_heat_in</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>z_ref_mom_in</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>scale_precip_2d_in</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>do_area_weighted_flux_in</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>do_forecast_in</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>partition_fprec_from_lprec_in</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>nblocks_in</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>cplClock_in</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsCoupler1dBC_type),<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/>::<sp/>ex_gas_fields_atm_in</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsCoupler1dBC_type),<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/>::<sp/>ex_gas_fields_ice_in</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsCoupler1dBC_type),<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">target</highlight><highlight class="normal"><sp/>::<sp/>ex_gas_fluxes_in</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">character(len=48)</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">parameter</highlight><highlight class="normal"><sp/>::<sp/>module_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_mod&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">character(len=256)</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">parameter</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>note_header<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;==&gt;Note<sp/>from<sp/>&apos;</highlight><highlight class="normal"><sp/>//<sp/>trim(module_name)<sp/>//<sp/></highlight><highlight class="stringliteral">&apos;(&apos;</highlight><highlight class="normal"><sp/>//<sp/>trim(sub_name)<sp/>//<sp/></highlight><highlight class="stringliteral">&apos;):&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="517"><highlight class="normal"></highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i,<sp/>&amp;<sp/>!&lt;<sp/>temporary<sp/>index<sp/>do<sp/>loop</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>outunit,<sp/>&amp;<sp/>!&lt;<sp/></highlight><highlight class="comment">!<sp/>returned<sp/>value<sp/>from<sp/>fms_mpp_stdout()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logunit</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is,<sp/>&amp;<sp/>!&lt;<sp/>starting<sp/>x-index<sp/>on<sp/>compute<sp/>domain</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie,<sp/>&amp;<sp/>!&lt;<sp/>ending<sp/>x-index<sp/>on<sp/>compute<sp/>domain</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>js,<sp/>&amp;<sp/>!&lt;<sp/>starting<sp/>y-index<sp/>on<sp/>compute<sp/>domain</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>je,<sp/>&amp;<sp/>!&lt;<sp/>ending<sp/>y-index<sp/>on<sp/>compute<sp/>domain</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>kd</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">character(32)</highlight><highlight class="normal"><sp/>::<sp/>tr_name</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>found</highlight></codeline>
<codeline lineno="532"></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/>dt_atm<sp/>=<sp/>dt_atm_in</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/>dt_cpl<sp/>=<sp/>dt_cpl_in</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/>z_ref_heat<sp/>=<sp/>z_ref_heat_in</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/>z_ref_mom<sp/>=<sp/>z_ref_mom_in</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/>do_area_weighted_flux<sp/>=<sp/>do_area_weighted_flux_in</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/>do_forecast<sp/>=<sp/>do_forecast_in</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/>partition_fprec_from_lprec<sp/>=<sp/>partition_fprec_from_lprec_in</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/>scale_precip_2d<sp/>=<sp/>scale_precip_2d_in</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/>nblocks<sp/>=<sp/>nblocks_in</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/>cplclock<sp/>=<sp/>cplclock_in</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/>ex_gas_fields_atm<sp/>=&gt;<sp/>ex_gas_fields_atm_in</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/>ex_gas_fields_ice<sp/>=&gt;<sp/>ex_gas_fields_ice_in</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/>ex_gas_fluxes<sp/>=&gt;<sp/>ex_gas_fluxes_in</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="549"><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/>outunit<sp/>=<sp/>fms_mpp_stdout()</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/>logunit<sp/>=<sp/>fms_mpp_stdlog()</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(block_start(nblocks),<sp/>block_end(nblocks))</highlight></codeline>
<codeline lineno="557"><highlight class="normal"></highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_number_tracers(model_atmos,<sp/>num_tracers=n_atm_tr_tot,<sp/>num_prog=n_atm_tr)</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_number_tracers(model_land,<sp/>num_tracers=n_lnd_tr_tot,<sp/>num_prog=n_lnd_tr)</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="564"><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(tr_table(n_atm_tr),<sp/>tr_table_map(n_atm_tr))</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/>n<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i=1,<sp/>n_atm_tr</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(<sp/>model_atmos,<sp/>i,<sp/>tr_name<sp/>)</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tr_table(n)%atm<sp/>=<sp/>i</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tr_table(n)%ice<sp/>=<sp/>fms_tracer_manager_get_tracer_index(<sp/>model_ice,<sp/><sp/>tr_name<sp/>)</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tr_table_map(i)%ice<sp/>=<sp/>tr_table(n)%ice</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tr_table(n)%lnd<sp/>=<sp/>fms_tracer_manager_get_tracer_index(<sp/>model_land,<sp/>tr_name<sp/>)</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tr_table_map(i)%lnd<sp/>=<sp/>tr_table(n)%lnd</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(tr_table(n)%ice/=no_tracer.or.tr_table(n)%lnd/=no_tracer)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tr_table_map(i)%exch<sp/>=<sp/>n</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n<sp/>=<sp/>n<sp/>+<sp/>1</highlight></codeline>
<codeline lineno="580"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="581"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/>n_exch_tr<sp/>=<sp/>n<sp/>-<sp/>1</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="584"><highlight class="normal"></highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/>n_gex_atm2lnd<sp/>=<sp/>fms_gex_get_n_ex(model_atmos,model_land)</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fms_mpp_root_pe().eq.fms_mpp_pe())<sp/></highlight><highlight class="keyword">write</highlight><highlight class="normal">(*,*)<sp/></highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_init<sp/>[gex]&apos;</highlight><highlight class="normal">,<sp/>n_gex_atm2lnd</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/>n_gex_lnd2atm<sp/>=<sp/>fms_gex_get_n_ex(model_land,model_atmos)</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fms_mpp_root_pe().eq.fms_mpp_pe())<sp/></highlight><highlight class="keyword">write</highlight><highlight class="normal">(*,*)<sp/></highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_init<sp/>[gex]&apos;</highlight><highlight class="normal">,<sp/>n_gex_lnd2atm</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>1,<sp/>ex_gas_fluxes%num_bcs</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ex_gas_fluxes%bc(n)%atm_tr_index<sp/>.gt.<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>found<sp/>=<sp/>.false.</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>1,<sp/>n_exch_tr</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ex_gas_fluxes%bc(n)%atm_tr_index<sp/>.eq.<sp/>tr_table(i)%atm)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>found<sp/>=<sp/>.true.</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">exit</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="605"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="606"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(.not.<sp/>found)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n_exch_tr<sp/>=<sp/>n_exch_tr<sp/>+<sp/>1</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tr_table(n_exch_tr)%atm<sp/>=<sp/>ex_gas_fluxes%bc(n)%atm_tr_index</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tr_table(n_exch_tr)%ice<sp/>=<sp/>no_tracer<sp/></highlight><highlight class="comment">!<sp/>because<sp/>ocean-atm<sp/>gas<sp/>fluxes<sp/>are<sp/>not<sp/>held<sp/>in<sp/>the<sp/>ice<sp/>model<sp/>as<sp/>tracers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tr_table(n_exch_tr)%lnd<sp/>=<sp/>no_tracer<sp/></highlight><highlight class="comment">!<sp/>because<sp/>this<sp/>would<sp/>have<sp/>been<sp/>found<sp/>above</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tr_table_map(n_exch_tr)%exch<sp/>=<sp/>n_exch_tr</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tr_table_map(n_exch_tr)%ice<sp/>=<sp/>tr_table(n_exch_tr)%ice</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tr_table_map(n_exch_tr)%lnd<sp/>=<sp/>tr_table(n_exch_tr)%lnd</highlight></codeline>
<codeline lineno="615"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="616"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="617"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">write</highlight><highlight class="normal">(outunit,*)<sp/>trim(note_header),<sp/></highlight><highlight class="stringliteral">&apos;<sp/>Number<sp/>of<sp/>exchanged<sp/>tracers<sp/>=<sp/>&apos;</highlight><highlight class="normal">,<sp/>n_exch_tr</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">write</highlight><highlight class="normal">(logunit,*)<sp/>trim(note_header),<sp/></highlight><highlight class="stringliteral">&apos;<sp/>Number<sp/>of<sp/>exchanged<sp/>tracers<sp/>=<sp/>&apos;</highlight><highlight class="normal">,<sp/>n_exch_tr</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>1,n_exch_tr</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(model_atmos,<sp/>tr_table(i)%atm,<sp/>tr_name)</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">write</highlight><highlight class="normal">(outunit,*)</highlight><highlight class="stringliteral">&apos;Tracer<sp/>field<sp/>name<sp/>:&apos;</highlight><highlight class="normal">//trim(tr_name)</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">write</highlight><highlight class="normal">(logunit,*)</highlight><highlight class="stringliteral">&apos;Tracer<sp/>field<sp/>name<sp/>:&apos;</highlight><highlight class="normal">//trim(tr_name)</highlight></codeline>
<codeline lineno="624"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>+fix-me-slm+<sp/>specific<sp/>humidity<sp/>may<sp/>not<sp/>be<sp/>present<sp/>if<sp/>we<sp/>are<sp/>running<sp/>with</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>dry<sp/>atmosphere.<sp/>Besides,<sp/>model<sp/>may<sp/>use<sp/>mixing<sp/>ratio<sp/>(&apos;mix_rat&apos;)<sp/>(?).<sp/>However,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>some<sp/>atmos<sp/>code<sp/>also<sp/>assumes<sp/>&apos;sphum&apos;<sp/>is<sp/>present,<sp/>so<sp/>for<sp/>now<sp/>the<sp/>following</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>code<sp/>may<sp/>be<sp/>good<sp/>enough.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i=1,<sp/>n_exch_tr</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(<sp/>model_atmos,<sp/>tr_table(i)%atm,<sp/>tr_name<sp/>)</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(fms_mpp_lowercase(tr_name)==</highlight><highlight class="stringliteral">&apos;sphum&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>isphum<sp/>=<sp/>i</highlight></codeline>
<codeline lineno="637"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>jgj:<sp/>find<sp/>out<sp/>which<sp/>exchange<sp/>tracer<sp/>is<sp/>co2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(fms_mpp_lowercase(tr_name)==</highlight><highlight class="stringliteral">&apos;co2&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ico2<sp/>=<sp/>i</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">write</highlight><highlight class="normal">(outunit,*)</highlight><highlight class="stringliteral">&apos;Exchange<sp/>tracer<sp/>index<sp/>for<sp/>&apos;</highlight><highlight class="normal">//trim(tr_name),</highlight><highlight class="stringliteral">&apos;<sp/>:<sp/>&apos;</highlight><highlight class="normal">,ico2</highlight></codeline>
<codeline lineno="642"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(fms_mpp_lowercase(tr_name)==</highlight><highlight class="stringliteral">&apos;nh3&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>inh3<sp/>=<sp/>i</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">write</highlight><highlight class="normal">(outunit,*)</highlight><highlight class="stringliteral">&apos;Exchange<sp/>tracer<sp/>index<sp/>for<sp/>&apos;</highlight><highlight class="normal">//trim(tr_name),</highlight><highlight class="stringliteral">&apos;<sp/>:<sp/>&apos;</highlight><highlight class="normal">,inh3</highlight></codeline>
<codeline lineno="646"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="647"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="648"><highlight class="normal"></highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isphum==no_tracer)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_error_mesg(module_name,<sp/></highlight><highlight class="stringliteral">&apos;tracer<sp/>&quot;sphum&quot;<sp/>must<sp/>be<sp/>present<sp/>in<sp/>the<sp/>atmosphere&apos;</highlight><highlight class="normal">,<sp/>fatal)</highlight></codeline>
<codeline lineno="651"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="652"><highlight class="normal"></highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ico2==no_tracer)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_error_mesg(module_name,<sp/></highlight><highlight class="stringliteral">&apos;tracer<sp/>&quot;co2&quot;<sp/>not<sp/>present<sp/>in<sp/>the<sp/>atmosphere&apos;</highlight><highlight class="normal">,<sp/>note)</highlight></codeline>
<codeline lineno="655"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="657"><highlight class="normal"></highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_get_compute_domain(atm%domain,<sp/>is,<sp/>ie,<sp/>js,<sp/>je)</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(scale_precip_2d)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(frac_precip(is:ie,js:je))</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>frac_precip=0.0</highlight></codeline>
<codeline lineno="663"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="664"><highlight class="normal"></highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_init(remap_method)</highlight></codeline>
<codeline lineno="668"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="669"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_setup_xmap(xmap_sfc,<sp/>[</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">],<sp/>[atm%Domain,<sp/>ice%Domain,<sp/>land%Domain],<sp/>&amp;</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;INPUT/grid_spec.nc&quot;</highlight><highlight class="normal">,<sp/>atm%grid,<sp/>lnd_ug_domain=land%ug_domain)</highlight></codeline>
<codeline lineno="671"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="672"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_setup_xmap(xmap_sfc,<sp/>[</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">],<sp/>[atm%Domain,<sp/>ice%Domain,<sp/>land%Domain],<sp/>&amp;</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;INPUT/grid_spec.nc&quot;</highlight><highlight class="normal">,<sp/>atm%grid)</highlight></codeline>
<codeline lineno="674"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="675"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/>x1_grid_atm<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/>x1_grid_ice<sp/>=<sp/>2</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/>x1_grid_lnd<sp/>=<sp/>3;</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae90760b8fd57a82bc54db9ece86486ba" kindref="member">generate_sfc_xgrid</ref>(land,<sp/>ice)</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n_xgrid_sfc.eq.1)<sp/></highlight><highlight class="keyword">write</highlight><highlight class="normal"><sp/>(*,</highlight><highlight class="stringliteral">&apos;(a,i6,6x,a)&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="stringliteral">&apos;PE<sp/>=<sp/>&apos;</highlight><highlight class="normal">,<sp/>fms_mpp_pe(),<sp/></highlight><highlight class="stringliteral">&apos;Surface<sp/>exchange<sp/>size<sp/>equals<sp/>one.&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">surface_flux_init()</highlight></codeline>
<codeline lineno="685"><highlight class="normal"></highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-----<sp/>initialize<sp/>quantities<sp/>for<sp/>global<sp/>integral<sp/>package<sp/>-----</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="687"><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!!<sp/>call<sp/>diag_integral_field_init<sp/>(&apos;prec&apos;,<sp/>&apos;f6.3&apos;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_integral_field_init<sp/>(</highlight><highlight class="stringliteral">&apos;evap&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;f6.3&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="690"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="691"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_integral_field_init<sp/>(</highlight><highlight class="stringliteral">&apos;t_surf&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;f10.3&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="comment">!miz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_integral_field_init<sp/>(</highlight><highlight class="stringliteral">&apos;t_ref&apos;</highlight><highlight class="normal">,<sp/><sp/></highlight><highlight class="stringliteral">&apos;f10.3&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="comment">!miz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="693"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="694"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>all<sp/>fields<sp/>will<sp/>be<sp/>output<sp/>on<sp/>the<sp/>atmospheric<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac8a26116481dffeb2f5f2ac6444c64f5" kindref="member">diag_field_init</ref><sp/>(<sp/>time,<sp/>atm%axes(1:2),<sp/>land%axes,<sp/>land%pe<sp/>)</highlight></codeline>
<codeline lineno="698"><highlight class="normal"></highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/>ni_atm<sp/>=<sp/></highlight><highlight class="keyword">size</highlight><highlight class="normal">(atm%lon_bnd,1)-1<sp/></highlight><highlight class="comment">!<sp/>to<sp/>dimension<sp/>&quot;diag_atm&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/>nj_atm<sp/>=<sp/></highlight><highlight class="keyword">size</highlight><highlight class="normal">(atm%lon_bnd,2)-1<sp/></highlight><highlight class="comment">!<sp/>in<sp/>flux_ocean_to_ice</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="704"><highlight class="normal"></highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_get_compute_domain(ice%domain,<sp/>is,<sp/>ie,<sp/>js,<sp/>je)</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/>kd<sp/>=<sp/></highlight><highlight class="keyword">size</highlight><highlight class="normal">(ice%part_size,3)</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%u_flux(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%v_flux(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%u_star(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%t_flux(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%q_flux(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%lw_flux(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%sw_flux_vis_dir(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%sw_flux_vis_dif(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%sw_flux_nir_dir(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%sw_flux_nir_dif(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%sw_down_vis_dir(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%sw_down_vis_dif(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%sw_down_nir_dir(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%sw_down_nir_dif(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%lprec(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%fprec(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%dhdt(is:ie,js:je,kd),<sp/>source=0.0)<sp/></highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%dedt(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%drdt(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%coszen(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(atmos_ice_boundary%p(is:ie,js:je,kd),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="731"><highlight class="normal"></highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Copying<sp/>initialized<sp/>gas<sp/>fluxes<sp/>from<sp/>exchange<sp/>grid<sp/>to<sp/>atmosphere_ice<sp/>boundary</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_coupler_type_copy(ex_gas_fluxes,<sp/>atmos_ice_boundary%fluxes,<sp/>is,<sp/>ie,<sp/>js,<sp/>je,<sp/>kd,<sp/><sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/>ice%axes,<sp/>time,<sp/>suffix<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;_atm_ice&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="737"><highlight class="normal"></highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Ice%ocean_fields<sp/>and<sp/>Ice%ocean_fluxes_top<sp/>will<sp/>not<sp/>be<sp/>passed<sp/>to<sp/>ocean,<sp/>so<sp/>these<sp/>two</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>coupler_type_copy<sp/>calls<sp/>are<sp/>moved<sp/>from<sp/>ice_ocean_flux_init<sp/>to<sp/>here.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(.not.fms_coupler_type_initialized(ice%ocean_fields))<sp/>&amp;</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_coupler_type_spawn(ex_gas_fields_ice,<sp/>ice%ocean_fields,<sp/>&amp;</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[is,is,ie,ie],<sp/>[js,js,je,je],<sp/>[1,<sp/>kd],<sp/>suffix<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;_ice&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_coupler_type_set_diags(ice%ocean_fields,<sp/></highlight><highlight class="stringliteral">&apos;ice_flux&apos;</highlight><highlight class="normal">,<sp/>ice%axes,<sp/>time)</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="745"><highlight class="normal"></highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_get_compute_domain(atm%domain,<sp/>is,<sp/>ie,<sp/>js,<sp/>je)</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%t(is:ie,js:je),<sp/>source=273.0)</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%t_ocean(is:ie,js:je),<sp/>source=200.0)</highlight><highlight class="comment">!<sp/>Joseph:<sp/>surf<sp/>ocean<sp/>temp</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%u_ref(is:ie,js:je),<sp/>source=0.0)<sp/><sp/></highlight><highlight class="comment">!<sp/>bqx</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%v_ref(is:ie,js:je),<sp/>source=0.0)<sp/><sp/></highlight><highlight class="comment">!<sp/>bqx</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%t_ref(is:ie,js:je),<sp/>source=273.0)<sp/><sp/></highlight><highlight class="comment">!<sp/>cjg:<sp/>PBL<sp/>depth<sp/>mods</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%q_ref(is:ie,js:je),<sp/>source=0.0)<sp/><sp/></highlight><highlight class="comment">!<sp/>cjg:<sp/>PBL<sp/>depth<sp/>mods</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%albedo(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%albedo_vis_dir(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%albedo_nir_dir(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%albedo_vis_dif(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%albedo_nir_dif(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%land_frac(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%dt_t(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%dt_tr(is:ie,js:je,n_atm_tr),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%u_flux(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%v_flux(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%dtaudu(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%dtaudv(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%u_star(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%b_star(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%q_star(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="770"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="771"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%shflx(is:ie,js:je),<sp/>source=0.0)</highlight><highlight class="comment">!miz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%lhflx(is:ie,js:je),<sp/>source=0.0)</highlight><highlight class="comment">!miz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="773"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="774"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%wind(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%thv_atm(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%thv_surf(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%rough_mom(is:ie,js:je),<sp/>source=0.01)</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%rough_heat(is:ie,js:je),<sp/>source=0.01)<sp/></highlight><highlight class="comment">!<sp/>Kun</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%frac_open_sea(is:ie,js:je),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(land_ice_atmos_boundary%gex_lnd2atm(is:ie,js:je,n_gex_lnd2atm),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="782"><highlight class="normal"></highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>The<sp/>first<sp/>call<sp/>is<sp/>no<sp/>longer<sp/>necessary,<sp/>the<sp/>fluxes<sp/>will<sp/>be<sp/>passed<sp/>by<sp/>the<sp/>land<sp/>module</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>The<sp/>2nd<sp/>call<sp/>is<sp/>useful<sp/>in<sp/>the<sp/>case<sp/>of<sp/>a<sp/>ocean<sp/>model<sp/>only<sp/>simulation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_coupler_type_copy(ex_gas_fields_atm,<sp/>atm%fields,<sp/>is,<sp/>ie,<sp/>js,<sp/>je,<sp/>&amp;</highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/>atm%axes(1:2),<sp/>time,<sp/>suffix<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;_atm&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="791"><highlight class="normal"></highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>ice%pe)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_get_compute_domain(ice%domain,<sp/>xsize=nxc_ice,<sp/>ysize=<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a8d9d3bc11f1a73d8a019470b1769a156" kindref="member">nyc_ice</ref>)</highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a4382a4653bce90fa50988dbf415ba7d9" kindref="member">nk_ice</ref><sp/>=<sp/></highlight><highlight class="keyword">size</highlight><highlight class="normal">(ice%part_size,3)</highlight></codeline>
<codeline lineno="796"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="797"><highlight class="normal"></highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>land%pe)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_get_compute_domain(land%domain,<sp/>xsize=nxc_lnd,<sp/>ysize=<ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac39eb3c6c82add4a1d0d7e2857c5b431" kindref="member">nyc_lnd</ref>)</highlight></codeline>
<codeline lineno="801"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="803"><highlight class="normal"></highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Balaji:<sp/>clocks<sp/>on<sp/>atm%pe<sp/>only</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/>sfcclock<sp/>=<sp/>fms_mpp_clock_id(<sp/></highlight><highlight class="stringliteral">&apos;SFC<sp/>boundary<sp/>layer&apos;</highlight><highlight class="normal">,<sp/>flags=fms_clock_flag_default,<sp/>grain=clock_subcomponent<sp/>)</highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/>fluxatmdnclock<sp/>=<sp/>fms_mpp_clock_id(<sp/></highlight><highlight class="stringliteral">&apos;Flux<sp/>DN<sp/>from<sp/>atm&apos;</highlight><highlight class="normal">,<sp/>flags=fms_clock_flag_default,<sp/>grain=clock_routine<sp/>)</highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/>regenclock<sp/>=<sp/>fms_mpp_clock_id(<sp/></highlight><highlight class="stringliteral">&apos;XGrid<sp/>generation&apos;</highlight><highlight class="normal">,<sp/>flags=fms_clock_flag_default,<sp/>grain=clock_routine<sp/>)</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/>fluxatmupclock<sp/>=<sp/>fms_mpp_clock_id(<sp/></highlight><highlight class="stringliteral">&apos;Flux<sp/>UP<sp/>to<sp/>atm&apos;</highlight><highlight class="normal">,<sp/>flags=fms_clock_flag_default,<sp/>grain=clock_routine<sp/>)</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/>do_init<sp/>=<sp/>.false.</highlight></codeline>
<codeline lineno="814"><highlight class="normal"></highlight></codeline>
<codeline lineno="815"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ab8675556ecdbebfb8b3093fadbe11cde" kindref="member">atm_land_ice_flux_exchange_init</ref></highlight></codeline>
<codeline lineno="816"><highlight class="normal"></highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!#######################################################################</highlight></codeline>
<codeline lineno="838"><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae7a53520e8a084f5fa930c5c18c85b54" kindref="member">sfc_boundary_layer</ref><sp/>(dt,<sp/>Time,<sp/>Atm,<sp/>Land,<sp/>Ice,<sp/>Land_Ice_Atmos_Boundary)</highlight></codeline>
<codeline lineno="839"><highlight class="normal"></highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">implicit<sp/>none</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>dt</highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsTime_type),<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>Time</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_data_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>Atm</highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(land_data_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>Land</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(ice_data_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>Ice</highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(land_ice_atmos_boundary_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>Land_Ice_Atmos_Boundary</highlight></codeline>
<codeline lineno="852"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="853"><highlight class="normal"></highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>----<sp/>local<sp/>vars<sp/>----------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(n_xgrid_sfc)</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>albedo<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_vis_dir,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>albedo<sp/>for<sp/>light<sp/>with<sp/>wavelength<sp/>in<sp/>visible<sp/>region<sp/>of<sp/>the<sp/>solar<sp/>spectrum</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_nir_dir,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>albedo<sp/>for<sp/>light<sp/>with<sp/>wavelength<sp/>in<sp/>near-ir<sp/>region<sp/>of<sp/>the<sp/>solar<sp/>spectrum</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_vis_dif,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>difference<sp/>in<sp/>albedo<sp/>for<sp/>light<sp/>with<sp/>wavelength<sp/>in<sp/>visible<sp/>region<sp/>of<sp/>the<sp/>solar<sp/>spectrum</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_nir_dif,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>difference<sp/>in<sp/>albedo<sp/>for<sp/>light<sp/>with<sp/>wavelength<sp/>in<sp/>near-ir<sp/>region<sp/>of<sp/>the<sp/>solar<sp/>spectrum</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_land_frac,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>fractional<sp/>area<sp/>of<sp/>land<sp/>in<sp/>grid<sp/>cell<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_t_atm,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>air<sp/>temperature<sp/>at<sp/>the<sp/>lowest<sp/>atmospheric<sp/>level</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_p_atm,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>pressure<sp/>at<sp/>the<sp/>lowest<sp/>atmospheric<sp/>level<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_u_atm,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>u<sp/>wind<sp/>component<sp/>at<sp/>the<sp/>lowest<sp/>atmospheric<sp/>level<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_v_atm,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>v<sp/>wind<sp/>component<sp/>at<sp/>the<sp/>lowest<sp/>atmospheric<sp/>level<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gust,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>gust<sp/>scale<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_t_surf4,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>(surface<sp/>temperature)<sp/>**<sp/>4</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_u_surf,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>u<sp/>wind<sp/>component<sp/>at<sp/>Earth&apos;s<sp/>surface</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_v_surf,<sp/>&amp;<sp/><sp/></highlight><highlight class="comment">!<sp/>v<sp/>wind<sp/>component<sp/>at<sp/>Earth&apos;s<sp/>surface</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_rough_mom,<sp/>&amp;<sp/><sp/></highlight><highlight class="comment">!<sp/>momentum<sp/>roughness<sp/>length</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_rough_heat,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>heat<sp/>roughness<sp/>length</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_rough_moist,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>moisture<sp/>roughness<sp/>length</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_rough_scale,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>scale<sp/>factor<sp/>for<sp/>topographic<sp/>roughness<sp/>calculation<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_q_star,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>turbulent<sp/>moisture<sp/>scale</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_thv_atm,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>area<sp/>theta_v<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_thv_surf,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>surface<sp/>theta_v</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_cd_q,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>moisture<sp/>exchange<sp/>coefficient</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_ref,<sp/>&amp;</highlight><highlight class="comment">!<sp/>specific<sp/>humidity<sp/>at<sp/>z_ref_heat<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_ref_u,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>zonal<sp/>wind<sp/>component<sp/>at<sp/>z_ref_mom</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_ref_v,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>meridional<sp/>wind<sp/>component<sp/>at<sp/>z_ref_mom</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_u10,<sp/>&amp;<sp/>!&lt;<sp/>zonal<sp/>wind<sp/>speed<sp/>at<sp/>10m<sp/>above<sp/>the<sp/>surface</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_ref2,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_t_ref,<sp/>&amp;</highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_qs_ref,<sp/>&amp;</highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_qs_ref_cmip,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_del_m,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>reference<sp/>height<sp/>for<sp/>interpolation<sp/>factor<sp/>for<sp/>momentum</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_del_h,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>reference<sp/>height<sp/>interpolation<sp/>factor<sp/>for<sp/>heat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_del_q,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>reference<sp/>height<sp/>interpation<sp/>factor<sp/>for<sp/>moisture</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_frac_open_sea<sp/></highlight><highlight class="comment">!<sp/>open-water<sp/>mask,<sp/>not<sp/>used?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="890"><highlight class="normal"></highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal"><sp/>::<sp/>rho</highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(n_xgrid_sfc,n_exch_tr)</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_atm,<sp/>&amp;<sp/>!&lt;<sp/>concentration<sp/>of<sp/>tracer<sp/>at<sp/>lowest<sp/>atmospheric<sp/>level</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_ref</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(n_xgrid_sfc)</highlight><highlight class="normal"><sp/>::<sp/>ex_co2_atm_dvmr<sp/></highlight><highlight class="comment">!<sp/>jgj:<sp/>added<sp/>for<sp/>co2_atm<sp/>diagnostic</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="897"><highlight class="normal"></highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(size(Land_Ice_Atmos_Boundary%t,1),size(Land_Ice_Atmos_Boundary%t,2))</highlight><highlight class="normal"><sp/>::<sp/>diag_atm</highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="900"><highlight class="normal"></highlight></codeline>
<codeline lineno="901"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="902"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(size(Land%t_ca,<sp/>1),size(Land%t_ca,2))</highlight><highlight class="normal"><sp/>::<sp/>diag_land</highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(size(Land%t_ca,<sp/>1))</highlight><highlight class="normal"><sp/>::<sp/>diag_land_ug,<sp/>tile_size_ug</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(nxc_lnd,nyc_lnd)</highlight><highlight class="normal"><sp/>::<sp/>diag_land_sg,<sp/>tile_size_sg</highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(size(Land%t_ca,<sp/>1))</highlight><highlight class="normal"><sp/>::<sp/>mask_ug</highlight></codeline>
<codeline lineno="906"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(nxc_lnd,nyc_lnd)</highlight><highlight class="normal"><sp/>::<sp/>mask_sg</highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>k</highlight></codeline>
<codeline lineno="908"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="909"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(size(Land%t_ca,<sp/>1),size(Land%t_ca,2),<sp/>size(Land%t_ca,3))</highlight><highlight class="normal"><sp/>::<sp/>diag_land</highlight></codeline>
<codeline lineno="910"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="911"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(size(Ice%t_surf,1),size(Ice%t_surf,2),size(Ice%t_surf,3))</highlight><highlight class="normal"><sp/>::<sp/>sea</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(size(Ice%albedo,1),size(Ice%albedo,2),size(Ice%albedo,3))</highlight><highlight class="normal"><sp/>::<sp/><sp/>tmp_open_sea</highlight></codeline>
<codeline lineno="913"><highlight class="normal"></highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>zrefm,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>reference<sp/>height<sp/>for<sp/>computing<sp/>surface<sp/>fluxes<sp/>from<sp/>Monin-Obukhov<sp/>similarity<sp/>theory</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>zrefh<sp/></highlight><highlight class="comment">!<sp/>reference<sp/>height<sp/>for<sp/>computing<sp/>surface<sp/>fluxes<sp/>from<sp/>Monin-Obukhov<sp/>similarity<sp/>theory</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>used</highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">character(32)</highlight><highlight class="normal"><sp/>::<sp/>tr_name,<sp/>tr_units<sp/></highlight><highlight class="comment">!<sp/>tracer<sp/>name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="920"><highlight class="normal"></highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>tr,<sp/>n,<sp/>m<sp/></highlight><highlight class="comment">!<sp/>tracer<sp/>indices</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>is,<sp/>ie,<sp/>isc,<sp/>iec,<sp/>jsc,<sp/>jec</highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>i,<sp/>l,<sp/>j,<sp/>n_gex</highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(n_xgrid_sfc,n_gex_lnd2atm)</highlight><highlight class="normal"><sp/>::<sp/>ex_gex_lnd2atm</highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="927"><highlight class="normal"></highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>[1]<sp/>check<sp/>that<sp/>the<sp/>module<sp/>was<sp/>initialized</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="929"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_init)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_error_mesg<sp/>(</highlight><highlight class="stringliteral">&apos;atm_land_ice_flux_exchange_mod&apos;</highlight><highlight class="normal">,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="930"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;must<sp/>call<sp/>atm_land_ice_flux_exchange_init<sp/>first&apos;</highlight><highlight class="normal">,<sp/>fatal)</highlight></codeline>
<codeline lineno="931"><highlight class="normal"></highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Balaji</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_begin(cplclock)</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_begin(sfcclock)</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal"><sp/>(<sp/>&amp;</highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref>(n_xgrid_sfc),<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a29071f5ae5e2772b510570b3834fe1b4" kindref="member">ex_t_surf_miz</ref>(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af4fdc80a51f0145da4aa80a6317cc156" kindref="member">ex_p_surf</ref>(n_xgrid_sfc),<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae70d5c9a1a49eff91b2c14c1657103a6" kindref="member">ex_slp</ref>(n_xgrid_sfc),<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref>(n_xgrid_sfc),<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="947"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7a723109680791b32db1371f623f679d" kindref="member">ex_dhdt_surf</ref>(n_xgrid_sfc),<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a50b141a6a27c86e08632eb459f39324b" kindref="member">ex_dedt_surf</ref>(n_xgrid_sfc),<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="949"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a1dcdd143924c77ba06ef91b15bfae469" kindref="member">ex_dqsatdt_surf</ref>(n_xgrid_sfc),<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="950"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aeba37d2c046170e4112311711809f620" kindref="member">ex_drdt_surf</ref>(n_xgrid_sfc),<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a04986e4dfe0871fb9b662597e47772bb" kindref="member">ex_dhdt_atm</ref>(n_xgrid_sfc),<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref>(n_xgrid_sfc),<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="953"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af36a6c987c16a10e698b500396554130" kindref="member">ex_flux_lw</ref>(n_xgrid_sfc),<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="954"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_drag_q(n_xgrid_sfc),<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="955"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_avail(n_xgrid_sfc),<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="956"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_f_t_delt_n(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="957"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_surf(n_xgrid_sfc,<sp/>n_exch_tr),<sp/>&amp;</highlight></codeline>
<codeline lineno="958"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dfdtr_surf(n_xgrid_sfc,<sp/>n_exch_tr),<sp/>&amp;</highlight></codeline>
<codeline lineno="959"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dfdtr_atm(n_xgrid_sfc,<sp/>n_exch_tr),<sp/>&amp;</highlight></codeline>
<codeline lineno="960"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_tr(n_xgrid_sfc,<sp/>n_exch_tr),<sp/>&amp;</highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_f_tr_delt_n(n_xgrid_sfc,<sp/>n_exch_tr),<sp/>&amp;</highlight></codeline>
<codeline lineno="962"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_e_tr_n(n_xgrid_sfc,<sp/>n_exch_tr),<sp/>&amp;</highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a972ea1bb3939a7b1fed1e698b182de88" kindref="member">ex_con_atm</ref>(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_con_ref(n_xgrid_sfc,<sp/>n_exch_tr),<sp/>&amp;</highlight></codeline>
<codeline lineno="965"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_con_atm(n_xgrid_sfc,<sp/>n_exch_tr),<sp/>&amp;</highlight></codeline>
<codeline lineno="966"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>MOD<sp/>these<sp/>were<sp/>moved<sp/>from<sp/>local<sp/>!<sp/>so<sp/>they<sp/>can<sp/>be<sp/>passed<sp/>to<sp/>flux<sp/>down</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="967"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a5419fecfda33b11db1caab9042cf90c2" kindref="member">ex_flux_u</ref>(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac27b58d41879537c39e4b8bc6eac83f8" kindref="member">ex_flux_v</ref>(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="969"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a4916ecd33588bcfbce81a5393f436671" kindref="member">ex_dtaudu_atm</ref>(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="970"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae3ae41712484a6829639b4cd4431dab1" kindref="member">ex_dtaudv_atm</ref>(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="971"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7cc9b8d546d6589e3b2cf8a7ad6dd90c" kindref="member">ex_seawater</ref>(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>values<sp/>added<sp/>for<sp/>LM3</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="973"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a1fc83cb6b523c05c9925f67c1bef77eb" kindref="member">ex_cd_t</ref>(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="974"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a26e0b81f6ed8473af88bdec4dda23c4b" kindref="member">ex_cd_m</ref>(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="975"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a0fd79bc7659c354908e2e6c325985544" kindref="member">ex_b_star</ref>(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="976"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3faddc34ad457fdb55533bead75ce7f0" kindref="member">ex_u_star</ref>(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="977"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ada77a5490b1ad25fa3ca68f3f81b9548" kindref="member">ex_wind</ref>(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="978"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a415a43eca092359dca12e46ac24bb0de" kindref="member">ex_z_atm</ref>(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="979"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_e_t_n(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="980"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a86ed92f16c0fb112e38dd6873ca4cded" kindref="member">ex_e_q_n</ref>(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="981"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_land(n_xgrid_sfc))</highlight></codeline>
<codeline lineno="982"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>SCM</highlight></codeline>
<codeline lineno="983"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal"><sp/>(<sp/>&amp;</highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dhdt_surf_forland(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dedt_surf_forland(n_xgrid_sfc),<sp/>&amp;</highlight></codeline>
<codeline lineno="986"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dedq_surf_forland(n_xgrid_sfc))</highlight></codeline>
<codeline lineno="987"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="988"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>END<sp/>ALLOCATION<sp/>ARRAYS<sp/>FOR<sp/>EXCHANGE<sp/>FIELDS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="989"><highlight class="normal"></highlight></codeline>
<codeline lineno="991"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="992"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af4fdc80a51f0145da4aa80a6317cc156" kindref="member">ex_p_surf</ref><sp/>=<sp/>1.0</highlight></codeline>
<codeline lineno="993"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Actual<sp/>allocation<sp/>of<sp/>exchange<sp/>fields<sp/>for<sp/>ocean_ice<sp/>boundary</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="994"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>1,<sp/>ex_gas_fields_ice%num_bcs</highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>m<sp/>=<sp/>1,<sp/>ex_gas_fields_ice%bc(n)%num_fields</highlight></codeline>
<codeline lineno="996"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">associated</highlight><highlight class="normal">(ex_gas_fields_ice%bc(n)%field(m)%values))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_error(<sp/>fatal,<sp/></highlight><highlight class="stringliteral">&apos;sfc_boundary_layer:<sp/>ex_gas_fields_ice<sp/>already<sp/>allocated.&apos;</highlight><highlight class="normal"><sp/>)</highlight></codeline>
<codeline lineno="998"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(ex_gas_fields_ice%bc(n)%field(m)%values(n_xgrid_sfc),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1001"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1003"><highlight class="normal"></highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>1,<sp/>ex_gas_fields_atm%num_bcs</highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>m<sp/>=<sp/>1,<sp/>ex_gas_fields_atm%bc(n)%num_fields</highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">associated</highlight><highlight class="normal">(ex_gas_fields_atm%bc(n)%field(m)%values))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_error(fatal,<sp/></highlight><highlight class="stringliteral">&apos;sfc_boundary_layer:<sp/>ex_gas_fields_atm<sp/>already<sp/>allocated.&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal"><sp/>(ex_gas_fields_atm%bc(n)%field(m)%values(n_xgrid_sfc),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="1012"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1013"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1015"><highlight class="normal"></highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>1,<sp/>ex_gas_fluxes%num_bcs</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>m<sp/>=<sp/>1,<sp/>ex_gas_fluxes%bc(n)%num_fields</highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">associated</highlight><highlight class="normal">(ex_gas_fluxes%bc(n)%field(m)%values))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_error(fatal,<sp/></highlight><highlight class="stringliteral">&apos;sfc_boundary_layer:<sp/>ex_gas_fluxes<sp/>already<sp/>allocated.&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(ex_gas_fluxes%bc(n)%field(m)%values(n_xgrid_sfc),<sp/>source=0.0)</highlight></codeline>
<codeline lineno="1024"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="1025"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1026"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1028"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Call<sp/>the<sp/>atmosphere<sp/>tracer<sp/>driver<sp/>to<sp/>gather<sp/>the<sp/>data<sp/>needed<sp/>for<sp/>extra<sp/>gas<sp/>tracers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1029"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>For<sp/>ocean<sp/>only<sp/>model</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1030"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>call<sp/>atmos_get_fields_for_flux(Atm)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1031"><highlight class="normal"></highlight></codeline>
<codeline lineno="1032"><highlight class="normal"></highlight></codeline>
<codeline lineno="1034"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1035"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>this<sp/>is<sp/>actually<sp/>a<sp/>safeguard<sp/>against<sp/>using<sp/>undefined<sp/>values</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1036"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>parallel<sp/>do<sp/>default(none)<sp/>shared(my_nblocks,block_start,block_end,ex_t_surf,ex_u_surf,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1037"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_v_surf,<sp/>ex_albedo,<sp/>ex_albedo_vis_dir,<sp/>ex_albedo_nir_dir,<sp/>ex_albedo_vis_dif,<sp/>ex_albedo_nir_dif,<sp/>ex_cd_t,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1038"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_cd_m,<sp/>ex_cd_q,<sp/>ex_frac_open_sea,<sp/>n_gex_lnd2atm,<sp/>ex_gex_lnd2atm)<sp/><sp/>private(is,ie,n_gex)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1039"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>1,<sp/>my_nblocks</highlight></codeline>
<codeline lineno="1040"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is=block_start(l)</highlight></codeline>
<codeline lineno="1041"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie=block_end(l)</highlight></codeline>
<codeline lineno="1042"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,ie</highlight></codeline>
<codeline lineno="1043"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref>(i)<sp/>=<sp/>200.</highlight></codeline>
<codeline lineno="1044"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_u_surf(i)<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="1045"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_v_surf(i)<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="1046"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo(i)<sp/>=<sp/>0.<sp/></highlight><highlight class="comment">!<sp/>bw</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1047"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_vis_dir(i)<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="1048"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_nir_dir(i)<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="1049"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_vis_dif(i)<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="1050"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_nir_dif(i)<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!----<sp/>do<sp/>not<sp/>use<sp/>if<sp/>relax<sp/>time<sp/>/=<sp/>0<sp/>----</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a1fc83cb6b523c05c9925f67c1bef77eb" kindref="member">ex_cd_t</ref>(i)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a26e0b81f6ed8473af88bdec4dda23c4b" kindref="member">ex_cd_m</ref>(i)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_cd_q(i)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="1055"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_frac_open_sea(i)<sp/>=0.</highlight></codeline>
<codeline lineno="1056"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>do</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1057"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n_gex=1,n_gex_lnd2atm</highlight></codeline>
<codeline lineno="1058"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,ie</highlight></codeline>
<codeline lineno="1059"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gex_lnd2atm(i,n_gex)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="1060"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1061"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1062"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1064"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1067"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1068"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Balaji:<sp/>data_override<sp/>stuff<sp/>moved<sp/>from<sp/>coupler_main</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1069"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;t_bot&apos;</highlight><highlight class="normal">,<sp/><sp/>atm%t_bot<sp/>,<sp/>time)</highlight></codeline>
<codeline lineno="1070"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;z_bot&apos;</highlight><highlight class="normal">,<sp/><sp/>atm%z_bot<sp/>,<sp/>time)</highlight></codeline>
<codeline lineno="1071"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;p_bot&apos;</highlight><highlight class="normal">,<sp/><sp/>atm%p_bot<sp/>,<sp/>time)</highlight></codeline>
<codeline lineno="1072"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;u_bot&apos;</highlight><highlight class="normal">,<sp/><sp/>atm%u_bot<sp/>,<sp/>time)</highlight></codeline>
<codeline lineno="1073"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;v_bot&apos;</highlight><highlight class="normal">,<sp/><sp/>atm%v_bot<sp/>,<sp/>time)</highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;p_surf&apos;</highlight><highlight class="normal">,<sp/>atm%p_surf,<sp/>time)</highlight></codeline>
<codeline lineno="1075"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;slp&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/>atm%slp,<sp/><sp/><sp/><sp/>time)</highlight></codeline>
<codeline lineno="1076"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;gust&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/>atm%gust,<sp/><sp/><sp/>time)</highlight></codeline>
<codeline lineno="1077"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1078"><highlight class="normal"></highlight></codeline>
<codeline lineno="1080"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1081"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>jgj:<sp/>2008/07/18</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1082"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>FV<sp/>atm<sp/>advects<sp/>tracers<sp/>in<sp/>moist<sp/>mass<sp/>mixing<sp/>ratio:<sp/>kg<sp/>co2<sp/>/(kg<sp/>air<sp/>+<sp/>kg<sp/>water)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1083"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>cubed<sp/>sphere<sp/>advects<sp/>moist<sp/>mass<sp/>mixing<sp/>ratio<sp/>also<sp/>(per<sp/>SJ)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>data<sp/>table<sp/>co2<sp/>overrides<sp/>for<sp/>ocean<sp/>(co2_flux_pcair_atm)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>and<sp/>land<sp/>(co2_bot)<sp/>should<sp/>be<sp/>in<sp/>dry<sp/>vmr<sp/>(mol/mol)<sp/>units.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1086"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>ATM:<sp/>co2_flux_pcair_atm<sp/>:<sp/>to<sp/>override<sp/>atm_btm<sp/>layer<sp/>to<sp/>send<sp/>to<sp/>ocean</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1087"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>ATM:<sp/>co2_bot<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>to<sp/>override<sp/>atm_btm<sp/>layer<sp/>to<sp/>send<sp/>to<sp/>land</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1088"><highlight class="normal"></highlight></codeline>
<codeline lineno="1089"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>data<sp/>override<sp/>for<sp/>co2<sp/>to<sp/>be<sp/>passed<sp/>to<sp/>land/photosynthesis<sp/>(co2_bot)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1090"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>land<sp/>co2<sp/>data<sp/>override<sp/>is<sp/>in<sp/>dry_vmr<sp/>units,<sp/>so<sp/>convert<sp/>to<sp/>wet_mmr<sp/>for<sp/>land<sp/>model.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1091"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>co2mmr<sp/>=<sp/>(wco2/wair)<sp/>*<sp/>co2vmr;<sp/><sp/>wet_mmr<sp/>=<sp/>dry_mmr<sp/>*<sp/>(1-Q)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1092"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1093"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,n_atm_tr</highlight></codeline>
<codeline lineno="1094"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(<sp/>model_atmos,<sp/>tr,<sp/>tr_name<sp/>)</highlight></codeline>
<codeline lineno="1095"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>trim(tr_name)//</highlight><highlight class="stringliteral">&apos;_bot&apos;</highlight><highlight class="normal">,<sp/>atm%tr_bot(:,:,tr),<sp/>time,<sp/>override=used)</highlight></codeline>
<codeline lineno="1096"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>conversion<sp/>for<sp/>land<sp/>co2<sp/>data<sp/>override<sp/>from<sp/>dry<sp/>vmr<sp/>to<sp/>moist<sp/>mmr</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1097"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(used<sp/>.and.<sp/>fms_mpp_lowercase(trim(tr_name)).eq.</highlight><highlight class="stringliteral">&apos;co2&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1098"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>2017/08/08<sp/>jgj<sp/>add<sp/>co2_bot<sp/>diagnostic<sp/>in<sp/>dry_vmr<sp/>units</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1099"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1abe4744b6ee8cc8e236be33b11254b857" kindref="member">id_co2_bot</ref><sp/>&gt;<sp/>0<sp/>)<sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1abe4744b6ee8cc8e236be33b11254b857" kindref="member">id_co2_bot</ref>,<sp/>atm%tr_bot(:,:,tr),<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>isc<sp/>=<sp/>lbound(atm%tr_bot,1);<sp/>iec<sp/>=<sp/>ubound(atm%tr_bot,1)</highlight></codeline>
<codeline lineno="1101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jsc<sp/>=<sp/>lbound(atm%tr_bot,2);<sp/>jec<sp/>=<sp/>ubound(atm%tr_bot,2)</highlight></codeline>
<codeline lineno="1102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>parallel<sp/>do<sp/>default(none)<sp/>shared(isc,iec,jsc,jec,Atm,tr,isphum)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>jsc,<sp/>jec</highlight></codeline>
<codeline lineno="1104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>isc,<sp/>iec</highlight></codeline>
<codeline lineno="1105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atm%tr_bot(i,j,tr)<sp/>=<sp/>atm%tr_bot(i,j,tr)<sp/>*<sp/>(wtmco2/wtmair)<sp/>*<sp/><sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="1106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(1.0<sp/>-<sp/>atm%tr_bot(i,j,isphum))</highlight></codeline>
<codeline lineno="1107"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1108"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1109"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1110"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1111"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1112"><highlight class="normal"></highlight></codeline>
<codeline lineno="1115"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1116"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>atmos_co2.F90<sp/>already<sp/>called:<sp/>converts<sp/>tr_bot<sp/>passed<sp/>to<sp/>ocean<sp/>via<sp/>gas_flux<sp/>from<sp/>moist<sp/>mmr<sp/>to<sp/>dry<sp/>vmr.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1117"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>1,<sp/>atm%fields%num_bcs</highlight></codeline>
<codeline lineno="1118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>m<sp/>=<sp/>1,<sp/>atm%fields%bc(n)%num_fields</highlight></codeline>
<codeline lineno="1119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>atm%fields%bc(n)%field(m)%name,<sp/>&amp;</highlight></codeline>
<codeline lineno="1120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atm%fields%bc(n)%field(m)%values,<sp/>time,<sp/>override<sp/>=<sp/>atm%fields%bc(n)%field(m)%override)</highlight></codeline>
<codeline lineno="1121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gas_fields_atm%bc(n)%field(m)%override<sp/>=<sp/>atm%fields%bc(n)%field(m)%override</highlight></codeline>
<codeline lineno="1122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>2017/08/08<sp/>jgj<sp/>add<sp/>co2_flux_pcair_atm<sp/>diagnostic</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>atm%fields%bc(n)%field(m)%override<sp/>.and.<sp/>&amp;</highlight></codeline>
<codeline lineno="1124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fms_mpp_lowercase(trim(atm%fields%bc(n)%field(m)%name))<sp/>.eq.<sp/></highlight><highlight class="stringliteral">&apos;co2_flux_pcair_atm&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a24abe80c13032b56cb0127ef9fdbf801" kindref="member">id_co2_flux_pcair_atm</ref><sp/>&gt;<sp/>0)<sp/>&amp;</highlight></codeline>
<codeline lineno="1126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a24abe80c13032b56cb0127ef9fdbf801" kindref="member">id_co2_flux_pcair_atm</ref>,<sp/>atm%fields%bc(n)%field(m)%values,<sp/>time)</highlight></codeline>
<codeline lineno="1127"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>2017/08/15<sp/>jgj<sp/>add<sp/>o2_flux_pcair_atm<sp/>diagnostic</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(atm%fields%bc(n)%field(m)%override<sp/>.and.<sp/>&amp;</highlight></codeline>
<codeline lineno="1130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fms_mpp_lowercase(trim(atm%fields%bc(n)%field(m)%name))<sp/>.eq.<sp/></highlight><highlight class="stringliteral">&apos;o2_flux_pcair_atm&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1adeb499100d57339308ae4b676aeeaa93" kindref="member">id_o2_flux_pcair_atm</ref><sp/>&gt;<sp/>0)<sp/>&amp;</highlight></codeline>
<codeline lineno="1132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1adeb499100d57339308ae4b676aeeaa93" kindref="member">id_o2_flux_pcair_atm</ref>,<sp/>atm%fields%bc(n)%field(m)%values,<sp/>time)</highlight></codeline>
<codeline lineno="1133"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1134"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="1135"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1136"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>1,<sp/>atm%fields%num_bcs</highlight></codeline>
<codeline lineno="1137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(atm%fields%bc(n)%use_atm_pressure)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(.not.<sp/>atm%fields%bc(n)%field(fms_coupler_ind_psurf)%override)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atm%fields%bc(n)%field(fms_coupler_ind_psurf)%values<sp/>=<sp/>atm%p_surf</highlight></codeline>
<codeline lineno="1140"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1141"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1142"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1143"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1144"><highlight class="normal"></highlight></codeline>
<codeline lineno="1148"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1149"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;t_surf&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/><sp/>ice%t_surf,<sp/>time)</highlight></codeline>
<codeline lineno="1150"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;rough_mom&apos;</highlight><highlight class="normal">,<sp/><sp/>ice%rough_mom,<sp/>time)</highlight></codeline>
<codeline lineno="1151"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;rough_heat&apos;</highlight><highlight class="normal">,<sp/>ice%rough_heat,<sp/>time)</highlight></codeline>
<codeline lineno="1152"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;rough_moist&apos;</highlight><highlight class="normal">,ice%rough_moist,<sp/>time)</highlight></codeline>
<codeline lineno="1153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;albedo&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/><sp/>ice%albedo,<sp/><sp/>time)</highlight></codeline>
<codeline lineno="1154"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;albedo_vis_dir&apos;</highlight><highlight class="normal">,<sp/>ice%albedo_vis_dir,<sp/>time)</highlight></codeline>
<codeline lineno="1155"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;albedo_nir_dir&apos;</highlight><highlight class="normal">,<sp/>ice%albedo_nir_dir,<sp/>time)</highlight></codeline>
<codeline lineno="1156"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;albedo_vis_dif&apos;</highlight><highlight class="normal">,<sp/>ice%albedo_vis_dif,<sp/>time)</highlight></codeline>
<codeline lineno="1157"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;albedo_nir_dif&apos;</highlight><highlight class="normal">,<sp/>ice%albedo_nir_dif,<sp/>time)</highlight></codeline>
<codeline lineno="1158"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;u_surf&apos;</highlight><highlight class="normal">,<sp/>ice%u_surf,<sp/>time)</highlight></codeline>
<codeline lineno="1159"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;v_surf&apos;</highlight><highlight class="normal">,<sp/>ice%v_surf,<sp/>time)</highlight></codeline>
<codeline lineno="1160"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_coupler_type_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/>ice%ocean_fields,<sp/>time)</highlight></codeline>
<codeline lineno="1161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_coupler_type_send_data(ice%ocean_fields,<sp/>time)</highlight></codeline>
<codeline lineno="1162"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;t_surf&apos;</highlight><highlight class="normal">,<sp/>land%t_surf,<sp/>time)</highlight></codeline>
<codeline lineno="1163"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;t_ca&apos;</highlight><highlight class="normal">,<sp/>land%t_ca,<sp/>time)</highlight></codeline>
<codeline lineno="1164"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;rough_mom&apos;</highlight><highlight class="normal">,<sp/><sp/>land%rough_mom,<sp/>time)</highlight></codeline>
<codeline lineno="1165"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;rough_heat&apos;</highlight><highlight class="normal">,<sp/>land%rough_heat,<sp/>time)</highlight></codeline>
<codeline lineno="1166"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;albedo&apos;</highlight><highlight class="normal">,<sp/>land%albedo,<sp/>time)</highlight></codeline>
<codeline lineno="1167"><highlight class="normal"></highlight></codeline>
<codeline lineno="1168"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>tracer<sp/>data<sp/>override</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,<sp/>n_lnd_tr</highlight></codeline>
<codeline lineno="1170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(model_land,<sp/>tr,<sp/>tr_name)</highlight></codeline>
<codeline lineno="1171"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="1172"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>trim(tr_name)//</highlight><highlight class="stringliteral">&apos;_surf&apos;</highlight><highlight class="normal">,<sp/>land%tr(:,:,tr),<sp/>time)</highlight></codeline>
<codeline lineno="1173"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="1174"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>trim(tr_name)//</highlight><highlight class="stringliteral">&apos;_surf&apos;</highlight><highlight class="normal">,<sp/>land%tr(:,:,:,tr),<sp/>time)</highlight></codeline>
<codeline lineno="1175"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1176"><highlight class="preprocessor"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;albedo_vis_dir&apos;</highlight><highlight class="normal">,<sp/>land%albedo_vis_dir,<sp/>time)</highlight></codeline>
<codeline lineno="1178"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;albedo_nir_dir&apos;</highlight><highlight class="normal">,<sp/>land%albedo_nir_dir,<sp/>time)</highlight></codeline>
<codeline lineno="1179"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;albedo_vis_dif&apos;</highlight><highlight class="normal">,<sp/>land%albedo_vis_dif,<sp/>time)</highlight></codeline>
<codeline lineno="1180"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;albedo_nir_dif&apos;</highlight><highlight class="normal">,<sp/>land%albedo_nir_dif,<sp/>time)</highlight></codeline>
<codeline lineno="1181"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1184"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1185"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="1186"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_forecast)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%Surf_diff%sst_miz,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a29071f5ae5e2772b510570b3834fe1b4" kindref="member">ex_t_surf_miz</ref>,<sp/>&amp;</highlight></codeline>
<codeline lineno="1188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xmap_sfc,<sp/>remap_method=remap_method,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1189"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1190"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1191"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>put<sp/>atmosphere<sp/>bottom<sp/>layer<sp/>tracer<sp/>data<sp/>onto<sp/>exchange<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1192"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr=1,<sp/>n_exch_tr</highlight></codeline>
<codeline lineno="1193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%tr_bot(:,:,tr_table(tr)%atm)<sp/>,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_tr_atm(:,tr),<sp/>xmap_sfc,<sp/>&amp;</highlight></codeline>
<codeline lineno="1194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>remap_method=remap_method,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1195"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1196"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>1,<sp/>atm%fields%num_bcs</highlight></codeline>
<codeline lineno="1197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(ex_gas_fields_atm%bc(n)%flux_type<sp/><sp/>.ne.<sp/></highlight><highlight class="stringliteral">&apos;air_sea_deposition&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>m<sp/>=<sp/>1,<sp/>atm%fields%bc(n)%num_fields</highlight></codeline>
<codeline lineno="1199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(atm%fields%bc(n)%field(m)%values,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="1200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gas_fields_atm%bc(n)%field(m)%values,<sp/>xmap_sfc,<sp/>remap_method=remap_method,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1201"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1202"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1203"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1204"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1205"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%t_bot,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_t_atm,<sp/>xmap_sfc,<sp/>remap_method=remap_method,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1206"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%z_bot,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a415a43eca092359dca12e46ac24bb0de" kindref="member">ex_z_atm</ref>,<sp/>xmap_sfc,<sp/>remap_method=remap_method,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1207"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%p_bot,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_p_atm,<sp/>xmap_sfc,<sp/>remap_method=remap_method,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1208"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%u_bot,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_u_atm,<sp/>xmap_sfc,<sp/>remap_method=remap_method,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1209"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%v_bot,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_v_atm,<sp/>xmap_sfc,<sp/>remap_method=remap_method,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1210"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%p_surf,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af4fdc80a51f0145da4aa80a6317cc156" kindref="member">ex_p_surf</ref>,<sp/>xmap_sfc,<sp/>remap_method=remap_method,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1211"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%slp,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae70d5c9a1a49eff91b2c14c1657103a6" kindref="member">ex_slp</ref>,<sp/>xmap_sfc,<sp/>remap_method=remap_method,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1212"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%gust,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_gust,<sp/>xmap_sfc,<sp/>remap_method=remap_method,<sp/>complete=.true.)</highlight></codeline>
<codeline lineno="1213"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1214"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1215"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>slm,<sp/>Mar<sp/>20<sp/>2002:<sp/>changed<sp/>order<sp/>in<sp/>whith<sp/>the<sp/>data<sp/>transferred<sp/>from<sp/>ice<sp/>and<sp/>land</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1216"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>grids,<sp/>to<sp/>fill<sp/>t_ca<sp/>first<sp/>with<sp/>t_surf<sp/>over<sp/>ocean<sp/>and<sp/>then<sp/>with<sp/>t_ca<sp/>from</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1217"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>land,<sp/>where<sp/>it<sp/>is<sp/>different<sp/>from<sp/>t_surf.<sp/>It<sp/>is<sp/>mostly<sp/>to<sp/>simplify</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1218"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>diagnostic,<sp/>since<sp/>surface_flux<sp/>calculations<sp/>distinguish<sp/>between<sp/>land<sp/>and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1219"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>not-land<sp/>anyway.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1220"><highlight class="normal"></highlight></codeline>
<codeline lineno="1222"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1223"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>prefill<sp/>surface<sp/>values<sp/>with<sp/>atmospheric<sp/>values<sp/>before<sp/>putting<sp/>tracers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1224"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>from<sp/>ice<sp/>or<sp/>land,<sp/>so<sp/>that<sp/>gradient<sp/>is<sp/>0<sp/>if<sp/>tracers<sp/>are<sp/>not<sp/>filled</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1225"><highlight class="normal"><sp/><sp/><sp/><sp/>ex_tr_surf<sp/>=<sp/>ex_tr_atm</highlight></codeline>
<codeline lineno="1226"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1227"><highlight class="normal"></highlight></codeline>
<codeline lineno="1229"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1230"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>(assume<sp/>that<sp/>ocean<sp/>quantites<sp/>are<sp/>stored<sp/>in<sp/>no<sp/>ice<sp/>partition)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1231"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>(note:<sp/>ex_avail<sp/>is<sp/>true<sp/>at<sp/>ice<sp/>and<sp/>ocean<sp/>points)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1232"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(ice%t_surf,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1233"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(ice%rough_mom,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_rough_mom,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1234"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(ice%rough_heat,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_rough_heat,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1235"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(ice%rough_moist,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_rough_moist,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1236"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(ice%albedo,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_albedo,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1237"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(ice%albedo_vis_dir,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_albedo_vis_dir,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1238"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(ice%albedo_nir_dir,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_albedo_nir_dir,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1239"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(ice%albedo_vis_dif,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_albedo_vis_dif,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1240"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(ice%albedo_nir_dif,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_albedo_nir_dif,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1241"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(ice%u_surf,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_u_surf,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1242"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(ice%v_surf,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_v_surf,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1243"><highlight class="normal"></highlight></codeline>
<codeline lineno="1244"><highlight class="normal"><sp/><sp/><sp/><sp/>tmp_open_sea<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="1245"><highlight class="normal"><sp/><sp/><sp/><sp/>tmp_open_sea(:,:,1)<sp/>=<sp/>1.</highlight></codeline>
<codeline lineno="1246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(tmp_open_sea,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_frac_open_sea,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1247"><highlight class="normal"></highlight></codeline>
<codeline lineno="1248"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>1,<sp/>ice%ocean_fields%num_bcs</highlight></codeline>
<codeline lineno="1249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>m<sp/>=<sp/>1,<sp/>ice%ocean_fields%bc(n)%num_fields</highlight></codeline>
<codeline lineno="1250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(ice%ocean_fields%bc(n)%field(m)%values,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="1251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gas_fields_ice%bc(n)%field(m)%values,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1252"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="1253"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1254"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1255"><highlight class="normal"></highlight></codeline>
<codeline lineno="1257"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1258"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Generate<sp/>a<sp/>wet<sp/>mask<sp/>array<sp/>on<sp/>the<sp/>xgrid<sp/>which<sp/>is:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1259"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/>1:<sp/>where<sp/>there<sp/>is<sp/>any<sp/>open<sp/>water<sp/>in<sp/>the<sp/>OCN<sp/>grid<sp/>cell</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1260"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/>0:<sp/>where<sp/>there<sp/>is<sp/>no<sp/><sp/>open<sp/>water<sp/>in<sp/>the<sp/>OCN<sp/>grid<sp/>cell,<sp/>i.e.,<sp/>totally<sp/>ice<sp/>covered<sp/>or<sp/>land</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1261"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!This<sp/>is<sp/>a<sp/>dynamic<sp/>wet<sp/>mask<sp/>and<sp/>particularly<sp/>is<sp/>not<sp/>the<sp/>same<sp/>as<sp/>a<sp/>static<sp/>land<sp/>mask<sp/>because<sp/>seaice<sp/>fractions<sp/>change</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1262"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>as<sp/>the<sp/>model<sp/>runs.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1263"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!One<sp/>way<sp/>to<sp/>create<sp/>such<sp/>a<sp/>mask<sp/>is<sp/>if<sp/>&apos;OCN&apos;<sp/>puts<sp/>an<sp/>array<sp/>on<sp/>the<sp/>xgrid<sp/>which<sp/>is</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1264"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>1<sp/>on<sp/>every<sp/>OCN<sp/>grid<sp/>cell<sp/>with<sp/>the<sp/>3rd<sp/>index<sp/>equal<sp/>to<sp/>1<sp/>(ice<sp/>category<sp/>1<sp/>corresponds<sp/>to<sp/>open<sp/>water<sp/>in<sp/>the<sp/>grid<sp/>cell)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1265"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>0<sp/>otherwise</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1266"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!This<sp/>wet<sp/>mask<sp/>will<sp/>be<sp/>used<sp/>to<sp/>limit<sp/>the<sp/>air-sea<sp/>flux<sp/>exchange<sp/>to<sp/>areas<sp/>that<sp/>are<sp/>not<sp/>totally<sp/>covered<sp/>by<sp/>seaice.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1267"><highlight class="normal"><sp/><sp/><sp/><sp/>sea<sp/>=<sp/>0.0;<sp/>sea(:,:,1)<sp/>=<sp/>1.0;</highlight></codeline>
<codeline lineno="1268"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7cc9b8d546d6589e3b2cf8a7ad6dd90c" kindref="member">ex_seawater</ref><sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="1269"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(sea,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7cc9b8d546d6589e3b2cf8a7ad6dd90c" kindref="member">ex_seawater</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1271"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1272"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Question:<sp/>Why<sp/>is<sp/>the<sp/>above<sp/>ex_seawater<sp/>a<sp/>dynamic<sp/>mask<sp/>array?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1273"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>From<sp/>its<sp/>construction<sp/>it<sp/>looks<sp/>like<sp/>a<sp/>static<sp/>array<sp/>of<sp/>1s<sp/>and<sp/>0s<sp/>!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1274"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Answer:<sp/>The<sp/>xmap_sfc<sp/>is<sp/>dynamic<sp/>and<sp/>changes<sp/>as<sp/>the<sp/>model<sp/>steps<sp/>because<sp/>it<sp/>contains<sp/>updated<sp/>information<sp/>about</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1275"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>seaice<sp/>fractions.<sp/>The<sp/>updated<sp/>array<sp/>&quot;ex_seawater&quot;<sp/>after<sp/>the<sp/>above<sp/>&quot;put&quot;<sp/>call<sp/>will<sp/>be<sp/>1<sp/>where<sp/>there</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1276"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is<sp/>open<sp/>water<sp/>even<sp/>if<sp/>those<sp/>grid<sp/>cells<sp/>where<sp/>previously<sp/>closed<sp/>by<sp/>seaice.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1277"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Particularly<sp/>if<sp/>we<sp/>restrict<sp/>xgrid<sp/>calculations<sp/>where<sp/><sp/>ex_seawater==1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1278"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>only<sp/>cells<sp/>with<sp/>(partially<sp/>or<sp/>totally)<sp/>open<sp/>water<sp/>contribute<sp/>and<sp/>totally<sp/>covered<sp/>cells<sp/>won&apos;t<sp/>contribute.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1279"><highlight class="normal"></highlight></codeline>
<codeline lineno="1280"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Not<sp/>related<sp/>to<sp/>the<sp/>above<sp/>comments,<sp/>it<sp/>seems<sp/>that<sp/>the<sp/>above<sp/>ex_frac_open_sea<sp/>could<sp/>be<sp/>replaced<sp/>by<sp/>ex_seawater</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1281"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!for<sp/>code<sp/>cleaning.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1282"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!The<sp/>following<sp/>test<sp/>does<sp/>not<sp/>print<sp/>out<sp/>anything<sp/>for<sp/>a<sp/>fully<sp/>coupled<sp/>model.<sp/>This<sp/>asserts<sp/>that</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1283"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!1.<sp/>The<sp/>two<sp/>arrays<sp/>ex_frac_open_sea<sp/>and<sp/><sp/>ex_seawater<sp/>are<sp/>the<sp/>same</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1284"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/>Their<sp/>difference<sp/>is<sp/>that<sp/>ex_frac_open_sea<sp/>is<sp/>a<sp/>local<sp/>array,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1285"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/>but<sp/>ex_seawater<sp/>is<sp/>a<sp/>module<sp/>array<sp/>used<sp/>outside<sp/>this<sp/>subroutine</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1286"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!2.<sp/>The<sp/>xgrid<sp/>array<sp/>&quot;ex_seawater&quot;<sp/>is<sp/>either<sp/>0<sp/>or<sp/>1<sp/>and<sp/>nothing<sp/>else,<sp/>just<sp/>like<sp/>the<sp/>&quot;OCN&quot;<sp/>grid<sp/>array<sp/>&quot;sea&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1287"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Test:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1288"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!do<sp/>l<sp/>=<sp/>1,<sp/>my_nblocks</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/>is=block_start(l)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1290"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/>ie=block_end(l)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1291"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/>do<sp/>i<sp/>=<sp/>is,<sp/>ie</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1292"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/>if(ex_frac_open_sea(i)<sp/>/=<sp/>ex_seawater(i))<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1293"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print*,&apos;ex_frac_open_sea<sp/>!=<sp/>ex_seawater<sp/>&apos;,ex_frac_open_sea(i),ex_seawater(i)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1294"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/>if(ex_seawater(i)<sp/>/=<sp/>0.0<sp/>.or.ex_seawater(i)<sp/>/=<sp/>1.0<sp/>)&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1295"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print*,&apos;ex_seawater<sp/>!1<sp/>or<sp/>0<sp/>&apos;<sp/>,ex_seawater(i)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1296"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1297"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1298"><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="1300"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref><sp/>=<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref><sp/></highlight><highlight class="comment">!<sp/>slm,<sp/>Mar<sp/>20<sp/>2002<sp/>to<sp/>define<sp/>values<sp/>over<sp/>the<sp/>ocean</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1301"><highlight class="normal"></highlight></codeline>
<codeline lineno="1303"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1304"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_some(xmap_sfc,<sp/>ex_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1305"><highlight class="normal"></highlight></codeline>
<codeline lineno="1306"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="1307"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_forecast)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%t_surf,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a29071f5ae5e2772b510570b3834fe1b4" kindref="member">ex_t_surf_miz</ref>,<sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref>(:)<sp/>=<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a29071f5ae5e2772b510570b3834fe1b4" kindref="member">ex_t_surf_miz</ref>(:)</highlight></codeline>
<codeline lineno="1310"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1311"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1312"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1313"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%t_surf,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%t_ca,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1315"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%rough_mom,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_rough_mom,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1316"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%rough_heat,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_rough_heat,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1317"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%rough_heat,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_rough_moist,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1318"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%albedo,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_albedo,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1319"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%albedo_vis_dir,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_albedo_vis_dir,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1320"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%albedo_nir_dir,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_albedo_nir_dir,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1321"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%albedo_vis_dif,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_albedo_vis_dif,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1322"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%albedo_nir_dif,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_albedo_nir_dif,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1323"><highlight class="normal"><sp/><sp/><sp/><sp/>ex_rough_scale<sp/>=<sp/>ex_rough_mom</highlight></codeline>
<codeline lineno="1324"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%rough_scale,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_rough_scale,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1325"><highlight class="normal"></highlight></codeline>
<codeline lineno="1326"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n_gex=1,n_gex_lnd2atm</highlight></codeline>
<codeline lineno="1327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%gex_lnd2atm(:,:,n_gex),</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_gex_lnd2atm(:,n_gex),xmap_sfc)</highlight></codeline>
<codeline lineno="1328"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>do</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1329"><highlight class="normal"></highlight></codeline>
<codeline lineno="1330"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,n_exch_tr</highlight></codeline>
<codeline lineno="1331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n<sp/>=<sp/>tr_table(tr)%lnd</highlight></codeline>
<codeline lineno="1332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(n<sp/>/=<sp/>no_tracer<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1333"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="1334"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%tr(:,:,n),<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_tr_surf(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1335"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="1336"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%tr(:,:,:,n),<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_tr_surf(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1337"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1338"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>do<sp/>nothing,<sp/>since<sp/>ex_tr_surf<sp/>is<sp/>prefilled<sp/>with<sp/>ex_tr_atm,<sp/>and<sp/>therefore</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>fluxes<sp/>will<sp/>be<sp/>0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1341"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1342"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1343"><highlight class="normal"></highlight></codeline>
<codeline lineno="1344"><highlight class="normal"><sp/><sp/><sp/><sp/>ex_land_frac<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="1345"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="interfaceatm__land__ice__flux__exchange__mod_1_1put__logical__to__real" kindref="compound">put_logical_to_real</ref><sp/>(land%mask,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_land_frac,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1346"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>END<sp/>MAP<sp/>LAND<sp/>EXCHANGE<sp/>FIELDS<sp/>ONTO<sp/>THE<sp/>EXCHANGE<sp/>GRID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1347"><highlight class="normal"></highlight></codeline>
<codeline lineno="1348"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>SCM</highlight></codeline>
<codeline lineno="1349"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_specified_land)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_specified_albedo)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo<sp/>=<sp/>albedo_obs</highlight></codeline>
<codeline lineno="1352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_vis_dir<sp/>=<sp/>albedo_obs</highlight></codeline>
<codeline lineno="1353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_nir_dir<sp/>=<sp/>albedo_obs</highlight></codeline>
<codeline lineno="1354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_vis_dif<sp/>=<sp/>albedo_obs</highlight></codeline>
<codeline lineno="1355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_nir_dif<sp/>=<sp/>albedo_obs</highlight></codeline>
<codeline lineno="1356"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_specified_tskin)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref><sp/>=<sp/>tskin</highlight></codeline>
<codeline lineno="1359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref><sp/><sp/><sp/>=<sp/>tskin</highlight></codeline>
<codeline lineno="1360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_surf(:,isphum)<sp/>=<sp/>15.e-3</highlight></codeline>
<codeline lineno="1361"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_specified_rough_leng)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_rough_mom<sp/><sp/><sp/>=<sp/>rough_mom</highlight></codeline>
<codeline lineno="1364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_rough_heat<sp/><sp/>=<sp/>rough_heat</highlight></codeline>
<codeline lineno="1365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_rough_moist<sp/>=<sp/>rough_heat</highlight></codeline>
<codeline lineno="1366"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1367"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1368"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1369"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1370"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="1371"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_forecast)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref><sp/>=<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a29071f5ae5e2772b510570b3834fe1b4" kindref="member">ex_t_surf_miz</ref></highlight></codeline>
<codeline lineno="1373"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1374"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1375"><highlight class="preprocessor"></highlight></codeline>
<codeline lineno="1377"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1378"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_some(xmap_sfc,<sp/>ex_avail)</highlight></codeline>
<codeline lineno="1379"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>parallel<sp/>do<sp/>default(none)<sp/>shared(my_nblocks,<sp/>ex_t_atm,<sp/>ex_tr_atm,<sp/>ex_u_atm,<sp/>ex_v_atm,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1380"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_p_atm,<sp/>ex_z_atm,<sp/>ex_p_surf,<sp/>ex_t_surf,<sp/>ex_t_ca,<sp/>ex_tr_surf,<sp/>ex_u_surf,<sp/>ex_v_surf,<sp/>ex_rough_mom,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1381"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_rough_heat,<sp/>ex_rough_moist,<sp/>ex_rough_scale,<sp/>ex_gust,<sp/>ex_flux_t,<sp/>ex_flux_tr,<sp/>ex_flux_lw,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1382"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_flux_u,<sp/>ex_flux_v,<sp/>ex_cd_m,<sp/>ex_cd_t,<sp/>ex_cd_q,<sp/>ex_wind,<sp/>ex_u_star,<sp/>ex_b_star,<sp/>ex_q_star,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1383"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_thv_atm,<sp/>ex_thv_surf,<sp/>ex_dhdt_surf,<sp/>ex_dedt_surf,<sp/>ex_dfdtr_surf,<sp/>ex_drdt_surf,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1384"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_dhdt_atm,<sp/>ex_dfdtr_atm,<sp/>ex_dtaudu_atm,<sp/>ex_dtaudv_atm,<sp/>dt,<sp/>ex_land,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1385"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_seawater,ex_avail,block_start,block_end,isphum)<sp/>private(is,ie)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1386"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>1,<sp/>my_nblocks</highlight></codeline>
<codeline lineno="1387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is=block_start(l)</highlight></codeline>
<codeline lineno="1388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie=block_end(l)</highlight></codeline>
<codeline lineno="1389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="interfacesurface__flux__mod_1_1surface__flux" kindref="compound">surface_flux</ref><sp/>(&amp;</highlight></codeline>
<codeline lineno="1390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_t_atm(is:ie),<sp/>ex_tr_atm(is:ie,isphum),<sp/>ex_u_atm(is:ie),<sp/>ex_v_atm(is:ie),<sp/>ex_p_atm(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a415a43eca092359dca12e46ac24bb0de" kindref="member">ex_z_atm</ref>(is:ie),&amp;</highlight></codeline>
<codeline lineno="1391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af4fdc80a51f0145da4aa80a6317cc156" kindref="member">ex_p_surf</ref>(is:ie),<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref>(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref>(is:ie),<sp/>ex_tr_surf(is:ie,isphum),<sp/>ex_u_surf(is:ie),<sp/>ex_v_surf(is:ie),<sp/>&amp;</highlight></codeline>
<codeline lineno="1392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_rough_mom(is:ie),<sp/>ex_rough_heat(is:ie),<sp/>ex_rough_moist(is:ie),<sp/>ex_rough_scale(is:ie),<sp/>ex_gust(is:ie),<sp/>&amp;</highlight></codeline>
<codeline lineno="1393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref>(is:ie),<sp/>ex_flux_tr(is:ie,isphum),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af36a6c987c16a10e698b500396554130" kindref="member">ex_flux_lw</ref>(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a5419fecfda33b11db1caab9042cf90c2" kindref="member">ex_flux_u</ref>(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac27b58d41879537c39e4b8bc6eac83f8" kindref="member">ex_flux_v</ref>(is:ie),<sp/>&amp;</highlight></codeline>
<codeline lineno="1394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a26e0b81f6ed8473af88bdec4dda23c4b" kindref="member">ex_cd_m</ref>(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a1fc83cb6b523c05c9925f67c1bef77eb" kindref="member">ex_cd_t</ref>(is:ie),<sp/>ex_cd_q(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ada77a5490b1ad25fa3ca68f3f81b9548" kindref="member">ex_wind</ref>(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3faddc34ad457fdb55533bead75ce7f0" kindref="member">ex_u_star</ref>(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a0fd79bc7659c354908e2e6c325985544" kindref="member">ex_b_star</ref>(is:ie),<sp/>&amp;</highlight></codeline>
<codeline lineno="1395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_q_star(is:ie),<sp/>ex_thv_atm(is:ie),<sp/>ex_thv_surf(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7a723109680791b32db1371f623f679d" kindref="member">ex_dhdt_surf</ref>(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a50b141a6a27c86e08632eb459f39324b" kindref="member">ex_dedt_surf</ref>(is:ie),<sp/>&amp;</highlight></codeline>
<codeline lineno="1396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dfdtr_surf(is:ie,isphum),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aeba37d2c046170e4112311711809f620" kindref="member">ex_drdt_surf</ref>(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a04986e4dfe0871fb9b662597e47772bb" kindref="member">ex_dhdt_atm</ref>(is:ie),<sp/>ex_dfdtr_atm(is:ie,isphum),<sp/>&amp;</highlight></codeline>
<codeline lineno="1397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a4916ecd33588bcfbce81a5393f436671" kindref="member">ex_dtaudu_atm</ref>(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae3ae41712484a6829639b4cd4431dab1" kindref="member">ex_dtaudv_atm</ref>(is:ie),<sp/>dt,<sp/>ex_land(is:ie),<sp/>(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7cc9b8d546d6589e3b2cf8a7ad6dd90c" kindref="member">ex_seawater</ref>(is:ie).gt.0.0),<sp/>ex_avail(is:ie))</highlight></codeline>
<codeline lineno="1398"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1399"><highlight class="normal"></highlight></codeline>
<codeline lineno="1400"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>SCM</highlight></codeline>
<codeline lineno="1401"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Option<sp/>to<sp/>override<sp/>surface<sp/>fluxes<sp/>for<sp/>SCM</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1402"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_specified_flux)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1403"><highlight class="normal"></highlight></codeline>
<codeline lineno="1404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">scm_surface_flux(&amp;</highlight></codeline>
<codeline lineno="1405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_t_atm,<sp/>ex_tr_atm(:,isphum),<sp/>ex_u_atm,<sp/>ex_v_atm,<sp/><sp/>ex_p_atm,<sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a415a43eca092359dca12e46ac24bb0de" kindref="member">ex_z_atm</ref>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="1406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af4fdc80a51f0145da4aa80a6317cc156" kindref="member">ex_p_surf</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref>,<sp/>ex_tr_surf(:,isphum),<sp/>ex_u_surf,<sp/>ex_v_surf,<sp/>&amp;</highlight></codeline>
<codeline lineno="1407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_rough_mom,<sp/>ex_rough_heat,<sp/>ex_rough_moist,<sp/>ex_rough_scale,<sp/>&amp;</highlight></codeline>
<codeline lineno="1408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gust,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref>,<sp/>ex_flux_tr(:,isphum),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af36a6c987c16a10e698b500396554130" kindref="member">ex_flux_lw</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a5419fecfda33b11db1caab9042cf90c2" kindref="member">ex_flux_u</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac27b58d41879537c39e4b8bc6eac83f8" kindref="member">ex_flux_v</ref>,<sp/>&amp;</highlight></codeline>
<codeline lineno="1409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a26e0b81f6ed8473af88bdec4dda23c4b" kindref="member">ex_cd_m</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a1fc83cb6b523c05c9925f67c1bef77eb" kindref="member">ex_cd_t</ref>,<sp/>ex_cd_q,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ada77a5490b1ad25fa3ca68f3f81b9548" kindref="member">ex_wind</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3faddc34ad457fdb55533bead75ce7f0" kindref="member">ex_u_star</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a0fd79bc7659c354908e2e6c325985544" kindref="member">ex_b_star</ref>,<sp/>ex_q_star,<sp/>&amp;</highlight></codeline>
<codeline lineno="1410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_thv_atm,<sp/>ex_thv_surf,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7a723109680791b32db1371f623f679d" kindref="member">ex_dhdt_surf</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a50b141a6a27c86e08632eb459f39324b" kindref="member">ex_dedt_surf</ref>,<sp/>ex_dfdtr_surf(:,isphum),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aeba37d2c046170e4112311711809f620" kindref="member">ex_drdt_surf</ref>,<sp/>&amp;</highlight></codeline>
<codeline lineno="1411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a04986e4dfe0871fb9b662597e47772bb" kindref="member">ex_dhdt_atm</ref>,<sp/>ex_dfdtr_atm(:,isphum),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a4916ecd33588bcfbce81a5393f436671" kindref="member">ex_dtaudu_atm</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae3ae41712484a6829639b4cd4431dab1" kindref="member">ex_dtaudv_atm</ref>,<sp/>dt,<sp/>(ex_land,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7cc9b8d546d6589e3b2cf8a7ad6dd90c" kindref="member">ex_seawater</ref><sp/>.gt.<sp/>0.0),<sp/>&amp;</highlight></codeline>
<codeline lineno="1412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_avail,<sp/>ex_dhdt_surf_forland,<sp/>ex_dedt_surf_forland,<sp/>ex_dedq_surf_forland)</highlight></codeline>
<codeline lineno="1413"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1414"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1415"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>END<sp/>CALL<sp/>SURFACE_FLUX</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1416"><highlight class="normal"></highlight></codeline>
<codeline lineno="1417"><highlight class="normal"></highlight></codeline>
<codeline lineno="1418"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>call<sp/>mpp_clock_end(fluxClock)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1419"><highlight class="normal"></highlight></codeline>
<codeline lineno="1421"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1422"><highlight class="normal"><sp/><sp/><sp/><sp/>zrefm<sp/>=<sp/>10.0</highlight></codeline>
<codeline lineno="1423"><highlight class="normal"><sp/><sp/><sp/><sp/>zrefh<sp/>=<sp/>z_ref_heat</highlight></codeline>
<codeline lineno="1424"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/>----<sp/>optimize<sp/>calculation<sp/>----</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1425"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>parallel<sp/>do<sp/>default(shared)<sp/>private(is,ie)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1426"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>1,<sp/>my_nblocks</highlight></codeline>
<codeline lineno="1427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is=block_start(l)</highlight></codeline>
<codeline lineno="1428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie=block_end(l)</highlight></codeline>
<codeline lineno="1429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_monin_obukhov_mo_profile(zrefm,<sp/>zrefh,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a415a43eca092359dca12e46ac24bb0de" kindref="member">ex_z_atm</ref>(is:ie),<sp/>ex_rough_mom(is:ie),<sp/>&amp;</highlight></codeline>
<codeline lineno="1430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_rough_heat(is:ie),<sp/>ex_rough_moist(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3faddc34ad457fdb55533bead75ce7f0" kindref="member">ex_u_star</ref>(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a0fd79bc7659c354908e2e6c325985544" kindref="member">ex_b_star</ref>(is:ie),<sp/>ex_q_star(is:ie),<sp/>&amp;</highlight></codeline>
<codeline lineno="1431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_del_m(is:ie),<sp/>ex_del_h(is:ie),<sp/>ex_del_q(is:ie),<sp/>ex_avail(is:ie))</highlight></codeline>
<codeline lineno="1432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,ie</highlight></codeline>
<codeline lineno="1433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_u10(i)<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="1434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(ex_avail(i))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_ref_u(i)<sp/>=<sp/>ex_u_surf(i)<sp/>+<sp/>(ex_u_atm(i)-ex_u_surf(i))<sp/>*<sp/>ex_del_m(i)</highlight></codeline>
<codeline lineno="1436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_ref_v(i)<sp/>=<sp/>ex_v_surf(i)<sp/>+<sp/>(ex_v_atm(i)-ex_v_surf(i))<sp/>*<sp/>ex_del_m(i)</highlight></codeline>
<codeline lineno="1437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_u10(i)<sp/>=<sp/>sqrt(ex_ref_u(i)**2<sp/>+<sp/>ex_ref_v(i)**2)</highlight></codeline>
<codeline lineno="1438"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1439"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>1,<sp/>ex_gas_fields_atm%num_bcs</highlight></codeline>
<codeline lineno="1441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(atm%fields%bc(n)%use_10m_wind_speed)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(.not.<sp/>ex_gas_fields_atm%bc(n)%field(fms_coupler_ind_u10)%override)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,ie</highlight></codeline>
<codeline lineno="1444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gas_fields_atm%bc(n)%field(fms_coupler_ind_u10)%values(i)<sp/>=<sp/>ex_u10(i)</highlight></codeline>
<codeline lineno="1445"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1446"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1447"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1448"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>END<sp/>COMPUTE<sp/>ZONAL<sp/>AND<sp/>MERIDIONAL<sp/>WINDS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1450"><highlight class="normal"></highlight></codeline>
<codeline lineno="1452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!f1p:<sp/>calculate<sp/>atmospheric<sp/>conductance<sp/>to<sp/>send<sp/>to<sp/>the<sp/>land<sp/>model</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i=is,ie</highlight></codeline>
<codeline lineno="1455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a972ea1bb3939a7b1fed1e698b182de88" kindref="member">ex_con_atm</ref>(i)<sp/>=<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ada77a5490b1ad25fa3ca68f3f81b9548" kindref="member">ex_wind</ref>(i)*ex_cd_q(i)</highlight></codeline>
<codeline lineno="1456"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>do</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1458"><highlight class="normal"></highlight></codeline>
<codeline lineno="1460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>F<sp/>=<sp/>C0*u*rho*delta_q,<sp/>C0*u*rho<sp/>is<sp/>the<sp/>same<sp/>for<sp/>all<sp/>tracers,<sp/>copy<sp/>from<sp/>sphum</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,n_exch_tr</highlight></codeline>
<codeline lineno="1463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tr==isphum)<sp/>cycle</highlight></codeline>
<codeline lineno="1464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,ie</highlight></codeline>
<codeline lineno="1465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>slm:<sp/>ex_dfdtr_surf(:,isphum)<sp/>is<sp/>manipulated<sp/>in<sp/>surface_flux:<sp/>it<sp/>is<sp/>set<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>zero<sp/>over<sp/>the<sp/>ocean,<sp/>so<sp/>it<sp/>is<sp/>not<sp/>appropriate<sp/>to<sp/>use<sp/>for<sp/>other<sp/>tracers.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>However,<sp/>since<sp/>flux<sp/>=<sp/>rho*Cd*|v|*(q_surf-q_atm),<sp/>we<sp/>can<sp/>simply<sp/>use<sp/>negative</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>dfdtr_atm<sp/>for<sp/>the<sp/>dfdtr_surf<sp/>derivative.<sp/>This<sp/>will<sp/>break<sp/>if<sp/>ever<sp/>the<sp/>flux</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>formulation<sp/>is<sp/>changed<sp/>to<sp/>be<sp/>not<sp/>symmetrical<sp/>w.r.t.<sp/>q_surf<sp/>and<sp/>q_atm,<sp/>but</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>then<sp/>this<sp/>whole<sp/>section<sp/>will<sp/>have<sp/>to<sp/>be<sp/>changed.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dfdtr_atm(i,tr)<sp/>=<sp/>ex_dfdtr_atm(i,isphum)</highlight></codeline>
<codeline lineno="1472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dfdtr_surf(i,tr)<sp/>=<sp/>-ex_dfdtr_atm(i,isphum)</highlight></codeline>
<codeline lineno="1473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_tr(i,tr)<sp/>=<sp/><sp/>ex_dfdtr_surf(i,tr)*(ex_tr_surf(i,tr)-ex_tr_atm(i,tr))</highlight></codeline>
<codeline lineno="1474"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1475"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1476"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1477"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1478"><highlight class="normal"></highlight></codeline>
<codeline lineno="1479"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Combine<sp/>explicit<sp/>ocean<sp/>flux<sp/>and<sp/>implicit<sp/>land<sp/>flux<sp/>of<sp/>extra<sp/>flux<sp/>fields.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1480"><highlight class="normal"></highlight></codeline>
<codeline lineno="1482"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1483"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespaceatmos__ocean__fluxes__calc__mod_1acc10568af1ebdd92581183632c4e1f74" kindref="member">atmos_ocean_fluxes_calc</ref>(ex_gas_fields_atm,<sp/>ex_gas_fields_ice,<sp/>ex_gas_fluxes,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7cc9b8d546d6589e3b2cf8a7ad6dd90c" kindref="member">ex_seawater</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref>)</highlight></codeline>
<codeline lineno="1484"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1485"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n=1,<sp/>ex_gas_fluxes%num_bcs</highlight></codeline>
<codeline lineno="1486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ex_gas_fluxes%bc(n)%atm_tr_index<sp/>.gt.<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>m<sp/>=<sp/>tr_table_map(ex_gas_fluxes%bc(n)%atm_tr_index)%exch</highlight></codeline>
<codeline lineno="1488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1af4c241a58e2d051452ea6ac2165b605c" kindref="member">id_tr_mol_flux0</ref>(m)<sp/>.gt.<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(&amp;</highlight></codeline>
<codeline lineno="1490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_gas_fluxes%bc(n)%field(fms_coupler_ind_flux0)%values(:),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1af4c241a58e2d051452ea6ac2165b605c" kindref="member">id_tr_mol_flux0</ref>(m),<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="1492"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1493"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1494"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>do</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1495"><highlight class="normal"></highlight></codeline>
<codeline lineno="1496"><highlight class="normal"></highlight></codeline>
<codeline lineno="1497"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>The<sp/>following<sp/>statement<sp/>is<sp/>a<sp/>concise<sp/>version<sp/>of<sp/>what&apos;s<sp/>following<sp/>and<sp/>worth</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1498"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>looking<sp/>into<sp/>in<sp/>the<sp/>future.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1499"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>ex_flux_tr(:,itracer)<sp/>=<sp/>ex_gas_fluxes%bc(itracer_ocn)%field(fms_coupler_ind_flux)%values(:)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1500"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>where(ex_seawater.gt.0)<sp/>ex_flux_tr(:,itracer)<sp/>=<sp/>F_ocn</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1501"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>parallel<sp/>do<sp/>default(shared)<sp/>private(is,ie,m,tr_units,tr_name)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1502"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>l=1,<sp/>my_nblocks</highlight></codeline>
<codeline lineno="1503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is<sp/>=<sp/>block_start(l)</highlight></codeline>
<codeline lineno="1504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie<sp/>=<sp/>block_end(l)</highlight></codeline>
<codeline lineno="1505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n=1,<sp/>ex_gas_fluxes%num_bcs</highlight></codeline>
<codeline lineno="1506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(ex_gas_fluxes%bc(n)%atm_tr_index<sp/>.gt.<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="1507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>m<sp/>=<sp/>tr_table_map(ex_gas_fluxes%bc(n)%atm_tr_index)%exch</highlight></codeline>
<codeline lineno="1508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(&amp;</highlight></codeline>
<codeline lineno="1509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>model_atmos,<sp/>ex_gas_fluxes%bc(n)%atm_tr_index,<sp/>tr_name,<sp/>units=tr_units)</highlight></codeline>
<codeline lineno="1510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i=is,<sp/>ie<sp/></highlight></codeline>
<codeline lineno="1511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ex_land(i))<sp/>cycle<sp/><sp/></highlight><highlight class="comment">!<sp/>over<sp/>land,<sp/>don&apos;t<sp/>do<sp/>anything</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>on<sp/>ocean<sp/>or<sp/>ice<sp/>cells,<sp/>flux<sp/>is<sp/>explicit<sp/>therefore<sp/>we<sp/>zero<sp/>derivatives.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dfdtr_atm(i,m)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="1514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dfdtr_surf(i,m)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="1515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7cc9b8d546d6589e3b2cf8a7ad6dd90c" kindref="member">ex_seawater</ref>(i)&gt;0.0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fms_mpp_lowercase(trim(tr_units)).eq.</highlight><highlight class="stringliteral">&quot;vmr&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>in<sp/>mol/m2/s<sp/>but<sp/>from<sp/>land<sp/>model<sp/>it<sp/>should<sp/>be<sp/>in<sp/>vmr<sp/>*<sp/>kg/m2/s</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>This<sp/>was<sp/>converting<sp/>to<sp/>dry<sp/>vmr<sp/>(as<sp/>opposed<sp/>to<sp/>ambient<sp/>vmr)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>ex_flux_tr(i,m)<sp/><sp/><sp/><sp/>=<sp/>ex_gas_fluxes%bc(n)%field(fms_coupler_ind_flux)%values(i)<sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>WTMAIR*1.0e-3<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>/<sp/>(1.-ex_tr_atm(i,isphum))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>vmr<sp/>*<sp/>kg/m2/s<sp/>=<sp/>mol(X)/[m2<sp/>s]<sp/>[1/mol(air)<sp/>*<sp/>mol(air)]<sp/>*<sp/>WTM(air)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_tr(i,m)<sp/>=<sp/>ex_gas_fluxes%bc(n)%field(fms_coupler_ind_flux)%values(i)<sp/>&amp;</highlight></codeline>
<codeline lineno="1526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>1.0e-3*wtmair*wtmh2o/((1.-ex_tr_atm(i,isphum))*wtmh2o+ex_tr_atm(i,isphum)*wtmair)</highlight></codeline>
<codeline lineno="1527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>jgj:<sp/>convert<sp/>to<sp/>kg<sp/>co2/m2/sec<sp/>for<sp/>atm</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_tr(i,m)<sp/>=<sp/>ex_gas_fluxes%bc(n)%field(fms_coupler_ind_flux)%values(i)<sp/>*<sp/>&amp;</highlight></codeline>
<codeline lineno="1531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gas_fluxes%bc(n)%mol_wt<sp/>*<sp/>1.0e-03</highlight></codeline>
<codeline lineno="1532"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_tr(i,m)<sp/>=<sp/>0.0<sp/></highlight><highlight class="comment">!<sp/>pure<sp/>ice<sp/>exchange<sp/>cell</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1535"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1536"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1537"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1538"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1539"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1540"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>END<sp/>COMPUTE<sp/>EXPLICIT<sp/>OCEAN<sp/>FLUXES</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1541"><highlight class="normal"></highlight></codeline>
<codeline lineno="1544"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1545"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">![5.2]<sp/>override<sp/>tracer<sp/>fluxes<sp/>and<sp/>derivatives</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1546"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr=1,<sp/>n_exch_tr</highlight></codeline>
<codeline lineno="1547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>tr_table(tr)%atm<sp/>==<sp/>no_tracer<sp/>)<sp/>cycle<sp/></highlight><highlight class="comment">!<sp/>it<sp/>should<sp/>never<sp/>happen,<sp/>though</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1548"><highlight class="normal"></highlight></codeline>
<codeline lineno="1549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(model_atmos,<sp/>tr_table(tr)%atm,<sp/>tr_name)</highlight></codeline>
<codeline lineno="1550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>[5.2.1]<sp/>override<sp/>tracer<sp/>flux.<sp/>Note<sp/>that<sp/>&quot;sea&quot;<sp/>and<sp/>&quot;diag_land&quot;<sp/>are<sp/>repeatedly<sp/>used</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>as<sp/>temporary<sp/>storage<sp/>for<sp/>the<sp/>values<sp/>we<sp/>are<sp/>overriding<sp/>fluxes<sp/>and<sp/>derivative<sp/>with,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>over<sp/>ocean<sp/>and<sp/>land<sp/>respectively</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_<sp/>(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;ex_flux_&apos;</highlight><highlight class="normal">//trim(tr_name),<sp/>diag_land,<sp/>time,<sp/>override=used)</highlight></codeline>
<codeline lineno="1554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(used)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_<sp/>(<sp/>diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_flux_tr(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;ex_flux_&apos;</highlight><highlight class="normal">//trim(tr_name),<sp/>sea,<sp/>time,<sp/>override=used)</highlight></codeline>
<codeline lineno="1556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(used)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(sea,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_flux_tr(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>[5.2.2]<sp/>override<sp/>derivative<sp/>of<sp/>flux<sp/>wrt<sp/>surface<sp/>concentration</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;ex_dfd&apos;</highlight><highlight class="normal">//trim(tr_name)//</highlight><highlight class="stringliteral">&apos;_surf&apos;</highlight><highlight class="normal">,<sp/>diag_land,<sp/>time,<sp/>override=used)</highlight></codeline>
<codeline lineno="1559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(used)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_dfdtr_surf(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;ex_dfd&apos;</highlight><highlight class="normal">//trim(tr_name)//</highlight><highlight class="stringliteral">&apos;_surf&apos;</highlight><highlight class="normal">,<sp/>sea,<sp/>time,<sp/>override=used)</highlight></codeline>
<codeline lineno="1561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(used)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(sea,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_dfdtr_surf(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>[5.2.3]<sp/>override<sp/>derivative<sp/>of<sp/>flux<sp/>wrt<sp/>atmospheric<sp/>concentration</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;ex_dfd&apos;</highlight><highlight class="normal">//trim(tr_name)//</highlight><highlight class="stringliteral">&apos;_atm&apos;</highlight><highlight class="normal">,<sp/>diag_land,<sp/>time,<sp/>override=used)</highlight></codeline>
<codeline lineno="1564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(used)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_dfdtr_atm(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;ex_dfd&apos;</highlight><highlight class="normal">//trim(tr_name)//</highlight><highlight class="stringliteral">&apos;_atm&apos;</highlight><highlight class="normal">,<sp/>sea,<sp/>time,<sp/>override=used)</highlight></codeline>
<codeline lineno="1566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(used)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(<sp/>sea,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_dfdtr_atm(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1567"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1568"><highlight class="normal"></highlight></codeline>
<codeline lineno="1569"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>[5.3]<sp/>override<sp/>flux<sp/>and<sp/>derivatives<sp/>for<sp/>sensible<sp/>heat<sp/>flux</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1570"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>[5.3.1]<sp/>override<sp/>flux</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1571"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_<sp/>(<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;ex_flux_t&apos;</highlight><highlight class="normal">,<sp/>diag_land,<sp/>time,<sp/>override=used<sp/>)</highlight></codeline>
<codeline lineno="1572"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(used)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_<sp/>(<sp/>diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref>,<sp/>xmap_sfc<sp/>)</highlight></codeline>
<codeline lineno="1573"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override<sp/>(<sp/></highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;ex_flux_t&apos;</highlight><highlight class="normal">,<sp/>sea,<sp/>time,<sp/>override=used<sp/>)</highlight></codeline>
<codeline lineno="1574"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(used)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(<sp/>sea,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref>,<sp/>xmap_sfc<sp/>)</highlight></codeline>
<codeline lineno="1575"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>[5.3.2]<sp/>override<sp/>derivative<sp/>of<sp/>flux<sp/>wrt<sp/>near-surface<sp/>temperature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1576"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_<sp/>(<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;ex_dhdt_surf&apos;</highlight><highlight class="normal">,<sp/>diag_land,<sp/>time,<sp/>override=used<sp/>)</highlight></codeline>
<codeline lineno="1577"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(used)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_<sp/>(<sp/>diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7a723109680791b32db1371f623f679d" kindref="member">ex_dhdt_surf</ref>,<sp/>xmap_sfc<sp/>)</highlight></codeline>
<codeline lineno="1578"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override<sp/>(<sp/></highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;ex_dhdt_surf&apos;</highlight><highlight class="normal">,<sp/>sea,<sp/>time,<sp/>override=used<sp/>)</highlight></codeline>
<codeline lineno="1579"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(used)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(<sp/>sea,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7a723109680791b32db1371f623f679d" kindref="member">ex_dhdt_surf</ref>,<sp/>xmap_sfc<sp/>)</highlight></codeline>
<codeline lineno="1580"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>[5.3.3]<sp/>override<sp/>derivative<sp/>of<sp/>flux<sp/>wrt<sp/>atmospheric<sp/>temperature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1581"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_<sp/>(<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;ex_dhdt_atm&apos;</highlight><highlight class="normal">,<sp/>diag_land,<sp/>time,override=used<sp/>)</highlight></codeline>
<codeline lineno="1582"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(used)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_<sp/>(<sp/>diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a04986e4dfe0871fb9b662597e47772bb" kindref="member">ex_dhdt_atm</ref>,<sp/>xmap_sfc<sp/>)</highlight></codeline>
<codeline lineno="1583"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override<sp/>(<sp/></highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;ex_dhdt_atm&apos;</highlight><highlight class="normal">,<sp/>sea,<sp/>time,<sp/>override=used<sp/>)</highlight></codeline>
<codeline lineno="1584"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(used)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(<sp/>sea,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a04986e4dfe0871fb9b662597e47772bb" kindref="member">ex_dhdt_atm</ref>,<sp/>xmap_sfc<sp/>)</highlight></codeline>
<codeline lineno="1585"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>END<sp/>DATAOVERRIDE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1586"><highlight class="normal"></highlight></codeline>
<codeline lineno="1587"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>NB:<sp/>names<sp/>of<sp/>the<sp/>override<sp/>fields<sp/>are<sp/>constructed<sp/>using<sp/>tracer<sp/>name<sp/>and<sp/>certain</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1588"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>prefixes<sp/>/<sp/>suffixes.<sp/>For<sp/>example,<sp/>for<sp/>the<sp/>tracer<sp/>named<sp/>&quot;sphum&quot;<sp/>(specific<sp/>humidity)<sp/>they<sp/>will<sp/>be:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1589"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>&quot;ex_flux_sphum&quot;,<sp/>&quot;ex_dfdsphum_surf&quot;,<sp/>and<sp/>&quot;ex_dfdsphum_atm&quot;.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1590"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1591"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>For<sp/>sensible<sp/>heat<sp/>flux<sp/>names<sp/>are<sp/>&quot;ex_flux_t&quot;,<sp/>&quot;ex_dhdt_surf&quot;,<sp/>and<sp/>&quot;ex_dhdt_atm&quot;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1592"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>despite<sp/>the<sp/>name<sp/>those<sp/>are<sp/>actually<sp/>in<sp/>energy<sp/>units,<sp/>W/m2,<sp/>W/(m2<sp/>degK),<sp/>and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1593"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>W/(m2<sp/>degK)<sp/>respectively</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1594"><highlight class="normal"></highlight></codeline>
<codeline lineno="1596"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1597"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>parallel<sp/>do<sp/>default(none)<sp/>shared(my_nblocks,block_start,block_end,ex_avail,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1598"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_drag_q,ex_wind,ex_cd_q,ex_t_surf4,ex_t_surf<sp/>)<sp/>private(is,ie)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1599"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>1,<sp/>my_nblocks</highlight></codeline>
<codeline lineno="1600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is=block_start(l)</highlight></codeline>
<codeline lineno="1601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie=block_end(l)</highlight></codeline>
<codeline lineno="1602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,<sp/>ie</highlight></codeline>
<codeline lineno="1603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(ex_avail(i))<sp/>ex_drag_q(i)<sp/>=<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ada77a5490b1ad25fa3ca68f3f81b9548" kindref="member">ex_wind</ref>(i)*ex_cd_q(i)</highlight></codeline>
<codeline lineno="1604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>[6]<sp/>get<sp/>mean<sp/>quantities<sp/>on<sp/>atmosphere<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>[6.1]<sp/>compute<sp/>t<sp/>surf<sp/>for<sp/>radiation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_t_surf4(i)<sp/>=<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref>(i)<sp/>**<sp/>4</highlight></codeline>
<codeline lineno="1607"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1608"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1609"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1610"><highlight class="normal"></highlight></codeline>
<codeline lineno="1611"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>[6.2]<sp/>put<sp/>relevant<sp/>quantities<sp/>onto<sp/>atmospheric<sp/>boundary</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1612"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(&amp;</highlight></codeline>
<codeline lineno="1613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>land_ice_atmos_boundary%t_ocean,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref>,<sp/>xmap_sfc,<sp/>complete=.false.)<sp/></highlight><highlight class="comment">!joseph</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1614"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%t,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_t_surf4,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1615"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%frac_open_sea,</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,ex_frac_open_sea,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1616"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%albedo,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_albedo,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1617"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(&amp;</highlight></codeline>
<codeline lineno="1618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>land_ice_atmos_boundary%albedo_vis_dir,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_albedo_vis_dir,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1619"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(&amp;</highlight></codeline>
<codeline lineno="1620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>land_ice_atmos_boundary%albedo_nir_dir,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_albedo_nir_dir,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1621"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(&amp;</highlight></codeline>
<codeline lineno="1622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>land_ice_atmos_boundary%albedo_vis_dif,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_albedo_vis_dif,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1623"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(&amp;</highlight></codeline>
<codeline lineno="1624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>land_ice_atmos_boundary%albedo_nir_dif,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_albedo_nir_dif,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1625"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%rough_mom,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_rough_mom,<sp/><sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1626"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(&amp;</highlight></codeline>
<codeline lineno="1627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>land_ice_atmos_boundary%rough_heat,</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_rough_heat,<sp/>xmap_sfc,<sp/>complete=.false.)<sp/></highlight><highlight class="comment">!kgao</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1628"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%land_frac,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_land_frac,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1629"><highlight class="normal"></highlight></codeline>
<codeline lineno="1630"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%u_flux,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a5419fecfda33b11db1caab9042cf90c2" kindref="member">ex_flux_u</ref>,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1631"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%v_flux,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac27b58d41879537c39e4b8bc6eac83f8" kindref="member">ex_flux_v</ref>,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1632"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%dtaudu,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a4916ecd33588bcfbce81a5393f436671" kindref="member">ex_dtaudu_atm</ref>,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1633"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%dtaudv,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae3ae41712484a6829639b4cd4431dab1" kindref="member">ex_dtaudv_atm</ref>,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1634"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%u_star,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3faddc34ad457fdb55533bead75ce7f0" kindref="member">ex_u_star</ref>,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1635"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%b_star,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a0fd79bc7659c354908e2e6c325985544" kindref="member">ex_b_star</ref>,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1636"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%q_star,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_q_star,<sp/>xmap_sfc,<sp/>complete=.true.)</highlight></codeline>
<codeline lineno="1637"><highlight class="normal"></highlight></codeline>
<codeline lineno="1638"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n_gex=1,n_gex_lnd2atm</highlight></codeline>
<codeline lineno="1639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(&amp;</highlight></codeline>
<codeline lineno="1640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land_ice_atmos_boundary%gex_lnd2atm(:,:,n_gex),<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_gex_lnd2atm(:,n_gex),<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1641"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>do</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1642"><highlight class="normal"></highlight></codeline>
<codeline lineno="1643"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%u_ref,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_ref_u,<sp/>xmap_sfc,<sp/>complete=.false.)<sp/></highlight><highlight class="comment">!bqx</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1644"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%v_ref,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_ref_v,<sp/>xmap_sfc,<sp/>complete=.true.)<sp/></highlight><highlight class="comment">!bqx</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1645"><highlight class="normal"></highlight></codeline>
<codeline lineno="1646"><highlight class="normal"></highlight><highlight class="comment">!<sp/>kgao:<sp/>for<sp/>shield+mom6<sp/>coupling;<sp/>used<sp/>by<sp/>shield<sp/>pbl<sp/>schemes<sp/>(am5<sp/>with<sp/>tke-edmf<sp/>should<sp/>do<sp/>the<sp/>same)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1647"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="1648"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%shflx,</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref>,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1649"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%lhflx,</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_flux_tr(:,isphum),<sp/>xmap_sfc,<sp/>complete=.true.)</highlight></codeline>
<codeline lineno="1650"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1651"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%wind,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ada77a5490b1ad25fa3ca68f3f81b9548" kindref="member">ex_wind</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1652"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%thv_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_thv_atm,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1653"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%thv_surf,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_thv_surf,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1654"><highlight class="normal"></highlight></codeline>
<codeline lineno="1655"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="1656"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_forecast)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(ice%t_surf,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref>,<sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1658"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1659"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1660"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1661"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_get_compute_domain(atm%domain,<sp/>isc,<sp/>iec,<sp/>jsc,<sp/>jec<sp/>)</highlight></codeline>
<codeline lineno="1662"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>parallel<sp/>do<sp/>default(none)<sp/>shared(isc,iec,jsc,jec,Land_Ice_Atmos_Boundary)<sp/>private(is,ie)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1663"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>jsc,<sp/>jec</highlight></codeline>
<codeline lineno="1664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>isc,<sp/>iec</highlight></codeline>
<codeline lineno="1665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land_ice_atmos_boundary%t(i,j)<sp/>=<sp/>land_ice_atmos_boundary%t(i,j)<sp/>**<sp/>0.25</highlight></codeline>
<codeline lineno="1666"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1667"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1668"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Balaji:<sp/>fms_data_override<sp/>calls<sp/>moved<sp/>here<sp/>from<sp/>coupler_main</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1669"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;t&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land_ice_atmos_boundary%t,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>time)</highlight></codeline>
<codeline lineno="1670"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;albedo&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/>land_ice_atmos_boundary%albedo,<sp/><sp/><sp/><sp/>time)</highlight></codeline>
<codeline lineno="1671"><highlight class="normal"></highlight></codeline>
<codeline lineno="1672"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;albedo_vis_dir&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/>land_ice_atmos_boundary%albedo_vis_dir,<sp/><sp/><sp/><sp/>time)</highlight></codeline>
<codeline lineno="1673"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;albedo_nir_dir&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/>land_ice_atmos_boundary%albedo_nir_dir,<sp/><sp/><sp/><sp/>time)</highlight></codeline>
<codeline lineno="1674"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;albedo_vis_dif&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/>land_ice_atmos_boundary%albedo_vis_dif,<sp/><sp/><sp/><sp/>time)</highlight></codeline>
<codeline lineno="1675"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;albedo_nir_dif&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/>land_ice_atmos_boundary%albedo_nir_dif,<sp/><sp/><sp/><sp/>time)</highlight></codeline>
<codeline lineno="1676"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;land_frac&apos;</highlight><highlight class="normal">,<sp/>land_ice_atmos_boundary%land_frac,<sp/>time)</highlight></codeline>
<codeline lineno="1677"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;dt_t&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/><sp/><sp/>land_ice_atmos_boundary%dt_t,<sp/><sp/><sp/><sp/><sp/><sp/>time)</highlight></codeline>
<codeline lineno="1678"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr=1,n_atm_tr</highlight></codeline>
<codeline lineno="1679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(model_atmos,<sp/>tr,<sp/>tr_name)</highlight></codeline>
<codeline lineno="1680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;dt_&apos;</highlight><highlight class="normal">//trim(tr_name),<sp/>land_ice_atmos_boundary%dt_tr(:,:,tr),<sp/>time)</highlight></codeline>
<codeline lineno="1681"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1682"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;u_flux&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/>land_ice_atmos_boundary%u_flux,<sp/><sp/><sp/><sp/>time)</highlight></codeline>
<codeline lineno="1683"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;v_flux&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/>land_ice_atmos_boundary%v_flux,<sp/><sp/><sp/><sp/>time)</highlight></codeline>
<codeline lineno="1684"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;dtaudu&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/>land_ice_atmos_boundary%dtaudu,<sp/><sp/><sp/><sp/>time)</highlight></codeline>
<codeline lineno="1685"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;dtaudv&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/>land_ice_atmos_boundary%dtaudv,<sp/><sp/><sp/><sp/>time)</highlight></codeline>
<codeline lineno="1686"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;u_star&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/>land_ice_atmos_boundary%u_star,<sp/><sp/><sp/><sp/>time)</highlight></codeline>
<codeline lineno="1687"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;b_star&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/>land_ice_atmos_boundary%b_star,<sp/><sp/><sp/><sp/>time)</highlight></codeline>
<codeline lineno="1688"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>call<sp/>fms_data_override(&apos;ATM&apos;,<sp/>&apos;q_star&apos;,<sp/><sp/><sp/><sp/>Land_Ice_Atmos_Boundary%q_star,<sp/><sp/><sp/><sp/>Time)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1689"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;rough_mom&apos;</highlight><highlight class="normal">,<sp/>land_ice_atmos_boundary%rough_mom,<sp/>time)</highlight></codeline>
<codeline lineno="1690"><highlight class="normal"></highlight></codeline>
<codeline lineno="1691"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>[6.3]<sp/>save<sp/>atmos<sp/>albedo<sp/>fix<sp/>and<sp/>old<sp/>albedo<sp/>(for<sp/>downward<sp/>SW<sp/>flux<sp/>calculations)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1692"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>on<sp/>exchange<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1693"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>allocate<sp/>(<sp/>ex_old_albedo(n_xgrid_sfc)<sp/><sp/>)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1694"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>ex_old_albedo<sp/>=<sp/>ex_albedo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1695"><highlight class="normal"></highlight></codeline>
<codeline lineno="1696"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!!<sp/><sp/>STILL<sp/>NEEDED<sp/><sp/><sp/>????</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1697"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!!<sp/>IS<sp/>THIS<sp/>CORRECT<sp/>??</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1698"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal"><sp/>(<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6ce3eaf605064a25d5cc1283e0e11276" kindref="member">ex_albedo_fix</ref>(n_xgrid_sfc)<sp/>)</highlight></codeline>
<codeline lineno="1699"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal"><sp/>(<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aad98ee1a168521649429409b391b9762" kindref="member">ex_albedo_vis_dir_fix</ref>(n_xgrid_sfc)<sp/>)</highlight></codeline>
<codeline lineno="1700"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal"><sp/>(<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a104be61b1aa14a50d997b6993b5274c9" kindref="member">ex_albedo_nir_dir_fix</ref>(n_xgrid_sfc)<sp/>)</highlight></codeline>
<codeline lineno="1701"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal"><sp/>(<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aa10f4fb058cec37b5080747c92b38ccc" kindref="member">ex_albedo_vis_dif_fix</ref>(n_xgrid_sfc)<sp/>)</highlight></codeline>
<codeline lineno="1702"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal"><sp/>(<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a328257f3efd36a27514c76d5cf96c379" kindref="member">ex_albedo_nir_dif_fix</ref>(n_xgrid_sfc)<sp/>)</highlight></codeline>
<codeline lineno="1703"><highlight class="normal"></highlight></codeline>
<codeline lineno="1704"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>parallel<sp/>do<sp/>default(none)<sp/>shared(my_nblocks,block_start,block_end,ex_albedo_fix,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1705"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_vis_dir_fix,ex_albedo_nir_dir_fix,<sp/><sp/><sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1706"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_vis_dif_fix,ex_albedo_nir_dif_fix<sp/>)<sp/><sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1707"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>private(is,ie)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1708"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>1,<sp/>my_nblocks</highlight></codeline>
<codeline lineno="1709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is=block_start(l)</highlight></codeline>
<codeline lineno="1710"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie=block_end(l)</highlight></codeline>
<codeline lineno="1711"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,<sp/>ie</highlight></codeline>
<codeline lineno="1712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6ce3eaf605064a25d5cc1283e0e11276" kindref="member">ex_albedo_fix</ref>(i)<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="1713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aad98ee1a168521649429409b391b9762" kindref="member">ex_albedo_vis_dir_fix</ref>(i)<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="1714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a104be61b1aa14a50d997b6993b5274c9" kindref="member">ex_albedo_nir_dir_fix</ref>(i)<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="1715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aa10f4fb058cec37b5080747c92b38ccc" kindref="member">ex_albedo_vis_dif_fix</ref>(i)<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="1716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a328257f3efd36a27514c76d5cf96c379" kindref="member">ex_albedo_nir_dif_fix</ref>(i)<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="1717"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1718"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1719"><highlight class="normal"></highlight></codeline>
<codeline lineno="1720"><highlight class="normal"></highlight></codeline>
<codeline lineno="1721"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(land_ice_atmos_boundary%albedo,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6ce3eaf605064a25d5cc1283e0e11276" kindref="member">ex_albedo_fix</ref>,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1722"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(land_ice_atmos_boundary%albedo_vis_dir,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="1723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aad98ee1a168521649429409b391b9762" kindref="member">ex_albedo_vis_dir_fix</ref>,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1724"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(land_ice_atmos_boundary%albedo_nir_dir,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="1725"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a104be61b1aa14a50d997b6993b5274c9" kindref="member">ex_albedo_nir_dir_fix</ref>,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1726"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(land_ice_atmos_boundary%albedo_vis_dif,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="1727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aa10f4fb058cec37b5080747c92b38ccc" kindref="member">ex_albedo_vis_dif_fix</ref>,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="1728"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(land_ice_atmos_boundary%albedo_nir_dif,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="1729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a328257f3efd36a27514c76d5cf96c379" kindref="member">ex_albedo_nir_dif_fix</ref>,<sp/>xmap_sfc,<sp/>complete=.true.)</highlight></codeline>
<codeline lineno="1730"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>parallel<sp/>do<sp/>default(none)<sp/>shared(my_nblocks,block_start,block_end,ex_albedo_fix,<sp/><sp/><sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1731"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo,ex_albedo_vis_dir_fix,ex_albedo_vis_dir,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1732"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_nir_dir,ex_albedo_nir_dir_fix,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1733"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_vis_dif_fix,ex_albedo_vis_dif,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1734"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_albedo_nir_dif_fix,ex_albedo_nir_dif)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1735"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>private(is,ie)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1736"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>1,<sp/>my_nblocks</highlight></codeline>
<codeline lineno="1737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is=block_start(l)</highlight></codeline>
<codeline lineno="1738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie=block_end(l)</highlight></codeline>
<codeline lineno="1739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,<sp/>ie</highlight></codeline>
<codeline lineno="1740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6ce3eaf605064a25d5cc1283e0e11276" kindref="member">ex_albedo_fix</ref>(i)<sp/>=<sp/>(1.0-ex_albedo(i))<sp/>/<sp/>(1.0-<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6ce3eaf605064a25d5cc1283e0e11276" kindref="member">ex_albedo_fix</ref>(i))</highlight></codeline>
<codeline lineno="1741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aad98ee1a168521649429409b391b9762" kindref="member">ex_albedo_vis_dir_fix</ref>(i)<sp/>=<sp/>(1.0-ex_albedo_vis_dir(i))<sp/>/<sp/>(1.0-<ref refid="namespaceatm__land__ice__flux__exchange__mod_1aad98ee1a168521649429409b391b9762" kindref="member">ex_albedo_vis_dir_fix</ref>(i))</highlight></codeline>
<codeline lineno="1742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a104be61b1aa14a50d997b6993b5274c9" kindref="member">ex_albedo_nir_dir_fix</ref>(i)<sp/>=<sp/>(1.0-ex_albedo_nir_dir(i))<sp/>/<sp/>(1.0-<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a104be61b1aa14a50d997b6993b5274c9" kindref="member">ex_albedo_nir_dir_fix</ref>(i))</highlight></codeline>
<codeline lineno="1743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aa10f4fb058cec37b5080747c92b38ccc" kindref="member">ex_albedo_vis_dif_fix</ref>(i)<sp/>=<sp/>(1.0-ex_albedo_vis_dif(i))<sp/>/<sp/>(1.0-<ref refid="namespaceatm__land__ice__flux__exchange__mod_1aa10f4fb058cec37b5080747c92b38ccc" kindref="member">ex_albedo_vis_dif_fix</ref>(i))</highlight></codeline>
<codeline lineno="1744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a328257f3efd36a27514c76d5cf96c379" kindref="member">ex_albedo_nir_dif_fix</ref>(i)<sp/>=<sp/>(1.0-ex_albedo_nir_dif(i))<sp/>/<sp/>(1.0-<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a328257f3efd36a27514c76d5cf96c379" kindref="member">ex_albedo_nir_dif_fix</ref>(i))</highlight></codeline>
<codeline lineno="1745"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1746"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1747"><highlight class="normal"></highlight></codeline>
<codeline lineno="1748"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>SCM</highlight></codeline>
<codeline lineno="1749"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_specified_albedo<sp/>.and.<sp/>do_specified_land)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6ce3eaf605064a25d5cc1283e0e11276" kindref="member">ex_albedo_fix</ref><sp/>=<sp/>1.</highlight></codeline>
<codeline lineno="1751"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aad98ee1a168521649429409b391b9762" kindref="member">ex_albedo_vis_dir_fix</ref><sp/>=<sp/>1.</highlight></codeline>
<codeline lineno="1752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aa10f4fb058cec37b5080747c92b38ccc" kindref="member">ex_albedo_vis_dif_fix</ref><sp/>=<sp/>1.</highlight></codeline>
<codeline lineno="1753"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a104be61b1aa14a50d997b6993b5274c9" kindref="member">ex_albedo_nir_dir_fix</ref><sp/>=<sp/>1.</highlight></codeline>
<codeline lineno="1754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a328257f3efd36a27514c76d5cf96c379" kindref="member">ex_albedo_nir_dif_fix</ref><sp/>=<sp/>1.</highlight></codeline>
<codeline lineno="1755"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1756"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1757"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1758"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!=======================================================================</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1759"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>[7]<sp/>diagnostics<sp/>section</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1760"><highlight class="normal"></highlight></codeline>
<codeline lineno="1761"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>save<sp/>static<sp/>fields<sp/>first<sp/>time<sp/>only<sp/>------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1762"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(first_static)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1763"><highlight class="normal"></highlight></codeline>
<codeline lineno="1764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>land<sp/>fraction<sp/>------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_land_mask<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_land_mask,<sp/>land_ice_atmos_boundary%land_frac,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1767"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_sftlf<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_sftlf,<sp/>land_ice_atmos_boundary%land_frac,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1770"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>near-surface<sp/>heights</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_height2m<sp/><sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_height2m,<sp/>z_ref_heat,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_height10m<sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_height10m,<sp/>z_ref_mom,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1774"><highlight class="normal"></highlight></codeline>
<codeline lineno="1775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>first_static<sp/>=<sp/>.false.</highlight></codeline>
<codeline lineno="1776"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1777"><highlight class="normal"></highlight></codeline>
<codeline lineno="1778"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>Atm<sp/>fields<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1779"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>1,<sp/>atm%fields%num_bcs<sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>m<sp/>=<sp/>1,<sp/>atm%fields%bc(n)%num_fields<sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>atm%fields%bc(n)%field(m)%id_diag<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(atm%fields%bc(n)%use_10m_wind_speed<sp/>.and.<sp/>m<sp/>.eq.<sp/>fms_coupler_ind_u10<sp/>.and.<sp/>&amp;</highlight></codeline>
<codeline lineno="1783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.not.<sp/>atm%fields%bc(n)%field(m)%override)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(atm%fields%bc(n)%field(m)%values,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="1785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gas_fields_atm%bc(n)%field(m)%values,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1786"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1787"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>atm%fields%bc(n)%field(m)%id_diag<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(atm%fields%bc(n)%field(m)%id_diag,<sp/>atm%fields%bc(n)%field(m)%values,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1789"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1790"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1791"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!}<sp/>m</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1792"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!}<sp/>n</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1793"><highlight class="normal"></highlight></codeline>
<codeline lineno="1794"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>drag<sp/>coeff<sp/>moisture<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1795"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_wind<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ada77a5490b1ad25fa3ca68f3f81b9548" kindref="member">ex_wind</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_wind,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1798"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1799"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>drag<sp/>coeff<sp/>moisture<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1800"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_drag_moist<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_cd_q,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1802"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_drag_moist,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1803"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1804"><highlight class="normal"></highlight></codeline>
<codeline lineno="1805"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>drag<sp/>coeff<sp/>heat<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1806"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_drag_heat<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1807"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a1fc83cb6b523c05c9925f67c1bef77eb" kindref="member">ex_cd_t</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1808"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_drag_heat,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1809"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1810"><highlight class="normal"></highlight></codeline>
<codeline lineno="1811"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>drag<sp/>coeff<sp/>momemtum<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1812"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_drag_mom<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1813"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a26e0b81f6ed8473af88bdec4dda23c4b" kindref="member">ex_cd_m</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1814"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_drag_mom,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1815"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1816"><highlight class="normal"></highlight></codeline>
<codeline lineno="1817"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>roughness<sp/>moisture<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1818"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_rough_moist<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1819"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_rough_moist,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1820"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_rough_moist,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1821"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1822"><highlight class="normal"></highlight></codeline>
<codeline lineno="1823"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>roughness<sp/>heat<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1824"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_rough_heat<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1825"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_rough_heat,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1826"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_rough_heat,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1827"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1828"><highlight class="normal"></highlight></codeline>
<codeline lineno="1829"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>roughness<sp/>momemtum<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1830"><highlight class="normal"><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_rough_mom,<sp/>land_ice_atmos_boundary%rough_mom,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1831"><highlight class="normal"></highlight></codeline>
<codeline lineno="1832"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>friction<sp/>velocity<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1833"><highlight class="normal"><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_u_star,<sp/>land_ice_atmos_boundary%u_star,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1834"><highlight class="normal"></highlight></codeline>
<codeline lineno="1835"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>bouyancy<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1836"><highlight class="normal"><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_b_star,<sp/>land_ice_atmos_boundary%b_star,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1837"><highlight class="normal"></highlight></codeline>
<codeline lineno="1838"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>moisture<sp/>scale<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1839"><highlight class="normal"><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_q_star,<sp/>land_ice_atmos_boundary%q_star,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1840"><highlight class="normal"></highlight></codeline>
<codeline lineno="1841"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>surf<sp/>and<sp/>atm<sp/>virtual<sp/>potential<sp/>temperature<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1842"><highlight class="normal"><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_thv_atm,<sp/><sp/>land_ice_atmos_boundary%thv_atm,<sp/><sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1843"><highlight class="normal"><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_thv_surf,<sp/>land_ice_atmos_boundary%thv_surf,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1844"><highlight class="normal"></highlight></codeline>
<codeline lineno="1845"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-----------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1846"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!------<sp/>diagnostics<sp/>for<sp/>fields<sp/>at<sp/>bottom<sp/>atmospheric<sp/>level<sp/>------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1847"><highlight class="normal"></highlight></codeline>
<codeline lineno="1848"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_t_atm<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1849"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_t_atm,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1850"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_t_atm,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1851"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1852"><highlight class="normal"></highlight></codeline>
<codeline lineno="1853"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_u_atm<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1854"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_u_atm,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1855"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_u_atm,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1856"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1857"><highlight class="normal"></highlight></codeline>
<codeline lineno="1858"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_v_atm<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1859"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_v_atm,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1860"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_v_atm,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1861"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1862"><highlight class="normal"></highlight></codeline>
<codeline lineno="1863"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,n_exch_tr</highlight></codeline>
<codeline lineno="1864"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(<sp/>model_atmos,<sp/>tr_table(tr)%atm,<sp/>tr_name<sp/>)</highlight></codeline>
<codeline lineno="1865"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_tr_atm(tr)<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1866"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_tr_atm(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1867"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_tr_atm(tr),<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1868"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1869"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!!jgj:<sp/>add<sp/>dryvmr<sp/>co2_atm</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1870"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>-<sp/>slm<sp/>Mar<sp/>25<sp/>2010:<sp/>moved<sp/>to<sp/>resolve<sp/>interdependence<sp/>of<sp/>diagnostic<sp/>fields</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1871"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_co2_atm_dvmr<sp/>&gt;<sp/>0<sp/>.and.<sp/>fms_mpp_lowercase(trim(tr_name))==</highlight><highlight class="stringliteral">&apos;co2&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1872"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_co2_atm_dvmr<sp/>=<sp/>(ex_tr_atm(:,tr)<sp/>/<sp/>(1.0<sp/>-<sp/>ex_tr_atm(:,isphum)))<sp/>*<sp/>wtmair/wtmco2</highlight></codeline>
<codeline lineno="1873"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_co2_atm_dvmr,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1874"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_co2_atm_dvmr,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1875"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1876"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1877"><highlight class="normal"></highlight></codeline>
<codeline lineno="1878"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>-<sp/>slm,<sp/>Mar<sp/>25,<sp/>2002</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1879"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_p_atm<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1880"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_p_atm,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_p_atm,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1882"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1883"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_z_atm<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1884"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a415a43eca092359dca12e46ac24bb0de" kindref="member">ex_z_atm</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1885"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_z_atm,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1886"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1887"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_gust<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1888"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_gust,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1889"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_gust,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1890"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1891"><highlight class="normal"></highlight></codeline>
<codeline lineno="1892"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>-<sp/>bw,<sp/>Sep<sp/>17,<sp/>2007</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1893"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_slp<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_psl<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1894"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae70d5c9a1a49eff91b2c14c1657103a6" kindref="member">ex_slp</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1895"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_slp<sp/>&gt;<sp/>0<sp/>)<sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_slp,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1896"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_psl<sp/>&gt;<sp/>0<sp/>)<sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_psl,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1897"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1898"><highlight class="normal"></highlight></codeline>
<codeline lineno="1899"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_t_ocean<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1900"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_t_ocean,<sp/>land_ice_atmos_boundary%t_ocean,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="1901"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1902"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-----------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1903"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!---------<sp/>diagnostics<sp/>for<sp/>fields<sp/>at<sp/>reference<sp/>level<sp/>---------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1904"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!cjg</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1905"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>if<sp/>(<sp/>id_t_ref<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_rh_ref<sp/>&gt;<sp/>0<sp/>.or.<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1906"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_u_ref<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_v_ref<sp/><sp/>&gt;<sp/>0<sp/>.or.<sp/>id_wind_ref<sp/>&gt;<sp/>0<sp/>.or.<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1907"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_q_ref<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_q_ref_land<sp/>&gt;<sp/>0<sp/>.or.<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1908"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_t_ref_land<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_rh_ref_land<sp/>&gt;<sp/>0<sp/>.or.<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1909"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_rh_ref_cmip<sp/>&gt;0<sp/>.or.<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1910"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_u_ref_land<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_v_ref_land<sp/><sp/>&gt;<sp/>0<sp/>)<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1911"><highlight class="normal"></highlight></codeline>
<codeline lineno="1912"><highlight class="normal"><sp/><sp/><sp/><sp/>zrefm<sp/>=<sp/>z_ref_mom</highlight></codeline>
<codeline lineno="1913"><highlight class="normal"><sp/><sp/><sp/><sp/>zrefh<sp/>=<sp/>z_ref_heat</highlight></codeline>
<codeline lineno="1914"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/>----<sp/>optimize<sp/>calculation<sp/>----</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1915"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!cjg<sp/><sp/><sp/><sp/><sp/>if<sp/>(<sp/>id_t_ref<sp/>&lt;=<sp/>0<sp/>)<sp/>zrefh<sp/>=<sp/>zrefm</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1916"><highlight class="normal"></highlight></codeline>
<codeline lineno="1917"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>parallel<sp/>do<sp/>default(none)<sp/>shared(my_nblocks,block_start,block_end,zrefm,zrefh,ex_z_atm,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1918"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_rough_mom,ex_rough_heat,ex_rough_moist,ex_u_star,<sp/><sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1919"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_b_star,ex_q_star,ex_del_m,ex_del_h,ex_del_q,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1920"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_ref,n_exch_tr,id_tr_ref,id_tr_ref_land,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1921"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_con_ref,<sp/>id_tr_con_ref,<sp/>id_tr_con_ref_land,<sp/><sp/><sp/><sp/><sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1922"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_con_atm,<sp/>id_tr_con_atm,<sp/>id_tr_con_atm_land,<sp/><sp/><sp/><sp/><sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1923"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_avail,ex_ref,ex_tr_surf,ex_tr_atm,isphum,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1924"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_tr,ex_t_atm,ex_p_surf)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1925"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>private(is,ie,rho)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1926"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>1,<sp/>my_nblocks</highlight></codeline>
<codeline lineno="1927"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is=block_start(l)</highlight></codeline>
<codeline lineno="1928"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie=block_end(l)</highlight></codeline>
<codeline lineno="1929"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_monin_obukhov_mo_profile<sp/>(<sp/>zrefm,<sp/>zrefh,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a415a43eca092359dca12e46ac24bb0de" kindref="member">ex_z_atm</ref>(is:ie),<sp/><sp/><sp/>ex_rough_mom(is:ie),<sp/>&amp;</highlight></codeline>
<codeline lineno="1930"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_rough_heat(is:ie),<sp/>ex_rough_moist(is:ie),<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="1931"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3faddc34ad457fdb55533bead75ce7f0" kindref="member">ex_u_star</ref>(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a0fd79bc7659c354908e2e6c325985544" kindref="member">ex_b_star</ref>(is:ie),<sp/>ex_q_star(is:ie),<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="1932"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_del_m(is:ie),<sp/>ex_del_h(is:ie),<sp/>ex_del_q(is:ie),<sp/>ex_avail(is:ie)<sp/><sp/>)</highlight></codeline>
<codeline lineno="1933"><highlight class="normal"></highlight></codeline>
<codeline lineno="1934"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>-------<sp/>reference<sp/>relative<sp/>humidity<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1935"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!cjg<sp/><sp/><sp/><sp/><sp/>if<sp/>(<sp/>id_rh_ref<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_rh_ref_land<sp/>&gt;<sp/>0<sp/>.or.<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1936"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!cjg<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_rh_ref_cmip<sp/>&gt;<sp/>0<sp/>.or.<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1937"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!cjg<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_q_ref<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_q_ref_land<sp/>&gt;0<sp/>)<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1938"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,ie</highlight></codeline>
<codeline lineno="1939"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_ref(i)<sp/>=<sp/>1.0e-06</highlight></codeline>
<codeline lineno="1940"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_ref(i,:)<sp/>=<sp/>1.e-20</highlight></codeline>
<codeline lineno="1941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ex_avail(i)<sp/>.and.<sp/>ex_rough_moist(i)<sp/>&gt;<sp/>0.)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_ref(i)<sp/><sp/><sp/>=<sp/>ex_tr_surf(i,isphum)<sp/>+<sp/>(ex_tr_atm(i,isphum)-ex_tr_surf(i,isphum))<sp/>*<sp/>ex_del_q(i)</highlight></codeline>
<codeline lineno="1943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rho<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af4fdc80a51f0145da4aa80a6317cc156" kindref="member">ex_p_surf</ref>(i)/(rdgas<sp/>*<sp/>ex_t_atm(i)*(1.0+d608*ex_tr_atm(i,isphum)))</highlight></codeline>
<codeline lineno="1944"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr=1,n_exch_tr</highlight></codeline>
<codeline lineno="1945"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_tr_ref(tr).gt.0<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="1946"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.or.<sp/>id_tr_ref_land(tr).gt.0<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="1947"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.or.<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ab67aebeab080001bcc0b7df4ba4ce31d" kindref="member">id_tr_con_ref</ref>(tr).gt.0<sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="1948"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.or.<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3b0582183221d7ffb1ba6e814cdd2bd5" kindref="member">id_tr_con_ref_land</ref>(tr).gt.0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1949"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_ref(i,tr)<sp/>=<sp/>ex_tr_surf(i,tr)<sp/>+<sp/>(ex_tr_atm(i,tr)-ex_tr_surf(i,tr))<sp/>*<sp/>ex_del_q(i)</highlight></codeline>
<codeline lineno="1950"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_con_ref(i,tr)<sp/>=<sp/>-ex_flux_tr(i,tr)/max(ex_tr_ref(i,tr)*rho,epsln)</highlight></codeline>
<codeline lineno="1951"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1952"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3700e57c52d7ba6ff7ce17de7a52f885" kindref="member">id_tr_con_atm</ref>(tr).gt.0<sp/>.or.<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aaf13f42049e3c17ce32b99e263ed19ca" kindref="member">id_tr_con_atm_land</ref>(tr).gt.0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1953"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_con_atm(i,tr)<sp/>=<sp/>-ex_flux_tr(i,tr)/max(ex_tr_atm(i,tr)*rho,epsln)</highlight></codeline>
<codeline lineno="1954"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1955"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>do</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1956"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1957"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1958"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1959"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(land_ice_atmos_boundary%q_ref,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_ref,<sp/><sp/><sp/>xmap_sfc)<sp/><sp/></highlight><highlight class="comment">!<sp/>cjg</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1960"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_q_ref<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1961"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(id_q_ref,land_ice_atmos_boundary%q_ref,time)</highlight></codeline>
<codeline lineno="1962"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1963"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_huss<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1964"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(id_huss,land_ice_atmos_boundary%q_ref,time)</highlight></codeline>
<codeline lineno="1965"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1966"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_q_ref_land<sp/>&gt;<sp/>0<sp/>.or.id_husslut_land<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1967"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_<sp/>(diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_ref,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1968"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="1969"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!duplicate<sp/>send_tile_data.<sp/>We<sp/>may<sp/>remove<sp/>id_q_ref_land<sp/>in<sp/>the<sp/>future.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1970"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data<sp/>(id_q_ref_land,<sp/>diag_land)</highlight></codeline>
<codeline lineno="1971"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data<sp/>(id_husslut_land,<sp/>diag_land)</highlight></codeline>
<codeline lineno="1972"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="1973"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_tile_averaged_data(id_q_ref_land,<sp/>diag_land,<sp/>&amp;</highlight></codeline>
<codeline lineno="1974"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land%tile_size,<sp/>time,<sp/>mask=land%mask)</highlight></codeline>
<codeline lineno="1975"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1976"><highlight class="preprocessor"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1977"><highlight class="normal"></highlight></codeline>
<codeline lineno="1978"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr=1,n_exch_tr</highlight></codeline>
<codeline lineno="1979"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_tr_ref(tr)&gt;0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1980"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_tr_ref(:,tr),<sp/><sp/><sp/>xmap_sfc)<sp/><sp/></highlight><highlight class="comment">!<sp/>cjg</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1981"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_tr_ref(tr)<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1982"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(id_tr_ref(tr),diag_atm,time)</highlight></codeline>
<codeline lineno="1983"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1984"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1985"><highlight class="normal"></highlight></codeline>
<codeline lineno="1986"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_tr_ref_land(tr)<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1987"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_<sp/>(diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_tr_ref(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="1988"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="1989"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data<sp/>(id_tr_ref_land(tr),<sp/>diag_land)</highlight></codeline>
<codeline lineno="1990"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="1991"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_tile_averaged_data(id_tr_ref_land(tr),<sp/>diag_land,<sp/>&amp;</highlight></codeline>
<codeline lineno="1992"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land%tile_size,<sp/>time,<sp/>mask=land%mask)</highlight></codeline>
<codeline lineno="1993"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="1994"><highlight class="preprocessor"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1995"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>do</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1996"><highlight class="normal"></highlight></codeline>
<codeline lineno="1997"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>parallel<sp/>do<sp/>default(none)<sp/>shared(my_nblocks,block_start,block_end,ex_t_ref,ex_avail,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1998"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_rough_heat,ex_t_ca,ex_t_atm,ex_p_surf,ex_qs_ref,ex_del_h,<sp/><sp/><sp/><sp/><sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1999"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_ref,ex_qs_ref_cmip,ex_ref2<sp/>)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2000"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>private(is,ie)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2001"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>1,<sp/>my_nblocks</highlight></codeline>
<codeline lineno="2002"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is=block_start(l)</highlight></codeline>
<codeline lineno="2003"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie=block_end(l)</highlight></codeline>
<codeline lineno="2004"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,ie</highlight></codeline>
<codeline lineno="2005"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_t_ref(i)<sp/>=<sp/>200.</highlight></codeline>
<codeline lineno="2006"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>ex_avail(i)<sp/>.and.<sp/>ex_rough_heat(i)<sp/>&gt;<sp/>0.<sp/>)<sp/>&amp;</highlight></codeline>
<codeline lineno="2007"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_t_ref(i)<sp/>=<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref>(i)<sp/>+<sp/>(ex_t_atm(i)-<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref>(i))<sp/>*<sp/>ex_del_h(i)</highlight></codeline>
<codeline lineno="2008"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_sat_vapor_pres_compute_qs<sp/>(ex_t_ref(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af4fdc80a51f0145da4aa80a6317cc156" kindref="member">ex_p_surf</ref>(is:ie),<sp/>ex_qs_ref(is:ie),<sp/>q<sp/>=<sp/>ex_ref(is:ie))</highlight></codeline>
<codeline lineno="2010"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_sat_vapor_pres_compute_qs<sp/>(ex_t_ref(is:ie),<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af4fdc80a51f0145da4aa80a6317cc156" kindref="member">ex_p_surf</ref>(is:ie),<sp/>ex_qs_ref_cmip(is:ie),<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="2011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q<sp/>=<sp/>ex_ref(is:ie),<sp/>es_over_liq_and_ice<sp/>=<sp/>.true.)</highlight></codeline>
<codeline lineno="2012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,ie</highlight></codeline>
<codeline lineno="2013"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(ex_avail(i))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2014"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>remove<sp/>cap<sp/>on<sp/>relative<sp/>humidity<sp/>--<sp/>this<sp/>mod<sp/>requested<sp/>by<sp/>cjg,<sp/>ljd</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2015"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!RSH<sp/><sp/><sp/><sp/>ex_ref<sp/><sp/><sp/><sp/>=<sp/>MIN(100.,100.*ex_ref/ex_qs_ref)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2016"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_ref2(i)<sp/><sp/><sp/>=<sp/>100.*ex_ref(i)/ex_qs_ref_cmip(i)</highlight></codeline>
<codeline lineno="2017"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_ref(i)<sp/><sp/><sp/><sp/>=<sp/>100.*ex_ref(i)/ex_qs_ref(i)</highlight></codeline>
<codeline lineno="2018"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2019"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2020"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2021"><highlight class="normal"></highlight></codeline>
<codeline lineno="2022"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(land_ice_atmos_boundary%t_ref,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_t_ref,<sp/>xmap_sfc)<sp/><sp/></highlight><highlight class="comment">!<sp/>cjg</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2023"><highlight class="normal"></highlight></codeline>
<codeline lineno="2024"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_rh_ref_land<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2025"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_<sp/>(diag_land,</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_ref,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2026"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="2027"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data<sp/>(id_rh_ref_land,<sp/>diag_land)</highlight></codeline>
<codeline lineno="2028"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="2029"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_tile_averaged_data(<sp/>id_rh_ref_land,<sp/>diag_land,<sp/>&amp;</highlight></codeline>
<codeline lineno="2030"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land%tile_size,<sp/>time,<sp/>mask<sp/>=<sp/>land%mask<sp/>)</highlight></codeline>
<codeline lineno="2031"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2032"><highlight class="preprocessor"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2033"><highlight class="normal"></highlight></codeline>
<codeline lineno="2034"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_rh_ref<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2035"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_ref,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2036"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_rh_ref,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2037"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2038"><highlight class="normal"></highlight></codeline>
<codeline lineno="2039"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_rh_ref_cmip<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_hurs<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_rhs<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2040"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_ref2,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2041"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_rh_ref_cmip<sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_rh_ref_cmip,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2042"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_hurs<sp/>&gt;<sp/>0)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_hurs,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2043"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_rhs<sp/><sp/>&gt;<sp/>0)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_rhs,<sp/><sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2044"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2045"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!cjg<sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2046"><highlight class="normal"></highlight></codeline>
<codeline lineno="2047"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>-------<sp/>reference<sp/>temp<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2048"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="2049"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_t_ref<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_t_ref_land<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_taslut_land<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2050"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">where</highlight><highlight class="normal"><sp/>(ex_avail)<sp/>ex_ref<sp/>=<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref><sp/>+<sp/>(ex_t_atm-<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref>)<sp/>*<sp/>ex_del_h</highlight></codeline>
<codeline lineno="2051"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_t_ref_land<sp/>&gt;<sp/>0.or.id_taslut_land<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2052"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_ref,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2053"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="2054"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_t_ref_land<sp/>&gt;<sp/>0)<sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data<sp/>(id_t_ref_land,<sp/>diag_land)</highlight></codeline>
<codeline lineno="2055"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_taslut_land<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data<sp/>(id_taslut_land,<sp/>diag_land)</highlight></codeline>
<codeline lineno="2056"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="2057"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_t_ref_land<sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>fms_diag_send_tile_averaged_data(<sp/>id_t_ref_land,<sp/>diag_land,<sp/>&amp;</highlight></codeline>
<codeline lineno="2058"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land%tile_size,<sp/>time,<sp/>mask<sp/>=<sp/>land%mask<sp/>)</highlight></codeline>
<codeline lineno="2059"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2060"><highlight class="preprocessor"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2061"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_t_ref<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2062"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_ref,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2063"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_t_ref,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2064"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2065"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2066"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="2067"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_t_ref_land<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_taslut_land<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_tasl_g<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2068"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">where</highlight><highlight class="normal"><sp/>(ex_avail)<sp/>ex_ref<sp/>=<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref><sp/>+<sp/>(ex_t_atm-<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref>)<sp/>*<sp/>ex_del_h</highlight></codeline>
<codeline lineno="2069"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>t_ref<sp/>diagnostic<sp/>at<sp/>land<sp/>points<sp/>only</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2070"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_<sp/>(diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_ref,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2071"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="2072"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_t_ref_land<sp/>&gt;<sp/>0)<sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data<sp/>(id_t_ref_land,<sp/>diag_land)</highlight></codeline>
<codeline lineno="2073"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_taslut_land<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data<sp/>(id_taslut_land,<sp/>diag_land)</highlight></codeline>
<codeline lineno="2074"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_tasl_g<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2075"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>send_global_land_diag(<sp/>get_global_diag_field_id(id_tasl_g),<sp/>&amp;</highlight></codeline>
<codeline lineno="2076"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>diag_land,<sp/>time,<sp/>land%tile_size,<sp/>land%mask,<sp/>land<sp/>)</highlight></codeline>
<codeline lineno="2077"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2078"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="2079"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_t_ref_land<sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>fms_diag_send_tile_averaged_data(<sp/>id_t_ref_land,<sp/>diag_land,<sp/>&amp;</highlight></codeline>
<codeline lineno="2080"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land%tile_size,<sp/>time,<sp/>mask<sp/>=<sp/>land%mask<sp/>)</highlight></codeline>
<codeline lineno="2081"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2082"><highlight class="preprocessor"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2083"><highlight class="normal"></highlight></codeline>
<codeline lineno="2084"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>t_ref<sp/>diagnostic<sp/>at<sp/>all<sp/>atmos<sp/>points</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2085"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_ref,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2086"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_t_ref<sp/>&gt;<sp/>0<sp/>)<sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_t_ref,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2087"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_tas<sp/>&gt;<sp/>0<sp/>)<sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_tas,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2088"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_sum_diag_integral_field<sp/>(</highlight><highlight class="stringliteral">&apos;t_ref&apos;</highlight><highlight class="normal">,<sp/><sp/>diag_atm)</highlight></codeline>
<codeline lineno="2089"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_tas_g<sp/>&gt;<sp/>0<sp/>)<sp/><sp/>used<sp/>=<sp/>send_global_diag(<sp/>id_tas_g,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2090"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2091"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2092"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>-------<sp/>reference<sp/>u<sp/>comp<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2093"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_u_ref<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_u_ref_land<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_uas<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2094"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">where</highlight><highlight class="normal"><sp/>(ex_avail)<sp/>&amp;</highlight></codeline>
<codeline lineno="2095"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_ref<sp/>=<sp/>ex_u_surf<sp/>+<sp/>(ex_u_atm-ex_u_surf)<sp/>*<sp/>ex_del_m</highlight></codeline>
<codeline lineno="2096"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_u_ref_land<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2097"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_<sp/>(<sp/>diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_ref,<sp/>xmap_sfc<sp/>)</highlight></codeline>
<codeline lineno="2098"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="2099"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data<sp/>(<sp/>id_u_ref_land,<sp/>diag_land<sp/>)</highlight></codeline>
<codeline lineno="2100"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="2101"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_tile_averaged_data(<sp/>id_u_ref_land,<sp/>diag_land,<sp/>&amp;</highlight></codeline>
<codeline lineno="2102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land%tile_size,<sp/>time,<sp/>mask<sp/>=<sp/>land%mask<sp/>)</highlight></codeline>
<codeline lineno="2103"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2104"><highlight class="preprocessor"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_u_ref<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_uas<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_ref,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_u_ref<sp/>&gt;<sp/>0<sp/>)<sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_u_ref,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_uas<sp/>&gt;<sp/>0<sp/>)<sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_uas,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2109"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2110"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2111"><highlight class="normal"></highlight></codeline>
<codeline lineno="2112"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>-------<sp/>reference<sp/>v<sp/>comp<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_v_ref<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_v_ref_land<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_vas<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">where</highlight><highlight class="normal"><sp/>(ex_avail)<sp/>&amp;</highlight></codeline>
<codeline lineno="2115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_ref<sp/>=<sp/>ex_v_surf<sp/>+<sp/>(ex_v_atm-ex_v_surf)<sp/>*<sp/>ex_del_m</highlight></codeline>
<codeline lineno="2116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_v_ref_land<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_<sp/>(<sp/>diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_ref,<sp/>xmap_sfc<sp/>)</highlight></codeline>
<codeline lineno="2118"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="2119"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data<sp/>(<sp/>id_v_ref_land,<sp/>diag_land<sp/>)</highlight></codeline>
<codeline lineno="2120"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="2121"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_tile_averaged_data(<sp/>id_v_ref_land,<sp/>diag_land,<sp/>&amp;</highlight></codeline>
<codeline lineno="2122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land%tile_size,<sp/>time,<sp/>mask<sp/>=<sp/>land%mask<sp/>)</highlight></codeline>
<codeline lineno="2123"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2124"><highlight class="preprocessor"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_v_ref<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_vas<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_ref,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_v_ref<sp/>&gt;<sp/>0<sp/>)<sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_v_ref,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_vas<sp/><sp/><sp/>&gt;<sp/>0<sp/>)<sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_vas,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2129"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2130"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2131"><highlight class="normal"></highlight></codeline>
<codeline lineno="2132"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>-------<sp/>reference-level<sp/>absolute<sp/>wind<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_wind_ref<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_sfcwind<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">where</highlight><highlight class="normal"><sp/>(ex_avail)<sp/>&amp;</highlight></codeline>
<codeline lineno="2135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_ref<sp/>=<sp/>sqrt((ex_u_surf<sp/>+<sp/>(ex_u_atm-ex_u_surf)<sp/>*<sp/>ex_del_m)**2<sp/>&amp;</highlight></codeline>
<codeline lineno="2136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+(ex_v_surf<sp/>+<sp/>(ex_v_atm-ex_v_surf)<sp/>*<sp/>ex_del_m)**2)</highlight></codeline>
<codeline lineno="2137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_ref,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_wind_ref<sp/>&gt;<sp/>0<sp/>)<sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_wind_ref,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_sfcwind<sp/><sp/>&gt;<sp/>0<sp/>)<sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_sfcwind,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2140"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2141"><highlight class="normal"></highlight></codeline>
<codeline lineno="2142"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>-------<sp/>interp<sp/>factor<sp/>for<sp/>heat<sp/>------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2143"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_del_h<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_del_h,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_del_h,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2146"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2147"><highlight class="normal"></highlight></codeline>
<codeline lineno="2148"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>-------<sp/>interp<sp/>factor<sp/>for<sp/>momentum<sp/>------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2149"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_del_m<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_del_m,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_del_m,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2152"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2153"><highlight class="normal"></highlight></codeline>
<codeline lineno="2154"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>-------<sp/>interp<sp/>factor<sp/>for<sp/>moisture<sp/>------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2155"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_del_q<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_del_q,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_del_q,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2158"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2159"><highlight class="normal"></highlight></codeline>
<codeline lineno="2160"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!cjg<sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>topographic<sp/>roughness<sp/>scale</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2162"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_rough_scale&gt;0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,&amp;</highlight></codeline>
<codeline lineno="2164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(log(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a415a43eca092359dca12e46ac24bb0de" kindref="member">ex_z_atm</ref>/ex_rough_mom+1.0)/log(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a415a43eca092359dca12e46ac24bb0de" kindref="member">ex_z_atm</ref>/ex_rough_scale+1.0))**2,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(id_rough_scale,<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="2166"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2167"><highlight class="normal"></highlight></codeline>
<codeline lineno="2168"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Balaji</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_end(sfcclock)</highlight></codeline>
<codeline lineno="2170"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_end(cplclock)</highlight></codeline>
<codeline lineno="2171"><highlight class="normal"></highlight></codeline>
<codeline lineno="2172"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!=======================================================================</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2173"><highlight class="normal"></highlight></codeline>
<codeline lineno="2174"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae7a53520e8a084f5fa930c5c18c85b54" kindref="member">sfc_boundary_layer</ref></highlight></codeline>
<codeline lineno="2175"><highlight class="normal"></highlight></codeline>
<codeline lineno="2185"><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a377e367901950e4541859f65655b6f38" kindref="member">flux_down_from_atmos</ref>(Time,<sp/>Atm,<sp/>Atmos_boundary,<sp/>Land_boundary,<sp/>Ice_boundary)</highlight></codeline>
<codeline lineno="2186"><highlight class="normal"></highlight></codeline>
<codeline lineno="2187"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">implicit<sp/>none</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2188"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsTime_type),<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal">::<sp/>Time</highlight></codeline>
<codeline lineno="2189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2190"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_data_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>Atm</highlight></codeline>
<codeline lineno="2191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2192"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(land_ice_atmos_boundary_type),<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>Atmos_boundary</highlight></codeline>
<codeline lineno="2193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2194"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_land_boundary_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal">::<sp/>Land_boundary</highlight></codeline>
<codeline lineno="2195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2196"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_ice_boundary_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal">::<sp/>Ice_boundary</highlight></codeline>
<codeline lineno="2197"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2198"><highlight class="normal"></highlight></codeline>
<codeline lineno="2199"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>the<sp/>following<sp/>variables<sp/>are<sp/>on<sp/>the<sp/>exchange<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2200"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(n_xgrid_sfc)</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="2201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>net<sp/>sfc<sp/>shortwave<sp/>radiation<sp/>flux</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_lwd,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>longwave<sp/>radiation<sp/>downward<sp/>flux<sp/>at<sp/>surface<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_dir,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>direct<sp/>shortwave<sp/>radiation<sp/>flux</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_dif,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>downward<sp/>diffuse<sp/>visible<sp/>shortwave<sp/>radiation<sp/>flux<sp/>ar<sp/>the<sp/>surface</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_down_vis_dir,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>downward<sp/>direct<sp/>visible<sp/>shortwave<sp/>radiation<sp/>flux<sp/>at<sp/>the<sp/>surface</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_down_total_dir,<sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>downward<sp/>direct<sp/>total<sp/>shortwave<sp/>radiation<sp/>flux<sp/>at<sp/>the<sp/>surface</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_down_vis_dif,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>downward<sp/>diffuse<sp/>visible<sp/>shortwave<sp/>radiation<sp/>flux<sp/>at<sp/>the<sp/>surface</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_down_total_dif,<sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>downward<sp/>diffusive<sp/>total<sp/>shortwave<sp/>radiation<sp/>flux<sp/>at<sp/>the<sp/>surface</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_vis,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>net<sp/>visible<sp/>shortwave<sp/>radiation<sp/>flux<sp/>at<sp/>the<sp/>surface</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_vis_dir,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>net<sp/>direct<sp/>visible<sp/>shortwave<sp/>radiation<sp/>flux<sp/>at<sp/>the<sp/>surface</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_vis_dif,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>net<sp/>diffuse<sp/>visible<sp/>shortwave<sp/>radiation<sp/>flux<sp/>at<sp/>the<sp/>surface</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_lprec,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>liquid<sp/>precipitation<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_fprec,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>frozen<sp/>precitipation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tprec,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>temperature<sp/>of<sp/>precipitation,<sp/>currently<sp/>equal<sp/>to<sp/>atm<sp/>temperature<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_u_star_smooth,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>friction<sp/>velocity<sp/>correction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2216"><highlight class="normal">#ifdef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="2217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_coszen<sp/></highlight><highlight class="comment">!<sp/>cosine<sp/>of<sp/>the<sp/>zenith<sp/>angle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2218"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="2219"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_coszen,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>cosine<sp/>of<sp/>the<sp/>zenith<sp/>angle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_setl_flux,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>tracer<sp/>sedimentation<sp/>flux<sp/>from<sp/>the<sp/>lowest<sp/>atmophere<sp/>layer<sp/>(positive<sp/>down)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dsetl_dtr<sp/><sp/></highlight><highlight class="comment">!<sp/>derivative<sp/>of<sp/>setl_flux<sp/>w.r.t.<sp/>tracer<sp/>concentration</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2222"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2223"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2224"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal"><sp/>::<sp/>setl_flux(size(Atm%tr_bot,1),size(Atm%tr_bot,2))<sp/></highlight><highlight class="comment">!<sp/>tracer<sp/>seditation<sp/>flux<sp/>from<sp/>the<sp/>lowest<sp/>atmospehere<sp/>layer<sp/>on<sp/>the<sp/>atm<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2225"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal"><sp/>::<sp/>dsetl_dtr(size(Atm%tr_bot,1),size(Atm%tr_bot,2))<sp/></highlight><highlight class="comment">!<sp/>derivative<sp/>of<sp/>setl_dtr<sp/>from<sp/>the<sp/>lowest<sp/>atmosphere<sp/>layer<sp/>on<sp/>the<sp/>atm<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2226"><highlight class="normal"></highlight></codeline>
<codeline lineno="2227"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>temporary<sp/>arrays<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2228"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(n_xgrid_sfc)</highlight><highlight class="normal"><sp/>::<sp/>ex_gamma,<sp/>ex_dtmass,<sp/>ex_delta_t,<sp/>ex_delta_u,<sp/>ex_delta_v,<sp/>ex_dflux_t</highlight></codeline>
<codeline lineno="2229"><highlight class="normal"></highlight></codeline>
<codeline lineno="2230"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(n_xgrid_sfc,n_gex_atm2lnd)</highlight><highlight class="normal"><sp/>::<sp/><sp/>ex_gex_atm2lnd<sp/></highlight><highlight class="comment">!<sp/>generic<sp/>exchange<sp/>fields<sp/>between<sp/>atm<sp/>and<sp/>land<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2231"><highlight class="normal"></highlight></codeline>
<codeline lineno="2232"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(n_xgrid_sfc,n_exch_tr)</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="2233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_delta_tr,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>tracer<sp/>tendencies</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dflux_tr<sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>tracer<sp/>flux<sp/>change</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2235"><highlight class="normal"></highlight></codeline>
<codeline lineno="2236"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal"><sp/>::<sp/>cp_inv<sp/></highlight><highlight class="comment">!<sp/>inverse<sp/>heat<sp/>capacity<sp/>at<sp/>constant<sp/>pressure</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2237"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>used,<sp/>ov,<sp/>ier<sp/></highlight><highlight class="comment">!<sp/>used<sp/>in<sp/>calls<sp/>to<sp/>fms<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2238"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>is_atm,<sp/>ie_atm,<sp/>js_atm,<sp/>je_atm,<sp/>j<sp/></highlight><highlight class="comment">!<sp/>do<sp/>loop<sp/>indices</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2239"><highlight class="normal"></highlight></codeline>
<codeline lineno="2240"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">character(32)</highlight><highlight class="normal"><sp/>::<sp/>tr_name<sp/></highlight><highlight class="comment">!<sp/>name<sp/>of<sp/>the<sp/>tracer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2241"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>tr,<sp/>n,<sp/>m<sp/></highlight><highlight class="comment">!<sp/>tracer<sp/>indices</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2242"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>is,<sp/>ie,<sp/>l,<sp/>i,<sp/>n_gex<sp/></highlight><highlight class="comment">!<sp/>do<sp/>loop<sp/>indices</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2243"><highlight class="normal"></highlight></codeline>
<codeline lineno="2245"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Balaji</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_begin(cplclock)</highlight></codeline>
<codeline lineno="2247"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_begin(fluxatmdnclock)</highlight></codeline>
<codeline lineno="2248"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2249"><highlight class="normal"></highlight></codeline>
<codeline lineno="2251"><highlight class="normal"><sp/><sp/><sp/><sp/>ov<sp/>=<sp/>.false.</highlight></codeline>
<codeline lineno="2252"><highlight class="normal"></highlight></codeline>
<codeline lineno="2255"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Balaji:<sp/>fms_data_override<sp/>calls<sp/>moved<sp/>here<sp/>from<sp/>coupler_main</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2256"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;flux_sw&apos;</highlight><highlight class="normal">,<sp/>atm%flux_sw,<sp/>time)</highlight></codeline>
<codeline lineno="2257"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;flux_sw_dir&apos;</highlight><highlight class="normal">,<sp/>atm%flux_sw_dir,<sp/>time)</highlight></codeline>
<codeline lineno="2258"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;flux_sw_dif&apos;</highlight><highlight class="normal">,<sp/>atm%flux_sw_dif,<sp/>time)</highlight></codeline>
<codeline lineno="2259"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;flux_sw_down_vis_dir&apos;</highlight><highlight class="normal">,<sp/>atm%flux_sw_down_vis_dir,<sp/>time)</highlight></codeline>
<codeline lineno="2260"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;flux_sw_down_vis_dif&apos;</highlight><highlight class="normal">,<sp/>atm%flux_sw_down_vis_dif,<sp/>time)</highlight></codeline>
<codeline lineno="2261"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;flux_sw_down_total_dir&apos;</highlight><highlight class="normal">,<sp/>atm%flux_sw_down_total_dir,<sp/>time)</highlight></codeline>
<codeline lineno="2262"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;flux_sw_down_total_dif&apos;</highlight><highlight class="normal">,<sp/>atm%flux_sw_down_total_dif,<sp/>time)</highlight></codeline>
<codeline lineno="2263"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;flux_sw_vis&apos;</highlight><highlight class="normal">,<sp/><sp/>atm%flux_sw_vis,<sp/>time)</highlight></codeline>
<codeline lineno="2264"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;flux_sw_vis_dir&apos;</highlight><highlight class="normal">,<sp/>atm%flux_sw_vis_dir,<sp/>time)</highlight></codeline>
<codeline lineno="2265"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;flux_sw_vis_dif&apos;</highlight><highlight class="normal">,<sp/>atm%flux_sw_vis_dif,<sp/>time)</highlight></codeline>
<codeline lineno="2266"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;flux_lw&apos;</highlight><highlight class="normal">,<sp/>atm%flux_lw,<sp/>time)</highlight></codeline>
<codeline lineno="2267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;lprec&apos;</highlight><highlight class="normal">,<sp/>atm%lprec,<sp/>time)</highlight></codeline>
<codeline lineno="2268"><highlight class="normal"></highlight></codeline>
<codeline lineno="2272"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(scale_precip_2d)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_get_compute_domain(atm%Domain,<sp/>is_atm,<sp/>ie_atm,<sp/>js_atm,<sp/>je_atm)</highlight></codeline>
<codeline lineno="2274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override<sp/>(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;precip_scale2d&apos;</highlight><highlight class="normal">,<sp/>frac_precip,<sp/>time)</highlight></codeline>
<codeline lineno="2275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>js_atm,<sp/>je_atm</highlight></codeline>
<codeline lineno="2276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is_atm,<sp/>ie_atm</highlight></codeline>
<codeline lineno="2277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atm%lprec(i,j)<sp/>=<sp/>atm%lprec(i,j)*frac_precip(i,j)</highlight></codeline>
<codeline lineno="2278"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2279"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2280"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2281"><highlight class="normal"></highlight></codeline>
<codeline lineno="2285"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(partition_fprec_from_lprec<sp/>.and.<sp/>atm%pe)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_get_compute_domain(atm%Domain,<sp/>is_atm,<sp/>ie_atm,<sp/>js_atm,<sp/>je_atm)</highlight></codeline>
<codeline lineno="2287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>j=js_atm,je_atm</highlight></codeline>
<codeline lineno="2288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i=is_atm,<sp/>ie_atm</highlight></codeline>
<codeline lineno="2289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(atm%t_bot(i,j)<sp/>&lt;<sp/>tfreeze)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atm%fprec(i,j)<sp/>=<sp/>atm%lprec(i,j)</highlight></codeline>
<codeline lineno="2291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atm%lprec(i,j)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="2292"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2293"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2294"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2295"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2296"><highlight class="normal"></highlight></codeline>
<codeline lineno="2298"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2299"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override<sp/>(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;fprec&apos;</highlight><highlight class="normal">,<sp/>atm%fprec,<sp/><sp/><sp/>time)</highlight></codeline>
<codeline lineno="2300"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override<sp/>(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;coszen&apos;</highlight><highlight class="normal">,<sp/>atm%coszen,<sp/><sp/>time)</highlight></codeline>
<codeline lineno="2301"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override<sp/>(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;dtmass&apos;</highlight><highlight class="normal">,<sp/>atm%Surf_Diff%dtmass,<sp/>time)</highlight></codeline>
<codeline lineno="2302"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override<sp/>(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;delta_t&apos;</highlight><highlight class="normal">,<sp/>atm%Surf_Diff%delta_t,<sp/>time)</highlight></codeline>
<codeline lineno="2303"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override<sp/>(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;dflux_t&apos;</highlight><highlight class="normal">,<sp/>atm%Surf_Diff%dflux_t,<sp/>time)</highlight></codeline>
<codeline lineno="2304"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,n_atm_tr</highlight></codeline>
<codeline lineno="2305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(model_atmos,tr,tr_name)</highlight></codeline>
<codeline lineno="2306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override<sp/>(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;delta_&apos;</highlight><highlight class="normal">//trim(tr_name),<sp/>atm%Surf_Diff%delta_tr(:,:,tr),<sp/>time)</highlight></codeline>
<codeline lineno="2307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override<sp/>(</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;dflux_&apos;</highlight><highlight class="normal">//trim(tr_name),<sp/>atm%Surf_Diff%dflux_tr(:,:,tr),<sp/>time)</highlight></codeline>
<codeline lineno="2308"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2309"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2310"><highlight class="normal"></highlight></codeline>
<codeline lineno="2312"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2313"><highlight class="normal"></highlight></codeline>
<codeline lineno="2314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>parallel<sp/>do<sp/>default(none)<sp/>shared(my_nblocks,<sp/>block_start,<sp/>block_end,<sp/>ex_flux_sw_dir,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2315"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_flux_sw_vis_dir,<sp/>ex_flux_sw_dif,<sp/>ex_delta_u,<sp/>ex_flux_sw_vis_dif,<sp/>ex_flux_lwd,<sp/>ex_delta_v,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2316"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_gex_atm2lnd,<sp/>n_gex_atm2lnd)<sp/>private(is,ie,n_gex)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2317"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>1,<sp/>my_nblocks</highlight></codeline>
<codeline lineno="2318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is<sp/>=<sp/>block_start(l)</highlight></codeline>
<codeline lineno="2319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie<sp/>=<sp/>block_end(l)</highlight></codeline>
<codeline lineno="2320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,<sp/>ie</highlight></codeline>
<codeline lineno="2321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_dir(i)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="2322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_vis_dir(i)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="2323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_dif(i)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="2324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_vis_dif(i)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="2325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_lwd(i)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="2326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_delta_u(i)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="2327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_delta_v(i)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="2328"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n_gex=1,n_gex_atm2lnd</highlight></codeline>
<codeline lineno="2330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,<sp/>ie</highlight></codeline>
<codeline lineno="2331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gex_atm2lnd(i,n_gex)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="2332"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>do</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2333"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>do</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2334"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2335"><highlight class="normal"></highlight></codeline>
<codeline lineno="2336"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%flux_sw_dir,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_dir,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="2337"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%flux_sw_vis_dir,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_vis_dir,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="2338"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%flux_sw_dif,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_dif,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="2339"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%flux_sw_vis_dif,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_vis_dif,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="2340"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%flux_sw_down_vis_dir,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_down_vis_dir,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="2341"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%flux_sw_down_total_dir,</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_down_total_dir,<sp/>xmap_sfc,complete=.false.)</highlight></codeline>
<codeline lineno="2342"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%flux_sw_down_vis_dif,</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_down_vis_dif,<sp/>xmap_sfc,complete=.false.)</highlight></codeline>
<codeline lineno="2343"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%flux_sw_down_total_dif,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,ex_flux_sw_down_total_dif,<sp/>xmap_sfc,complete=.false.)</highlight></codeline>
<codeline lineno="2344"><highlight class="normal"></highlight></codeline>
<codeline lineno="2345"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>ccc<sp/>=<sp/>conservation_check(Atm%lprec,<sp/>&apos;ATM&apos;,<sp/>xmap_sfc)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2346"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>if<sp/>(fms_mpp_pe()==<sp/>fms_mpp_root_pe())<sp/>print<sp/>*,&apos;LPREC&apos;,<sp/>ccc</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2347"><highlight class="normal"></highlight></codeline>
<codeline lineno="2348"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>if(do_area_weighted_flux)<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2349"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/>call<sp/>put_to_xgrid<sp/>(Atm%lprec<sp/>*<sp/>AREA_ATM_MODEL,<sp/><sp/><sp/>&apos;ATM&apos;,<sp/>ex_lprec,<sp/>xmap_sfc)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2350"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/>call<sp/>put_to_xgrid<sp/>(Atm%fprec<sp/>*<sp/>AREA_ATM_MODEL,<sp/><sp/><sp/>&apos;ATM&apos;,<sp/>ex_fprec,<sp/>xmap_sfc)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2351"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2352"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(atm%lprec,<sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_lprec,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="2353"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(atm%fprec,<sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_fprec,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="2354"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(atm%t_bot,<sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_tprec,<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="2355"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2356"><highlight class="normal"></highlight></codeline>
<codeline lineno="2357"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n_gex=1,n_gex_atm2lnd</highlight></codeline>
<codeline lineno="2358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%gex_atm2lnd(:,:,n_gex),</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,ex_gex_atm2lnd(:,n_gex),xmap_sfc,complete=.false.)</highlight></codeline>
<codeline lineno="2359"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>do</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2360"><highlight class="normal"></highlight></codeline>
<codeline lineno="2361"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%coszen,<sp/><sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_coszen,<sp/>xmap_sfc,<sp/>complete=.true.)</highlight></codeline>
<codeline lineno="2362"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%flux_lw,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_flux_lwd,<sp/>xmap_sfc,<sp/>remap_method=remap_method,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="2363"><highlight class="normal"></highlight></codeline>
<codeline lineno="2364"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>MOD<sp/>changed<sp/>the<sp/>following<sp/>two<sp/>lines<sp/>to<sp/>put<sp/>Atmos%surf_diff%delta_u<sp/>and<sp/>v</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2365"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>on<sp/>exchange<sp/>grid<sp/>instead<sp/>of<sp/>the<sp/>stresses<sp/>themselves<sp/>so<sp/>that<sp/>only<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2366"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>implicit<sp/>corrections<sp/>are<sp/>filtered<sp/>through<sp/>the<sp/>atmospheric<sp/>grid<sp/>not<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2367"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>stresses<sp/>themselves</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2368"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%Surf_Diff%delta_u,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_delta_u,<sp/>xmap_sfc,<sp/>remap_method=remap_method,<sp/>&amp;</highlight></codeline>
<codeline lineno="2369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>complete=.false.)</highlight></codeline>
<codeline lineno="2370"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%Surf_Diff%delta_v,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_delta_v,<sp/>xmap_sfc,<sp/>remap_method=remap_method,<sp/>&amp;</highlight></codeline>
<codeline lineno="2371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>complete=.true.)</highlight></codeline>
<codeline lineno="2372"><highlight class="normal"></highlight></codeline>
<codeline lineno="2373"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>end<sp/>map<sp/>atmospheric<sp/>quantities<sp/>on<sp/>exchange<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2374"><highlight class="normal"></highlight></codeline>
<codeline lineno="2376"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2377"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>MOD<sp/>update<sp/>stresses<sp/>using<sp/>atmos<sp/>delta&apos;s<sp/>but<sp/>derivatives<sp/>on<sp/>exchange<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2378"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>parallel<sp/>do<sp/>default(none)<sp/>shared(my_nblocks,<sp/>block_start,<sp/>block_end,<sp/>ex_flux_u,<sp/>ex_delta_u,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2379"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_dtaudu_atm,<sp/>ex_dtaudv_atm,<sp/>ex_flux_v,<sp/>ex_delta_v)<sp/>private(is,ie)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2380"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>1,<sp/>my_nblocks</highlight></codeline>
<codeline lineno="2381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is<sp/>=<sp/>block_start(l)</highlight></codeline>
<codeline lineno="2382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie<sp/>=<sp/>block_end(l)</highlight></codeline>
<codeline lineno="2383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,<sp/>ie</highlight></codeline>
<codeline lineno="2384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a5419fecfda33b11db1caab9042cf90c2" kindref="member">ex_flux_u</ref>(i)<sp/>=<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a5419fecfda33b11db1caab9042cf90c2" kindref="member">ex_flux_u</ref>(i)<sp/>+<sp/>ex_delta_u(i)*<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a4916ecd33588bcfbce81a5393f436671" kindref="member">ex_dtaudu_atm</ref>(i)</highlight></codeline>
<codeline lineno="2385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac27b58d41879537c39e4b8bc6eac83f8" kindref="member">ex_flux_v</ref>(i)<sp/>=<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac27b58d41879537c39e4b8bc6eac83f8" kindref="member">ex_flux_v</ref>(i)<sp/>+<sp/>ex_delta_v(i)*<ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae3ae41712484a6829639b4cd4431dab1" kindref="member">ex_dtaudv_atm</ref>(i)</highlight></codeline>
<codeline lineno="2386"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2387"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2388"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>end<sp/>update<sp/>u<sp/>and<sp/>v<sp/>stress<sp/>on<sp/>the<sp/>exchange<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2389"><highlight class="normal"></highlight></codeline>
<codeline lineno="2391"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2392"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!----<sp/>adjust<sp/>sw<sp/>flux<sp/>for<sp/>albedo<sp/>variations<sp/>on<sp/>exch<sp/>grid<sp/>----</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2393"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!----<sp/>adjust<sp/>4<sp/>categories<sp/>(vis/nir<sp/>dir/dif)<sp/>separately<sp/><sp/>----</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2394"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>parallel<sp/>do<sp/>default(none)<sp/>shared(my_nblocks,<sp/>block_start,<sp/>block_end,<sp/>ex_flux_sw_dir,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2395"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_flux_sw_vis_dir,<sp/>ex_albedo_nir_dir_fix,<sp/>ex_albedo_vis_dir_fix,<sp/>ex_flux_sw_dif,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2396"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_flux_sw_vis_dif,<sp/>ex_flux_sw_vis,<sp/>ex_flux_sw,<sp/>ex_albedo_nir_dif_fix,<sp/>ex_albedo_vis_dif_fix)&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2397"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>private(is,ie)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2398"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>1,<sp/>my_nblocks</highlight></codeline>
<codeline lineno="2399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is=block_start(l)</highlight></codeline>
<codeline lineno="2400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie=block_end(l)</highlight></codeline>
<codeline lineno="2401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,<sp/>ie</highlight></codeline>
<codeline lineno="2402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_dir(i)<sp/>=<sp/>ex_flux_sw_dir(i)<sp/>-<sp/>ex_flux_sw_vis_dir(i)<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>temporarily<sp/>nir/dir</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_dir(i)<sp/>=<sp/>ex_flux_sw_dir(i)<sp/>*<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a104be61b1aa14a50d997b6993b5274c9" kindref="member">ex_albedo_nir_dir_fix</ref>(i)<sp/><sp/></highlight><highlight class="comment">!<sp/>fix<sp/>nir/dir</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_vis_dir(i)<sp/>=<sp/>ex_flux_sw_vis_dir(i)<sp/>*<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aad98ee1a168521649429409b391b9762" kindref="member">ex_albedo_vis_dir_fix</ref>(i)<sp/></highlight><highlight class="comment">!<sp/>fix<sp/>vis/dir</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_dir(i)<sp/>=<sp/>ex_flux_sw_dir(i)<sp/>+<sp/>ex_flux_sw_vis_dir(i)<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>back<sp/>to<sp/>total<sp/>dir</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2406"><highlight class="normal"></highlight></codeline>
<codeline lineno="2407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_dif(i)<sp/>=<sp/>ex_flux_sw_dif(i)<sp/>-<sp/>ex_flux_sw_vis_dif(i)<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>temporarily<sp/>nir/dif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_dif(i)<sp/>=<sp/>ex_flux_sw_dif(i)<sp/>*<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a328257f3efd36a27514c76d5cf96c379" kindref="member">ex_albedo_nir_dif_fix</ref>(i)<sp/><sp/></highlight><highlight class="comment">!<sp/>fix<sp/>nir/dif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_vis_dif(i)<sp/>=<sp/>ex_flux_sw_vis_dif(i)<sp/>*<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aa10f4fb058cec37b5080747c92b38ccc" kindref="member">ex_albedo_vis_dif_fix</ref>(i)<sp/></highlight><highlight class="comment">!<sp/>fix<sp/>vis/dif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_dif(i)<sp/>=<sp/>ex_flux_sw_dif(i)<sp/>+<sp/>ex_flux_sw_vis_dif(i)<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>back<sp/>to<sp/>total<sp/>dif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2411"><highlight class="normal"></highlight></codeline>
<codeline lineno="2412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw_vis(i)<sp/>=<sp/>ex_flux_sw_vis_dir(i)<sp/>+<sp/>ex_flux_sw_vis_dif(i)<sp/></highlight><highlight class="comment">!<sp/>legacy,<sp/>remove<sp/>later</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_sw(i)<sp/><sp/><sp/><sp/><sp/>=<sp/>ex_flux_sw_dir(i)<sp/><sp/><sp/><sp/><sp/>+<sp/>ex_flux_sw_dif(i)<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>legacy,<sp/>remove<sp/>later</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2414"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2415"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2416"><highlight class="normal"></highlight></codeline>
<codeline lineno="2417"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>ex_flux_sw_dir<sp/>=<sp/>ex_flux_sw_dir<sp/>-<sp/>ex_flux_sw_vis_dir<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>temporarily<sp/>nir/dir</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2418"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>ex_flux_sw_dir<sp/>=<sp/>ex_flux_sw_dir<sp/>*<sp/>ex_albedo_nir_dir_fix<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>fix<sp/>nir/dir</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2419"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>ex_flux_sw_vis_dir<sp/>=<sp/>ex_flux_sw_vis_dir<sp/>*<sp/>ex_albedo_vis_dir_fix<sp/>!<sp/>fix<sp/>vis/dir</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2420"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>ex_flux_sw_dir<sp/>=<sp/>ex_flux_sw_dir<sp/>+<sp/>ex_flux_sw_vis_dir<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>back<sp/>to<sp/>total<sp/>dir</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2421"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2422"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>ex_flux_sw_dif<sp/>=<sp/>ex_flux_sw_dif<sp/>-<sp/>ex_flux_sw_vis_dif<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>temporarily<sp/>nir/dif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2423"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>ex_flux_sw_dif<sp/>=<sp/>ex_flux_sw_dif<sp/>*<sp/>ex_albedo_nir_dif_fix<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>fix<sp/>nir/dif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2424"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>ex_flux_sw_vis_dif<sp/>=<sp/>ex_flux_sw_vis_dif<sp/>*<sp/>ex_albedo_vis_dif_fix<sp/>!<sp/>fix<sp/>vis/dif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2425"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>ex_flux_sw_dif<sp/>=<sp/>ex_flux_sw_dif<sp/>+<sp/>ex_flux_sw_vis_dif<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>back<sp/>to<sp/>total<sp/>dif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2426"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2427"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>ex_flux_sw_vis<sp/>=<sp/>ex_flux_sw_vis_dir<sp/>+<sp/>ex_flux_sw_vis_dif<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>legacy,<sp/>remove<sp/>later</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2428"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>ex_flux_sw<sp/><sp/><sp/><sp/><sp/>=<sp/>ex_flux_sw_dir<sp/><sp/><sp/><sp/><sp/>+<sp/>ex_flux_sw_dif<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>legacy,<sp/>remove<sp/>later</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2429"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2430"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">deallocate</highlight><highlight class="normal"><sp/>(<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6ce3eaf605064a25d5cc1283e0e11276" kindref="member">ex_albedo_fix</ref><sp/>)</highlight></codeline>
<codeline lineno="2431"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">deallocate</highlight><highlight class="normal"><sp/>(<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aad98ee1a168521649429409b391b9762" kindref="member">ex_albedo_vis_dir_fix</ref><sp/>)</highlight></codeline>
<codeline lineno="2432"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">deallocate</highlight><highlight class="normal"><sp/>(<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a104be61b1aa14a50d997b6993b5274c9" kindref="member">ex_albedo_nir_dir_fix</ref><sp/>)</highlight></codeline>
<codeline lineno="2433"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">deallocate</highlight><highlight class="normal"><sp/>(<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aa10f4fb058cec37b5080747c92b38ccc" kindref="member">ex_albedo_vis_dif_fix</ref><sp/>)</highlight></codeline>
<codeline lineno="2434"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">deallocate</highlight><highlight class="normal"><sp/>(<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a328257f3efd36a27514c76d5cf96c379" kindref="member">ex_albedo_nir_dif_fix</ref><sp/>)</highlight></codeline>
<codeline lineno="2435"><highlight class="normal"></highlight></codeline>
<codeline lineno="2436"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>end<sp/>fix<sp/>short<sp/>wavelength<sp/>radiation<sp/>flux<sp/>on<sp/>the<sp/>exchange<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2437"><highlight class="normal"></highlight></codeline>
<codeline lineno="2438"><highlight class="normal"></highlight></codeline>
<codeline lineno="2440"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2441"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,n_exch_tr</highlight></codeline>
<codeline lineno="2442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n<sp/>=<sp/>tr_table(tr)%atm</highlight></codeline>
<codeline lineno="2443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(atm%Surf_Diff%delta_tr(:,:,n),<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_delta_tr(:,tr),<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="2444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(atm%Surf_Diff%dflux_tr(:,:,n),<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_dflux_tr(:,tr),<sp/>xmap_sfc,<sp/>complete=.false.)</highlight></codeline>
<codeline lineno="2445"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2446"><highlight class="normal"></highlight></codeline>
<codeline lineno="2447"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(atm%Surf_Diff%dtmass<sp/>,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_dtmass<sp/>,<sp/>xmap_sfc,<sp/>complete=.false.<sp/>)</highlight></codeline>
<codeline lineno="2448"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(atm%Surf_Diff%delta_t,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_delta_t,<sp/>xmap_sfc,<sp/>complete=.false.<sp/>)</highlight></codeline>
<codeline lineno="2449"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(atm%Surf_Diff%dflux_t,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_dflux_t,<sp/>xmap_sfc,<sp/>complete=.true.<sp/>)</highlight></codeline>
<codeline lineno="2450"><highlight class="normal"></highlight></codeline>
<codeline lineno="2451"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="2452"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Get<sp/>sedimentation<sp/>flux.<sp/>Has<sp/>to<sp/>be<sp/>here<sp/>(instead<sp/>of<sp/>sfc_boundary_layer<sp/>sub)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2453"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>because<sp/>of<sp/>time<sp/>stepping<sp/>order:<sp/>sedimentation<sp/>fluxes<sp/>are<sp/>calculated<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2454"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>update_atmos_model_down<sp/>(in<sp/>atmos_tracer_driver),<sp/>but<sp/>sfc_boundary_layer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2455"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>is<sp/>called<sp/>before<sp/>that.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2456"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,n_exch_tr</highlight></codeline>
<codeline lineno="2457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(atmos_tracer_has_surf_setl_flux(tr_table(tr)%atm))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">get_atmos_tracer_surf_setl_flux<sp/>(tr_table(tr)%atm,<sp/>setl_flux,<sp/>dsetl_dtr)</highlight></codeline>
<codeline lineno="2459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(setl_flux,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_setl_flux,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(dsetl_dtr,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_dsetl_dtr,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">where</highlight><highlight class="normal"><sp/>(ex_avail)</highlight></codeline>
<codeline lineno="2462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>minus<sp/>sign<sp/>is<sp/>because<sp/>sedimentation<sp/>is<sp/>positive<sp/>down</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_tr(:,tr)=<sp/>ex_flux_tr(:,tr)<sp/>-<sp/>ex_setl_flux(:)</highlight></codeline>
<codeline lineno="2464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dfdtr_atm(:,tr)<sp/>=<sp/>ex_dfdtr_atm(:,tr)<sp/>-<sp/>ex_dsetl_dtr(:)</highlight></codeline>
<codeline lineno="2465"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>where</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2466"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2467"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2468"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2469"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2470"><highlight class="normal"><sp/><sp/><sp/><sp/>cp_inv<sp/>=<sp/>1.0/cp_air</highlight></codeline>
<codeline lineno="2471"><highlight class="normal"></highlight></codeline>
<codeline lineno="2472"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>parallel<sp/>do<sp/>default(none)<sp/>shared(my_nblocks,<sp/>block_start,<sp/>block_end,<sp/>ex_flux_lw,<sp/>ex_flux_lwd,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2473"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_avail,<sp/>ex_gamma,<sp/>ex_dtmass,<sp/>ex_dflux_t,<sp/>ex_dhdt_atm,<sp/>cp_inv,<sp/>ex_e_t_n,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2474"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_dhdt_surf,ex_f_t_delt_n,ex_delta_t,<sp/>ex_flux_t,<sp/>ex_dflux_tr,<sp/>isphum,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2475"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_dfdtr_atm,<sp/>ex_e_q_n,<sp/>ex_dedt_surf,<sp/>n_exch_tr,<sp/>ex_e_tr_n,<sp/>ex_dfdtr_surf,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2476"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!$OMP<sp/>ex_f_tr_delt_n,<sp/>ex_delta_tr,<sp/>ex_flux_tr)<sp/>private(is,ie)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2477"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>1,<sp/>my_nblocks</highlight></codeline>
<codeline lineno="2478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is=block_start(l)</highlight></codeline>
<codeline lineno="2479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie=block_end(l)</highlight></codeline>
<codeline lineno="2480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,<sp/>ie</highlight></codeline>
<codeline lineno="2481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-----<sp/>compute<sp/>net<sp/>longwave<sp/>flux<sp/>(down-up)<sp/>-----</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>(note:<sp/>lw<sp/>up<sp/>already<sp/>in<sp/>ex_flux_lw)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af36a6c987c16a10e698b500396554130" kindref="member">ex_flux_lw</ref>(i)<sp/>=<sp/>ex_flux_lwd(i)<sp/>-<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af36a6c987c16a10e698b500396554130" kindref="member">ex_flux_lw</ref>(i)</highlight></codeline>
<codeline lineno="2484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ex_avail(i)<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>temperature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gamma(i)<sp/>=<sp/><sp/>1./<sp/>(1.0<sp/>-<sp/>ex_dtmass(i)*(ex_dflux_t(i)<sp/>+<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a04986e4dfe0871fb9b662597e47772bb" kindref="member">ex_dhdt_atm</ref>(i)*cp_inv))</highlight></codeline>
<codeline lineno="2487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_e_t_n(i)<sp/>=<sp/><sp/>ex_dtmass(i)*<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7a723109680791b32db1371f623f679d" kindref="member">ex_dhdt_surf</ref>(i)*cp_inv*ex_gamma(i)</highlight></codeline>
<codeline lineno="2488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_f_t_delt_n(i)<sp/>=<sp/>(ex_delta_t(i)<sp/>+<sp/>ex_dtmass(i)<sp/>*<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref>(i)*cp_inv)<sp/>*<sp/>ex_gamma(i)</highlight></codeline>
<codeline lineno="2489"><highlight class="normal"></highlight></codeline>
<codeline lineno="2490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref>(i)<sp/><sp/>=<sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref>(i)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a04986e4dfe0871fb9b662597e47772bb" kindref="member">ex_dhdt_atm</ref>(i)<sp/>*<sp/>ex_f_t_delt_n(i)</highlight></codeline>
<codeline lineno="2491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7a723109680791b32db1371f623f679d" kindref="member">ex_dhdt_surf</ref>(i)<sp/>=<sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7a723109680791b32db1371f623f679d" kindref="member">ex_dhdt_surf</ref>(i)<sp/><sp/><sp/><sp/><sp/>+<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a04986e4dfe0871fb9b662597e47772bb" kindref="member">ex_dhdt_atm</ref>(i)<sp/>*<sp/>ex_e_t_n(i)</highlight></codeline>
<codeline lineno="2492"><highlight class="normal"></highlight></codeline>
<codeline lineno="2493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>moisture</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/>ex_gamma<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><sp/>1./<sp/>(1.0<sp/>-<sp/>ex_dtmass*(ex_dflux_q<sp/>+<sp/>ex_dedq_atm))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>here<sp/>it<sp/>looks<sp/>like<sp/>two<sp/>derivatives<sp/>with<sp/>different<sp/>units<sp/>are<sp/>added<sp/>together,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>but<sp/>in<sp/>fact<sp/>they<sp/>are<sp/>not:<sp/>ex_dedt_surf<sp/>and<sp/>ex_dedq_surf<sp/>defined<sp/>in<sp/>complimentary</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>regions<sp/>of<sp/>exchange<sp/>grid,<sp/>so<sp/>that<sp/>if<sp/>one<sp/>of<sp/>them<sp/>is<sp/>not<sp/>zero<sp/>the<sp/>other<sp/>is,<sp/>and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>vice<sp/>versa.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/>ex_e_q_n<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><sp/>ex_dtmass*(ex_dedt_surf+ex_dedq_surf)<sp/>*<sp/>ex_gamma</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/>ex_f_q_delt_n<sp/>=<sp/>(ex_delta_q<sp/><sp/>+<sp/>ex_dtmass<sp/>*<sp/>ex_flux_q)<sp/>*<sp/>ex_gamma</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/>ex_flux_q<sp/><sp/><sp/><sp/><sp/>=<sp/><sp/>ex_flux_q<sp/><sp/><sp/><sp/>+<sp/>ex_dedq_atm<sp/>*<sp/>ex_f_q_delt_n</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/>ex_dedt_surf<sp/><sp/>=<sp/><sp/>ex_dedt_surf<sp/>+<sp/>ex_dedq_atm<sp/>*<sp/>ex_e_q_n</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/>ex_dedq_surf<sp/><sp/>=<sp/><sp/>ex_dedq_surf<sp/>+<sp/>ex_dedq_atm<sp/>*<sp/>ex_e_q_n</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>moisture<sp/>vs.<sp/>surface<sp/>temperture,<sp/>assuming<sp/>saturation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gamma(i)<sp/>=<sp/><sp/>1.0<sp/>/<sp/>(1.0<sp/>-<sp/>ex_dtmass(i)*(ex_dflux_tr(i,isphum)<sp/>+<sp/>ex_dfdtr_atm(i,isphum)))</highlight></codeline>
<codeline lineno="2506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a86ed92f16c0fb112e38dd6873ca4cded" kindref="member">ex_e_q_n</ref>(i)<sp/>=<sp/><sp/>ex_dtmass(i)<sp/>*<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a50b141a6a27c86e08632eb459f39324b" kindref="member">ex_dedt_surf</ref>(i)<sp/>*<sp/>ex_gamma(i)</highlight></codeline>
<codeline lineno="2507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a50b141a6a27c86e08632eb459f39324b" kindref="member">ex_dedt_surf</ref>(i)<sp/>=<sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a50b141a6a27c86e08632eb459f39324b" kindref="member">ex_dedt_surf</ref>(i)<sp/>+<sp/>ex_dfdtr_atm(i,isphum)<sp/>*<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a86ed92f16c0fb112e38dd6873ca4cded" kindref="member">ex_e_q_n</ref>(i)</highlight></codeline>
<codeline lineno="2508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,n_exch_tr</highlight></codeline>
<codeline lineno="2509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gamma(i)<sp/>=<sp/><sp/>1.0<sp/>/<sp/>(1.0<sp/>-<sp/>ex_dtmass(i)*(ex_dflux_tr(i,tr)<sp/>+<sp/>ex_dfdtr_atm(i,tr)))</highlight></codeline>
<codeline lineno="2510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_e_tr_n(i,tr)<sp/>=<sp/><sp/>ex_dtmass(i)*ex_dfdtr_surf(i,tr)*ex_gamma(i)</highlight></codeline>
<codeline lineno="2511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_f_tr_delt_n(i,tr)<sp/>=<sp/>(ex_delta_tr(i,tr)+ex_dtmass(i)*ex_flux_tr(i,tr))*ex_gamma(i)</highlight></codeline>
<codeline lineno="2512"><highlight class="normal"></highlight></codeline>
<codeline lineno="2513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_tr(i,tr)<sp/>=<sp/><sp/>ex_flux_tr(i,tr)<sp/>+<sp/>ex_dfdtr_atm(i,tr)*ex_f_tr_delt_n(i,tr)</highlight></codeline>
<codeline lineno="2514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dfdtr_surf(i,tr)<sp/><sp/>=<sp/><sp/>ex_dfdtr_surf(i,tr)<sp/>+<sp/>ex_dfdtr_atm(i,tr)*ex_e_tr_n(i,tr)</highlight></codeline>
<codeline lineno="2515"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2516"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2517"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2518"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2519"><highlight class="normal"></highlight></codeline>
<codeline lineno="2520"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>end<sp/>adjust<sp/>fluxes<sp/>for<sp/>implicit<sp/>dependence</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2521"><highlight class="normal"></highlight></codeline>
<codeline lineno="2523"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%t_flux,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2524"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%sw_flux,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2525"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%sw_flux_down_vis_dir,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_down_vis_dir,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2526"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%sw_flux_down_total_dir,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_down_total_dir,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2527"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%sw_flux_down_vis_dif,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_down_vis_dif,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2528"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%sw_flux_down_total_dif,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_down_total_dif,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2529"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%lw_flux,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af36a6c987c16a10e698b500396554130" kindref="member">ex_flux_lw</ref>,<sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2530"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>SCM</highlight></codeline>
<codeline lineno="2531"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_specified_land<sp/>.and.<sp/>do_specified_flux)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%dhdt,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_dhdt_surf_forland,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2533"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%dhdt,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7a723109680791b32db1371f623f679d" kindref="member">ex_dhdt_surf</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2535"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2536"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="2537"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%dhdt,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7a723109680791b32db1371f623f679d" kindref="member">ex_dhdt_surf</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2538"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2539"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%drdt,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aeba37d2c046170e4112311711809f620" kindref="member">ex_drdt_surf</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2540"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%p_surf,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af4fdc80a51f0145da4aa80a6317cc156" kindref="member">ex_p_surf</ref>,<sp/><sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2541"><highlight class="normal"></highlight></codeline>
<codeline lineno="2542"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%lprec,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_lprec,<sp/><sp/><sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2543"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%fprec,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_fprec,<sp/><sp/><sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2544"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%tprec,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_tprec,<sp/><sp/><sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2545"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>if(do_area_weighted_flux)<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2546"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/>!<sp/>evap<sp/>goes<sp/>here???</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2547"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/>do<sp/>k<sp/>=<sp/>1,<sp/>size(Land_boundary%lprec,<sp/>dim=3)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2548"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>Note:<sp/>we<sp/>divide<sp/>by<sp/>AREA_ATM_MODEL,<sp/>which<sp/>should<sp/>be<sp/>the<sp/>same<sp/>as</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2549"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<sp/>AREA_LND_MODEL<sp/>(but<sp/>the<sp/>latter<sp/>may<sp/>not<sp/>be<sp/>defined)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2550"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>call<sp/>divide_by_area(data=Land_boundary%lprec(:,:,k),<sp/>area=AREA_ATM_MODEL)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2551"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>call<sp/>divide_by_area(data=Land_boundary%fprec(:,:,k),<sp/>area=AREA_ATM_MODEL)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2552"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2553"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2554"><highlight class="normal"></highlight></codeline>
<codeline lineno="2555"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight><highlight class="keyword">associated</highlight><highlight class="normal">(land_boundary%drag_q))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%drag_q,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_drag_q,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;drag_q&apos;</highlight><highlight class="normal">,<sp/>land_boundary%drag_q,<sp/><sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2558"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2559"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight><highlight class="keyword">associated</highlight><highlight class="normal">(land_boundary%lwdn_flux))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%lwdn_flux,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_flux_lwd,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;lwdn_flux&apos;</highlight><highlight class="normal">,<sp/>land_boundary%lwdn_flux,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2562"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2563"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight><highlight class="keyword">associated</highlight><highlight class="normal">(land_boundary%cd_m))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%cd_m,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a26e0b81f6ed8473af88bdec4dda23c4b" kindref="member">ex_cd_m</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;cd_m&apos;</highlight><highlight class="normal">,<sp/>land_boundary%cd_m,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2566"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2567"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight><highlight class="keyword">associated</highlight><highlight class="normal">(land_boundary%cd_t))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%cd_t,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a1fc83cb6b523c05c9925f67c1bef77eb" kindref="member">ex_cd_t</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;cd_t&apos;</highlight><highlight class="normal">,<sp/>land_boundary%cd_t,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2570"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2571"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight><highlight class="keyword">associated</highlight><highlight class="normal">(land_boundary%bstar))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%bstar,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a0fd79bc7659c354908e2e6c325985544" kindref="member">ex_b_star</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;bstar&apos;</highlight><highlight class="normal">,<sp/><sp/>land_boundary%bstar,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2574"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2575"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight><highlight class="keyword">associated</highlight><highlight class="normal">(land_boundary%ustar))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%ustar,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3faddc34ad457fdb55533bead75ce7f0" kindref="member">ex_u_star</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;ustar&apos;</highlight><highlight class="normal">,<sp/><sp/>land_boundary%ustar,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2578"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2579"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight><highlight class="keyword">associated</highlight><highlight class="normal">(land_boundary%wind))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%wind,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ada77a5490b1ad25fa3ca68f3f81b9548" kindref="member">ex_wind</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;wind&apos;</highlight><highlight class="normal">,<sp/><sp/>land_boundary%wind,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2582"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2583"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight><highlight class="keyword">associated</highlight><highlight class="normal">(land_boundary%z_bot))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%z_bot,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a415a43eca092359dca12e46ac24bb0de" kindref="member">ex_z_atm</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;z_bot&apos;</highlight><highlight class="normal">,<sp/><sp/>land_boundary%z_bot,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2586"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2587"><highlight class="normal"></highlight></codeline>
<codeline lineno="2588"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">associated</highlight><highlight class="normal">(land_boundary%gex_atm2lnd))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n_gex=1,n_gex_atm2lnd</highlight></codeline>
<codeline lineno="2590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%gex_atm2lnd(:,:,n_gex),</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,ex_gex_atm2lnd(:,n_gex),xmap_sfc)</highlight></codeline>
<codeline lineno="2591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!add<sp/>data_override<sp/>here</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2592"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>do</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2593"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2594"><highlight class="normal"></highlight></codeline>
<codeline lineno="2595"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="2596"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">associated</highlight><highlight class="normal">(land_boundary%con_atm))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%con_atm,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a972ea1bb3939a7b1fed1e698b182de88" kindref="member">ex_con_atm</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2598"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2599"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2600"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2601"><highlight class="normal"><sp/><sp/><sp/><sp/>land_boundary%tr_flux<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="2602"><highlight class="normal"><sp/><sp/><sp/><sp/>land_boundary%dfdtr<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="2603"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,n_exch_tr</highlight></codeline>
<codeline lineno="2604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n<sp/>=<sp/>tr_table(tr)%lnd</highlight></codeline>
<codeline lineno="2605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(n<sp/>/=<sp/>no_tracer<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2606"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="2607"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%tr_flux(:,:,n),<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_flux_tr(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%dfdtr(:,:,n),<sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_dfdtr_surf(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2609"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="2610"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%tr_flux(:,:,:,n),<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_flux_tr(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%dfdtr(:,:,:,n),<sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_dfdtr_surf(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2612"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2613"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#ifdef<sp/>SCM</highlight></codeline>
<codeline lineno="2614"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_specified_land<sp/>.and.<sp/>do_specified_flux<sp/>.and.<sp/>tr.eq.isphum)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(land_boundary%dfdtr(:,:,n),<sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_dedq_surf_forland(:),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2616"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2617"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2618"><highlight class="preprocessor"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2619"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2620"><highlight class="normal"></highlight></codeline>
<codeline lineno="2621"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>map<sp/>fluxes<sp/>from<sp/>the<sp/>exchange<sp/>grid<sp/>to<sp/>the<sp/>land<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2622"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2624"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2625"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>current<sp/>time<sp/>is<sp/>Time:<sp/>is<sp/>that<sp/>ok?<sp/>not<sp/>available<sp/>in<sp/>land_data_type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2626"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Balaji:<sp/>data_override<sp/>calls<sp/>moved<sp/>here<sp/>from<sp/>coupler_main</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2627"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;t_flux&apos;</highlight><highlight class="normal">,<sp/><sp/>land_boundary%t_flux,<sp/>time)</highlight></codeline>
<codeline lineno="2628"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;lw_flux&apos;</highlight><highlight class="normal">,<sp/>land_boundary%lw_flux,<sp/>time)</highlight></codeline>
<codeline lineno="2629"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sw_flux&apos;</highlight><highlight class="normal">,<sp/>land_boundary%sw_flux,<sp/>time)</highlight></codeline>
<codeline lineno="2630"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sw_flux_down_vis_dir&apos;</highlight><highlight class="normal">,<sp/>land_boundary%sw_flux_down_vis_dir,<sp/>time)</highlight></codeline>
<codeline lineno="2631"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sw_flux_down_total_dir&apos;</highlight><highlight class="normal">,<sp/>land_boundary%sw_flux_down_total_dir,<sp/>time)</highlight></codeline>
<codeline lineno="2632"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sw_flux_down_vis_dif&apos;</highlight><highlight class="normal">,<sp/>land_boundary%sw_flux_down_vis_dif,<sp/>time)</highlight></codeline>
<codeline lineno="2633"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sw_flux_down_total_dif&apos;</highlight><highlight class="normal">,<sp/>land_boundary%sw_flux_down_total_dif,<sp/>time)</highlight></codeline>
<codeline lineno="2634"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;lprec&apos;</highlight><highlight class="normal">,<sp/>land_boundary%lprec,<sp/>time)</highlight></codeline>
<codeline lineno="2635"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;fprec&apos;</highlight><highlight class="normal">,<sp/>land_boundary%fprec,<sp/>time)</highlight></codeline>
<codeline lineno="2636"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;dhdt&apos;</highlight><highlight class="normal">,<sp/>land_boundary%dhdt,<sp/>time)</highlight></codeline>
<codeline lineno="2637"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;drdt&apos;</highlight><highlight class="normal">,<sp/>land_boundary%drdt,<sp/>time)</highlight></codeline>
<codeline lineno="2638"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;p_surf&apos;</highlight><highlight class="normal">,<sp/>land_boundary%p_surf,<sp/><sp/>time)</highlight></codeline>
<codeline lineno="2639"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,n_lnd_tr</highlight></codeline>
<codeline lineno="2640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(model_land,<sp/>tr,<sp/>tr_name)</highlight></codeline>
<codeline lineno="2641"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="2642"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>trim(tr_name)//</highlight><highlight class="stringliteral">&apos;_flux&apos;</highlight><highlight class="normal">,<sp/>land_boundary%tr_flux(:,:,tr),<sp/>time)</highlight></codeline>
<codeline lineno="2643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;dfd&apos;</highlight><highlight class="normal">//trim(tr_name),<sp/><sp/>land_boundary%dfdtr<sp/><sp/>(:,:,tr),<sp/>time)</highlight></codeline>
<codeline lineno="2644"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="2645"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>trim(tr_name)//</highlight><highlight class="stringliteral">&apos;_flux&apos;</highlight><highlight class="normal">,<sp/>land_boundary%tr_flux(:,:,:,tr),<sp/>time)</highlight></codeline>
<codeline lineno="2646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;dfd&apos;</highlight><highlight class="normal">//trim(tr_name),<sp/><sp/>land_boundary%dfdtr<sp/><sp/>(:,:,:,tr),<sp/>time)</highlight></codeline>
<codeline lineno="2647"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2648"><highlight class="preprocessor"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2649"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>end<sp/>override<sp/>land<sp/>fluxes<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2650"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2652"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2653"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%t_flux,<sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref>,<sp/><sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2654"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%q_flux,<sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_flux_tr(:,isphum),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2655"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%sw_flux_vis_dir,<sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_vis_dir,<sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2656"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%sw_flux_nir_dir,<sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_dir,xmap_sfc)</highlight></codeline>
<codeline lineno="2657"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>ice<sp/>&amp;<sp/>ocean<sp/>use<sp/>these<sp/>4:<sp/>dir/dif<sp/>nir/vis</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2658"><highlight class="normal"><sp/><sp/><sp/><sp/>ice_boundary%sw_flux_nir_dir<sp/>=<sp/>ice_boundary%sw_flux_nir_dir<sp/>-<sp/>ice_boundary%sw_flux_vis_dir</highlight></codeline>
<codeline lineno="2659"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%sw_flux_vis_dif,<sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_vis_dif,<sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2660"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%sw_flux_nir_dif,<sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_dif,xmap_sfc)</highlight></codeline>
<codeline lineno="2661"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>ice<sp/>&amp;<sp/>ocean<sp/>use<sp/>these<sp/>4:<sp/>dir/dif<sp/>nir/vis</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2662"><highlight class="normal"><sp/><sp/><sp/><sp/>ice_boundary%sw_flux_nir_dif<sp/>=<sp/>ice_boundary%sw_flux_nir_dif<sp/>-<sp/>ice_boundary%sw_flux_vis_dif</highlight></codeline>
<codeline lineno="2663"><highlight class="normal"></highlight></codeline>
<codeline lineno="2664"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%sw_down_vis_dir,<sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_down_vis_dir,<sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2665"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%sw_down_nir_dir,<sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_down_total_dir,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2666"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>ice<sp/>&amp;<sp/>ocean<sp/>use<sp/>these<sp/>4:<sp/>dir/dif<sp/>nir/vis</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2667"><highlight class="normal"><sp/><sp/><sp/><sp/>ice_boundary%sw_down_nir_dir<sp/>=<sp/>ice_boundary%sw_down_nir_dir<sp/>-<sp/>ice_boundary%sw_down_vis_dir</highlight></codeline>
<codeline lineno="2668"><highlight class="normal"></highlight></codeline>
<codeline lineno="2669"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%sw_down_vis_dif,<sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_down_vis_dif,<sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2670"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%sw_down_nir_dif,<sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_flux_sw_down_total_dif,xmap_sfc)</highlight></codeline>
<codeline lineno="2671"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>ice<sp/>&amp;<sp/>ocean<sp/>use<sp/>these<sp/>4:<sp/>dir/dif<sp/>nir/vis</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2672"><highlight class="normal"><sp/><sp/><sp/><sp/>ice_boundary%sw_down_nir_dif<sp/>=<sp/>ice_boundary%sw_down_nir_dif<sp/>-<sp/>ice_boundary%sw_down_vis_dif</highlight></codeline>
<codeline lineno="2673"><highlight class="normal"></highlight></codeline>
<codeline lineno="2674"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%lw_flux,<sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af36a6c987c16a10e698b500396554130" kindref="member">ex_flux_lw</ref>,<sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2675"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%dhdt,<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7a723109680791b32db1371f623f679d" kindref="member">ex_dhdt_surf</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2676"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%dedt,<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a50b141a6a27c86e08632eb459f39324b" kindref="member">ex_dedt_surf</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2677"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%drdt,<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aeba37d2c046170e4112311711809f620" kindref="member">ex_drdt_surf</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2678"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%u_flux,<sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a5419fecfda33b11db1caab9042cf90c2" kindref="member">ex_flux_u</ref>,<sp/><sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2679"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%v_flux,<sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac27b58d41879537c39e4b8bc6eac83f8" kindref="member">ex_flux_v</ref>,<sp/><sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2680"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%u_star,<sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3faddc34ad457fdb55533bead75ce7f0" kindref="member">ex_u_star</ref>,<sp/><sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2681"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%coszen,<sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_coszen,<sp/><sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2682"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%p,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae70d5c9a1a49eff91b2c14c1657103a6" kindref="member">ex_slp</ref>,<sp/><sp/><sp/><sp/><sp/><sp/><sp/>xmap_sfc)<sp/></highlight><highlight class="comment">!<sp/>mw<sp/>mod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2683"><highlight class="normal"></highlight></codeline>
<codeline lineno="2684"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%lprec,<sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_lprec,<sp/><sp/><sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2685"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%fprec,<sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_fprec,<sp/><sp/><sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2686"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>if<sp/>(do_area_weighted_flux)<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2687"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/>where<sp/>(AREA_ATM_SPHERE<sp/>/=<sp/>0)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2688"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice_boundary%lprec<sp/>=<sp/>Ice_boundary%lprec<sp/>*<sp/>AREA_ATM_MODEL/AREA_ATM_SPHERE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2689"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Ice_boundary%fprec<sp/>=<sp/>Ice_boundary%fprec<sp/>*<sp/>AREA_ATM_MODEL/AREA_ATM_SPHERE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2690"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/>end<sp/>where</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2691"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2692"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>if(do_area_weighted_flux)<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2693"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/>do<sp/>k<sp/>=<sp/>1,<sp/>size(Ice_boundary%lprec,<sp/>dim=3)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2694"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>call<sp/>divide_by_area(data=Ice_boundary%lprec(:,:,k),<sp/>area=AREA_ATM_SPHERE)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2695"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>call<sp/>divide_by_area(data=Ice_boundary%fprec(:,:,k),<sp/>area=AREA_ATM_SPHERE)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2696"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2697"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2698"><highlight class="normal"></highlight></codeline>
<codeline lineno="2699"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Extra<sp/>fluxes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2700"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>1,<sp/>ice_boundary%fluxes%num_bcs<sp/></highlight></codeline>
<codeline lineno="2701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(ex_gas_fluxes%bc(n)%flux_type<sp/><sp/>.ne.<sp/></highlight><highlight class="stringliteral">&apos;air_sea_deposition&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>m<sp/>=<sp/>1,<sp/>ice_boundary%fluxes%bc(n)%num_fields</highlight></codeline>
<codeline lineno="2703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(ice_boundary%fluxes%bc(n)%field(m)%values,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="2704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gas_fluxes%bc(n)%field(m)%values,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2705"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2706"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2707"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2708"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>end<sp/>map<sp/>ice<sp/>fields<sp/>from<sp/>the<sp/>exchange<sp/>grid<sp/>to<sp/>the<sp/>ice<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2709"><highlight class="normal"></highlight></codeline>
<codeline lineno="2711"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2712"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Balaji:<sp/>data_override<sp/>calls<sp/>moved<sp/>here<sp/>from<sp/>coupler_main</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2713"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;u_flux&apos;</highlight><highlight class="normal">,<sp/>ice_boundary%u_flux,<sp/>time)</highlight></codeline>
<codeline lineno="2714"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;v_flux&apos;</highlight><highlight class="normal">,<sp/>ice_boundary%v_flux,<sp/>time)</highlight></codeline>
<codeline lineno="2715"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;t_flux&apos;</highlight><highlight class="normal">,<sp/>ice_boundary%t_flux,<sp/>time)</highlight></codeline>
<codeline lineno="2716"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;q_flux&apos;</highlight><highlight class="normal">,<sp/>ice_boundary%q_flux,<sp/>time)</highlight></codeline>
<codeline lineno="2717"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;lw_flux&apos;</highlight><highlight class="normal">,ice_boundary%lw_flux,<sp/>time)</highlight></codeline>
<codeline lineno="2718"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;lw_flux_dn&apos;</highlight><highlight class="normal">,ice_boundary%lw_flux,<sp/>time,<sp/>override=ov)</highlight></codeline>
<codeline lineno="2719"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ov)<sp/>ice_boundary%lw_flux<sp/>=<sp/>ice_boundary%lw_flux<sp/>-<sp/>stefan*ice%t_surf**4</highlight></codeline>
<codeline lineno="2720"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sw_flux_nir_dir&apos;</highlight><highlight class="normal">,ice_boundary%sw_flux_nir_dir,<sp/>time)</highlight></codeline>
<codeline lineno="2721"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sw_flux_vis_dir&apos;</highlight><highlight class="normal">,ice_boundary%sw_flux_vis_dir,<sp/>time)</highlight></codeline>
<codeline lineno="2722"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sw_flux_nir_dif&apos;</highlight><highlight class="normal">,ice_boundary%sw_flux_nir_dif,<sp/>time,<sp/>override=ov)</highlight></codeline>
<codeline lineno="2723"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sw_flux_vis_dif&apos;</highlight><highlight class="normal">,ice_boundary%sw_flux_vis_dif,<sp/>time)</highlight></codeline>
<codeline lineno="2724"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sw_flux_vis_dir_dn&apos;</highlight><highlight class="normal">,ice_boundary%sw_down_vis_dir,<sp/>time,<sp/>override=ov)</highlight></codeline>
<codeline lineno="2725"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ov)<sp/>ice_boundary%sw_flux_vis_dir<sp/>=<sp/>ice_boundary%sw_down_vis_dir*(1.0-ice%albedo_vis_dir)</highlight></codeline>
<codeline lineno="2726"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sw_flux_vis_dif_dn&apos;</highlight><highlight class="normal">,ice_boundary%sw_down_vis_dif,<sp/>time,<sp/>override=ov)</highlight></codeline>
<codeline lineno="2727"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ov)<sp/>ice_boundary%sw_flux_vis_dif<sp/>=<sp/>ice_boundary%sw_down_vis_dif*(1.0-ice%albedo_vis_dif)</highlight></codeline>
<codeline lineno="2728"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sw_flux_nir_dir_dn&apos;</highlight><highlight class="normal">,ice_boundary%sw_down_nir_dir,<sp/>time,<sp/>override=ov)</highlight></codeline>
<codeline lineno="2729"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ov)<sp/>ice_boundary%sw_flux_nir_dir<sp/>=<sp/>ice_boundary%sw_down_nir_dir*(1.0-ice%albedo_nir_dir)</highlight></codeline>
<codeline lineno="2730"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sw_flux_nir_dif_dn&apos;</highlight><highlight class="normal">,ice_boundary%sw_down_nir_dif,<sp/>time,<sp/>override=ov)</highlight></codeline>
<codeline lineno="2731"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ov)<sp/>ice_boundary%sw_flux_nir_dif<sp/>=<sp/>ice_boundary%sw_down_nir_dif*(1.0-ice%albedo_nir_dif)</highlight></codeline>
<codeline lineno="2732"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;lprec&apos;</highlight><highlight class="normal">,<sp/>ice_boundary%lprec,<sp/>time)</highlight></codeline>
<codeline lineno="2733"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;fprec&apos;</highlight><highlight class="normal">,<sp/>ice_boundary%fprec,<sp/>time)</highlight></codeline>
<codeline lineno="2734"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;dhdt&apos;</highlight><highlight class="normal">,<sp/>ice_boundary%dhdt,<sp/>time)</highlight></codeline>
<codeline lineno="2735"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;dedt&apos;</highlight><highlight class="normal">,<sp/>ice_boundary%dedt,<sp/>time)</highlight></codeline>
<codeline lineno="2736"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;drdt&apos;</highlight><highlight class="normal">,<sp/>ice_boundary%drdt,<sp/>time)</highlight></codeline>
<codeline lineno="2737"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;coszen&apos;</highlight><highlight class="normal">,<sp/>ice_boundary%coszen,<sp/>time)</highlight></codeline>
<codeline lineno="2738"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;p&apos;</highlight><highlight class="normal">,<sp/>ice_boundary%p,<sp/>time)</highlight></codeline>
<codeline lineno="2739"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_coupler_type_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/>ice_boundary%fluxes,<sp/>time)</highlight></codeline>
<codeline lineno="2740"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_coupler_type_send_data(ice_boundary%fluxes,<sp/>time)</highlight></codeline>
<codeline lineno="2741"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>end<sp/>override<sp/>Ice<sp/>fields</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2742"><highlight class="normal"></highlight></codeline>
<codeline lineno="2744"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2745"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Atm<sp/>-&gt;<sp/>Lnd<sp/>(precip)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2746"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_stock_move_(<sp/>&amp;</highlight></codeline>
<codeline lineno="2747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>from<sp/>=<sp/>fms_stock_constants_atm_stock(istock_water),<sp/>&amp;</highlight></codeline>
<codeline lineno="2748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>to<sp/><sp/>=<sp/>fms_stock_constants_lnd_stock(istock_water),<sp/>&amp;</highlight></codeline>
<codeline lineno="2749"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="2750"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>stock_ug_data3d<sp/>=<sp/>(land_boundary%lprec<sp/>+<sp/>land_boundary%fprec),<sp/>&amp;</highlight></codeline>
<codeline lineno="2751"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="2752"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>stock_data3d<sp/>=<sp/>(land_boundary%lprec<sp/>+<sp/>land_boundary%fprec),<sp/>&amp;</highlight></codeline>
<codeline lineno="2753"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2754"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>grid_index=x1_grid_lnd,<sp/>&amp;</highlight></codeline>
<codeline lineno="2755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>xmap=xmap_sfc,<sp/>&amp;</highlight></codeline>
<codeline lineno="2756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>delta_t=dt_atm,<sp/>&amp;</highlight></codeline>
<codeline lineno="2757"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>from_side=istock_bottom,<sp/>to_side=istock_top,<sp/>&amp;</highlight></codeline>
<codeline lineno="2758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>radius=radius,<sp/>ier=ier,<sp/>verbose=</highlight><highlight class="stringliteral">&apos;stock<sp/>move<sp/>PRECIP<sp/>(Atm-&gt;Lnd)<sp/>&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="2759"><highlight class="normal"></highlight></codeline>
<codeline lineno="2760"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Atm<sp/>-&gt;<sp/>Lnd<sp/>(heat)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2761"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_stock_move_(<sp/>&amp;</highlight></codeline>
<codeline lineno="2762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>from<sp/>=<sp/>fms_stock_constants_atm_stock(istock_heat),<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="2763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>to<sp/>=<sp/>fms_stock_constants_lnd_stock(istock_heat),<sp/>&amp;</highlight></codeline>
<codeline lineno="2764"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="2765"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>stock_ug_data3d<sp/>=<sp/>&amp;</highlight></codeline>
<codeline lineno="2766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(-land_boundary%t_flux<sp/>+<sp/>land_boundary%lw_flux<sp/>+<sp/>land_boundary%sw_flux<sp/>-<sp/>land_boundary%fprec*hlf),<sp/>&amp;</highlight></codeline>
<codeline lineno="2767"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="2768"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>stock_data3d<sp/>=<sp/>&amp;</highlight></codeline>
<codeline lineno="2769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(-land_boundary%t_flux<sp/>+<sp/>land_boundary%lw_flux<sp/>+<sp/>land_boundary%sw_flux<sp/>-<sp/>land_boundary%fprec*hlf),<sp/>&amp;</highlight></codeline>
<codeline lineno="2770"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2771"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>grid_index=x1_grid_lnd,<sp/>&amp;</highlight></codeline>
<codeline lineno="2772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>xmap=xmap_sfc,<sp/>&amp;</highlight></codeline>
<codeline lineno="2773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>delta_t=dt_atm,<sp/>&amp;</highlight></codeline>
<codeline lineno="2774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>from_side=istock_bottom,<sp/>to_side=istock_top,<sp/>&amp;</highlight></codeline>
<codeline lineno="2775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>radius=radius,<sp/>ier=ier,<sp/>verbose=</highlight><highlight class="stringliteral">&apos;stock<sp/>move<sp/>HEAT<sp/>(Atm-&gt;Lnd)<sp/>&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="2776"><highlight class="normal"></highlight></codeline>
<codeline lineno="2777"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Atm<sp/>-&gt;<sp/>Ice<sp/>(precip)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2778"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_stock_move(<sp/>&amp;</highlight></codeline>
<codeline lineno="2779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>from<sp/>=<sp/>fms_stock_constants_atm_stock(istock_water),<sp/>&amp;</highlight></codeline>
<codeline lineno="2780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>to<sp/><sp/>=<sp/>fms_stock_constants_ice_stock(istock_water),<sp/>&amp;</highlight></codeline>
<codeline lineno="2781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>stock_data3d<sp/>=<sp/>(ice_boundary%lprec<sp/>+<sp/>ice_boundary%fprec),<sp/>&amp;</highlight></codeline>
<codeline lineno="2782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>grid_index=x1_grid_ice,<sp/>&amp;</highlight></codeline>
<codeline lineno="2783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>xmap=xmap_sfc,<sp/>&amp;</highlight></codeline>
<codeline lineno="2784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>delta_t=dt_atm,<sp/>&amp;</highlight></codeline>
<codeline lineno="2785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>from_side=istock_bottom,<sp/>to_side=istock_top,<sp/>&amp;</highlight></codeline>
<codeline lineno="2786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>radius=radius,<sp/>ier=ier,<sp/>verbose=</highlight><highlight class="stringliteral">&apos;stock<sp/>move<sp/>PRECIP<sp/>(Atm-&gt;Ice)<sp/>&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="2787"><highlight class="normal"></highlight></codeline>
<codeline lineno="2788"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Atm<sp/>-&gt;<sp/>Ice<sp/>(heat)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2789"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_stock_move(<sp/>&amp;</highlight></codeline>
<codeline lineno="2790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>from<sp/>=<sp/>fms_stock_constants_atm_stock(istock_heat),<sp/>&amp;</highlight></codeline>
<codeline lineno="2791"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>to<sp/><sp/>=<sp/>fms_stock_constants_ice_stock(istock_heat),<sp/>&amp;</highlight></codeline>
<codeline lineno="2792"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>stock_data3d<sp/>=<sp/>&amp;</highlight></codeline>
<codeline lineno="2793"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(-ice_boundary%t_flux<sp/>+<sp/>ice_boundary%lw_flux<sp/>-<sp/>ice_boundary%fprec*hlf<sp/>+<sp/>ice_boundary%sw_flux_vis_dir<sp/>+<sp/>&amp;</highlight></codeline>
<codeline lineno="2794"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ice_boundary%sw_flux_vis_dif<sp/>+<sp/>ice_boundary%sw_flux_nir_dir<sp/>+<sp/>ice_boundary%sw_flux_nir_dif),<sp/>&amp;</highlight></codeline>
<codeline lineno="2795"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>grid_index=x1_grid_ice,<sp/>&amp;</highlight></codeline>
<codeline lineno="2796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>xmap=xmap_sfc,<sp/>&amp;</highlight></codeline>
<codeline lineno="2797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>delta_t=dt_atm,<sp/>&amp;</highlight></codeline>
<codeline lineno="2798"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>from_side=istock_bottom,<sp/>to_side=istock_top,<sp/>&amp;</highlight></codeline>
<codeline lineno="2799"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>radius=radius,<sp/>ier=ier,<sp/>verbose=</highlight><highlight class="stringliteral">&apos;stock<sp/>move<sp/>HEAT<sp/>(Atm-&gt;Ice)<sp/>&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="2800"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>end<sp/>copute<sp/>stock<sp/>exchange<sp/>between<sp/>components</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2801"><highlight class="normal"></highlight></codeline>
<codeline lineno="2802"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">deallocate</highlight><highlight class="normal">(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a5419fecfda33b11db1caab9042cf90c2" kindref="member">ex_flux_u</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac27b58d41879537c39e4b8bc6eac83f8" kindref="member">ex_flux_v</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a4916ecd33588bcfbce81a5393f436671" kindref="member">ex_dtaudu_atm</ref>,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae3ae41712484a6829639b4cd4431dab1" kindref="member">ex_dtaudv_atm</ref>)</highlight></codeline>
<codeline lineno="2803"><highlight class="normal"></highlight></codeline>
<codeline lineno="2804"><highlight class="normal"></highlight></codeline>
<codeline lineno="2807"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2808"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>zonal<sp/>wind<sp/>stress<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2809"><highlight class="normal"><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_u_flux,<sp/>atmos_boundary%u_flux,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2810"><highlight class="normal"><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_tauu,<sp/><sp/>-atmos_boundary%u_flux,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2811"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2812"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>meridional<sp/>wind<sp/>stress<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2813"><highlight class="normal"><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_v_flux,<sp/>atmos_boundary%v_flux,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2814"><highlight class="normal"><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_tauv,<sp/><sp/>-atmos_boundary%v_flux,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="2815"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>end<sp/>send<sp/>data<sp/>to<sp/>diag_mana<sp/>ger</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2816"><highlight class="normal"></highlight></codeline>
<codeline lineno="2818"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Balaji</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2819"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_end(fluxatmdnclock)</highlight></codeline>
<codeline lineno="2820"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_end(cplclock)</highlight></codeline>
<codeline lineno="2821"><highlight class="normal"></highlight></codeline>
<codeline lineno="2822"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a377e367901950e4541859f65655b6f38" kindref="member">flux_down_from_atmos</ref></highlight></codeline>
<codeline lineno="2823"><highlight class="normal"></highlight></codeline>
<codeline lineno="2828"><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae90760b8fd57a82bc54db9ece86486ba" kindref="member">generate_sfc_xgrid</ref>(Land,<sp/>Ice)</highlight></codeline>
<codeline lineno="2829"><highlight class="normal"></highlight></codeline>
<codeline lineno="2830"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">implicit<sp/>none</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2831"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(land_data_type),<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>Land</highlight></codeline>
<codeline lineno="2832"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">Type</highlight><highlight class="normal">(Ice_Data_Type),<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>Ice</highlight></codeline>
<codeline lineno="2833"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2834"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>isc,<sp/>iec,<sp/>jsc,<sp/>jec<sp/></highlight><highlight class="comment">!compute<sp/>domain<sp/>indices</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2835"><highlight class="normal"></highlight></codeline>
<codeline lineno="2836"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Balaji</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2837"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_begin(cplclock)</highlight></codeline>
<codeline lineno="2838"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_begin(regenclock)</highlight></codeline>
<codeline lineno="2839"><highlight class="normal"></highlight></codeline>
<codeline lineno="2840"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_get_compute_domain(ice%Domain,<sp/>isc,<sp/>iec,<sp/>jsc,<sp/>jec)</highlight></codeline>
<codeline lineno="2841"><highlight class="normal"></highlight></codeline>
<codeline lineno="2843"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2844"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_set_frac_area(ice%part_size(isc:iec,jsc:jec,:)<sp/>,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2845"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_set_frac_area_(land%tile_size,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2846"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2847"><highlight class="normal"></highlight></codeline>
<codeline lineno="2849"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2850"><highlight class="normal"><sp/><sp/><sp/><sp/>n_xgrid_sfc<sp/>=<sp/>max(fms_xgrid_count(xmap_sfc),1)</highlight></codeline>
<codeline lineno="2851"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(n_xgrid_sfc<sp/>.ge.<sp/>nblocks)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2852"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>my_nblocks<sp/>=<sp/>nblocks</highlight></codeline>
<codeline lineno="2853"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_domains_compute_extent(1,<sp/>n_xgrid_sfc,<sp/>nblocks,<sp/>block_start,<sp/>block_end)</highlight></codeline>
<codeline lineno="2854"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2855"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>my_nblocks<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="2856"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>block_start(1)<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="2857"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>block_end(1)<sp/>=<sp/>n_xgrid_sfc</highlight></codeline>
<codeline lineno="2858"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2859"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2860"><highlight class="normal"></highlight></codeline>
<codeline lineno="2861"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Balaji</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2862"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_end(regenclock)</highlight></codeline>
<codeline lineno="2863"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_end(cplclock)</highlight></codeline>
<codeline lineno="2864"><highlight class="normal"></highlight></codeline>
<codeline lineno="2865"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae90760b8fd57a82bc54db9ece86486ba" kindref="member">generate_sfc_xgrid</ref></highlight></codeline>
<codeline lineno="2866"><highlight class="normal"></highlight></codeline>
<codeline lineno="2867"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!#######################################################################</highlight></codeline>
<codeline lineno="2883"><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a9ff1868e71257630777ac2d9c8b6180c" kindref="member">flux_up_to_atmos</ref><sp/>(<sp/>Time,<sp/>Land,<sp/>Ice,<sp/>Land_Ice_Atmos_Boundary,<sp/>Land_boundary,<sp/>Ice_boundary<sp/>)</highlight></codeline>
<codeline lineno="2884"><highlight class="normal"></highlight></codeline>
<codeline lineno="2885"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">implicit<sp/>none</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2886"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsTime_type),<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>Time</highlight></codeline>
<codeline lineno="2887"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2888"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(land_data_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>Land</highlight></codeline>
<codeline lineno="2889"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2890"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(ice_data_type),<sp/><sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>Ice</highlight></codeline>
<codeline lineno="2891"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2892"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(land_ice_atmos_boundary_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>Land_Ice_Atmos_Boundary</highlight></codeline>
<codeline lineno="2893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2894"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_land_boundary_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>Land_boundary</highlight></codeline>
<codeline lineno="2895"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2896"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_ice_boundary_type),<sp/><sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>Ice_boundary</highlight></codeline>
<codeline lineno="2897"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2898"><highlight class="normal"></highlight></codeline>
<codeline lineno="2899"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(n_xgrid_sfc)</highlight><highlight class="normal"><sp/>::<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="2900"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_t_surf_new,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>new<sp/>surface<sp/>temperature<sp/>on<sp/>the<sp/>exchange<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2901"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dt_t_surf,<sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2902"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_delta_t_n,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="2903"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_t_ca_new,<sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="2904"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dt_t_ca,<sp/><sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="2905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_icetemp,<sp/><sp/><sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="2906"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_land_frac,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="2907"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_temp</highlight></codeline>
<codeline lineno="2908"><highlight class="normal"></highlight></codeline>
<codeline lineno="2909"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(n_xgrid_sfc,n_exch_tr)</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="2910"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_surf_new,<sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>updated<sp/>tracer<sp/>values<sp/>at<sp/>the<sp/>surface</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2911"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dt_tr_surf,<sp/><sp/>&amp;<sp/></highlight><highlight class="comment">!<sp/>tendency<sp/>of<sp/>tracers<sp/>at<sp/>the<sp/>surface</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2912"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_delta_tr_n</highlight></codeline>
<codeline lineno="2913"><highlight class="normal"></highlight></codeline>
<codeline lineno="2914"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>jgj:<sp/>added<sp/>for<sp/>co2_surf<sp/>diagnostic,<sp/>where<sp/>co2_surf_dvmr<sp/>is<sp/>the<sp/>updated<sp/>CO2<sp/>tracer<sp/>values<sp/>at<sp/>the<sp/>surface<sp/>(dry<sp/>vmr)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2915"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(n_xgrid_sfc)</highlight><highlight class="normal"><sp/>::<sp/>ex_co2_surf_dvmr<sp/><sp/></highlight></codeline>
<codeline lineno="2916"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2917"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(size(Land_Ice_Atmos_Boundary%dt_t,1),size(Land_Ice_Atmos_Boundary%dt_t,2))</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="2918"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>diag_atm,<sp/>&amp;</highlight></codeline>
<codeline lineno="2919"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evap_atm,<sp/>&amp;</highlight></codeline>
<codeline lineno="2920"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>frac_atm</highlight></codeline>
<codeline lineno="2921"><highlight class="normal"></highlight></codeline>
<codeline lineno="2922"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="2923"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(size(Land_boundary%lprec,1),<sp/>size(Land_boundary%lprec,2))</highlight><highlight class="normal"><sp/>::<sp/>data_lnd,<sp/>diag_land</highlight></codeline>
<codeline lineno="2924"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="2925"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(size(Land_boundary%lprec,1),<sp/>size(Land_boundary%lprec,2),<sp/>size(Land_boundary%lprec,3))</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="2926"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data_lnd,<sp/>diag_land</highlight></codeline>
<codeline lineno="2927"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2928"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(size(Ice_boundary%lprec,1),<sp/>size(Ice_boundary%lprec,2),<sp/>size(Ice_boundary%lprec,3))</highlight><highlight class="normal"><sp/>::<sp/>data_ice</highlight></codeline>
<codeline lineno="2929"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(size(Ice%albedo,1),size(Ice%albedo,2),size(Ice%albedo,3))</highlight><highlight class="normal"><sp/>::<sp/><sp/>icegrid</highlight></codeline>
<codeline lineno="2930"><highlight class="normal"></highlight></codeline>
<codeline lineno="2931"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>used</highlight></codeline>
<codeline lineno="2932"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>tr<sp/><sp/></highlight><highlight class="comment">!<sp/>tracer<sp/>index</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2933"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">character(32)</highlight><highlight class="normal"><sp/>::<sp/>tr_name,<sp/>tr_units<sp/></highlight><highlight class="comment">!<sp/>tracer<sp/>name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2934"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>n,<sp/>i,<sp/>m,<sp/>ier</highlight></codeline>
<codeline lineno="2935"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>is,<sp/>ie,<sp/>l</highlight></codeline>
<codeline lineno="2936"><highlight class="normal"></highlight></codeline>
<codeline lineno="2937"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Balaji</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2938"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_begin(cplclock)</highlight></codeline>
<codeline lineno="2939"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_begin(fluxatmupclock)</highlight></codeline>
<codeline lineno="2940"><highlight class="normal"></highlight></codeline>
<codeline lineno="2943"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2944"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Balaji:<sp/>data_override<sp/>calls<sp/>moved<sp/>here<sp/>from<sp/>coupler_main</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2945"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;t_surf&apos;</highlight><highlight class="normal">,<sp/>ice%t_surf,<sp/><sp/>time)</highlight></codeline>
<codeline lineno="2946"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;t_ca&apos;</highlight><highlight class="normal">,<sp/>land%t_ca,<sp/>time)</highlight></codeline>
<codeline lineno="2947"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;t_surf&apos;</highlight><highlight class="normal">,<sp/>land%t_surf,<sp/>time)</highlight></codeline>
<codeline lineno="2948"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,<sp/>n_lnd_tr</highlight></codeline>
<codeline lineno="2949"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(<sp/>model_land,<sp/>tr,<sp/>tr_name<sp/>)</highlight></codeline>
<codeline lineno="2950"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="2951"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>trim(tr_name)//</highlight><highlight class="stringliteral">&apos;_surf&apos;</highlight><highlight class="normal">,<sp/>land%tr(:,:,tr),<sp/>time)</highlight></codeline>
<codeline lineno="2952"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="2953"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override_(</highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>trim(tr_name)//</highlight><highlight class="stringliteral">&apos;_surf&apos;</highlight><highlight class="normal">,<sp/>land%tr(:,:,:,tr),<sp/>time)</highlight></codeline>
<codeline lineno="2954"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2955"><highlight class="preprocessor"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2956"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2957"><highlight class="normal"></highlight></codeline>
<codeline lineno="2959"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2960"><highlight class="normal"><sp/><sp/><sp/><sp/>ex_t_surf_new<sp/>=<sp/>200.0</highlight></codeline>
<codeline lineno="2961"><highlight class="normal"></highlight></codeline>
<codeline lineno="2962"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(ice%t_surf,<sp/><sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_t_surf_new,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2963"><highlight class="normal"><sp/><sp/><sp/><sp/>ex_t_ca_new<sp/>=<sp/>ex_t_surf_new<sp/><sp/></highlight><highlight class="comment">!<sp/>since<sp/>it<sp/>is<sp/>the<sp/>same<sp/>thing<sp/>over<sp/>oceans</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2964"><highlight class="normal"></highlight></codeline>
<codeline lineno="2965"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_<sp/>(land%t_ca,<sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_t_ca_new,<sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2966"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_<sp/>(land%t_surf,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_t_surf_new,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="2967"><highlight class="normal"></highlight></codeline>
<codeline lineno="2968"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>call<sp/>escomp(ex_t_ca_new,<sp/>ex_q_surf_new)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2969"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>ex_q_surf_new<sp/><sp/>=<sp/>d622*ex_q_surf_new/(ex_p_surf-d378*ex_q_surf_new)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2970"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>call<sp/>put_to_xgrid<sp/>(Land%q_ca,<sp/>&apos;LND&apos;,<sp/>ex_q_surf_new,<sp/>xmap_sfc)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2971"><highlight class="normal"></highlight></codeline>
<codeline lineno="2972"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>SCM</highlight></codeline>
<codeline lineno="2973"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_specified_flux<sp/>.and.<sp/>do_specified_land)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2974"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_t_surf_new<sp/>=<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref></highlight></codeline>
<codeline lineno="2975"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_t_ca_new<sp/><sp/><sp/>=<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref></highlight></codeline>
<codeline lineno="2976"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2977"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="2978"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2979"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>1,<sp/>my_nblocks</highlight></codeline>
<codeline lineno="2980"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is<sp/>=<sp/>block_start(l)</highlight></codeline>
<codeline lineno="2981"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie<sp/>=<sp/>block_end(l)</highlight></codeline>
<codeline lineno="2982"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,<sp/>ie</highlight></codeline>
<codeline lineno="2983"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(ex_avail(i))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2984"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dt_t_ca(i)<sp/>=<sp/>ex_t_ca_new(i)<sp/>-<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref>(i)<sp/></highlight><highlight class="comment">!<sp/>changes<sp/>in<sp/>near-surface<sp/>T</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2985"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dt_t_surf(i)<sp/>=<sp/>ex_t_surf_new(i)<sp/>-<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref>(i)<sp/></highlight><highlight class="comment">!<sp/>changes<sp/>in<sp/>radiative<sp/>T</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2986"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2987"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2988"><highlight class="normal"></highlight></codeline>
<codeline lineno="2989"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(do_forecast)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2990"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,<sp/>ie</highlight></codeline>
<codeline lineno="2991"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(ex_avail(i)<sp/>.and.<sp/>(.not.ex_land(i)))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2992"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dt_t_ca(i)<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="2993"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dt_t_surf(i)<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="2994"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2995"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2996"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2997"><highlight class="normal"></highlight></codeline>
<codeline lineno="2998"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>END<sp/>COMPUTE<sp/>CHANGE<sp/>IN<sp/>SURFACE<sp/>TEMPERATURE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2999"><highlight class="normal"></highlight></codeline>
<codeline lineno="3001"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3002"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,n_exch_tr</highlight></codeline>
<codeline lineno="3003"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>set<sp/>up<sp/>updated<sp/>surface<sp/>tracer<sp/>field<sp/>so<sp/>that<sp/>flux<sp/>to<sp/>atmos<sp/>for<sp/>absent</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3004"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>tracers<sp/>is<sp/>zero</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3005"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,ie</highlight></codeline>
<codeline lineno="3006"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(.not.ex_avail(i))<sp/>cycle</highlight></codeline>
<codeline lineno="3007"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ex_dfdtr_surf(i,tr)/=0.0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3008"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dt_tr_surf(i,tr)<sp/>=<sp/>-ex_flux_tr(i,tr)/ex_dfdtr_surf(i,tr)</highlight></codeline>
<codeline lineno="3009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3010"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dt_tr_surf(i,tr)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="3011"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_surf_new(i,tr)<sp/>=<sp/>ex_tr_surf(i,tr)+ex_dt_tr_surf(i,tr)</highlight></codeline>
<codeline lineno="3013"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3014"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3015"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3016"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>get<sp/>all<sp/>tracers<sp/>available<sp/>from<sp/>land,<sp/>and<sp/>calculate<sp/>changes<sp/>in<sp/>near-tracer<sp/>field</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3017"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,n_exch_tr</highlight></codeline>
<codeline lineno="3018"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n<sp/>=<sp/>tr_table(tr)%lnd</highlight></codeline>
<codeline lineno="3019"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(n<sp/>/=<sp/>no_tracer<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3020"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="3021"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%tr(:,:,n),<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_tr_surf_new(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3022"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="3023"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(land%tr(:,:,:,n),<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_tr_surf_new(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3024"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3025"><highlight class="preprocessor"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3026"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3027"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>END<sp/>UPDATE<sp/>FLUXES<sp/>AND<sp/>ATMOSPHERIC<sp/>INCREMENTS<sp/>FOR<sp/>IMPLICIT<sp/>DEPENDENCE<sp/>ON<sp/>SURFACE<sp/>TEMPERATURE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3028"><highlight class="normal"></highlight></codeline>
<codeline lineno="3029"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>get<sp/>all<sp/>tracers<sp/>available<sp/>from<sp/>ocean<sp/>here</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3030"><highlight class="normal"></highlight></codeline>
<codeline lineno="3032"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3033"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>1,<sp/>my_nblocks</highlight></codeline>
<codeline lineno="3034"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is<sp/>=<sp/>block_start(l)</highlight></codeline>
<codeline lineno="3035"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie<sp/>=<sp/>block_end(l)</highlight></codeline>
<codeline lineno="3036"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,n_exch_tr</highlight></codeline>
<codeline lineno="3037"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,<sp/>ie</highlight></codeline>
<codeline lineno="3038"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(ex_avail(i))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3039"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dt_tr_surf(i,tr)<sp/>=<sp/>ex_tr_surf_new(i,tr)<sp/>-<sp/>ex_tr_surf(i,tr)</highlight></codeline>
<codeline lineno="3040"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_delta_tr_n(i,tr)<sp/>=<sp/>ex_f_tr_delt_n(i,tr)<sp/>+<sp/>ex_dt_tr_surf(i,tr)<sp/>*<sp/>ex_e_tr_n(i,tr)</highlight></codeline>
<codeline lineno="3041"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_tr(i,tr)<sp/>=<sp/>ex_flux_tr(i,tr)<sp/>+<sp/>ex_dt_tr_surf(i,tr)<sp/>*<sp/>ex_dfdtr_surf(i,tr)</highlight></codeline>
<codeline lineno="3042"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3043"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3044"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3045"><highlight class="normal"></highlight></codeline>
<codeline lineno="3046"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>re-calculate<sp/>fluxes<sp/>of<sp/>specific<sp/>humidity<sp/>over<sp/>ocean</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3047"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,<sp/>ie</highlight></codeline>
<codeline lineno="3048"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(ex_avail(i)<sp/>.and.<sp/>(.not.ex_land(i)))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3049"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>note<sp/>that<sp/>in<sp/>this<sp/>region<sp/>(over<sp/>ocean)<sp/>ex_dt_t_surf<sp/>==<sp/>ex_dt_t_ca</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3050"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_delta_tr_n(i,isphum)<sp/>=<sp/>ex_f_tr_delt_n(i,isphum)<sp/>+<sp/>ex_dt_t_surf(i)<sp/>*<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a86ed92f16c0fb112e38dd6873ca4cded" kindref="member">ex_e_q_n</ref>(i)</highlight></codeline>
<codeline lineno="3051"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_tr(i,isphum)<sp/>=<sp/>ex_flux_tr(i,isphum)<sp/>+<sp/>ex_dt_t_surf(i)<sp/>*<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a50b141a6a27c86e08632eb459f39324b" kindref="member">ex_dedt_surf</ref>(i)</highlight></codeline>
<codeline lineno="3052"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3053"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3054"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3055"><highlight class="normal"></highlight></codeline>
<codeline lineno="3056"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr=1,n_exch_tr</highlight></codeline>
<codeline lineno="3057"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>get<sp/>updated<sp/>tracer<sp/>tendency<sp/>on<sp/>the<sp/>atmospheic<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3058"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n<sp/>=<sp/>tr_table(tr)%atm</highlight></codeline>
<codeline lineno="3059"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(land_ice_atmos_boundary%dt_tr(:,:,n),<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_delta_tr_n(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3060"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3061"><highlight class="normal"></highlight></codeline>
<codeline lineno="3062"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>1,<sp/>my_nblocks</highlight></codeline>
<codeline lineno="3063"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is<sp/>=<sp/>block_start(l)</highlight></codeline>
<codeline lineno="3064"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ie<sp/>=<sp/>block_end(l)</highlight></codeline>
<codeline lineno="3065"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>is,<sp/>ie</highlight></codeline>
<codeline lineno="3066"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_delta_t_n(i)<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="3067"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(ex_avail(i))<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3068"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref>(i)<sp/>=<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref>(i)<sp/>+<sp/>ex_dt_t_ca(i)<sp/>*<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7a723109680791b32db1371f623f679d" kindref="member">ex_dhdt_surf</ref>(i)</highlight></codeline>
<codeline lineno="3069"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af36a6c987c16a10e698b500396554130" kindref="member">ex_flux_lw</ref>(i)<sp/>=<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af36a6c987c16a10e698b500396554130" kindref="member">ex_flux_lw</ref>(i)<sp/>-<sp/>ex_dt_t_surf(i)<sp/>*<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aeba37d2c046170e4112311711809f620" kindref="member">ex_drdt_surf</ref>(i)</highlight></codeline>
<codeline lineno="3070"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_delta_t_n(i)<sp/>=<sp/>ex_f_t_delt_n(i)<sp/><sp/>+<sp/>ex_dt_t_ca(i)<sp/>*<sp/>ex_e_t_n(i)</highlight></codeline>
<codeline lineno="3071"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3072"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3073"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3074"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>END<sp/>UPDATE<sp/>TRACER<sp/>TENDENCIES<sp/>IN<sp/>THE<sp/>ATMOSPHERE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3075"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3077"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3078"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(land_ice_atmos_boundary%dt_t,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_delta_t_n,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3079"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="3080"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(land_ice_atmos_boundary%shflx,</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref><sp/><sp/><sp/><sp/>,<sp/>xmap_sfc)<sp/></highlight><highlight class="comment">!miz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3081"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(land_ice_atmos_boundary%lhflx,</highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_flux_tr(:,isphum),<sp/>xmap_sfc)</highlight><highlight class="comment">!miz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3082"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3083"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>END<sp/>MAP<sp/>MEAN<sp/>QUANITTIES<sp/>FROM<sp/>THE<sp/>EXCHANGE<sp/>GRID<sp/>TO<sp/>THE<sp/>ATMOSPHERE<sp/>GRID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3084"><highlight class="normal"></highlight></codeline>
<codeline lineno="3085"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3088"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3089"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="3090"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_t_surf<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3091"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_t_surf_new,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3092"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(id_t_surf,<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3093"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3094"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="3095"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_t_surf_new,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3096"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_t_surf<sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>fms_diag_send_data(id_t_surf,<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3097"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_ts<sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>fms_diag_send_data(id_ts,<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3098"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_sum_diag_integral_field<sp/>(</highlight><highlight class="stringliteral">&apos;t_surf&apos;</highlight><highlight class="normal">,<sp/>diag_atm)</highlight></codeline>
<codeline lineno="3099"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_ts_g<sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>send_global_diag(id_ts_g,<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3100"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>new<sp/>surface<sp/>temperature<sp/>only<sp/>over<sp/>open<sp/>ocean<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3101"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_tos<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_icetemp<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="3103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>icegrid<sp/>=<sp/>0.0;<sp/>icegrid(:,:,1)<sp/>=<sp/>1.0</highlight></codeline>
<codeline lineno="3104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(icegrid,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_icetemp,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_temp<sp/>=<sp/>ex_t_surf_new<sp/>*<sp/>ex_icetemp</highlight></codeline>
<codeline lineno="3106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_temp,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(frac_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_icetemp,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">where</highlight><highlight class="normal"><sp/>(frac_atm<sp/>&gt;<sp/>0.0)</highlight></codeline>
<codeline lineno="3109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>diag_atm<sp/>=<sp/>(diag_atm/frac_atm)<sp/></highlight><highlight class="comment">!<sp/>-<sp/>tfreeze<sp/><sp/>CMIP6<sp/>in<sp/>degK</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>frac_atm<sp/>=<sp/>1.0</highlight></codeline>
<codeline lineno="3111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elsewhere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>diag_atm<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="3113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>frac_atm<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="3114"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endwhere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(id_tos,<sp/>diag_atm,<sp/>time,<sp/>rmask=frac_atm)</highlight></codeline>
<codeline lineno="3116"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3117"><highlight class="normal"></highlight></codeline>
<codeline lineno="3118"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>new<sp/>surface<sp/>temperature<sp/>only<sp/>over<sp/>land<sp/>and<sp/>sea-ice<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_tslsi<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_land_frac<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="3121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="interfaceatm__land__ice__flux__exchange__mod_1_1put__logical__to__real" kindref="compound">put_logical_to_real</ref><sp/>(land%mask,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_land_frac,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>icegrid<sp/>=<sp/>1.0;<sp/>icegrid(:,:,1)<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="3123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_icetemp<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="3124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid<sp/>(icegrid,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_icetemp,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_icetemp<sp/>=<sp/>ex_icetemp<sp/>+<sp/>ex_land_frac</highlight></codeline>
<codeline lineno="3126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_temp<sp/>=<sp/>ex_t_surf_new<sp/>*<sp/>ex_icetemp</highlight></codeline>
<codeline lineno="3127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_temp,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(frac_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_icetemp,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">where</highlight><highlight class="normal"><sp/>(frac_atm<sp/>&gt;<sp/>0.0)</highlight></codeline>
<codeline lineno="3130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>diag_atm<sp/>=<sp/>diag_atm/frac_atm</highlight></codeline>
<codeline lineno="3131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>frac_atm<sp/>=<sp/>1.0</highlight></codeline>
<codeline lineno="3132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elsewhere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>diag_atm<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="3134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>frac_atm<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="3135"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endwhere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(id_tslsi,<sp/>diag_atm,<sp/>time,<sp/>rmask=frac_atm)</highlight></codeline>
<codeline lineno="3137"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3138"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3139"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3140"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>+<sp/>slm,<sp/>Mar<sp/>27<sp/>2002</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3141"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>------<sp/>new<sp/>canopy<sp/>temperature<sp/>--------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3142"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/>NOTE,<sp/>that<sp/>in<sp/>the<sp/>particular<sp/>case<sp/>of<sp/>LM2<sp/>t_ca<sp/>is<sp/>identical<sp/>to<sp/>t_surf,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3143"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/>but<sp/>this<sp/>will<sp/>be<sp/>changed<sp/>in<sp/>future<sp/>version<sp/>of<sp/>the<sp/>land<sp/>madel</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3144"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_t_ca<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_t_ca_new,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(id_t_ca,<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3147"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3148"><highlight class="normal"></highlight></codeline>
<codeline lineno="3149"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>updated<sp/>surface<sp/>tracer<sp/>fields<sp/>------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3150"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr=1,<sp/>n_exch_tr</highlight></codeline>
<codeline lineno="3151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(<sp/>model_atmos,<sp/>tr_table(tr)%atm,<sp/>tr_name<sp/>)</highlight></codeline>
<codeline lineno="3152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_tr_surf(tr)<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_tr_surf_new(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(id_tr_surf(tr),<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3155"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!!jgj:<sp/><sp/>add<sp/>dryvmr<sp/>co2_surf</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>-<sp/>slm<sp/>Mar<sp/>25,<sp/>2010:<sp/>moved<sp/>to<sp/>resolve<sp/>interdependence<sp/>of<sp/>diagnostic<sp/>fields</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_co2_surf_dvmr<sp/>&gt;<sp/>0<sp/>.and.<sp/>fms_mpp_lowercase(trim(tr_name))==</highlight><highlight class="stringliteral">&apos;co2&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_co2_surf_dvmr<sp/>=<sp/>(ex_tr_surf_new(:,tr)<sp/>/<sp/>(1.0<sp/>-<sp/>ex_tr_surf_new(:,isphum)))<sp/>*<sp/>wtmair/wtmco2</highlight></codeline>
<codeline lineno="3160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_co2_surf_dvmr,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(id_co2_surf_dvmr,<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3162"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3163"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3164"><highlight class="normal"></highlight></codeline>
<codeline lineno="3165"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>sensible<sp/>heat<sp/>flux<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3166"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_t_flux<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_hfss<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_hfss_g<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_t_flux<sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>fms_diag_send_data(id_t_flux,<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_hfss<sp/><sp/><sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>fms_diag_send_data(id_hfss,<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3170"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="3171"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_hfss_g<sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>send_global_diag(<sp/>id_hfss_g,<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="3172"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3173"><highlight class="preprocessor"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3174"><highlight class="normal"></highlight></codeline>
<codeline lineno="3175"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>net<sp/>longwave<sp/>flux<sp/>-----------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3176"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_r_flux<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_rls_g<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af36a6c987c16a10e698b500396554130" kindref="member">ex_flux_lw</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_r_flux<sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>fms_diag_send_data(id_r_flux,<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3179"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="3180"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_rls_g<sp/><sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>send_global_diag(id_rls_g,<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3181"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3182"><highlight class="preprocessor"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3183"><highlight class="normal"></highlight></codeline>
<codeline lineno="3184"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>tracer<sp/>fluxes<sp/>------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3185"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>tr_mol_flux<sp/>diagnostic<sp/>will<sp/>be<sp/>correct<sp/>for<sp/>co2<sp/>tracer<sp/>only.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>will<sp/>need<sp/>update<sp/>code<sp/>to<sp/>use<sp/>correct<sp/>molar<sp/>mass<sp/>for<sp/>tracers<sp/>other<sp/>than<sp/>co2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3187"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr=1,<sp/>n_exch_tr</highlight></codeline>
<codeline lineno="3188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_tr_flux(tr)<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_tr_mol_flux(tr)<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_flux_tr(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(model_atmos,<sp/>tr_table(tr)%atm,<sp/>tr_name,<sp/>units=tr_units)</highlight></codeline>
<codeline lineno="3191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_tr_flux(tr)<sp/>&gt;<sp/>0<sp/>)<sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_tr_flux(tr),<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/>if<sp/>(id_tr_mol_flux(tr)<sp/>&gt;<sp/>0<sp/>)<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_end_data<sp/>(<sp/>id_tr_mol_flux(tr),<sp/>diag_atm*1000./WTMCO2,<sp/>Time)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>2017/08/08<sp/>jgj<sp/>-<sp/>replaced<sp/>2<sp/>lines<sp/>above<sp/>by<sp/>the<sp/>following</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_tr_mol_flux(tr)<sp/>&gt;<sp/>0<sp/>.and.<sp/>fms_mpp_lowercase(trim(tr_name))==</highlight><highlight class="stringliteral">&apos;co2&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_tr_mol_flux(tr),<sp/>diag_atm*1000./wtmco2,<sp/>time)</highlight></codeline>
<codeline lineno="3197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!sometimes<sp/>in<sp/>2018<sp/>f1p<sp/>for<sp/>vmr<sp/>tracers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elseif</highlight><highlight class="normal">(id_tr_mol_flux(tr)<sp/>&gt;<sp/>0<sp/>.and.<sp/>fms_mpp_lowercase(trim(tr_units)).eq.</highlight><highlight class="stringliteral">&quot;vmr&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>if<sp/>(ocn_atm_flux_vmr_bug)<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>call<sp/>fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/>&apos;ATM&apos;,<sp/><sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_tr(:,tr)*(1.-ex_tr_surf_new(:,isphum)),<sp/>xmap_sfc)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data<sp/>(<sp/>id_tr_mol_flux(tr),<sp/>diag_atm*1000./WTMAIR,<sp/>Time)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!flux<sp/>is<sp/>in<sp/>vmr<sp/>*<sp/>kg/m2/s.<sp/>Divide<sp/>by<sp/>MW_air</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_tr(:,tr)*((1.-ex_tr_surf_new(:,isphum))*wtmh2o+ex_tr_surf_new(:,isphum)*wtmair)<sp/>&amp;</highlight></codeline>
<codeline lineno="3207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>/<sp/>(1e-3*wtmair*wtmh2o)<sp/>,<sp/>&amp;</highlight></codeline>
<codeline lineno="3208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/>id_tr_mol_flux(tr),<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3210"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3211"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3700e57c52d7ba6ff7ce17de7a52f885" kindref="member">id_tr_con_atm</ref>(tr)<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid<sp/>(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_tr_con_atm(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3700e57c52d7ba6ff7ce17de7a52f885" kindref="member">id_tr_con_atm</ref>(tr),<sp/>diag_atm,<sp/>time<sp/>)</highlight></codeline>
<codeline lineno="3215"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1ab67aebeab080001bcc0b7df4ba4ce31d" kindref="member">id_tr_con_ref</ref>(tr)<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_tr_con_ref(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1ab67aebeab080001bcc0b7df4ba4ce31d" kindref="member">id_tr_con_ref</ref>(tr),<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3219"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3220"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3221"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3222"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="3223"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_t_flux_land<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref>,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data(id_t_flux_land,<sp/>diag_land)</highlight></codeline>
<codeline lineno="3226"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3227"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-------<sp/>tracer<sp/>fluxes<sp/>for<sp/>land</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3228"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr=1,<sp/>n_exch_tr</highlight></codeline>
<codeline lineno="3229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a92413e2be778482c1557dc71b7dd6961" kindref="member">id_tr_flux_land</ref>(tr)<sp/>&gt;<sp/>0<sp/>.or.<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a75dad27ee32489cb9f2d4075a92dfffd" kindref="member">id_tr_mol_flux_land</ref>(tr)<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(model_atmos,<sp/>tr_table(tr)%atm,<sp/>tr_name,<sp/>units=tr_units)</highlight></codeline>
<codeline lineno="3231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_flux_tr(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a92413e2be778482c1557dc71b7dd6961" kindref="member">id_tr_flux_land</ref>(tr)<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a92413e2be778482c1557dc71b7dd6961" kindref="member">id_tr_flux_land</ref>(tr),<sp/>diag_land)</highlight></codeline>
<codeline lineno="3233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a75dad27ee32489cb9f2d4075a92dfffd" kindref="member">id_tr_mol_flux_land</ref>(tr)<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(fms_mpp_lowercase(trim(tr_name))==</highlight><highlight class="stringliteral">&apos;co2&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data<sp/>(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a75dad27ee32489cb9f2d4075a92dfffd" kindref="member">id_tr_mol_flux_land</ref>(tr),<sp/>diag_land*1000./wtmco2)</highlight></codeline>
<codeline lineno="3236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elseif</highlight><highlight class="normal">(fms_mpp_lowercase(trim(tr_units)).eq.</highlight><highlight class="stringliteral">&apos;vmr&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!flux<sp/>is<sp/>in<sp/>vmr<sp/>*<sp/>kg/m2/s.<sp/>Divide<sp/>by<sp/>MW_air</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_<sp/>(diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_tr(:,tr)*((1.-ex_tr_surf_new(:,isphum))*wtmh2o+ex_tr_surf_new(:,isphum)*wtmair)<sp/>&amp;</highlight></codeline>
<codeline lineno="3240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>/(1e-3*wtmair*wtmh2o)<sp/>,<sp/>&amp;</highlight></codeline>
<codeline lineno="3241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a75dad27ee32489cb9f2d4075a92dfffd" kindref="member">id_tr_mol_flux_land</ref>(tr),<sp/>diag_land)</highlight></codeline>
<codeline lineno="3243"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3244"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3245"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3246"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3247"><highlight class="normal"></highlight></codeline>
<codeline lineno="3248"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!--------<sp/>tracer<sp/>deposition<sp/>velocity</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr=1,<sp/>n_exch_tr</highlight></codeline>
<codeline lineno="3250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1aaf13f42049e3c17ce32b99e263ed19ca" kindref="member">id_tr_con_atm_land</ref>(tr)<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_tr_con_atm(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1aaf13f42049e3c17ce32b99e263ed19ca" kindref="member">id_tr_con_atm_land</ref>(tr),<sp/>diag_land)</highlight></codeline>
<codeline lineno="3253"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3b0582183221d7ffb1ba6e814cdd2bd5" kindref="member">id_tr_con_ref_land</ref>(tr)<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_tr_con_ref(:,tr),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3b0582183221d7ffb1ba6e814cdd2bd5" kindref="member">id_tr_con_ref_land</ref>(tr),<sp/>diag_land)</highlight></codeline>
<codeline lineno="3257"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3258"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3259"><highlight class="normal"></highlight></codeline>
<codeline lineno="3260"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3261"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3262"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-----------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3263"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!----<sp/>accumulate<sp/>global<sp/>integral<sp/>of<sp/>evaporation<sp/>(mm/day)<sp/>-----</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3264"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(evap_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_flux_tr(:,isphum),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3265"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_q_flux<sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>fms_diag_send_data(id_q_flux,<sp/>evap_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3266"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_evspsbl<sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>fms_diag_send_data(id_evspsbl,<sp/>evap_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_hfls<sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>fms_diag_send_data(id_hfls,<sp/>hlv*evap_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3268"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="3269"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_hfls_g<sp/><sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>send_global_diag(id_hfls_g,<sp/>hlv*evap_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3270"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3271"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3272"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_q_flux_land<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(diag_land,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_flux_tr(:,isphum),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3274"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="3275"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data(id_q_flux_land,<sp/>diag_land)</highlight></codeline>
<codeline lineno="3276"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="3277"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_tile_averaged_data(id_q_flux_land,<sp/>diag_land,<sp/>&amp;</highlight></codeline>
<codeline lineno="3278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land%tile_size,<sp/>time,<sp/>mask=land%mask)</highlight></codeline>
<codeline lineno="3279"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3280"><highlight class="preprocessor"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3281"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_sum_diag_integral_field(</highlight><highlight class="stringliteral">&apos;evap&apos;</highlight><highlight class="normal">,<sp/>evap_atm*86400.)</highlight></codeline>
<codeline lineno="3282"><highlight class="normal"></highlight></codeline>
<codeline lineno="3283"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="3284"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_evspsbl_g<sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>send_global_diag(id_evspsbl_g,<sp/>evap_atm,<sp/>time)</highlight></codeline>
<codeline lineno="3285"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3286"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3287"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="3288"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">send_tile_data<sp/>(id_q_flux_land,<sp/>diag_land)</highlight></codeline>
<codeline lineno="3289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>need<sp/>this<sp/>to<sp/>avoid<sp/>diag<sp/>issues<sp/>with<sp/>tiling<sp/>changes<sp/>in<sp/>update_land_slow</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3290"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">dump_tile_diag_fields(time)</highlight></codeline>
<codeline lineno="3291"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3292"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>END<sp/>SEND<sp/>DATA<sp/>TO<sp/>DIAG_MANAGER_BUFFER</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3293"><highlight class="normal"></highlight></codeline>
<codeline lineno="3295"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3296"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid_(data_lnd,<sp/></highlight><highlight class="stringliteral">&apos;LND&apos;</highlight><highlight class="normal">,<sp/>ex_flux_tr(:,isphum),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3297"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3298"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Lnd<sp/>-&gt;<sp/>Atm<sp/>(evap)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3299"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_stock_move_(<sp/>&amp;</highlight></codeline>
<codeline lineno="3300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>to<sp/>=<sp/>fms_stock_constants_atm_stock(istock_water),<sp/>&amp;</highlight></codeline>
<codeline lineno="3301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>from<sp/>=<sp/>fms_stock_constants_lnd_stock(istock_water),<sp/>&amp;</highlight></codeline>
<codeline lineno="3302"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="3303"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>stock_ug_data3d<sp/>=<sp/>data_lnd,<sp/>&amp;</highlight></codeline>
<codeline lineno="3304"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="3305"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>stock_data3d<sp/>=<sp/>data_lnd,<sp/>&amp;</highlight></codeline>
<codeline lineno="3306"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3307"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>grid_index=x1_grid_lnd,<sp/>&amp;</highlight></codeline>
<codeline lineno="3308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>xmap=xmap_sfc,<sp/>&amp;</highlight></codeline>
<codeline lineno="3309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>delta_t=dt_atm,<sp/>&amp;</highlight></codeline>
<codeline lineno="3310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>to_side=istock_side,<sp/>from_side=istock_top,<sp/>&amp;</highlight></codeline>
<codeline lineno="3311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>radius=radius,<sp/>ier=ier,<sp/>verbose=</highlight><highlight class="stringliteral">&apos;stock<sp/>move<sp/>EVAP<sp/>(Lnd-&gt;ATm)<sp/>&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3312"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3313"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Lnd<sp/>-&gt;<sp/>Atm<sp/>(heat<sp/>lost<sp/>through<sp/>evap)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_stock_move_(<sp/>&amp;</highlight></codeline>
<codeline lineno="3315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>to<sp/><sp/><sp/>=<sp/>fms_stock_constants_atm_stock(istock_heat),<sp/>&amp;</highlight></codeline>
<codeline lineno="3316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>from<sp/>=<sp/>fms_stock_constants_lnd_stock(istock_heat),<sp/>&amp;</highlight></codeline>
<codeline lineno="3317"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="3318"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>stock_ug_data3d<sp/>=<sp/>data_lnd<sp/>*<sp/>hlv,<sp/>&amp;</highlight></codeline>
<codeline lineno="3319"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="3320"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>stock_data3d<sp/>=<sp/>data_lnd<sp/>*<sp/>hlv,<sp/>&amp;</highlight></codeline>
<codeline lineno="3321"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3322"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>grid_index=x1_grid_lnd,<sp/>&amp;</highlight></codeline>
<codeline lineno="3323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>xmap=xmap_sfc,<sp/>&amp;</highlight></codeline>
<codeline lineno="3324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>delta_t=dt_atm,<sp/>&amp;</highlight></codeline>
<codeline lineno="3325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>to_side=istock_side,<sp/>from_side=istock_top,<sp/>&amp;</highlight></codeline>
<codeline lineno="3326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>radius=radius,<sp/>ier=ier,<sp/>verbose=</highlight><highlight class="stringliteral">&apos;stock<sp/>move<sp/>EVAP*HLV<sp/>(Lnd-&gt;ATm)<sp/>&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3327"><highlight class="normal"></highlight></codeline>
<codeline lineno="3328"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(data_ice,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_flux_tr(:,isphum),<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3329"><highlight class="normal"></highlight></codeline>
<codeline lineno="3330"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Ice<sp/>-&gt;<sp/>Atm<sp/>(evap)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3331"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_stock_move(<sp/>&amp;</highlight></codeline>
<codeline lineno="3332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>to<sp/><sp/><sp/>=<sp/>fms_stock_constants_atm_stock(istock_water),<sp/>&amp;</highlight></codeline>
<codeline lineno="3333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>from<sp/>=<sp/>fms_stock_constants_ice_stock(istock_water),<sp/>&amp;</highlight></codeline>
<codeline lineno="3334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>stock_data3d<sp/>=<sp/>data_ice,<sp/>&amp;</highlight></codeline>
<codeline lineno="3335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>grid_index=x1_grid_ice,<sp/>&amp;</highlight></codeline>
<codeline lineno="3336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>xmap=xmap_sfc,<sp/>&amp;</highlight></codeline>
<codeline lineno="3337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>delta_t=dt_atm,<sp/>&amp;</highlight></codeline>
<codeline lineno="3338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>to_side=istock_top,<sp/>from_side=istock_top,<sp/>&amp;</highlight></codeline>
<codeline lineno="3339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>radius=radius,<sp/>ier=ier,<sp/>verbose=</highlight><highlight class="stringliteral">&apos;stock<sp/>move<sp/>EVAP<sp/>(Ice-&gt;ATm)<sp/>&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3340"><highlight class="normal"></highlight></codeline>
<codeline lineno="3341"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Ice<sp/>-&gt;<sp/>Atm<sp/>(heat<sp/>lost<sp/>through<sp/>evap)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3342"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_stock_move(<sp/>&amp;</highlight></codeline>
<codeline lineno="3343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>to<sp/><sp/><sp/>=<sp/>fms_stock_constants_atm_stock(istock_heat),<sp/>&amp;</highlight></codeline>
<codeline lineno="3344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>from<sp/>=<sp/>fms_stock_constants_ice_stock(istock_heat),<sp/>&amp;</highlight></codeline>
<codeline lineno="3345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>stock_data3d<sp/>=<sp/>data_ice<sp/>*<sp/>hlv,<sp/>&amp;</highlight></codeline>
<codeline lineno="3346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>grid_index=x1_grid_ice,<sp/>&amp;</highlight></codeline>
<codeline lineno="3347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>xmap=xmap_sfc,<sp/>&amp;</highlight></codeline>
<codeline lineno="3348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>delta_t=dt_atm,<sp/>&amp;</highlight></codeline>
<codeline lineno="3349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>to_side=istock_top,<sp/>from_side=istock_top,<sp/>&amp;</highlight></codeline>
<codeline lineno="3350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>radius=radius,<sp/>ier=ier,<sp/>verbose=</highlight><highlight class="stringliteral">&apos;stock<sp/>move<sp/>EVAP*HLV<sp/>(Ice-&gt;ATm)<sp/>&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3351"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}<sp/>END<sp/>COMPUTE<sp/>STOCK<sp/>EXCHANGE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3352"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3353"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Balaji</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3354"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_end(fluxatmupclock)</highlight></codeline>
<codeline lineno="3355"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_clock_end(cplclock)</highlight></codeline>
<codeline lineno="3356"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a9ff1868e71257630777ac2d9c8b6180c" kindref="member">flux_up_to_atmos</ref></highlight></codeline>
<codeline lineno="3357"><highlight class="normal"></highlight></codeline>
<codeline lineno="3358"><highlight class="normal"></highlight></codeline>
<codeline lineno="3359"><highlight class="normal"></highlight></codeline>
<codeline lineno="3361"><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac8716ce7e07543b081c151bd0b24d7d1" kindref="member">flux_ex_arrays_dealloc</ref>()</highlight></codeline>
<codeline lineno="3362"><highlight class="normal"></highlight></codeline>
<codeline lineno="3363"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">implicit<sp/>none</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3364"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>m,n</highlight></codeline>
<codeline lineno="3365"><highlight class="normal"></highlight></codeline>
<codeline lineno="3366"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!----<sp/>deallocate<sp/>module<sp/>storage<sp/>----</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3367"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">deallocate</highlight><highlight class="normal"><sp/>(<sp/>&amp;</highlight></codeline>
<codeline lineno="3368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b2ef838084f4e936de81bcf4acba447" kindref="member">ex_t_surf</ref><sp/><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a29071f5ae5e2772b510570b3834fe1b4" kindref="member">ex_t_surf_miz</ref>,<sp/>&amp;</highlight></codeline>
<codeline lineno="3370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af4fdc80a51f0145da4aa80a6317cc156" kindref="member">ex_p_surf</ref><sp/><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae70d5c9a1a49eff91b2c14c1657103a6" kindref="member">ex_slp</ref><sp/><sp/><sp/><sp/><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a11f41fbfe9ab8aa845f8337fb270f9d9" kindref="member">ex_t_ca</ref><sp/><sp/><sp/><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7a723109680791b32db1371f623f679d" kindref="member">ex_dhdt_surf</ref>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a50b141a6a27c86e08632eb459f39324b" kindref="member">ex_dedt_surf</ref>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a1dcdd143924c77ba06ef91b15bfae469" kindref="member">ex_dqsatdt_surf</ref>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aeba37d2c046170e4112311711809f620" kindref="member">ex_drdt_surf</ref>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a04986e4dfe0871fb9b662597e47772bb" kindref="member">ex_dhdt_atm</ref><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ae9b13bb6dda1c9dd7d826fc60e495a7d" kindref="member">ex_flux_t</ref><sp/><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af36a6c987c16a10e698b500396554130" kindref="member">ex_flux_lw</ref><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_drag_q<sp/><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_avail<sp/><sp/><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_f_t_delt_n,<sp/>&amp;</highlight></codeline>
<codeline lineno="3383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_surf<sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_con_ref,<sp/>&amp;</highlight></codeline>
<codeline lineno="3385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_tr_con_atm,<sp/>&amp;</highlight></codeline>
<codeline lineno="3386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dfdtr_surf<sp/><sp/>,<sp/>&amp;</highlight></codeline>
<codeline lineno="3387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dfdtr_atm<sp/><sp/><sp/>,<sp/>&amp;</highlight></codeline>
<codeline lineno="3388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_flux_tr<sp/><sp/><sp/><sp/><sp/>,<sp/>&amp;</highlight></codeline>
<codeline lineno="3389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_f_tr_delt_n<sp/>,<sp/>&amp;</highlight></codeline>
<codeline lineno="3390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_e_tr_n<sp/><sp/><sp/><sp/><sp/><sp/>,<sp/>&amp;</highlight></codeline>
<codeline lineno="3391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_e_t_n<sp/><sp/><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a86ed92f16c0fb112e38dd6873ca4cded" kindref="member">ex_e_q_n</ref><sp/><sp/><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>values<sp/>added<sp/>for<sp/>LM3</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a1fc83cb6b523c05c9925f67c1bef77eb" kindref="member">ex_cd_t</ref><sp/><sp/><sp/><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a26e0b81f6ed8473af88bdec4dda23c4b" kindref="member">ex_cd_m</ref><sp/><sp/><sp/><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a0fd79bc7659c354908e2e6c325985544" kindref="member">ex_b_star</ref><sp/><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3faddc34ad457fdb55533bead75ce7f0" kindref="member">ex_u_star</ref><sp/><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ada77a5490b1ad25fa3ca68f3f81b9548" kindref="member">ex_wind</ref><sp/><sp/><sp/><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a415a43eca092359dca12e46ac24bb0de" kindref="member">ex_z_atm</ref><sp/><sp/><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a972ea1bb3939a7b1fed1e698b182de88" kindref="member">ex_con_atm</ref><sp/><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7cc9b8d546d6589e3b2cf8a7ad6dd90c" kindref="member">ex_seawater</ref><sp/>,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_land<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="3403"><highlight class="normal"></highlight></codeline>
<codeline lineno="3404"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>SCM</highlight></codeline>
<codeline lineno="3405"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">deallocate</highlight><highlight class="normal"><sp/>(<sp/>&amp;</highlight></codeline>
<codeline lineno="3406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dhdt_surf_forland,<sp/>&amp;</highlight></codeline>
<codeline lineno="3407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dedt_surf_forland,<sp/>&amp;</highlight></codeline>
<codeline lineno="3408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_dedq_surf_forland<sp/><sp/>)</highlight></codeline>
<codeline lineno="3409"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3410"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3411"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>Extra<sp/>fluxes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3412"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>1,<sp/>ex_gas_fields_ice%num_bcs</highlight></codeline>
<codeline lineno="3413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>m<sp/>=<sp/>1,<sp/>ex_gas_fields_ice%bc(n)%num_fields</highlight></codeline>
<codeline lineno="3414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">deallocate</highlight><highlight class="normal">(ex_gas_fields_ice%bc(n)%field(m)%values)</highlight></codeline>
<codeline lineno="3415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">nullify</highlight><highlight class="normal"><sp/>(<sp/>ex_gas_fields_ice%bc(n)%field(m)%values)</highlight></codeline>
<codeline lineno="3416"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="3417"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3418"><highlight class="normal"></highlight></codeline>
<codeline lineno="3419"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>1,<sp/>ex_gas_fields_atm%num_bcs</highlight></codeline>
<codeline lineno="3420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>m<sp/>=<sp/>1,<sp/>ex_gas_fields_atm%bc(n)%num_fields</highlight></codeline>
<codeline lineno="3421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">deallocate</highlight><highlight class="normal"><sp/>(<sp/>ex_gas_fields_atm%bc(n)%field(m)%values<sp/>)</highlight></codeline>
<codeline lineno="3422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">nullify</highlight><highlight class="normal"><sp/>(<sp/>ex_gas_fields_atm%bc(n)%field(m)%values<sp/>)</highlight></codeline>
<codeline lineno="3423"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3424"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3425"><highlight class="normal"></highlight></codeline>
<codeline lineno="3426"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>1,<sp/>ex_gas_fluxes%num_bcs</highlight></codeline>
<codeline lineno="3427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>m<sp/>=<sp/>1,<sp/>ex_gas_fluxes%bc(n)%num_fields</highlight></codeline>
<codeline lineno="3428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">deallocate</highlight><highlight class="normal"><sp/>(<sp/>ex_gas_fluxes%bc(n)%field(m)%values<sp/>)</highlight></codeline>
<codeline lineno="3429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">nullify</highlight><highlight class="normal"><sp/>(<sp/>ex_gas_fluxes%bc(n)%field(m)%values<sp/>)</highlight></codeline>
<codeline lineno="3430"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3431"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3432"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3433"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac8716ce7e07543b081c151bd0b24d7d1" kindref="member">flux_ex_arrays_dealloc</ref></highlight></codeline>
<codeline lineno="3434"><highlight class="normal"></highlight></codeline>
<codeline lineno="3436"><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b47968fcb9188a68db2b7b8e1ea7a0f" kindref="member">flux_atmos_to_ocean</ref>(Time,<sp/>Atm,<sp/>Ice_boundary,<sp/>Ice)</highlight></codeline>
<codeline lineno="3437"><highlight class="normal"></highlight></codeline>
<codeline lineno="3438"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">implicit<sp/>none</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3439"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsTime_type),<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>Time</highlight></codeline>
<codeline lineno="3440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3441"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_data_type),<sp/><sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal">::<sp/>Atm</highlight></codeline>
<codeline lineno="3442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3443"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_ice_boundary_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal">::<sp/>Ice_boundary</highlight></codeline>
<codeline lineno="3444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3445"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(ice_data_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal">::<sp/>Ice</highlight></codeline>
<codeline lineno="3446"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3447"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>n,m</highlight></codeline>
<codeline lineno="3448"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>used</highlight></codeline>
<codeline lineno="3449"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3450"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="3451"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">atmos_tracer_driver_gather_data_down(atm%fields,<sp/>atm%tr_bot)</highlight></codeline>
<codeline lineno="3452"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3453"><highlight class="preprocessor"></highlight></codeline>
<codeline lineno="3455"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3456"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!air-sea<sp/>deposition<sp/>fluxes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3457"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>1,<sp/>atm%fields%num_bcs</highlight></codeline>
<codeline lineno="3458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!Do<sp/>the<sp/>string<sp/>copies.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atm%fields%bc(n)%flux_type<sp/>=<sp/>trim(ex_gas_fluxes%bc(n)%flux_type)</highlight></codeline>
<codeline lineno="3460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atm%fields%bc(n)%implementation<sp/>=<sp/>trim(ex_gas_fluxes%bc(n)%implementation)</highlight></codeline>
<codeline lineno="3461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(ex_gas_fields_atm%bc(n)%flux_type<sp/>.eq.<sp/></highlight><highlight class="stringliteral">&apos;air_sea_deposition&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>m<sp/>=<sp/>1,<sp/>atm%fields%bc(n)%num_fields</highlight></codeline>
<codeline lineno="3463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(atm%fields%bc(n)%field(m)%values,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gas_fields_atm%bc(n)%field(m)%values,<sp/>xmap_sfc,<sp/>remap_method=remap_method)</highlight></codeline>
<codeline lineno="3465"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3466"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3467"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3468"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3469"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3471"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3472"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal"><ref refid="namespaceatmos__ocean__dep__fluxes__calc__mod_1a5880644207752e6a4873458a90f04cea" kindref="member">atmos_ocean_dep_fluxes_calc</ref>(ex_gas_fields_atm,<sp/>ex_gas_fields_ice,<sp/>ex_gas_fluxes,<sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a7cc9b8d546d6589e3b2cf8a7ad6dd90c" kindref="member">ex_seawater</ref>)</highlight></codeline>
<codeline lineno="3473"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3474"><highlight class="normal"></highlight></codeline>
<codeline lineno="3476"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3477"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>1,<sp/>ice_boundary%fluxes%num_bcs</highlight></codeline>
<codeline lineno="3478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(ice_boundary%fluxes%bc(n)%flux_type<sp/>.eq.<sp/></highlight><highlight class="stringliteral">&apos;air_sea_deposition&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>m<sp/>=<sp/>1,<sp/>ice_boundary%fluxes%bc(n)%num_fields</highlight></codeline>
<codeline lineno="3480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(ice_boundary%fluxes%bc(n)%field(m)%values,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_gas_fluxes%bc(n)%field(m)%values,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="3482"><highlight class="normal"></highlight></codeline>
<codeline lineno="3483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_data_override(</highlight><highlight class="stringliteral">&apos;ICE&apos;</highlight><highlight class="normal">,<sp/>ice_boundary%fluxes%bc(n)%field(m)%name,<sp/>&amp;</highlight></codeline>
<codeline lineno="3484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ice_boundary%fluxes%bc(n)%field(m)%values,<sp/>time)</highlight></codeline>
<codeline lineno="3485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(ice_boundary%fluxes%bc(n)%field(m)%id_diag<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(ice_boundary%fluxes%bc(n)%field(m)%id_diag,<sp/>&amp;</highlight></codeline>
<codeline lineno="3487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ice_boundary%fluxes%bc(n)%field(m)%values,<sp/>time)</highlight></codeline>
<codeline lineno="3488"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="3489"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3490"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3491"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3492"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3493"><highlight class="normal"></highlight></codeline>
<codeline lineno="3495"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3496"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">update_ice_atm_deposition_flux(ice_boundary,<sp/>ice)</highlight></codeline>
<codeline lineno="3497"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3498"><highlight class="normal"></highlight></codeline>
<codeline lineno="3499"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6b47968fcb9188a68db2b7b8e1ea7a0f" kindref="member">flux_atmos_to_ocean</ref></highlight></codeline>
<codeline lineno="3500"><highlight class="normal"></highlight></codeline>
<codeline lineno="3504"><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a50837c09366fc3aee78c7d5909783559" kindref="member">put_logical_to_real_sg</ref><sp/>(mask,<sp/>id,<sp/>ex_mask,<sp/>xmap)</highlight></codeline>
<codeline lineno="3505"><highlight class="normal"></highlight></codeline>
<codeline lineno="3506"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">implicit<sp/>none</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3507"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>mask(:,:,:)</highlight></codeline>
<codeline lineno="3508"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">character(len=3)</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>id</highlight></codeline>
<codeline lineno="3509"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>ex_mask(:)</highlight></codeline>
<codeline lineno="3510"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsXgridXmap_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>xmap</highlight></codeline>
<codeline lineno="3511"><highlight class="normal"></highlight></codeline>
<codeline lineno="3512"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(size(mask,1),size(mask,2),size(mask,3))</highlight><highlight class="normal"><sp/>::<sp/>rmask</highlight></codeline>
<codeline lineno="3513"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3514"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">where</highlight><highlight class="normal"><sp/>(mask)</highlight></codeline>
<codeline lineno="3515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rmask<sp/>=<sp/>1.0</highlight></codeline>
<codeline lineno="3516"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elsewhere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rmask<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="3518"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endwhere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3519"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3520"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(rmask,<sp/>id,<sp/>ex_mask,<sp/>xmap)</highlight></codeline>
<codeline lineno="3521"><highlight class="normal"></highlight></codeline>
<codeline lineno="3522"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a50837c09366fc3aee78c7d5909783559" kindref="member">put_logical_to_real_sg</ref></highlight></codeline>
<codeline lineno="3523"><highlight class="normal"></highlight></codeline>
<codeline lineno="3524"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="3528"><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a996a4e123202df434c2b7a3e370dd854" kindref="member">put_logical_to_real_ug</ref><sp/>(mask,<sp/>id,<sp/>ex_mask,<sp/>xmap)</highlight></codeline>
<codeline lineno="3529"><highlight class="normal"></highlight></codeline>
<codeline lineno="3530"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">implicit<sp/>none</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3531"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>mask(:,:)</highlight></codeline>
<codeline lineno="3532"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">character(len=3)</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>id</highlight></codeline>
<codeline lineno="3533"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>ex_mask(:)</highlight></codeline>
<codeline lineno="3534"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsXgridXmap_type),<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>xmap</highlight></codeline>
<codeline lineno="3535"><highlight class="normal"></highlight></codeline>
<codeline lineno="3536"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3537"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(size(mask,1),size(mask,2))</highlight><highlight class="normal"><sp/>::<sp/>rmask</highlight></codeline>
<codeline lineno="3538"><highlight class="normal"></highlight></codeline>
<codeline lineno="3539"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">where</highlight><highlight class="normal"><sp/>(mask)</highlight></codeline>
<codeline lineno="3540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rmask<sp/>=<sp/>1.0</highlight></codeline>
<codeline lineno="3541"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elsewhere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rmask<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="3543"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endwhere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3544"><highlight class="normal"></highlight></codeline>
<codeline lineno="3545"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid_(rmask,<sp/>id,<sp/>ex_mask,<sp/>xmap)</highlight></codeline>
<codeline lineno="3546"><highlight class="normal"></highlight></codeline>
<codeline lineno="3547"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a996a4e123202df434c2b7a3e370dd854" kindref="member">put_logical_to_real_ug</ref></highlight></codeline>
<codeline lineno="3548"><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="3549"><highlight class="normal"></highlight></codeline>
<codeline lineno="3554"><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac8a26116481dffeb2f5f2ac6444c64f5" kindref="member">diag_field_init</ref>(Time,<sp/>atmos_axes,<sp/>land_axes,<sp/>land_pe)</highlight></codeline>
<codeline lineno="3555"><highlight class="normal"></highlight></codeline>
<codeline lineno="3556"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">implicit<sp/>none</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3557"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsTime_type),<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>Time</highlight></codeline>
<codeline lineno="3558"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>atmos_axes(2)</highlight></codeline>
<codeline lineno="3559"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>land_axes(:)</highlight></codeline>
<codeline lineno="3560"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>land_pe</highlight></codeline>
<codeline lineno="3561"><highlight class="normal"></highlight></codeline>
<codeline lineno="3562"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>iref</highlight></codeline>
<codeline lineno="3563"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">character(len=6)</highlight><highlight class="normal"><sp/>::<sp/>label_zm,<sp/>label_zh</highlight></codeline>
<codeline lineno="3564"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(2)</highlight><highlight class="normal"><sp/>::<sp/>&amp;</highlight></codeline>
<codeline lineno="3565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>trange<sp/>=<sp/>[100.,<sp/>400.],<sp/>&amp;</highlight></codeline>
<codeline lineno="3566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vrange<sp/>=<sp/>[-400.,<sp/>400.],<sp/>&amp;</highlight></codeline>
<codeline lineno="3567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>frange<sp/>=<sp/>[-0.01,<sp/>1.01]</highlight></codeline>
<codeline lineno="3568"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">character(len=32)</highlight><highlight class="normal"><sp/><sp/>::<sp/>name,<sp/>units<sp/></highlight><highlight class="comment">!<sp/>name<sp/>of<sp/>the<sp/>tracer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3569"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">character(len=128)</highlight><highlight class="normal"><sp/>::<sp/>longname<sp/></highlight><highlight class="comment">!<sp/>long<sp/>name<sp/>of<sp/>the<sp/>tracer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3570"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>tr<sp/></highlight><highlight class="comment">!<sp/>tracer<sp/>index</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3571"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>area_id</highlight></codeline>
<codeline lineno="3572"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3574"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3575"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>(z_ref_mom,<sp/>z_ref_heat<sp/>are<sp/>namelist<sp/>variables)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3576"><highlight class="normal"><sp/><sp/><sp/><sp/>iref<sp/>=<sp/>int(z_ref_mom+0.5)</highlight></codeline>
<codeline lineno="3577"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/></highlight><highlight class="keywordtype">real(iref)</highlight><highlight class="normal"><sp/>==<sp/>z_ref_mom<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">write</highlight><highlight class="normal"><sp/>(label_zm,105)<sp/>iref</highlight></codeline>
<codeline lineno="3579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(iref<sp/>&lt;<sp/>10)<sp/></highlight><highlight class="keyword">write</highlight><highlight class="normal"><sp/>(label_zm,100)<sp/>iref</highlight></codeline>
<codeline lineno="3580"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">write</highlight><highlight class="normal"><sp/>(label_zm,110)<sp/>z_ref_mom</highlight></codeline>
<codeline lineno="3582"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3583"><highlight class="normal"></highlight></codeline>
<codeline lineno="3584"><highlight class="normal"><sp/><sp/><sp/><sp/>iref<sp/>=<sp/>int(z_ref_heat+0.5)</highlight></codeline>
<codeline lineno="3585"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/></highlight><highlight class="keywordtype">real(iref)</highlight><highlight class="normal"><sp/>==<sp/>z_ref_heat<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">write</highlight><highlight class="normal"><sp/>(label_zh,105)<sp/>iref</highlight></codeline>
<codeline lineno="3587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(iref<sp/>&lt;<sp/>10)<sp/></highlight><highlight class="keyword">write</highlight><highlight class="normal"><sp/>(label_zh,100)<sp/>iref</highlight></codeline>
<codeline lineno="3588"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">write</highlight><highlight class="normal"><sp/>(label_zh,110)<sp/>z_ref_heat</highlight></codeline>
<codeline lineno="3590"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3591"><highlight class="normal"></highlight></codeline>
<codeline lineno="3592"><highlight class="normal">100<sp/></highlight><highlight class="keyword">format</highlight><highlight class="normal"><sp/>(i1,</highlight><highlight class="stringliteral">&apos;<sp/>m&apos;</highlight><highlight class="normal">,3x)</highlight></codeline>
<codeline lineno="3593"><highlight class="normal">105<sp/></highlight><highlight class="keyword">format</highlight><highlight class="normal"><sp/>(i2,</highlight><highlight class="stringliteral">&apos;<sp/>m&apos;</highlight><highlight class="normal">,2x)</highlight></codeline>
<codeline lineno="3594"><highlight class="normal">110<sp/></highlight><highlight class="keyword">format</highlight><highlight class="normal"><sp/>(f4.1,</highlight><highlight class="stringliteral">&apos;<sp/>m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3595"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3596"><highlight class="normal"></highlight></codeline>
<codeline lineno="3597"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3598"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!---------<sp/>initialize<sp/>static<sp/>diagnostic<sp/>fields<sp/>--------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3599"><highlight class="normal"><sp/><sp/><sp/><sp/>id_land_mask<sp/>=<sp/>&amp;</highlight></codeline>
<codeline lineno="3600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fms_diag_register_static_field(<sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;land_mask&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;fractional<sp/>amount<sp/>of<sp/>land&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;none&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>range=frange,<sp/>interp_method<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;conserve_order1&quot;</highlight><highlight class="normal"><sp/>)</highlight></codeline>
<codeline lineno="3603"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3604"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!---------<sp/>initialize<sp/>diagnostic<sp/>fields<sp/>--------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3605"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3606"><highlight class="normal"><sp/><sp/><sp/><sp/>id_ice_mask<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;ice_mask&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;fractional<sp/>amount<sp/>of<sp/>sea<sp/>ice&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;none&apos;</highlight><highlight class="normal">,<sp/>range=frange,<sp/>&amp;</highlight></codeline>
<codeline lineno="3608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>interp_method<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;conserve_order1&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3609"><highlight class="normal"></highlight></codeline>
<codeline lineno="3610"><highlight class="normal"><sp/><sp/><sp/><sp/>id_wind<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;wind&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;wind<sp/>speed<sp/>for<sp/>flux<sp/>calculations&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m/s&apos;</highlight><highlight class="normal">,<sp/>range=[0.,vrange(2)])</highlight></codeline>
<codeline lineno="3612"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3613"><highlight class="normal"><sp/><sp/><sp/><sp/>id_drag_moist<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;drag_moist&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;drag<sp/>coeff<sp/>for<sp/>moisture&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;none&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3615"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3616"><highlight class="normal"><sp/><sp/><sp/><sp/>id_drag_heat<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;drag_heat&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;drag<sp/>coeff<sp/>for<sp/>heat&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;none&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3618"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3619"><highlight class="normal"><sp/><sp/><sp/><sp/>id_drag_mom<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;drag_mom&apos;</highlight><highlight class="normal">,<sp/><sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;drag<sp/>coeff<sp/>for<sp/>momentum&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;none&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3621"><highlight class="normal"></highlight></codeline>
<codeline lineno="3622"><highlight class="normal"><sp/><sp/><sp/><sp/>id_rough_moist<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;rough_moist&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;surface<sp/>roughness<sp/>for<sp/>moisture&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3624"><highlight class="normal"></highlight></codeline>
<codeline lineno="3625"><highlight class="normal"><sp/><sp/><sp/><sp/>id_rough_heat<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;rough_heat&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;surface<sp/>roughness<sp/>for<sp/>heat&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3627"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3628"><highlight class="normal"><sp/><sp/><sp/><sp/>id_rough_mom<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;rough_mom&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;surface<sp/>roughness<sp/>for<sp/>momentum&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3630"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3631"><highlight class="normal"><sp/><sp/><sp/><sp/>id_u_star<sp/><sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;u_star&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;friction<sp/>velocity&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m/s&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3633"><highlight class="normal"></highlight></codeline>
<codeline lineno="3634"><highlight class="normal"><sp/><sp/><sp/><sp/>id_b_star<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;b_star&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;buoyancy<sp/>scale&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m/s2&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3636"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3637"><highlight class="normal"><sp/><sp/><sp/><sp/>id_q_star<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;q_star&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;moisture<sp/>scale&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;kg<sp/>water/kg<sp/>air&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3639"><highlight class="normal"></highlight></codeline>
<codeline lineno="3640"><highlight class="normal"><sp/><sp/><sp/><sp/>id_thv_atm<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;thv_atm&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;surface<sp/>air<sp/>virtual<sp/>potential<sp/>temperature&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;K&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3642"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3643"><highlight class="normal"><sp/><sp/><sp/><sp/>id_thv_surf<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;thv_surf&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;surface<sp/>virtual<sp/>potential<sp/>temperature&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;K&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3645"><highlight class="normal"></highlight></codeline>
<codeline lineno="3646"><highlight class="normal"><sp/><sp/><sp/><sp/>id_u_flux<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;tau_x&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;zonal<sp/>wind<sp/>stress&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;pa&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3648"><highlight class="normal"></highlight></codeline>
<codeline lineno="3649"><highlight class="normal"><sp/><sp/><sp/><sp/>id_v_flux<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;tau_y&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;meridional<sp/>wind<sp/>stress&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;pa&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3651"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3652"><highlight class="normal"><sp/><sp/><sp/><sp/>id_t_ocean<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;t_ocean&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;surface<sp/>temperature<sp/>from<sp/>ocean<sp/>output&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;deg_k&apos;</highlight><highlight class="normal">,<sp/>range=trange)</highlight></codeline>
<codeline lineno="3654"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3655"><highlight class="normal"><sp/><sp/><sp/><sp/>id_t_surf<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;t_surf&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;surface<sp/>temperature&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;deg_k&apos;</highlight><highlight class="normal">,<sp/>range=trange)</highlight></codeline>
<codeline lineno="3657"><highlight class="normal"></highlight></codeline>
<codeline lineno="3658"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>+<sp/>slm,<sp/>Mar<sp/>25,<sp/>2002<sp/>--<sp/>add<sp/>diagnositcs<sp/>for<sp/>t_ca,<sp/>q_ca,<sp/>and<sp/>q_atm</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3659"><highlight class="normal"><sp/><sp/><sp/><sp/>id_t_ca<sp/><sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;t_ca&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;canopy<sp/>air<sp/>temperature&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;deg_k&apos;</highlight><highlight class="normal">,<sp/>range=trange)</highlight></codeline>
<codeline lineno="3661"><highlight class="normal"></highlight></codeline>
<codeline lineno="3662"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>-<sp/>slm,<sp/>Mar<sp/>25,<sp/>2002</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3663"><highlight class="normal"><sp/><sp/><sp/><sp/>id_z_atm<sp/><sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;z_atm&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;height<sp/>of<sp/>btm<sp/>level&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3665"><highlight class="normal"></highlight></codeline>
<codeline lineno="3666"><highlight class="normal"><sp/><sp/><sp/><sp/>id_p_atm<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;p_atm&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;pressure<sp/>at<sp/>btm<sp/>level&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;pa&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3668"><highlight class="normal"></highlight></codeline>
<codeline lineno="3669"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>-<sp/>bw,<sp/>Mar<sp/>25,<sp/>2002<sp/>--<sp/>added<sp/>diagnostic<sp/>slp</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3670"><highlight class="normal"><sp/><sp/><sp/><sp/>id_slp<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3671"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;slp&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;sea<sp/>level<sp/>pressure&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;pa&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3672"><highlight class="normal"></highlight></codeline>
<codeline lineno="3673"><highlight class="normal"><sp/><sp/><sp/><sp/>id_gust<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;gust&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;gust<sp/>scale&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m/s&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3675"><highlight class="normal"></highlight></codeline>
<codeline lineno="3676"><highlight class="normal"><sp/><sp/><sp/><sp/>id_t_flux<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;shflx&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;sensible<sp/>heat<sp/>flux&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;w/m2&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3678"><highlight class="normal"></highlight></codeline>
<codeline lineno="3679"><highlight class="normal"><sp/><sp/><sp/><sp/>id_r_flux<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;lwflx&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;net<sp/>(down-up)<sp/>longwave<sp/>flux&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;w/m2&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3681"><highlight class="normal"></highlight></codeline>
<codeline lineno="3682"><highlight class="normal"><sp/><sp/><sp/><sp/>id_t_atm<sp/><sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;t_atm&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;temperature<sp/>at<sp/>btm<sp/>level&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;deg_k&apos;</highlight><highlight class="normal">,<sp/>range=trange)</highlight></codeline>
<codeline lineno="3684"><highlight class="normal"></highlight></codeline>
<codeline lineno="3685"><highlight class="normal"><sp/><sp/><sp/><sp/>id_u_atm<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3686"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;u_atm&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;u<sp/>wind<sp/>component<sp/>at<sp/>btm<sp/>level&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m/s&apos;</highlight><highlight class="normal">,<sp/>range=vrange)</highlight></codeline>
<codeline lineno="3687"><highlight class="normal"></highlight></codeline>
<codeline lineno="3688"><highlight class="normal"><sp/><sp/><sp/><sp/>id_v_atm<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;v_atm&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;v<sp/>wind<sp/>component<sp/>at<sp/>btm<sp/>level&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m/s&apos;</highlight><highlight class="normal">,<sp/>range=vrange)</highlight></codeline>
<codeline lineno="3690"><highlight class="normal"></highlight></codeline>
<codeline lineno="3691"><highlight class="normal"><sp/><sp/><sp/><sp/>id_t_ref<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;t_ref&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;temperature<sp/>at<sp/>&apos;</highlight><highlight class="normal">//label_zh,<sp/></highlight><highlight class="stringliteral">&apos;deg_k&apos;</highlight><highlight class="normal">,<sp/>range=trange)</highlight></codeline>
<codeline lineno="3693"><highlight class="normal"></highlight></codeline>
<codeline lineno="3694"><highlight class="normal"><sp/><sp/><sp/><sp/>id_rh_ref<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;rh_ref&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;relative<sp/>humidity<sp/>at<sp/>&apos;</highlight><highlight class="normal">//label_zh,<sp/></highlight><highlight class="stringliteral">&apos;percent&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3696"><highlight class="normal"></highlight></codeline>
<codeline lineno="3697"><highlight class="normal"><sp/><sp/><sp/><sp/>id_rh_ref_cmip<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;rh_ref_cmip&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;relative<sp/>humidity<sp/>at<sp/>&apos;</highlight><highlight class="normal">//label_zh,<sp/></highlight><highlight class="stringliteral">&apos;percent&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3699"><highlight class="normal"></highlight></codeline>
<codeline lineno="3700"><highlight class="normal"><sp/><sp/><sp/><sp/>id_u_ref<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;u_ref&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;zonal<sp/>wind<sp/>component<sp/>at<sp/>&apos;</highlight><highlight class="normal">//label_zm,<sp/></highlight><highlight class="stringliteral">&apos;m/s&apos;</highlight><highlight class="normal">,<sp/>range=vrange)</highlight></codeline>
<codeline lineno="3702"><highlight class="normal"></highlight></codeline>
<codeline lineno="3703"><highlight class="normal"><sp/><sp/><sp/><sp/>id_v_ref<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;v_ref&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;meridional<sp/>wind<sp/>component<sp/>at<sp/>&apos;</highlight><highlight class="normal">//label_zm,<sp/></highlight><highlight class="stringliteral">&apos;m/s&apos;</highlight><highlight class="normal">,<sp/>range=vrange)</highlight></codeline>
<codeline lineno="3705"><highlight class="normal"></highlight></codeline>
<codeline lineno="3706"><highlight class="normal"><sp/><sp/><sp/><sp/>id_wind_ref<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;wind_ref&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;absolute<sp/>value<sp/>of<sp/>wind<sp/>at<sp/>&apos;</highlight><highlight class="normal">//label_zm,<sp/></highlight><highlight class="stringliteral">&apos;m/s&apos;</highlight><highlight class="normal">,<sp/>range=vrange)</highlight></codeline>
<codeline lineno="3708"><highlight class="normal"></highlight></codeline>
<codeline lineno="3709"><highlight class="normal"><sp/><sp/><sp/><sp/>id_del_h<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3710"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;del_h&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;ref<sp/>height<sp/>interp<sp/>factor<sp/>for<sp/>heat&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;none&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3711"><highlight class="normal"></highlight></codeline>
<codeline lineno="3712"><highlight class="normal"><sp/><sp/><sp/><sp/>id_del_m<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;del_m&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;ref<sp/>height<sp/>interp<sp/>factor<sp/>for<sp/>momentum&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;none&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3714"><highlight class="normal"></highlight></codeline>
<codeline lineno="3715"><highlight class="normal"><sp/><sp/><sp/><sp/>id_del_q<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;del_q&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;ref<sp/>height<sp/>interp<sp/>factor<sp/>for<sp/>moisture&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;none&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3717"><highlight class="normal"></highlight></codeline>
<codeline lineno="3718"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(land_pe)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>set<sp/>the<sp/>default<sp/>filter<sp/>(for<sp/>area<sp/>and<sp/>subsampling)<sp/>for<sp/>consequent<sp/>calls<sp/>to<sp/>register_tiled_diag_field</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3720"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="3721"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">set_default_diag_filter(</highlight><highlight class="stringliteral">&apos;land&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3722"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3723"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_t_ref_land<sp/>=<sp/>fms_diag_register_field_(&amp;</highlight></codeline>
<codeline lineno="3724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;flux_land&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;t_ref&apos;</highlight><highlight class="normal">,<sp/>land_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;temperature<sp/>at<sp/>&apos;</highlight><highlight class="normal">//trim(label_zh)//</highlight><highlight class="stringliteral">&apos;<sp/>over<sp/>land&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;deg_k&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3725"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>range=trange,<sp/>missing_value=-100.0)</highlight></codeline>
<codeline lineno="3726"><highlight class="normal"></highlight></codeline>
<codeline lineno="3727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_q_ref_land<sp/>=<sp/>fms_diag_register_field_(&amp;</highlight></codeline>
<codeline lineno="3728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;flux_land&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;q_ref&apos;</highlight><highlight class="normal">,<sp/>land_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;specific<sp/>humidity<sp/>at<sp/>&apos;</highlight><highlight class="normal">//trim(label_zh)//</highlight><highlight class="stringliteral">&apos;<sp/>over<sp/>land&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;kg/kg&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>missing_value=-1.0)</highlight></codeline>
<codeline lineno="3730"><highlight class="normal"></highlight></codeline>
<codeline lineno="3731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_rh_ref_land=<sp/>fms_diag_register_field_(&amp;</highlight></codeline>
<codeline lineno="3732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;flux_land&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;rh_ref&apos;</highlight><highlight class="normal">,<sp/>land_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;relative<sp/>humidity<sp/>at<sp/>&apos;</highlight><highlight class="normal">//trim(label_zh)//</highlight><highlight class="stringliteral">&apos;<sp/>over<sp/>land&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;percent&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>missing_value=-999.0)</highlight></codeline>
<codeline lineno="3734"><highlight class="normal"></highlight></codeline>
<codeline lineno="3735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_u_ref_land<sp/>=<sp/>fms_diag_register_field_(&amp;</highlight></codeline>
<codeline lineno="3736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;flux_land&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;u_ref&apos;</highlight><highlight class="normal">,<sp/><sp/>land_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;zonal<sp/>wind<sp/>component<sp/>at<sp/>&apos;</highlight><highlight class="normal">//trim(label_zm)//</highlight><highlight class="stringliteral">&apos;<sp/>over<sp/>land&apos;</highlight><highlight class="normal">,<sp/><sp/></highlight><highlight class="stringliteral">&apos;m/s&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>range=vrange,<sp/>missing_value=-999.0)</highlight></codeline>
<codeline lineno="3738"><highlight class="normal"></highlight></codeline>
<codeline lineno="3739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_v_ref_land<sp/>=<sp/>fms_diag_register_field_(<sp/>&amp;</highlight></codeline>
<codeline lineno="3740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;flux_land&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;v_ref&apos;</highlight><highlight class="normal">,<sp/><sp/>land_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;meridional<sp/>wind<sp/>component<sp/>at<sp/>&apos;</highlight><highlight class="normal">//trim(label_zm)//</highlight><highlight class="stringliteral">&apos;<sp/>over<sp/>land&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;m/s&apos;</highlight><highlight class="normal">,<sp/>range=vrange,<sp/>missing_value<sp/>=<sp/>-999.0)</highlight></codeline>
<codeline lineno="3742"><highlight class="normal"></highlight></codeline>
<codeline lineno="3743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_q_flux_land<sp/>=<sp/>fms_diag_register_field_(&amp;</highlight></codeline>
<codeline lineno="3744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;flux_land&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;evap&apos;</highlight><highlight class="normal">,<sp/>land_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;evaporation<sp/>rate<sp/>over<sp/>land&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;kg/m2/s&apos;</highlight><highlight class="normal">,<sp/>missing_value=-1.0)</highlight></codeline>
<codeline lineno="3745"><highlight class="normal"></highlight></codeline>
<codeline lineno="3746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_t_flux_land<sp/>=<sp/>fms_diag_register_field_(&amp;</highlight></codeline>
<codeline lineno="3747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;flux_land&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;shflx&apos;</highlight><highlight class="normal">,<sp/>land_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;sensible<sp/>heat<sp/>flux&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;W/m2&apos;</highlight><highlight class="normal">,<sp/>missing_value=-1.0)</highlight></codeline>
<codeline lineno="3748"><highlight class="normal"></highlight></codeline>
<codeline lineno="3749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_taslut_land<sp/>=<sp/>fms_diag_register_field_(&amp;</highlight></codeline>
<codeline lineno="3750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cmor_land&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tasLut&apos;</highlight><highlight class="normal">,<sp/>land_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3751"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Near-Surface<sp/>Air<sp/>Temperature<sp/>(&apos;</highlight><highlight class="normal">//trim(label_zh)//</highlight><highlight class="stringliteral">&apos;<sp/>Above<sp/>Displacement<sp/>Height)<sp/>on<sp/>Land<sp/>Use<sp/>Tile&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>units=</highlight><highlight class="stringliteral">&apos;K&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;air_temperature&apos;</highlight><highlight class="normal">,<sp/>missing_value=-1.0<sp/>)</highlight></codeline>
<codeline lineno="3753"><highlight class="normal"></highlight></codeline>
<codeline lineno="3754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_husslut_land<sp/>=<sp/>fms_diag_register_field_(&amp;</highlight></codeline>
<codeline lineno="3755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cmor_land&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;hussLut&apos;</highlight><highlight class="normal">,<sp/>land_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;Near-Surface<sp/>Specific<sp/>Humidity<sp/>on<sp/>Land<sp/>Use<sp/>Tile&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;1.0&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>standard_name=</highlight><highlight class="stringliteral">&apos;specific_humidity&apos;</highlight><highlight class="normal">,<sp/>missing_value=-1.0<sp/>)</highlight></codeline>
<codeline lineno="3757"><highlight class="normal"></highlight></codeline>
<codeline lineno="3758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a92413e2be778482c1557dc71b7dd6961" kindref="member">id_tr_flux_land</ref>(n_exch_tr))</highlight></codeline>
<codeline lineno="3759"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a75dad27ee32489cb9f2d4075a92dfffd" kindref="member">id_tr_mol_flux_land</ref>(n_exch_tr))</highlight></codeline>
<codeline lineno="3760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1aaf13f42049e3c17ce32b99e263ed19ca" kindref="member">id_tr_con_atm_land</ref>(n_exch_tr))</highlight></codeline>
<codeline lineno="3761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3b0582183221d7ffb1ba6e814cdd2bd5" kindref="member">id_tr_con_ref_land</ref>(n_exch_tr))</highlight></codeline>
<codeline lineno="3762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(id_tr_ref_land(n_exch_tr))</highlight></codeline>
<codeline lineno="3763"><highlight class="normal"></highlight></codeline>
<codeline lineno="3764"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="3765"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aaf13f42049e3c17ce32b99e263ed19ca" kindref="member">id_tr_con_atm_land</ref>(:)<sp/>=<sp/>-1</highlight></codeline>
<codeline lineno="3766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3b0582183221d7ffb1ba6e814cdd2bd5" kindref="member">id_tr_con_ref_land</ref>(:)<sp/>=<sp/>-1</highlight></codeline>
<codeline lineno="3767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tr_ref_land(:)=<sp/><sp/>-1</highlight></codeline>
<codeline lineno="3768"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3769"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,<sp/>n_exch_tr</highlight></codeline>
<codeline lineno="3771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(<sp/>model_atmos,<sp/>tr_table(tr)%atm,<sp/>name,<sp/>longname,<sp/>units<sp/>)</highlight></codeline>
<codeline lineno="3772"><highlight class="normal"></highlight></codeline>
<codeline lineno="3773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a92413e2be778482c1557dc71b7dd6961" kindref="member">id_tr_flux_land</ref>(tr)<sp/>=<sp/>fms_diag_register_field_(</highlight><highlight class="stringliteral">&apos;flux_land&apos;</highlight><highlight class="normal">,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_flux&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;flux<sp/>of<sp/>&apos;</highlight><highlight class="normal">//trim(longname),<sp/>trim(units)//</highlight><highlight class="stringliteral">&apos;<sp/>kg<sp/>air/(m2<sp/>s)&apos;</highlight><highlight class="normal">,<sp/>missing_value=-1.0)</highlight></codeline>
<codeline lineno="3775"><highlight class="normal"></highlight></codeline>
<codeline lineno="3776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>fms_mpp_lowercase(trim(name))==</highlight><highlight class="stringliteral">&apos;co2&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a75dad27ee32489cb9f2d4075a92dfffd" kindref="member">id_tr_mol_flux_land</ref>(tr)<sp/>=<sp/>fms_diag_register_field_(</highlight><highlight class="stringliteral">&apos;flux_land&apos;</highlight><highlight class="normal">,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_mol_flux&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land_axes,time,<sp/></highlight><highlight class="stringliteral">&apos;flux<sp/>of<sp/>&apos;</highlight><highlight class="normal">//trim(longname),<sp/></highlight><highlight class="stringliteral">&apos;mol<sp/>CO2/(m2<sp/>s)&apos;</highlight><highlight class="normal">,<sp/>missing_value=-1.0)</highlight></codeline>
<codeline lineno="3779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a75dad27ee32489cb9f2d4075a92dfffd" kindref="member">id_tr_mol_flux_land</ref>(tr)<sp/>=<sp/>fms_diag_register_field_(</highlight><highlight class="stringliteral">&apos;flux_land&apos;</highlight><highlight class="normal">,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_mol_flux&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land_axes,time,<sp/></highlight><highlight class="stringliteral">&apos;flux<sp/>of<sp/>&apos;</highlight><highlight class="normal">//trim(longname),<sp/></highlight><highlight class="stringliteral">&apos;mol/(m2<sp/>s)&apos;</highlight><highlight class="normal">,<sp/>missing_value=-1.0)</highlight></codeline>
<codeline lineno="3782"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3783"><highlight class="normal"></highlight></codeline>
<codeline lineno="3784"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_USE_LEGACY_LAND_</highlight></codeline>
<codeline lineno="3785"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1aaf13f42049e3c17ce32b99e263ed19ca" kindref="member">id_tr_con_atm_land</ref>(tr)<sp/>=<sp/>fms_diag_register_field_(</highlight><highlight class="stringliteral">&apos;flux_land&apos;</highlight><highlight class="normal">,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_tot_con_atm&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;vd<sp/>of<sp/>&apos;</highlight><highlight class="normal">//trim(longname),<sp/></highlight><highlight class="stringliteral">&apos;m/s&apos;</highlight><highlight class="normal">,<sp/>missing_value=-1.0<sp/>)</highlight></codeline>
<codeline lineno="3787"><highlight class="normal"></highlight></codeline>
<codeline lineno="3788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3b0582183221d7ffb1ba6e814cdd2bd5" kindref="member">id_tr_con_ref_land</ref>(tr)<sp/>=<sp/>register_diag_field(</highlight><highlight class="stringliteral">&apos;flux_land&apos;</highlight><highlight class="normal">,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_tot_con_ref&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;vd<sp/>of<sp/>&apos;</highlight><highlight class="normal">//trim(longname)//</highlight><highlight class="stringliteral">&apos;<sp/>at<sp/>&apos;</highlight><highlight class="normal">//trim(label_zh),<sp/></highlight><highlight class="stringliteral">&apos;m/s&apos;</highlight><highlight class="normal">,<sp/>missing_value=-1.0<sp/>)</highlight></codeline>
<codeline lineno="3790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3791"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>we<sp/>skip<sp/>sphum<sp/>because<sp/>it<sp/>is<sp/>already<sp/>available<sp/>as<sp/>flux_land/q_ref</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3792"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(tr<sp/>.ne.<sp/>isphum)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3793"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tr_ref_land(tr)<sp/>=<sp/>fms_diag_register_field_(</highlight><highlight class="stringliteral">&apos;flux_land&apos;</highlight><highlight class="normal">,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_ref&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3794"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>land_axes,<sp/>time,<sp/>trim(longname)//</highlight><highlight class="stringliteral">&apos;<sp/>at<sp/>&apos;</highlight><highlight class="normal">//trim(label_zh)//</highlight><highlight class="stringliteral">&apos;<sp/>over<sp/>land&apos;</highlight><highlight class="normal">,<sp/>trim(units),missing_value=-1.0)</highlight></codeline>
<codeline lineno="3795"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tr_ref_land(tr)<sp/>=<sp/>-1</highlight></codeline>
<codeline lineno="3797"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3798"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="3799"><highlight class="preprocessor"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3800"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3801"><highlight class="normal"></highlight></codeline>
<codeline lineno="3802"><highlight class="normal"><sp/><sp/><sp/><sp/>id_q_ref<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3803"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;q_ref&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;specific<sp/>humidity<sp/>at<sp/>&apos;</highlight><highlight class="normal">//trim(label_zh),<sp/></highlight><highlight class="stringliteral">&apos;kg/kg&apos;</highlight><highlight class="normal">,<sp/>missing_value=-1.0)</highlight></codeline>
<codeline lineno="3804"><highlight class="normal"></highlight></codeline>
<codeline lineno="3805"><highlight class="normal"><sp/><sp/><sp/><sp/>id_rough_scale<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3806"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;rough_scale&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;topographic<sp/>scaling<sp/>factor<sp/>for<sp/>momentum<sp/>drag&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;1&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3807"><highlight class="normal"></highlight></codeline>
<codeline lineno="3808"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(id_tr_atm(n_exch_tr))</highlight></codeline>
<codeline lineno="3809"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(id_tr_surf(n_exch_tr))</highlight></codeline>
<codeline lineno="3810"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(id_tr_flux(n_exch_tr))</highlight></codeline>
<codeline lineno="3811"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(id_tr_mol_flux(n_exch_tr))</highlight></codeline>
<codeline lineno="3812"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1af4c241a58e2d051452ea6ac2165b605c" kindref="member">id_tr_mol_flux0</ref>(n_exch_tr))</highlight></codeline>
<codeline lineno="3813"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3700e57c52d7ba6ff7ce17de7a52f885" kindref="member">id_tr_con_atm</ref>(n_exch_tr))</highlight></codeline>
<codeline lineno="3814"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(<ref refid="namespaceatm__land__ice__flux__exchange__mod_1ab67aebeab080001bcc0b7df4ba4ce31d" kindref="member">id_tr_con_ref</ref>(n_exch_tr))</highlight></codeline>
<codeline lineno="3815"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">allocate</highlight><highlight class="normal">(id_tr_ref(n_exch_tr))</highlight></codeline>
<codeline lineno="3816"><highlight class="normal"></highlight></codeline>
<codeline lineno="3817"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>tr<sp/>=<sp/>1,<sp/>n_exch_tr</highlight></codeline>
<codeline lineno="3818"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_tracer_manager_get_tracer_names(model_atmos,<sp/>tr_table(tr)%atm,<sp/>name,<sp/>longname,<sp/>units)</highlight></codeline>
<codeline lineno="3819"><highlight class="normal"></highlight></codeline>
<codeline lineno="3820"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a3700e57c52d7ba6ff7ce17de7a52f885" kindref="member">id_tr_con_atm</ref>(tr)<sp/>=<sp/>fms_diag_register_diag_field(<sp/>mod_name,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_tot_con_atm&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3821"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;vd<sp/>of<sp/>&apos;</highlight><highlight class="normal">//trim(longname),<sp/></highlight><highlight class="stringliteral">&apos;m/s&apos;</highlight><highlight class="normal">,<sp/>missing_value=-1.0<sp/>)</highlight></codeline>
<codeline lineno="3822"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ab67aebeab080001bcc0b7df4ba4ce31d" kindref="member">id_tr_con_ref</ref>(tr)<sp/>=<sp/>fms_diag_register_diag_field(<sp/>mod_name,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_tot_con_ref&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3823"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;vd<sp/>of<sp/>&apos;</highlight><highlight class="normal">//trim(longname)//</highlight><highlight class="stringliteral">&apos;<sp/>at<sp/>&apos;</highlight><highlight class="normal">//trim(label_zh),<sp/></highlight><highlight class="stringliteral">&apos;m/s&apos;</highlight><highlight class="normal">,<sp/>missing_value=-1.0<sp/>)</highlight></codeline>
<codeline lineno="3824"><highlight class="normal"></highlight></codeline>
<codeline lineno="3825"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tr_atm(tr)<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_atm&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3826"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>trim(longname)//</highlight><highlight class="stringliteral">&apos;<sp/>at<sp/>btm<sp/>level&apos;</highlight><highlight class="normal">,<sp/>trim(units))</highlight></codeline>
<codeline lineno="3827"><highlight class="normal"></highlight></codeline>
<codeline lineno="3828"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tr_surf(tr)<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_surf&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3829"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>trim(longname)//</highlight><highlight class="stringliteral">&apos;<sp/>at<sp/>the<sp/>surface&apos;</highlight><highlight class="normal">,<sp/>trim(units))</highlight></codeline>
<codeline lineno="3830"><highlight class="normal"></highlight></codeline>
<codeline lineno="3831"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tr_flux(tr)<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_flux&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3832"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;flux<sp/>of<sp/>&apos;</highlight><highlight class="normal">//trim(longname),<sp/>trim(units)//</highlight><highlight class="stringliteral">&apos;<sp/>kg<sp/>air/(m2<sp/>s)&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3833"><highlight class="normal"></highlight></codeline>
<codeline lineno="3834"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>tr<sp/>.ne.<sp/>isphum<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3835"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tr_ref(tr)<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_ref&apos;</highlight><highlight class="normal">,<sp/><sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3836"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>trim(longname)//</highlight><highlight class="stringliteral">&apos;<sp/>at<sp/>&apos;</highlight><highlight class="normal">//trim(label_zh),<sp/>trim(units),missing_value=-1.0)</highlight></codeline>
<codeline lineno="3837"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3838"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tr_ref(tr)<sp/>=<sp/>-1</highlight></codeline>
<codeline lineno="3839"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3840"><highlight class="normal"></highlight></codeline>
<codeline lineno="3841"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!!<sp/>add<sp/>dryvmr<sp/>co2_surf<sp/>and<sp/>co2_atm</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3842"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>fms_mpp_lowercase(trim(name))==</highlight><highlight class="stringliteral">&apos;co2&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3843"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>-<sp/>slm<sp/>Mar<sp/>25,<sp/>2010:<sp/>moved<sp/>registration<sp/>of<sp/>mol_flux<sp/>inside<sp/>&apos;if&apos;<sp/>to<sp/>disable</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>saving<sp/>incorrect<sp/>results<sp/>(mol<sp/>fluxes<sp/>for<sp/>other<sp/>tracers<sp/>computed<sp/>with<sp/>CO2<sp/>molar<sp/>mass</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3845"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tr_mol_flux(tr)<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_mol_flux&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;flux<sp/>of<sp/>&apos;</highlight><highlight class="normal">//trim(longname),<sp/></highlight><highlight class="stringliteral">&apos;mol<sp/>CO2/(m2<sp/>s)&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3847"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_co2_atm_dvmr<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_atm_dvmr&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3848"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>trim(longname)//</highlight><highlight class="stringliteral">&apos;<sp/>at<sp/>btm<sp/>level&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;mol<sp/>CO2<sp/>/mol<sp/>air&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3849"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_co2_surf_dvmr<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_surf_dvmr&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3850"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>trim(longname)//</highlight><highlight class="stringliteral">&apos;<sp/>at<sp/>the<sp/>surface&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;mol<sp/>CO2<sp/>/mol<sp/>air&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3851"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3852"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!f1p</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3853"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>id_tr_mol_flux(tr)<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_mol_flux&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3854"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;flux<sp/>of<sp/>&apos;</highlight><highlight class="normal">//trim(longname),<sp/></highlight><highlight class="stringliteral">&apos;mol/(m2<sp/>s)&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3855"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3856"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!f1p</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3857"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af4c241a58e2d051452ea6ac2165b605c" kindref="member">id_tr_mol_flux0</ref>(tr)<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/>trim(name)//</highlight><highlight class="stringliteral">&apos;_mol_flux_atm0&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3858"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;gross<sp/>flux<sp/>of<sp/>&apos;</highlight><highlight class="normal">//trim(longname),<sp/></highlight><highlight class="stringliteral">&apos;mol/(m2<sp/>s)&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3859"><highlight class="normal"></highlight></codeline>
<codeline lineno="3860"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>enddo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3861"><highlight class="normal"></highlight></codeline>
<codeline lineno="3862"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>2017/08/08<sp/>jgj<sp/>add<sp/>diagnostics<sp/>for<sp/>co2<sp/>data<sp/>overrides<sp/>even<sp/>if<sp/>co2<sp/>is<sp/>not<sp/>a<sp/>tracer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3863"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>register<sp/>data<sp/>calls<sp/>not<sp/>needed<sp/>here<sp/>for<sp/>co2_flux_pcair_atm<sp/>and<sp/>o2_flux_pcair_atm<sp/>as<sp/>this<sp/>happens<sp/>elsewhere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3864"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceatm__land__ice__flux__exchange__mod_1abe4744b6ee8cc8e236be33b11254b857" kindref="member">id_co2_bot</ref><sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;co2_bot&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3865"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;co2_bot<sp/>from<sp/>data_override&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;ppmv&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3866"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3867"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>id_nh3_flux_atm0<sp/>=<sp/>fms_diag_register_diag_field<sp/>(mod_name,<sp/>&apos;nh3_flux_atm0&apos;,<sp/>atmos_axes,<sp/>Time,<sp/>&amp;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3868"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;nh3<sp/>flux<sp/>out<sp/>of<sp/>the<sp/>ocean<sp/>assuming<sp/>not<sp/>nh3<sp/>in<sp/>the<sp/>atmosphere&apos;,<sp/>&apos;mol/m2/s&apos;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3869"><highlight class="normal"></highlight></codeline>
<codeline lineno="3870"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3871"><highlight class="normal"><sp/><sp/><sp/><sp/>id_q_flux<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;evap&apos;</highlight><highlight class="normal">,fatmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3872"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;evaporation<sp/>rate&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;kg/m2/s&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3873"><highlight class="normal"></highlight></codeline>
<codeline lineno="3874"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!--------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3875"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>retrieve<sp/>the<sp/>diag_manager<sp/>id<sp/>for<sp/>the<sp/>area<sp/>diagnostic,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3876"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/>needed<sp/>for<sp/>cmorizing<sp/>various<sp/>diagnostics.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3877"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!--------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3878"><highlight class="normal"><sp/><sp/><sp/><sp/>area_id<sp/>=<sp/>fms_diag_get_field_id(</highlight><highlight class="stringliteral">&apos;dynamics&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;area&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3879"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(area_id<sp/>.eq.<sp/>diag_field_not_found)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_error_mesg<sp/>&amp;</highlight></codeline>
<codeline lineno="3880"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="stringliteral">&apos;diag_field_init<sp/>in<sp/>atm_land_ice_flux_exchange_mod&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;diagnostic<sp/>field<sp/>&quot;dynamics&quot;,<sp/>&quot;area&quot;<sp/>is<sp/>not<sp/>in<sp/>the<sp/>diag_table&apos;</highlight><highlight class="normal">,<sp/>note)</highlight></codeline>
<codeline lineno="3882"><highlight class="normal"></highlight></codeline>
<codeline lineno="3883"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-----------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3884"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/>register<sp/>cmip<sp/>variable<sp/>names</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3885"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-----------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3886"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>NOTE:<sp/>add<sp/>extra<sp/>dimension<sp/>reference<sp/>level<sp/>fields?<sp/><sp/>height2m,<sp/>height10m</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3887"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/><sp/><sp/><sp/><sp/><sp/><sp/>for<sp/>now<sp/>we<sp/>will<sp/>handle<sp/>this<sp/>with<sp/>an<sp/>attribute</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3888"><highlight class="normal"></highlight></codeline>
<codeline lineno="3889"><highlight class="normal"><sp/><sp/><sp/><sp/>id_height2m<sp/>=<sp/>fms_diag_register_static_field(&amp;</highlight></codeline>
<codeline lineno="3890"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;height2m&apos;</highlight><highlight class="normal">,<sp/>[null_axis_id],<sp/></highlight><highlight class="stringliteral">&apos;Height&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;height&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3891"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_height2m<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3892"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_height2m,<sp/></highlight><highlight class="stringliteral">&apos;axis&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Z&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_height2m,<sp/></highlight><highlight class="stringliteral">&apos;positive&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;up&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3894"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3895"><highlight class="normal"></highlight></codeline>
<codeline lineno="3896"><highlight class="normal"><sp/><sp/><sp/><sp/>id_height10m<sp/>=<sp/>fms_diag_register_static_field(&amp;</highlight></codeline>
<codeline lineno="3897"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;height10m&apos;</highlight><highlight class="normal">,<sp/>[null_axis_id],<sp/></highlight><highlight class="stringliteral">&apos;Height&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;height&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3898"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_height10m<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3899"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_height10m,<sp/></highlight><highlight class="stringliteral">&apos;axis&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Z&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3900"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_height10m,<sp/></highlight><highlight class="stringliteral">&apos;positive&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;up&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3901"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3902"><highlight class="normal"></highlight></codeline>
<codeline lineno="3903"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>use_AM3_physics</highlight></codeline>
<codeline lineno="3904"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/>id_tas<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;tas&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;Near-Surface<sp/>Air<sp/>Temperature&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;K&apos;</highlight><highlight class="normal"><sp/>,<sp/>&amp;</highlight></codeline>
<codeline lineno="3906"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;air_temperature&apos;</highlight><highlight class="normal">,<sp/>area=area_id,<sp/>missing_value=cmor_missing_value,<sp/>range=trange)</highlight></codeline>
<codeline lineno="3907"><highlight class="normal"></highlight></codeline>
<codeline lineno="3908"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_tas<sp/>&gt;<sp/>0<sp/>.and.<sp/>id_height2m<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_tas,<sp/></highlight><highlight class="stringliteral">&apos;coordinates&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;height2m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3909"><highlight class="normal"></highlight></codeline>
<codeline lineno="3910"><highlight class="normal"><sp/><sp/><sp/><sp/>id_uas<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3911"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;uas&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;Eastward<sp/>Near-Surface<sp/>Wind&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m<sp/>s-1&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3912"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;eastward_wind&apos;</highlight><highlight class="normal">,<sp/>area=area_id,<sp/>missing_value=cmor_missing_value,<sp/>range=vrange)</highlight></codeline>
<codeline lineno="3913"><highlight class="normal"></highlight></codeline>
<codeline lineno="3914"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_uas<sp/>&gt;<sp/>0<sp/>.and.<sp/>id_height10m<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_uas,<sp/></highlight><highlight class="stringliteral">&apos;coordinates&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;height10m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3915"><highlight class="normal"></highlight></codeline>
<codeline lineno="3916"><highlight class="normal"><sp/><sp/><sp/><sp/>id_vas<sp/>=<sp/>fms_diag_register_diag_field(&amp;</highlight></codeline>
<codeline lineno="3917"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mod_name,<sp/></highlight><highlight class="stringliteral">&apos;vas&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;Northward<sp/>Near-Surface<sp/>Wind&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m<sp/>s-1&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3918"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;northward_wind&apos;</highlight><highlight class="normal">,<sp/>area=area_id,<sp/>missing_value=cmor_missing_value,<sp/>range=vrange)</highlight></codeline>
<codeline lineno="3919"><highlight class="normal"></highlight></codeline>
<codeline lineno="3920"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_vas<sp/>&gt;<sp/>0<sp/>.and.<sp/>id_height10m<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_vas,<sp/></highlight><highlight class="stringliteral">&apos;coordinates&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;height10m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3921"><highlight class="normal"></highlight></codeline>
<codeline lineno="3922"><highlight class="normal"><sp/><sp/><sp/><sp/>id_sfcwind<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;sfcWind&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3923"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Near-Surface<sp/>Wind<sp/>Speed&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m<sp/>s-1&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;wind_speed&apos;</highlight><highlight class="normal">,<sp/>area=area_id,<sp/>&amp;</highlight></codeline>
<codeline lineno="3924"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>missing_value=cmor_missing_value,<sp/>range=vrange)</highlight></codeline>
<codeline lineno="3925"><highlight class="normal"></highlight></codeline>
<codeline lineno="3926"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_sfcwind<sp/>&gt;<sp/>0<sp/>.and.<sp/>id_height10m<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_sfcwind,<sp/></highlight><highlight class="stringliteral">&apos;coordinates&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;height10m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3927"><highlight class="normal"></highlight></codeline>
<codeline lineno="3928"><highlight class="normal"><sp/><sp/><sp/><sp/>id_huss<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;huss&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3929"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Near-Surface<sp/>Specific<sp/>Humidity&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;1.0&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;specific_humidity&apos;</highlight><highlight class="normal">,<sp/>area=area_id,<sp/>&amp;</highlight></codeline>
<codeline lineno="3930"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>missing_value=cmor_missing_value)</highlight></codeline>
<codeline lineno="3931"><highlight class="normal"></highlight></codeline>
<codeline lineno="3932"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_huss<sp/>&gt;<sp/>0<sp/>.and.<sp/>id_height2m<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_huss,<sp/></highlight><highlight class="stringliteral">&apos;coordinates&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;height2m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3933"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="3934"><highlight class="normal"><sp/><sp/><sp/><sp/>id_hurs<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;hurs&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3935"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Near-Surface<sp/>Relative<sp/>Humidity&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;%&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;relative_humidity&apos;</highlight><highlight class="normal">,<sp/>area=area_id,<sp/>&amp;</highlight></codeline>
<codeline lineno="3936"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>missing_value=cmor_missing_value)</highlight></codeline>
<codeline lineno="3937"><highlight class="normal"></highlight></codeline>
<codeline lineno="3938"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_hurs<sp/>&gt;<sp/>0<sp/>.and.<sp/>id_height2m<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_hurs,<sp/></highlight><highlight class="stringliteral">&apos;coordinates&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;height2m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3939"><highlight class="normal"></highlight></codeline>
<codeline lineno="3940"><highlight class="normal"><sp/><sp/><sp/><sp/>id_rhs<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;rhs&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Near-Surface<sp/>Relative<sp/>Humidity&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;%&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;relative_humidity&apos;</highlight><highlight class="normal">,<sp/>area=area_id,<sp/>&amp;</highlight></codeline>
<codeline lineno="3942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>missing_value=cmor_missing_value)</highlight></codeline>
<codeline lineno="3943"><highlight class="normal"></highlight></codeline>
<codeline lineno="3944"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_rhs<sp/>&gt;<sp/>0<sp/>.and.<sp/>id_height2m<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_rhs,<sp/></highlight><highlight class="stringliteral">&apos;coordinates&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;height2m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3945"><highlight class="normal"></highlight></codeline>
<codeline lineno="3946"><highlight class="normal"><sp/><sp/><sp/><sp/>id_ts<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;ts&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3947"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Surface<sp/>Temperature&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;K&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;surface_temperature&apos;</highlight><highlight class="normal">,<sp/>area=area_id,<sp/>&amp;</highlight></codeline>
<codeline lineno="3948"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>missing_value=cmor_missing_value,<sp/>range=trange)</highlight></codeline>
<codeline lineno="3949"><highlight class="normal"></highlight></codeline>
<codeline lineno="3950"><highlight class="normal"><sp/><sp/><sp/><sp/>id_psl<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;psl&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3951"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Sea<sp/>Level<sp/>Pressure&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Pa&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;air_pressure_at_sea_level&apos;</highlight><highlight class="normal">,<sp/>area=area_id,<sp/>&amp;</highlight></codeline>
<codeline lineno="3952"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>missing_value=cmor_missing_value)</highlight></codeline>
<codeline lineno="3953"><highlight class="normal"></highlight></codeline>
<codeline lineno="3954"><highlight class="normal"><sp/><sp/><sp/><sp/>id_tauu<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;tauu&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3955"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Surface<sp/>Downward<sp/>Eastward<sp/>Wind<sp/>Stress&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Pa&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;surface_downward_eastward_stress&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3956"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>area=area_id,<sp/>missing_value=cmor_missing_value)</highlight></codeline>
<codeline lineno="3957"><highlight class="normal"></highlight></codeline>
<codeline lineno="3958"><highlight class="normal"><sp/><sp/><sp/><sp/>id_tauv<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;tauv&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3959"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Surface<sp/>Downward<sp/>Northward<sp/>Wind<sp/>Stress&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Pa&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;surface_downward_northward_stress&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3960"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>area=area_id,<sp/>missing_value=cmor_missing_value)</highlight></codeline>
<codeline lineno="3961"><highlight class="normal"></highlight></codeline>
<codeline lineno="3962"><highlight class="normal"><sp/><sp/><sp/><sp/>id_hfss<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;hfss&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3963"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Surface<sp/>Upward<sp/>Sensible<sp/>Heat<sp/>Flux&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;W<sp/>m-2&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;surface_upward_sensible_heat_flux&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3964"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>area=area_id,<sp/>missing_value=cmor_missing_value)</highlight></codeline>
<codeline lineno="3965"><highlight class="normal"></highlight></codeline>
<codeline lineno="3966"><highlight class="normal"><sp/><sp/><sp/><sp/>id_hfls<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;hfls&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3967"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Surface<sp/>Upward<sp/>Latent<sp/>Heat<sp/>Flux&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;W<sp/>m-2&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;surface_upward_latent_heat_flux&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="3968"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>area=area_id,<sp/>missing_value=cmor_missing_value)</highlight></codeline>
<codeline lineno="3969"><highlight class="normal"></highlight></codeline>
<codeline lineno="3970"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_hfls<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_hfls,<sp/></highlight><highlight class="stringliteral">&apos;comment&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Lv*evap&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3971"><highlight class="normal"></highlight></codeline>
<codeline lineno="3972"><highlight class="normal"><sp/><sp/><sp/><sp/>id_evspsbl<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;evspsbl&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3973"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Evaporation&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;kg<sp/>m-2<sp/>s-1&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;water_evaporation_flux&apos;</highlight><highlight class="normal">,<sp/>area=area_id,<sp/>&amp;</highlight></codeline>
<codeline lineno="3974"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>missing_value=cmor_missing_value)</highlight></codeline>
<codeline lineno="3975"><highlight class="normal"></highlight></codeline>
<codeline lineno="3976"><highlight class="normal"><sp/><sp/><sp/><sp/>id_sftlf<sp/>=<sp/>fms_diag_register_static_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;sftlf&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3977"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Fraction<sp/>of<sp/>the<sp/>Grid<sp/>Cell<sp/>Occupied<sp/>by<sp/>Land&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;1.0&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;land_area_fraction&apos;</highlight><highlight class="normal">,<sp/>area=area_id,<sp/>&amp;</highlight></codeline>
<codeline lineno="3978"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>interp_method<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;conserve_order1&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3979"><highlight class="normal"></highlight></codeline>
<codeline lineno="3980"><highlight class="normal"><sp/><sp/><sp/><sp/>id_tslsi<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;tslsi&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3981"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Surface<sp/>Temperature<sp/>Where<sp/>Land<sp/>or<sp/>Sea<sp/>Ice&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;K&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;surface_temperature&apos;</highlight><highlight class="normal">,<sp/>area=area_id,<sp/>&amp;</highlight></codeline>
<codeline lineno="3982"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mask_variant=.true.,<sp/>missing_value=cmor_missing_value)</highlight></codeline>
<codeline lineno="3983"><highlight class="normal"></highlight></codeline>
<codeline lineno="3984"><highlight class="normal"><sp/><sp/><sp/><sp/>id_tos<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;tos&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3985"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Sea<sp/>Surface<sp/>Temperature&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;K&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;sea_surface_temperature&apos;</highlight><highlight class="normal">,<sp/>area=area_id,<sp/>&amp;</highlight></codeline>
<codeline lineno="3986"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mask_variant=.true.,<sp/>missing_value=cmor_missing_value)</highlight></codeline>
<codeline lineno="3987"><highlight class="normal"></highlight></codeline>
<codeline lineno="3988"><highlight class="normal"><sp/><sp/><sp/><sp/>id_sic<sp/>=<sp/>fms_diag_register_diag_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;sic&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>time,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="3989"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Sea<sp/>Ice<sp/>Area<sp/>Fraction&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;1.0&apos;</highlight><highlight class="normal">,<sp/>standard_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;sea_ice_area_fraction&apos;</highlight><highlight class="normal">,<sp/>area=area_id,<sp/>&amp;</highlight></codeline>
<codeline lineno="3990"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>missing_value=cmor_missing_value)</highlight></codeline>
<codeline lineno="3991"><highlight class="normal"></highlight></codeline>
<codeline lineno="3992"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_sic<sp/>&gt;<sp/>0<sp/>)<sp/>&amp;</highlight></codeline>
<codeline lineno="3993"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_sic,<sp/></highlight><highlight class="stringliteral">&apos;comment&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;averaged<sp/>over<sp/>the<sp/>ocean<sp/>portion<sp/>of<sp/>grid<sp/>box&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3994"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight></codeline>
<codeline lineno="3995"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/>id_tas<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;tas&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="3996"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Near-Surface<sp/>Air<sp/>Temperature&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;K&apos;</highlight><highlight class="normal"><sp/>,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;air_temperature&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3997"><highlight class="normal"></highlight></codeline>
<codeline lineno="3998"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_tas<sp/>&gt;<sp/>0<sp/>.and.<sp/>id_height2m<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_tas,<sp/></highlight><highlight class="stringliteral">&apos;coordinates&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;height2m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="3999"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="4000"><highlight class="normal"><sp/><sp/><sp/><sp/>id_uas<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;uas&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4001"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Eastward<sp/>Near-Surface<sp/>Wind&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m<sp/>s-1&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;eastward_wind&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4002"><highlight class="normal"></highlight></codeline>
<codeline lineno="4003"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_uas<sp/>&gt;<sp/>0<sp/>.and.<sp/>id_height10m<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_uas,<sp/></highlight><highlight class="stringliteral">&apos;coordinates&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;height10m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4004"><highlight class="normal"></highlight></codeline>
<codeline lineno="4005"><highlight class="normal"><sp/><sp/><sp/><sp/>id_vas<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;vas&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4006"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Northward<sp/>Near-Surface<sp/>Wind&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m<sp/>s-1&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;northward_wind&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4007"><highlight class="normal"></highlight></codeline>
<codeline lineno="4008"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_vas<sp/>&gt;<sp/>0<sp/>.and.<sp/>id_height10m<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_vas,<sp/></highlight><highlight class="stringliteral">&apos;coordinates&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;height10m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4009"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="4010"><highlight class="normal"><sp/><sp/><sp/><sp/>id_sfcwind<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;sfcWind&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Near-Surface<sp/>Wind<sp/>Speed&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;m<sp/>s-1&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;wind_speed&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4012"><highlight class="normal"></highlight></codeline>
<codeline lineno="4013"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_sfcwind<sp/>&gt;<sp/>0<sp/>.and.<sp/>id_height10m<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_sfcwind,<sp/></highlight><highlight class="stringliteral">&apos;coordinates&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;height10m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4014"><highlight class="normal"></highlight></codeline>
<codeline lineno="4015"><highlight class="normal"><sp/><sp/><sp/><sp/>id_huss<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;huss&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4016"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Near-Surface<sp/>Specific<sp/>Humidity&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;1.0&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;specific_humidity&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4017"><highlight class="normal"></highlight></codeline>
<codeline lineno="4018"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_huss<sp/>&gt;<sp/>0<sp/>.and.<sp/>id_height2m<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_huss,<sp/></highlight><highlight class="stringliteral">&apos;coordinates&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;height2m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4019"><highlight class="normal"></highlight></codeline>
<codeline lineno="4020"><highlight class="normal"><sp/><sp/><sp/><sp/>id_hurs<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;hurs&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4021"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Near-Surface<sp/>Relative<sp/>Humidity&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;%&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;relative_humidity&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4022"><highlight class="normal"></highlight></codeline>
<codeline lineno="4023"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_hurs<sp/>&gt;<sp/>0<sp/>.and.<sp/>id_height2m<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_hurs,<sp/></highlight><highlight class="stringliteral">&apos;coordinates&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;height2m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4024"><highlight class="normal"></highlight></codeline>
<codeline lineno="4025"><highlight class="normal"><sp/><sp/><sp/><sp/>id_rhs<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;rhs&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4026"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Near-Surface<sp/>Relative<sp/>Humidity&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;%&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;relative_humidity&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4027"><highlight class="normal"></highlight></codeline>
<codeline lineno="4028"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_rhs<sp/>&gt;<sp/>0<sp/>.and.<sp/>id_height2m<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_rhs,<sp/></highlight><highlight class="stringliteral">&apos;coordinates&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;height2m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4029"><highlight class="normal"></highlight></codeline>
<codeline lineno="4030"><highlight class="normal"><sp/><sp/><sp/><sp/>id_ts<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;ts&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4031"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Surface<sp/>Temperature&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;K&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;surface_temperature&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4032"><highlight class="normal"></highlight></codeline>
<codeline lineno="4033"><highlight class="normal"><sp/><sp/><sp/><sp/>id_psl<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;psl&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4034"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Sea<sp/>Level<sp/>Pressure&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Pa&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;air_pressure_at_sea_level&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4035"><highlight class="normal"></highlight></codeline>
<codeline lineno="4036"><highlight class="normal"><sp/><sp/><sp/><sp/>id_tauu<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;tauu&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4037"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Surface<sp/>Downward<sp/>Eastward<sp/>Wind<sp/>Stress&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Pa&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;surface_downward_eastward_stress&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4038"><highlight class="normal"></highlight></codeline>
<codeline lineno="4039"><highlight class="normal"><sp/><sp/><sp/><sp/>id_tauv<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;tauv&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4040"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Surface<sp/>Downward<sp/>Northward<sp/>Wind<sp/>Stress&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Pa&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;surface_downward_northward_stress&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4041"><highlight class="normal"></highlight></codeline>
<codeline lineno="4042"><highlight class="normal"><sp/><sp/><sp/><sp/>id_hfss<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;hfss&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4043"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Surface<sp/>Upward<sp/>Sensible<sp/>Heat<sp/>Flux&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;W<sp/>m-2&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;surface_upward_sensible_heat_flux&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4044"><highlight class="normal"></highlight></codeline>
<codeline lineno="4045"><highlight class="normal"><sp/><sp/><sp/><sp/>id_hfls<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;hfls&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4046"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Surface<sp/>Upward<sp/>Latent<sp/>Heat<sp/>Flux&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;W<sp/>m-2&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;surface_upward_latent_heat_flux&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4047"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_hfls<sp/>&gt;<sp/>0<sp/>)<sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(<sp/>id_hfls,<sp/></highlight><highlight class="stringliteral">&apos;comment&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Lv*evap&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4048"><highlight class="normal"></highlight></codeline>
<codeline lineno="4049"><highlight class="normal"><sp/><sp/><sp/><sp/>id_evspsbl<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;evspsbl&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4050"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Evaporation&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;kg<sp/>m-2<sp/>s-1&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;water_evaporation_flux&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4051"><highlight class="normal"></highlight></codeline>
<codeline lineno="4052"><highlight class="normal"><sp/><sp/><sp/><sp/>id_sftlf<sp/>=<sp/>fms_diag_register_static_field(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;sftlf&apos;</highlight><highlight class="normal">,<sp/>atmos_axes,<sp/>&amp;</highlight></codeline>
<codeline lineno="4053"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Fraction<sp/>of<sp/>the<sp/>Grid<sp/>Cell<sp/>Occupied<sp/>by<sp/>Land&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;1.0&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;land_area_fraction&apos;</highlight><highlight class="normal">,<sp/>&amp;</highlight></codeline>
<codeline lineno="4054"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>area=area_id,<sp/>interp_method=</highlight><highlight class="stringliteral">&apos;conserve_order1&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4055"><highlight class="normal"></highlight></codeline>
<codeline lineno="4056"><highlight class="normal"><sp/><sp/><sp/><sp/>id_tslsi<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;tslsi&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4057"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Surface<sp/>Temperature<sp/>Where<sp/>Land<sp/>or<sp/>Sea<sp/>Ice&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;K&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;surface_temperature&apos;</highlight><highlight class="normal">,<sp/>mask_variant=.true.)</highlight></codeline>
<codeline lineno="4058"><highlight class="normal"></highlight></codeline>
<codeline lineno="4059"><highlight class="normal"></highlight></codeline>
<codeline lineno="4060"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>tos,sic<sp/>are<sp/>ocean,seaIce<sp/>fields<sp/>on<sp/>the<sp/>atmos<sp/>grid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4061"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!<sp/>useful<sp/>for<sp/>amip-type<sp/>runs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4062"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="4063"><highlight class="normal"><sp/><sp/><sp/><sp/>id_tos<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;tos&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4064"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Sea<sp/>Surface<sp/>Temperature&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;K&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;sea_surface_temperature&apos;</highlight><highlight class="normal">,<sp/>mask_variant=.true.)</highlight></codeline>
<codeline lineno="4065"><highlight class="normal"></highlight></codeline>
<codeline lineno="4066"><highlight class="normal"><sp/><sp/><sp/><sp/>id_sic<sp/>=<sp/>register_cmip_diag_field_2d(mod_name,<sp/></highlight><highlight class="stringliteral">&apos;sic&apos;</highlight><highlight class="normal">,<sp/>time,<sp/><sp/>&amp;</highlight></codeline>
<codeline lineno="4067"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Sea<sp/>Ice<sp/>Area<sp/>Fraction&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;1.0&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;sea_ice_area_fraction&apos;</highlight><highlight class="normal"><sp/>)</highlight></codeline>
<codeline lineno="4068"><highlight class="normal"></highlight></codeline>
<codeline lineno="4069"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_sic<sp/>&gt;<sp/>0<sp/>)<sp/>&amp;</highlight></codeline>
<codeline lineno="4070"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(id_sic,<sp/></highlight><highlight class="stringliteral">&apos;comment&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;averaged<sp/>over<sp/>the<sp/>ocean<sp/>portion<sp/>of<sp/>grid<sp/>box&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4071"><highlight class="normal"></highlight></codeline>
<codeline lineno="4072"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">!-----<sp/>initialize<sp/>global<sp/>integrals<sp/>for<sp/>netCDF<sp/>output<sp/>-----</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4073"><highlight class="normal"><sp/><sp/><sp/><sp/>id_evspsbl_g<sp/>=<sp/>register_global_diag_field(&amp;</highlight></codeline>
<codeline lineno="4074"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;evspsbl&apos;</highlight><highlight class="normal">,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;Evaporation&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;mm<sp/>d-1&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;water_evaporation_flux&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4075"><highlight class="normal"></highlight></codeline>
<codeline lineno="4076"><highlight class="normal"><sp/><sp/><sp/><sp/>id_ts_g<sp/>=<sp/>register_global_diag_field(&amp;</highlight></codeline>
<codeline lineno="4077"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;ts&apos;</highlight><highlight class="normal">,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;Surface<sp/>Temperature&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;K&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;surface_temperature&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4078"><highlight class="normal"></highlight></codeline>
<codeline lineno="4079"><highlight class="normal"><sp/><sp/><sp/><sp/>id_tas_g<sp/>=<sp/>register_global_diag_field(&amp;</highlight></codeline>
<codeline lineno="4080"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tas&apos;</highlight><highlight class="normal">,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;Near-Surface<sp/>Air<sp/>Temperature&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;K&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;air_temperature&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4081"><highlight class="normal"></highlight></codeline>
<codeline lineno="4082"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_tas_g<sp/>&gt;<sp/>0<sp/>.and.<sp/>id_height2m<sp/>&gt;<sp/>0)<sp/>&amp;</highlight></codeline>
<codeline lineno="4083"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(get_global_diag_field_id(id_tas_g),<sp/></highlight><highlight class="stringliteral">&apos;coordinates&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;height2m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4084"><highlight class="normal"></highlight></codeline>
<codeline lineno="4085"><highlight class="normal"><sp/><sp/><sp/><sp/>id_tasl_g<sp/>=<sp/>register_global_diag_field(&amp;</highlight></codeline>
<codeline lineno="4086"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tasl&apos;</highlight><highlight class="normal">,<sp/>time,<sp/></highlight><highlight class="stringliteral">&apos;Near-Surface<sp/>Air<sp/>Temperature<sp/>(Land<sp/>Only)&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;K&apos;</highlight><highlight class="normal"><sp/>,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;air_temperature&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4087"><highlight class="normal"></highlight></codeline>
<codeline lineno="4088"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>defined(_USE_LEGACY_LAND_)<sp/>||<sp/>defined(use_AM3_physics)</highlight></codeline>
<codeline lineno="4089"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_tasl_g&gt;0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4090"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_mpp_error(warning,<sp/></highlight><highlight class="stringliteral">&quot;diag_field_init:<sp/>field<sp/>tasl<sp/>is<sp/>registered,<sp/>but<sp/>macro<sp/>&quot;</highlight><highlight class="normal">//<sp/>&amp;</highlight></codeline>
<codeline lineno="4091"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;_USE_LEGACY_LAND_<sp/>or<sp/>use_AM3_physics<sp/>is<sp/>defined,<sp/>no<sp/>data<sp/>will<sp/>be<sp/>written<sp/>out&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4092"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4093"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="4094"><highlight class="preprocessor"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_tasl_g<sp/>&gt;<sp/>0<sp/>.and.<sp/>id_height2m<sp/>&gt;<sp/>0)<sp/>&amp;</highlight></codeline>
<codeline lineno="4095"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(get_global_diag_field_id(id_tasl_g),<sp/></highlight><highlight class="stringliteral">&apos;coordinates&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;height2m&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4096"><highlight class="normal"></highlight></codeline>
<codeline lineno="4097"><highlight class="normal"><sp/><sp/><sp/><sp/>id_hfss_g<sp/>=<sp/>register_global_diag_field(</highlight><highlight class="stringliteral">&apos;hfss&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4098"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Surface<sp/>Upward<sp/>Sensible<sp/>Heat<sp/>Flux&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;W<sp/>m-2&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;surface_upward_sensible_heat_flux&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4099"><highlight class="normal"></highlight></codeline>
<codeline lineno="4100"><highlight class="normal"><sp/><sp/><sp/><sp/>id_hfls_g<sp/>=<sp/>register_global_diag_field(</highlight><highlight class="stringliteral">&apos;hfls&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Surface<sp/>Upward<sp/>Latent<sp/>Heat<sp/>Flux&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;W<sp/>m-2&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;surface_upward_latent_heat_flux&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4102"><highlight class="normal"></highlight></codeline>
<codeline lineno="4103"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>id_hfls_g<sp/>&gt;<sp/>0<sp/>)<sp/>&amp;</highlight></codeline>
<codeline lineno="4104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_diag_field_add_attribute(get_global_diag_field_id(id_hfls_g),<sp/></highlight><highlight class="stringliteral">&apos;comment&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Lv*evap&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4105"><highlight class="normal"></highlight></codeline>
<codeline lineno="4106"><highlight class="normal"><sp/><sp/><sp/><sp/>id_rls_g<sp/>=<sp/>register_global_diag_field(</highlight><highlight class="stringliteral">&apos;rls&apos;</highlight><highlight class="normal">,<sp/>time,<sp/>&amp;</highlight></codeline>
<codeline lineno="4107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Net<sp/>Longwave<sp/>Surface<sp/>Radiation&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;W<sp/>m-2&apos;</highlight><highlight class="normal">,<sp/>standard_name=</highlight><highlight class="stringliteral">&apos;surface_net_longwave_flux&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="4108"><highlight class="normal"></highlight></codeline>
<codeline lineno="4109"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
<codeline lineno="4110"><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4111"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ac8a26116481dffeb2f5f2ac6444c64f5" kindref="member">diag_field_init</ref></highlight></codeline>
<codeline lineno="4112"><highlight class="normal"></highlight></codeline>
<codeline lineno="4113"><highlight class="normal"></highlight></codeline>
<codeline lineno="4115"><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6dbcba7c48b5f085de6b33e9f05d6868" kindref="member">divide_by_area</ref>(data,<sp/>area)</highlight></codeline>
<codeline lineno="4116"><highlight class="normal"></highlight></codeline>
<codeline lineno="4117"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">implicit<sp/>none</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4118"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(inout)</highlight><highlight class="normal"><sp/>::<sp/>data(:,:)</highlight></codeline>
<codeline lineno="4119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>area(:,:)</highlight></codeline>
<codeline lineno="4120"><highlight class="normal"></highlight></codeline>
<codeline lineno="4122"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(</highlight><highlight class="keyword">size</highlight><highlight class="normal">(</highlight><highlight class="keyword">data</highlight><highlight class="normal">,<sp/>dim=1)<sp/>/=<sp/></highlight><highlight class="keyword">size</highlight><highlight class="normal">(area,<sp/>dim=1)<sp/>.or.<sp/></highlight><highlight class="keyword">size</highlight><highlight class="normal">(</highlight><highlight class="keyword">data</highlight><highlight class="normal">,<sp/>dim=2)<sp/>/=<sp/></highlight><highlight class="keyword">size</highlight><highlight class="normal">(area,<sp/>dim=2))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4123"><highlight class="normal"></highlight></codeline>
<codeline lineno="4125"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">where</highlight><highlight class="normal">(area<sp/>/=<sp/>0.0)</highlight></codeline>
<codeline lineno="4126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">data</highlight><highlight class="normal"><sp/>=<sp/></highlight><highlight class="keyword">data</highlight><highlight class="normal"><sp/>/<sp/>area</highlight></codeline>
<codeline lineno="4127"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>end<sp/>where</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4128"><highlight class="normal"></highlight></codeline>
<codeline lineno="4129"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1a6dbcba7c48b5f085de6b33e9f05d6868" kindref="member">divide_by_area</ref></highlight></codeline>
<codeline lineno="4130"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="4132"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!<sp/>This<sp/>was<sp/>called<sp/>inside<sp/>flux_ocean_to_ice.<sp/>Why?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4133"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af00a10abb94ffaa2f305e00de92362bc" kindref="member">send_ice_mask_sic</ref>(Time)</highlight></codeline>
<codeline lineno="4134"><highlight class="normal"></highlight></codeline>
<codeline lineno="4135"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">implicit<sp/>none</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4136"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(FmsTime_type),<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/><sp/>::<sp/>Time</highlight></codeline>
<codeline lineno="4137"><highlight class="normal"></highlight></codeline>
<codeline lineno="4138"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(nxc_ice,<sp/>nyc_ice,<sp/>nk_ice)</highlight><highlight class="normal"><sp/>::<sp/>ice_frac</highlight></codeline>
<codeline lineno="4139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(n_xgrid_sfc)</highlight><highlight class="normal"><sp/>::<sp/>ex_ice_frac</highlight></codeline>
<codeline lineno="4140"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">dimension(ni_atm,<sp/>nj_atm)</highlight><highlight class="normal"><sp/>::<sp/>diag_atm,<sp/>ocean_frac</highlight></codeline>
<codeline lineno="4141"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">logical</highlight><highlight class="normal"><sp/>::<sp/>used</highlight></codeline>
<codeline lineno="4142"><highlight class="normal"></highlight></codeline>
<codeline lineno="4143"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_ice_mask<sp/>&gt;<sp/>0<sp/>.or.<sp/>id_sic<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4144"><highlight class="normal"></highlight></codeline>
<codeline lineno="4146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ice_frac<sp/>=<sp/>1.</highlight></codeline>
<codeline lineno="4147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ice_frac(:,:,1)<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="4148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_ice_frac<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="4149"><highlight class="normal"></highlight></codeline>
<codeline lineno="4151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(ice_frac,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_ice_frac,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="4152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(diag_atm,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_ice_frac,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="4153"><highlight class="normal"></highlight></codeline>
<codeline lineno="4155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_ice_mask<sp/>&gt;<sp/>0)<sp/>used<sp/>=<sp/>fms_diag_send_data(id_ice_mask,<sp/>diag_atm,<sp/>time)</highlight></codeline>
<codeline lineno="4156"><highlight class="normal"></highlight></codeline>
<codeline lineno="4159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(id_sic<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ice_frac<sp/>=<sp/>1.</highlight></codeline>
<codeline lineno="4161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ex_ice_frac<sp/>=<sp/>0.</highlight></codeline>
<codeline lineno="4162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_put_to_xgrid(ice_frac,<sp/></highlight><highlight class="stringliteral">&apos;OCN&apos;</highlight><highlight class="normal">,<sp/>ex_ice_frac,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="4163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_get_from_xgrid(ocean_frac,<sp/></highlight><highlight class="stringliteral">&apos;ATM&apos;</highlight><highlight class="normal">,<sp/>ex_ice_frac,<sp/>xmap_sfc)</highlight></codeline>
<codeline lineno="4164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">where</highlight><highlight class="normal"><sp/>(ocean_frac<sp/>&gt;<sp/>0.0)</highlight></codeline>
<codeline lineno="4165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>diag_atm<sp/>=<sp/>min(1.,<sp/>diag_atm/ocean_frac)<sp/></highlight><highlight class="comment">!<sp/>CMIP6<sp/>as<sp/>fraction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean_frac<sp/>=<sp/>1.0</highlight></codeline>
<codeline lineno="4167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elsewhere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>diag_atm<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="4169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ocean_frac<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="4170"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endwhere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>used<sp/>=<sp/>fms_diag_send_data(id_sic,<sp/>diag_atm,<sp/>time,<sp/>rmask=ocean_frac)</highlight></codeline>
<codeline lineno="4172"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4173"><highlight class="normal"></highlight><highlight class="keywordflow"><sp/><sp/><sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4174"><highlight class="normal"></highlight></codeline>
<codeline lineno="4175"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1af00a10abb94ffaa2f305e00de92362bc" kindref="member">send_ice_mask_sic</ref></highlight></codeline>
<codeline lineno="4176"><highlight class="normal"></highlight></codeline>
<codeline lineno="4177"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">!#######################################################################</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4178"><highlight class="normal"></highlight></codeline>
<codeline lineno="4180"><highlight class="keyword"><sp/><sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ad11a70fa9758ae36a312504e589b3c1a" kindref="member">atm_stock_integrate</ref>(Atm,<sp/>res)</highlight></codeline>
<codeline lineno="4181"><highlight class="normal"></highlight></codeline>
<codeline lineno="4182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">implicit<sp/>none</highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="4183"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">type</highlight><highlight class="normal">(atmos_data_type),<sp/></highlight><highlight class="keywordtype">intent(in)</highlight><highlight class="normal"><sp/>::<sp/>Atm</highlight></codeline>
<codeline lineno="4184"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">real</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">intent(out)</highlight><highlight class="normal"><sp/>::<sp/>res</highlight></codeline>
<codeline lineno="4185"><highlight class="normal"></highlight></codeline>
<codeline lineno="4186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">integer</highlight><highlight class="normal"><sp/>::<sp/>ier</highlight></codeline>
<codeline lineno="4187"><highlight class="normal"></highlight></codeline>
<codeline lineno="4188"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">call<sp/></highlight><highlight class="normal">fms_xgrid_stock_integrate_2d(atm%lprec<sp/>+<sp/>atm%fprec,<sp/>xmap=xmap_sfc,<sp/>delta_t=dt_atm,<sp/>&amp;</highlight></codeline>
<codeline lineno="4189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>radius=radius,<sp/>res=res,<sp/>ier=ier)</highlight></codeline>
<codeline lineno="4190"><highlight class="normal"></highlight></codeline>
<codeline lineno="4191"><highlight class="normal"></highlight><highlight class="keyword"><sp/><sp/>end<sp/>subroutine<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod_1ad11a70fa9758ae36a312504e589b3c1a" kindref="member">atm_stock_integrate</ref></highlight></codeline>
<codeline lineno="4192"><highlight class="normal"></highlight></codeline>
<codeline lineno="4193"><highlight class="normal"></highlight><highlight class="comment">!#########################################################################</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4194"><highlight class="normal"></highlight></codeline>
<codeline lineno="4195"><highlight class="normal"></highlight><highlight class="keyword">end<sp/>module<sp/></highlight><highlight class="normal"><ref refid="namespaceatm__land__ice__flux__exchange__mod" kindref="compound">atm_land_ice_flux_exchange_mod</ref></highlight></codeline>
<codeline lineno="4196"><highlight class="normal"></highlight></codeline>
<codeline lineno="4197"><highlight class="normal"></highlight><highlight class="preprocessor">#undef<sp/>FMS_DATA_OVERRIDE_</highlight></codeline>
<codeline lineno="4198"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#undef<sp/>FMS_XGRID_PUT_TO_XGRID_</highlight></codeline>
<codeline lineno="4199"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#undef<sp/>FMS_XGRID_STOCK_MOVE_</highlight></codeline>
<codeline lineno="4200"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#undef<sp/>FMS_XGRID_SET_FRAC_AREA_</highlight></codeline>
<codeline lineno="4201"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#undef<sp/>FMS_XGRID_GET_FROM_XGRID_</highlight></codeline>
<codeline lineno="4202"><highlight class="preprocessor"></highlight><highlight class="preprocessor">#undef<sp/>FMS_DIAG_REGISTER_FIELD_</highlight></codeline>
<highlight class="preprocessor"></highlight>    </programlisting>
    <location file="full/atm_land_ice_flux_exchange.F90"/>
  </compounddef>
</doxygen>
